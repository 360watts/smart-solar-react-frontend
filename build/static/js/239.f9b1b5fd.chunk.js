"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[239],{9550(e,t,s){s.d(t,{A:()=>n});var r=s(5043),a=s(579);const i=e=>{let{createdBy:t,createdAt:s,updatedBy:r,updatedAt:i,className:n="audit-trail"}=e;const o=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleString()}catch(t){return e}};return(0,a.jsxs)("div",{className:n,children:[(0,a.jsxs)("div",{className:"audit-row",children:[(0,a.jsx)("span",{className:"audit-label",children:"Created:"}),t?(0,a.jsxs)("span",{className:"audit-value",children:["by ",(0,a.jsx)("strong",{children:t})," on ",o(s)]}):(0,a.jsx)("span",{className:"audit-value",children:"System"})]}),r&&(0,a.jsxs)("div",{className:"audit-row",children:[(0,a.jsx)("span",{className:"audit-label",children:"Last Updated:"}),(0,a.jsxs)("span",{className:"audit-value",children:["by ",(0,a.jsx)("strong",{children:r})," on ",o(i)]})]})]})},n=r.memo(i)},4239(e,t,s){s.r(t),s.d(t,{default:()=>P});var r=s(2555),a=s(5043),i=s(5475),n=s(5560);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;const[s,r]=(0,a.useState)(null),i=(0,a.useCallback)(function(){for(var a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];s&&clearTimeout(s);const o=setTimeout(()=>{e(...i)},t);r(o)},[e,t,s]);return(0,a.useEffect)(()=>()=>{s&&clearTimeout(s)},[s]),i}var l=s(8421),c=s(9550),d=s(108),h=s(877),u=s(7734),p=s(2185),g=s(6026),m=s(6150),x=s(1327),f=s(3839),y=s(168),v=s(3243),b=s(9600),j=s(5239),_=s.n(j),w=s(579);const S=e=>{let{active:t,payload:s,label:r}=e;return t&&s&&s.length?(0,w.jsxs)("div",{style:{background:"rgba(255,255,255,0.97)",border:"1px solid #00a63e22",borderRadius:10,padding:"0.7em 1.1em",boxShadow:"0 4px 16px #00a63e11",fontSize:13,minWidth:120},children:[(0,w.jsx)("div",{style:{fontWeight:700,color:"#00a63e",marginBottom:2},children:r}),s.map(e=>(0,w.jsxs)("div",{style:{color:e.color,fontWeight:600,margin:"2px 0"},children:[e.name,": ",(0,w.jsxs)("span",{style:{fontFamily:"JetBrains Mono, monospace"},children:[e.value," kW"]})]},e.dataKey))]}):null};function k(e,t){try{const s=new Date(e);return"24h"===t?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"7d"===t?s.toLocaleDateString([],{weekday:"short"})+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.toLocaleDateString([],{month:"short",day:"numeric"})}catch(s){return e}}const N={background:"rgba(255,255,255,0.97)",border:"1px solid rgba(0,166,62,0.15)",borderRadius:10,color:"#0a0a0a",boxShadow:"0 8px 24px rgba(0,0,0,0.1)",fontSize:12},A=()=>(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#F07522",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,w.jsx)("circle",{cx:"12",cy:"12",r:"5",fill:"#FFD600",stroke:"#F07522",strokeWidth:"1.5"}),(0,w.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),(0,w.jsx)("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),(0,w.jsx)("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),(0,w.jsx)("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),(0,w.jsx)("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),(0,w.jsx)("line",{x1:"21",y1:"12",x2:"23",y2:"12"})]}),C=()=>(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,w.jsx)("rect",{x:"1",y:"6",width:"18",height:"12",rx:"2"}),(0,w.jsx)("line",{x1:"23",y1:"13",x2:"23",y2:"11"}),(0,w.jsx)("rect",{x:"3",y:"8",width:"10",height:"8",fill:"currentColor",rx:"1"})]}),D=()=>(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,w.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),(0,w.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]}),T=()=>(0,w.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,w.jsx)("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),z=()=>(0,w.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,w.jsx)("path",{d:"M18 10h-1.26A8 8 0 109 20h9a5 5 0 000-10z"})}),L=e=>{let{label:t,value:s,unit:r,sub:a,accent:i,icon:n}=e;return(0,w.jsxs)("div",{className:"card",style:{padding:"1.1rem",flex:1,minWidth:130},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.4rem"},children:[(0,w.jsx)("span",{style:{fontSize:"0.7rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:t}),(0,w.jsx)("span",{style:{width:28,height:28,borderRadius:"50%",background:"".concat(i,"18"),display:"flex",alignItems:"center",justifyContent:"center",color:i,flexShrink:0},children:n})]}),(0,w.jsxs)("p",{style:{margin:0,fontFamily:"JetBrains Mono, monospace",fontSize:"1.55rem",fontWeight:800,color:"#0a0a0a",lineHeight:1},children:[s,r&&(0,w.jsx)("span",{style:{fontSize:"0.8rem",fontWeight:500,color:"#9ca3af",marginLeft:4},children:r})]}),a&&(0,w.jsx)("p",{style:{margin:"0.25rem 0 0",fontSize:"0.7rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:a})]})},F=e=>{var t,s,i,o,l;let{siteId:c,autoRefresh:j=!1}=e;const[F,P]=(0,a.useState)([]),[I,O]=(0,a.useState)([]),[E,W]=(0,a.useState)(null),[q,R]=(0,a.useState)(!0),[B,M]=(0,a.useState)(null),[J,U]=(0,a.useState)(null),[K,G]=(0,a.useState)({P10:!0,P50:!0,P90:!0}),[H,V]=(0,a.useState)("24h"),[Y,Z]=(0,a.useState)(""),[Q,X]=(0,a.useState)(""),$=(0,a.useCallback)(async()=>{try{let e={};e="custom"===H&&Y&&Q?{start_date:new Date(Y).toISOString(),end_date:new Date(Q).toISOString()}:"7d"===H?{days:7}:"30d"===H?{days:30}:{};let t={};if("custom"===H&&Y&&Q)t={start_date:new Date(Y).toISOString(),end_date:new Date(Q).toISOString()};else if("7d"===H){const e=new Date,s=new Date;s.setDate(e.getDate()-6),t={start_date:s.toISOString().split("T")[0]+"T00:00:00Z",end_date:e.toISOString().split("T")[0]+"T23:59:59Z"}}else if("30d"===H){const e=new Date,s=new Date;s.setDate(e.getDate()-29),t={start_date:s.toISOString().split("T")[0]+"T00:00:00Z",end_date:e.toISOString().split("T")[0]+"T23:59:59Z"}}else t={};const[s,r,a]=await Promise.all([n.K.getSiteTelemetry(c,e),n.K.getSiteForecast(c,t),n.K.getSiteWeather(c)]);console.log("[SiteDataPanel] Forecast API response:",r),console.log("[SiteDataPanel] Forecast count:",Array.isArray(r)?r.length:"not array"),Array.isArray(r)&&r.length>0&&console.log("[SiteDataPanel] First forecast item:",r[0]),P(Array.isArray(s)?s:[]),O(Array.isArray(r)?r:[]),W(a||null),U(new Date),M(null)}catch(e){M(e instanceof Error?e.message:"Failed to load site data")}finally{R(!1)}},[c,H,Y,Q]);(0,a.useEffect)(()=>{if(R(!0),$(),!j)return;const e=setInterval($,6e4);return()=>clearInterval(e)},[$,j]);const ee=F.length>0?F[F.length-1]:null,te=ee?((null!==(t=ee.pv1_power_w)&&void 0!==t?t:0)+(null!==(s=ee.pv2_power_w)&&void 0!==s?s:0))/1e3:null,se=null!==(i=null===ee||void 0===ee?void 0:ee.battery_soc_percent)&&void 0!==i?i:null,re=ee?(null!==(o=ee.load_power_w)&&void 0!==o?o:0)/1e3:null,ae=null!==(l=null===ee||void 0===ee?void 0:ee.pv_today_kwh)&&void 0!==l?l:null,ie=function(e,t){if(!e||0===e.length)return[];if("24h"===t)return e.filter((t,s)=>s%2===0||s===e.length-1);if("7d"===t){const t=new Map;return e.forEach(e=>{const s=new Date(e.timestamp),r="".concat(s.getFullYear(),"-").concat(s.getMonth(),"-").concat(s.getDate(),"-").concat(s.getHours());t.has(r)||t.set(r,[]),t.get(r).push(e)}),Array.from(t.values()).map(e=>{const t=e[0];return{timestamp:t.timestamp,pv1_power_w:e.reduce((e,t)=>{var s;return e+(null!==(s=t.pv1_power_w)&&void 0!==s?s:0)},0)/e.length,pv2_power_w:e.reduce((e,t)=>{var s;return e+(null!==(s=t.pv2_power_w)&&void 0!==s?s:0)},0)/e.length,load_power_w:e.reduce((e,t)=>{var s;return e+(null!==(s=t.load_power_w)&&void 0!==s?s:0)},0)/e.length,grid_power_w:e.reduce((e,t)=>{var s;return e+(null!==(s=t.grid_power_w)&&void 0!==s?s:0)},0)/e.length,battery_soc_percent:e.reduce((e,t)=>{var s;return e+(null!==(s=t.battery_soc_percent)&&void 0!==s?s:0)},0)/e.length,pv_today_kwh:t.pv_today_kwh}})}{const t=new Map;return e.forEach(e=>{const s=new Date(e.timestamp),r="".concat(s.getFullYear(),"-").concat(s.getMonth(),"-").concat(s.getDate());t.has(r)||t.set(r,[]),t.get(r).push(e)}),Array.from(t.values()).map(e=>({timestamp:e[0].timestamp,pv1_power_w:e.reduce((e,t)=>{var s;return e+(null!==(s=t.pv1_power_w)&&void 0!==s?s:0)},0)/e.length,pv2_power_w:e.reduce((e,t)=>{var s;return e+(null!==(s=t.pv2_power_w)&&void 0!==s?s:0)},0)/e.length,load_power_w:e.reduce((e,t)=>{var s;return e+(null!==(s=t.load_power_w)&&void 0!==s?s:0)},0)/e.length,grid_power_w:e.reduce((e,t)=>{var s;return e+(null!==(s=t.grid_power_w)&&void 0!==s?s:0)},0)/e.length,battery_soc_percent:e.reduce((e,t)=>{var s;return e+(null!==(s=t.battery_soc_percent)&&void 0!==s?s:0)},0)/e.length,pv_today_kwh:Math.max(...e.map(e=>{var t;return null!==(t=e.pv_today_kwh)&&void 0!==t?t:0}))}))}}(F,H).map(e=>{var t,s,r,a,i;return{time:k(e.timestamp,H),"PV (kW)":+(((null!==(t=e.pv1_power_w)&&void 0!==t?t:0)+(null!==(s=e.pv2_power_w)&&void 0!==s?s:0))/1e3).toFixed(2),"Load (kW)":+((null!==(r=e.load_power_w)&&void 0!==r?r:0)/1e3).toFixed(2),"Grid (kW)":+((null!==(a=e.grid_power_w)&&void 0!==a?a:0)/1e3).toFixed(2),"Batt SOC (%)":null!==(i=e.battery_soc_percent)&&void 0!==i?i:null}}),ne=I.map(e=>{let t="";if("7d"===H||"30d"===H||"custom"===H){const s=e.forecast_for||e.timestamp.replace("FORECAST#",""),r=new Date(s);t=r.toLocaleDateString([],{month:"short",day:"numeric"})+" "+r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}else t=function(e,t){const s=t||e.replace("FORECAST#","");try{return new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(r){return s}}(e.timestamp,e.forecast_for);return{time:t,p50:null!=e.p50_kw?+e.p50_kw.toFixed(3):null,p10:null!=e.p10_kw?+e.p10_kw.toFixed(3):null,p90:null!=e.p90_kw?+e.p90_kw.toFixed(3):null}});let oe=0,le=0,ce=0,de=null;if(I.length>1){const e=I[0];if(e.generated_at)de=new Date(e.generated_at);else if(e.timestamp){const t=e.timestamp.replace("FORECAST#","");de=new Date(t.split("T")[0]+"T00:00:00Z")}for(let t=0;t<I.length-1;t++){const e=new Date(I[t].timestamp.replace("FORECAST#","")).getTime(),s=new Date(I[t+1].timestamp.replace("FORECAST#","")).getTime(),r=Math.abs(s-e)/36e5;null!=I[t].p10_kw&&null!=I[t+1].p10_kw&&(oe+=(I[t].p10_kw+I[t+1].p10_kw)/2*r),null!=I[t].p50_kw&&null!=I[t+1].p50_kw&&(le+=(I[t].p50_kw+I[t+1].p50_kw)/2*r),null!=I[t].p90_kw&&null!=I[t+1].p90_kw&&(ce+=(I[t].p90_kw+I[t+1].p90_kw)/2*r)}}if(q)return(0,w.jsxs)("div",{style:{padding:"1.5rem 0"},children:[(0,w.jsx)("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem",flexWrap:"wrap"},children:[...Array(4)].map((e,t)=>(0,w.jsx)("div",{className:"card skeleton",style:{flex:1,minWidth:130,height:96}},t))}),(0,w.jsx)("div",{className:"card skeleton",style:{height:220,marginBottom:"1rem"}}),(0,w.jsx)("div",{className:"card skeleton",style:{height:200}})]});if(B)return(0,w.jsxs)("div",{style:{padding:"1.5rem",color:"#ef4444",fontSize:"0.85rem",background:"rgba(239,68,68,0.06)",borderRadius:10,marginTop:"1rem"},children:["Failed to load DynamoDB data for ",(0,w.jsx)("strong",{children:c}),": ",B]});const he=0===F.length&&0===I.length&&!E;return(0,w.jsxs)("div",{style:{marginTop:"1.5rem"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.75rem",gap:"1rem",flexWrap:"wrap"},children:[(0,w.jsxs)("p",{className:"dash-section-label",style:{margin:0},children:["Live Site Intelligence \u2014 ",(0,w.jsx)("span",{style:{fontFamily:"JetBrains Mono, monospace",color:"#00a63e"},children:c})]}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,w.jsxs)("select",{value:H,onChange:e=>V(e.target.value),style:{background:"var(--card-bg, #fff)",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.3rem 0.6rem",fontSize:"0.72rem",color:"var(--text-color, #0a0a0a)",cursor:"pointer",fontFamily:"Poppins, sans-serif",fontWeight:600},children:[(0,w.jsx)("option",{value:"24h",children:"Today"}),(0,w.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,w.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,w.jsx)("option",{value:"custom",children:"Custom range"})]}),"custom"===H&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("input",{type:"date",value:Y,onChange:e=>Z(e.target.value),style:{background:"var(--card-bg, #fff)",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.3rem 0.6rem",fontSize:"0.72rem",color:"var(--text-color, #0a0a0a)",fontFamily:"Poppins, sans-serif",fontWeight:600}}),(0,w.jsx)("span",{style:{color:"#9ca3af",fontSize:"0.7rem"},children:"to"}),(0,w.jsx)("input",{type:"date",value:Q,onChange:e=>X(e.target.value),style:{background:"var(--card-bg, #fff)",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.3rem 0.6rem",fontSize:"0.72rem",color:"var(--text-color, #0a0a0a)",fontFamily:"Poppins, sans-serif",fontWeight:600}})]})]}),J&&(0,w.jsxs)("span",{style:{fontSize:"0.7rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:["Updated ",J.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),(0,w.jsx)("button",{onClick:()=>{R(!0),$()},style:{background:"none",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.2rem 0.6rem",fontSize:"0.72rem",color:"#00a63e",cursor:"pointer",fontFamily:"Poppins, sans-serif",fontWeight:600},children:"\u21bb Refresh"})]})]}),he?(0,w.jsxs)("div",{style:{padding:"2rem",textAlign:"center",color:"#9ca3af",fontSize:"0.875rem",background:"rgba(0,166,62,0.03)",borderRadius:12,border:"1px dashed rgba(0,166,62,0.15)"},children:["No DynamoDB data found for site ",(0,w.jsx)("strong",{style:{color:"#00a63e"},children:c})," in the ","24h"===H?"today":"7d"===H?"last 7 days":"30d"===H?"last 30 days":"selected date range",".",(0,w.jsx)("br",{}),(0,w.jsx)("span",{style:{fontSize:"0.78rem"},children:"Data is written by the ML forecast scheduler when the device is actively posting telemetry."})]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap",marginBottom:"1rem"},children:[(0,w.jsx)(L,{label:"PV Power",value:null!=te?te.toFixed(2):"\u2014",unit:"kW",sub:"Current generation",accent:"#F07522",icon:(0,w.jsx)(A,{})}),(0,w.jsx)(L,{label:"Battery SOC",value:null!=se?se.toFixed(1):"\u2014",unit:"%",sub:"State of charge",accent:"#00a63e",icon:(0,w.jsx)(C,{})}),(0,w.jsx)(L,{label:"Load",value:null!=re?re.toFixed(2):"\u2014",unit:"kW",sub:"Current consumption",accent:"#8b5cf6",icon:(0,w.jsx)(D,{})}),(0,w.jsx)(L,{label:"Energy Today",value:null!=ae?ae.toFixed(2):"\u2014",unit:"kWh",sub:"Solar yield today",accent:"#10b981",icon:(0,w.jsx)(T,{})})]}),E&&(0,w.jsx)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"1rem"},children:[{label:"Temp",value:null!=E.temperature_c?"".concat(E.temperature_c.toFixed(1)," \xb0C"):null},{label:"Humidity",value:null!=E.humidity_pct?"".concat(E.humidity_pct," %"):null},{label:"Cloud",value:null!=E.cloud_cover_pct?"".concat(E.cloud_cover_pct," %"):null,icon:(0,w.jsx)(z,{})},{label:"Wind",value:null!=E.wind_speed_ms?"".concat(E.wind_speed_ms.toFixed(1)," m/s"):null},{label:"GHI",value:null!=E.ghi_wm2?"".concat(Math.round(E.ghi_wm2)," W/m\xb2"):null}].filter(e=>null!=e.value).map(e=>(0,w.jsxs)("span",{style:{fontSize:"0.72rem",fontWeight:600,fontFamily:"Poppins, sans-serif",padding:"0.2rem 0.65rem",borderRadius:99,background:"rgba(0,166,62,0.07)",border:"1px solid rgba(0,166,62,0.12)",color:"#007a55",display:"flex",alignItems:"center",gap:"0.3rem"},children:[e.icon,e.label,": ",(0,w.jsx)("span",{style:{fontFamily:"JetBrains Mono, monospace",color:"#0a0a0a"},children:e.value})]},e.label))}),ie.length>0&&(0,w.jsxs)("div",{className:"card",style:{padding:"1.25rem",marginBottom:"1rem"},children:[(0,w.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,w.jsxs)("h3",{style:{margin:"0 0 0.25rem",fontSize:"0.9rem",fontFamily:"Urbanist, sans-serif",color:"#0a0a0a"},children:["Power History \u2014 ","24h"===H?"Today":"7d"===H?"Last 7 days":"30d"===H?"Last 30 days":"custom"===H&&Y&&Q?"".concat(new Date(Y).toLocaleDateString()," - ").concat(new Date(Q).toLocaleDateString()):"Custom range"]}),("7d"===H||"30d"===H||"custom"===H)&&(0,w.jsx)("p",{style:{margin:0,fontSize:"0.7rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:"7d"===H?"Data aggregated by hour":"Data aggregated by day"})]}),(0,w.jsx)("div",{style:{height:220},children:(0,w.jsx)(d.u,{width:"100%",height:"100%",children:(0,w.jsxs)(h.Q,{data:ie,margin:{top:4,right:8,left:0,bottom:"7d"===H||"30d"===H?20:0},children:[(0,w.jsxs)("defs",{children:[(0,w.jsxs)("linearGradient",{id:"pvGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:"#F07522",stopOpacity:.22}),(0,w.jsx)("stop",{offset:"95%",stopColor:"#F07522",stopOpacity:0})]}),(0,w.jsxs)("linearGradient",{id:"loadGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.18}),(0,w.jsx)("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]})]}),(0,w.jsx)(u.d,{strokeDasharray:"3 3",stroke:"rgba(0,166,62,0.08)"}),(0,w.jsx)(p.W,{dataKey:"time",stroke:"#9ca3af",fontSize:"30d"===H?9:10,interval:"24h"===H?"preserveStartEnd":Math.ceil(ie.length/10),angle:"7d"===H||"30d"===H?-15:0,textAnchor:"7d"===H||"30d"===H?"end":"middle"}),(0,w.jsx)(g.h,{stroke:"#9ca3af",fontSize:10,tickFormatter:e=>"".concat(e,"kW")}),(0,w.jsx)(m.m,{contentStyle:N,formatter:(e,t)=>["".concat(e," ").concat(t.includes("%")?"%":"kW"),t]}),(0,w.jsx)(x.s,{iconType:"circle",iconSize:8,wrapperStyle:{fontSize:11,fontFamily:"Poppins, sans-serif"}}),(0,w.jsx)(f.G,{type:"monotone",dataKey:"PV (kW)",stroke:"#F07522",strokeWidth:2,fill:"url(#pvGrad)",dot:!1}),(0,w.jsx)(f.G,{type:"monotone",dataKey:"Load (kW)",stroke:"#8b5cf6",strokeWidth:2,fill:"url(#loadGrad)",dot:!1}),(0,w.jsx)(y.N,{type:"monotone",dataKey:"Grid (kW)",stroke:"#3b82f6",strokeWidth:1.5,dot:!1,strokeDasharray:"4 3"})]})})})]}),(0,w.jsxs)("div",{style:{padding:"0.5rem",background:"#ffe",border:"1px solid #cc0",marginBottom:"0.5rem",fontSize:"12px"},children:["DEBUG: forecast.length=",I.length,", forecastData.length=",ne.length,", telemetry.length=",F.length,", noData=",String(0===F.length&&0===I.length&&!E)]}),ne.length>0&&(0,w.jsxs)("div",{className:"card",style:{padding:"1.25rem",boxShadow:"0 4px 24px rgba(0,166,62,0.07)",border:"1px solid #e0f2ef",borderRadius:16,background:"linear-gradient(120deg, #f0fdfa 0%, #e0f7e9 100%)",position:"relative"},children:[(0,w.jsx)("button",{onClick:async()=>{const e=document.getElementById("forecast-chart-img");if(e){const t=await _()(e,{background:"transparent"}),s=document.createElement("a");s.download="solar-forecast-".concat((new Date).toISOString().slice(0,10),".png"),s.href=t.toDataURL(),s.click()}},style:{position:"absolute",top:12,right:16,background:"#00a63e",color:"#fff",border:"none",borderRadius:6,padding:"0.3em 0.9em",fontWeight:700,fontSize:13,cursor:"pointer",boxShadow:"0 2px 8px #00a63e22",zIndex:2},title:"Download chart as image",children:"\u2b07 Export"}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem",flexWrap:"wrap",gap:"1rem"},children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("h3",{style:{margin:"0 0 0.25rem",fontSize:"1.1rem",fontFamily:"Urbanist, sans-serif",color:"#00a63e",letterSpacing:"0.01em",fontWeight:800},children:[(0,w.jsx)("span",{style:{verticalAlign:"middle",marginRight:6,fontSize:"1.2em"},children:"\ud83d\udd06"})," Solar Forecast"]}),(0,w.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.7rem",alignItems:"center"},children:[le>0&&(0,w.jsxs)("span",{style:{fontSize:"0.8rem",color:"#00a63e",fontFamily:"JetBrains Mono, monospace",fontWeight:700,background:"#e0f7e9",borderRadius:8,padding:"0.18em 0.7em"},children:[oe.toFixed(2)," \u2013 ",le.toFixed(2)," \u2013 ",ce.toFixed(2)," kWh"]}),de&&(0,w.jsxs)("span",{style:{fontSize:"0.7rem",color:"#b0b0b0",fontFamily:"Poppins, sans-serif"},children:["Generated: ",de.toLocaleDateString()," ",de.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),(0,w.jsx)("div",{style:{display:"flex",gap:"0.4rem",alignItems:"center",flexWrap:"wrap"},children:[{label:"P10",color:"#fbbf24"},{label:"P50",color:"#00a63e"},{label:"P90",color:"#4ade80"}].map(e=>(0,w.jsxs)("label",{style:{fontSize:"0.7rem",fontWeight:600,color:e.color,display:"flex",alignItems:"center",gap:"0.25rem",fontFamily:"Poppins, sans-serif",cursor:"pointer"},children:[(0,w.jsx)("input",{type:"checkbox",checked:K[e.label],onChange:()=>G(t=>(0,r.A)((0,r.A)({},t),{},{[e.label]:!t[e.label]})),style:{accentColor:e.color,marginRight:3}}),(0,w.jsx)("span",{style:{width:8,height:8,borderRadius:"50%",background:e.color,display:"inline-block"}}),e.label]},e.label))})]}),(0,w.jsx)("div",{id:"forecast-chart-img",style:{height:260,borderRadius:12,overflow:"hidden",background:"linear-gradient(120deg, #f0fdfa 0%, #e0f7e9 100%)"},children:(0,w.jsx)(d.u,{width:"100%",height:"100%",children:(0,w.jsxs)(h.Q,{data:ne,margin:{top:4,right:8,left:0,bottom:24},children:[(0,w.jsxs)("defs",{children:[(0,w.jsxs)("linearGradient",{id:"p50Grad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:"#00a63e",stopOpacity:.25}),(0,w.jsx)("stop",{offset:"95%",stopColor:"#00a63e",stopOpacity:0})]}),(0,w.jsxs)("linearGradient",{id:"bgGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"0%",stopColor:"#e0f7e9",stopOpacity:.7}),(0,w.jsx)("stop",{offset:"100%",stopColor:"#f0fdfa",stopOpacity:.7})]})]}),(0,w.jsx)("rect",{x:0,y:0,width:"100%",height:"100%",fill:"url(#bgGrad)"}),(0,w.jsx)(u.d,{strokeDasharray:"3 3",stroke:"rgba(0,166,62,0.08)"}),(0,w.jsx)(p.W,{dataKey:"time",stroke:"#9ca3af",fontSize:10,interval:"24h"===H?"preserveStartEnd":Math.ceil(ne.length/10),angle:"7d"===H||"30d"===H||"custom"===H?-15:0,textAnchor:"7d"===H||"30d"===H||"custom"===H?"end":"middle"}),(0,w.jsx)(g.h,{stroke:"#9ca3af",fontSize:10,tickFormatter:e=>"".concat(e,"kW")}),(0,w.jsx)(m.m,{content:(0,w.jsx)(S,{}),animationDuration:350,cursor:{stroke:"#00a63e",strokeWidth:2,opacity:.18}}),(0,w.jsx)(x.s,{iconType:"circle",iconSize:10,wrapperStyle:{fontSize:12,fontFamily:"Poppins, sans-serif",bottom:0,left:0,padding:0},verticalAlign:"top",height:32}),K.P90&&(0,w.jsx)(f.G,{type:"monotone",dataKey:"p90",stroke:"#4ade80",strokeWidth:1,strokeDasharray:"4 3",fill:"rgba(74,222,128,0.08)",dot:!1,isAnimationActive:!0,name:"P90"}),K.P50&&(0,w.jsx)(f.G,{type:"monotone",dataKey:"p50",stroke:"#00a63e",strokeWidth:2,fill:"url(#p50Grad)",dot:!1,isAnimationActive:!0,name:"P50"}),K.P10&&(0,w.jsx)(f.G,{type:"monotone",dataKey:"p10",stroke:"#fbbf24",strokeWidth:1,strokeDasharray:"4 3",fill:"none",dot:!1,isAnimationActive:!0,name:"P10"}),(0,w.jsx)(v.e,{x:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),stroke:"#ef4444",strokeDasharray:"3 3",label:{value:"Now",position:"top",fill:"#ef4444",fontSize:11,fontWeight:700},ifOverflow:"extendDomain"}),(0,w.jsx)(b.v,{dataKey:"time",height:18,stroke:"#00a63e",fill:"#e0f7e9",travellerWidth:12,startIndex:0,endIndex:Math.min(23,ne.length-1)})]})})})]})]})]})},P=()=>{var e,t;const{isDark:s}=(0,l.D)(),[d]=(0,i.ok)(),[h,u]=(0,a.useState)([]),[p,g]=(0,a.useState)([]),[m,x]=(0,a.useState)(!0),[f,y]=(0,a.useState)(null),[v,b]=(0,a.useState)(null),[j,_]=(0,a.useState)(!1),[S,k]=(0,a.useState)(""),[N,A]=(0,a.useState)(""),[C,D]=(0,a.useState)([]),[T,z]=(0,a.useState)(!1),[L,P]=(0,a.useState)([]),[I,O]=(0,a.useState)(new Set),[E,W]=(0,a.useState)(!1),[q,R]=(0,a.useState)(1),[B,M]=(0,a.useState)(25),[J,U]=(0,a.useState)(0),[K,G]=(0,a.useState)(0),[H,V]=(0,a.useState)([]),[Y,Z]=(0,a.useState)(!0),[Q,X]=(0,a.useState)(null),[$,ee]=(0,a.useState)(null),[te,se]=(0,a.useState)([]),[re,ae]=(0,a.useState)(null),[ie,ne]=(0,a.useState)(null),[oe,le]=(0,a.useState)([]),[ce,de]=(0,a.useState)(!1),[he,ue]=(0,a.useState)({device_serial:"",user:"",config_version:""}),[pe,ge]=(0,a.useState)({device_serial:"",user:"",config_version:""}),[me,xe]=(0,a.useState)(null),[fe,ye]=(0,a.useState)(!1),[ve,be]=(0,a.useState)(!1),[je,_e]=(0,a.useState)({site_id:"",display_name:"",latitude:"",longitude:"",capacity_kw:"",tilt_deg:"18",azimuth_deg:"180",timezone:"Asia/Kolkata",is_active:!0}),[we,Se]=(0,a.useState)(!1),[ke,Ne]=(0,a.useState)(null),[Ae,Ce]=(0,a.useState)(null),De=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{x(!0);const s=await n.K.getDevices(t||void 0,e,B);s.results?(u(s.results),g(s.results),U(s.count),G(s.total_pages),R(s.current_page)):(u(Array.isArray(s)?s:[]),g(Array.isArray(s)?s:[]),U(Array.isArray(s)?s.length:0),G(1),R(1)),x(!1)}catch(s){y(s instanceof Error?s.message:"An error occurred"),x(!1)}},[B]),Te=(0,a.useCallback)(async e=>{de(!0);try{const t=await n.K.getDeviceLogs(e,50,0);le(t.logs||[])}catch(t){console.error("Failed to fetch device logs:",t),le([])}finally{de(!1)}},[]),ze=(0,a.useCallback)(e=>{if(ne(e),xe(null),ye(!0),le([]),e.config_version){const t=H.find(t=>t.config_id===e.config_version);Ce(t||null)}else Ce(null);Promise.all([n.K.getDeviceSite(e.id).then(e=>xe(e)).catch(t=>{console.error("Failed to fetch site for device",e.id,":",t),xe(null)}),Te(e.id)]).finally(()=>ye(!1))},[Te,H]);(0,a.useEffect)(()=>{(async()=>{try{const e=(await n.K.getUsers()).filter(e=>!e.is_staff&&!e.is_superuser);P(e)}catch(e){console.error("Failed to fetch users:",e),y("Failed to load users for device assignment")}})(),(async()=>{try{const e=await n.K.getPresets();V(Array.isArray(e)?e:[])}catch(e){console.error("Failed to fetch presets:",e)}finally{Z(!1)}})(),(async()=>{try{const[e,t]=await Promise.all([n.K.getSystemHealth(),n.K.getTelemetry()]);X(e||null);const s=Array.isArray(t)?t:[];se(s);const r=s.reduce((e,t)=>{if(null===t||void 0===t||!t.timestamp)return e;const s=new Date(t.timestamp);return Number.isNaN(s.getTime())?e:e?s>new Date(e)?t.timestamp:e:t.timestamp},null),a=new Set(s.map(e=>e.deviceId)).size;ee({totalPoints:s.length,deviceCount:a,latestTimestamp:r})}catch(e){console.error("Failed to fetch dashboard data:",e),ae("Failed to load device dashboards")}})()},[]),(0,a.useEffect)(()=>{const e=d.get("deviceId");if(e){const t=parseInt(e,10);if(!isNaN(t)){const e=h.find(e=>e.id===t);e&&ze(e)}}},[d,h,ze]),(0,a.useEffect)(()=>{De(q,S)},[q,S,B,De]),(0,a.useEffect)(()=>{const e=()=>{z(!1)};return T&&document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[T]),(0,a.useEffect)(()=>{if(""===N.trim())D(L);else{const e=N.toLowerCase(),t=L.filter(t=>{const s="".concat(t.first_name," ").concat(t.last_name).toLowerCase();return t.username.toLowerCase().includes(e)||t.first_name.toLowerCase().includes(e)||t.last_name.toLowerCase().includes(e)||s.includes(e)||t.email.toLowerCase().includes(e)});D(t)}},[L,N]);const Le=o(e=>{},300),Fe=e=>{var t,s;b(e),ue({device_serial:e.device_serial,user:e.user||"",config_version:e.config_version||""}),A(e.user?"".concat(null===(t=L.find(t=>t.username===e.user))||void 0===t?void 0:t.first_name," ").concat(null===(s=L.find(t=>t.username===e.user))||void 0===s?void 0:s.last_name," (").concat(e.user,")"):""),z(!1)},Pe=async()=>{if(v)try{await n.K.updateDevice(v.id,he),b(null),await De(q,S)}catch(e){y(e instanceof Error?e.message:"Failed to update device")}},Ie=async()=>{try{await n.K.createDevice(pe),_(!1),ge({device_serial:"",user:"",config_version:""}),await De(q,S)}catch(e){y(e instanceof Error?e.message:"Failed to create device")}},Oe=()=>{b(null),_(!1),A(""),z(!1)},Ee=()=>{ne(null),xe(null),be(!1)};if(m)return(0,w.jsx)("div",{className:"loading",children:"Loading devices..."});if(f)return(0,w.jsxs)("div",{className:"error",children:["Error: ",f]});const We=e=>{var t,s;return(null===(t=e.gateway_configuration)||void 0===t||null===(s=t.general_settings)||void 0===s?void 0:s.config_id)||e.config_id||""};if(ie){var qe,Re;const e=te.filter(e=>e.deviceId===ie.device_serial),t=e.reduce((e,t)=>{if(null===t||void 0===t||!t.timestamp)return e;const s=new Date(t.timestamp);if(Number.isNaN(s.getTime()))return e;if(!e)return t.timestamp;return s>new Date(e)?t.timestamp:e},null);return(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[(0,w.jsx)("button",{onClick:Ee,className:"btn btn-secondary",style:{marginRight:"15px"},children:"\u2190 Back to Devices"}),(0,w.jsxs)("h1",{style:{margin:0},children:[ie.device_serial," Dashboard"]})]}),(0,w.jsxs)("div",{className:"card",style:{marginBottom:"20px"},children:[(0,w.jsxs)("div",{className:"card-header",children:[(0,w.jsx)("h2",{children:"Device Details"}),(0,w.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,w.jsx)("button",{onClick:()=>Fe(ie),className:"btn",children:"Edit Device"}),(0,w.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to reboot device ".concat(e.device_serial,"? The device will restart on its next heartbeat.")))try{await n.K.rebootDevice(e.id),alert("Reboot command queued for ".concat(e.device_serial,". Device will reboot on next heartbeat."))}catch(t){console.error("Reboot error:",t),y(t instanceof Error?t.message:"Failed to queue reboot command")}})(ie),className:"btn",style:{backgroundColor:"#f59e0b",color:"white",border:"none"},title:"Queue reboot command for device",children:"\ud83d\udd04 Reboot"}),(0,w.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\u26a0\ufe0f WARNING: Hard reset will erase device configuration and restart it.\n\nAre you sure you want to hard reset device ".concat(e.device_serial,"?")))try{await n.K.hardResetDevice(e.id),alert("Hard reset command queued for ".concat(e.device_serial,". Device will reset on next heartbeat."))}catch(t){console.error("Hard reset error:",t),y(t instanceof Error?t.message:"Failed to queue hard reset command")}})(ie),className:"btn",style:{backgroundColor:"#dc2626",color:"white",border:"none"},title:"Queue hard reset command for device (erases config)",children:"\u26a0\ufe0f Hard Reset"}),(0,w.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\u26a0\ufe0f WARNING: This will permanently delete device ".concat(e.device_serial," and all its data.\n\nAre you sure you want to delete this device?")))try{await n.K.deleteDevice(e.id),alert("Device ".concat(e.device_serial," deleted successfully.")),ne(null),De()}catch(t){console.error("Delete device error:",t),y(t instanceof Error?t.message:"Failed to delete device")}})(ie),className:"btn",style:{backgroundColor:"#7f1d1d",color:"white",border:"none"},title:"Permanently delete device and all its data",children:"\ud83d\uddd1\ufe0f Delete"})]})]}),(0,w.jsx)("div",{style:{padding:"20px"},children:(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"15px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Status:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:(0,w.jsx)("span",{style:{display:"inline-block",padding:"4px 12px",borderRadius:"12px",fontSize:"0.875rem",fontWeight:"500",backgroundColor:ie.is_online?"#dcfce7":"#fee2e2",color:ie.is_online?"#166534":"#991b1b"},children:ie.is_online?"\ud83d\udfe2 Online":"\ud83d\udd34 Offline"})})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Last Heartbeat:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:ie.last_heartbeat?new Date(ie.last_heartbeat).toLocaleString():"Never"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"MAC / HW ID:"}),(0,w.jsx)("p",{style:{margin:"5px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.9rem"},children:ie.hw_id||"\u2014"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Model:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:ie.model||"\u2014"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Assigned User:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:ie.user||"-"})]}),(0,w.jsxs)("div",{style:{gridColumn:"1 / -1",padding:"15px",backgroundColor:"transparent",borderRadius:"8px",border:s?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-sync-card",children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{style:{fontSize:"0.95rem",color:"inherit"},className:"config-heading",children:"Configuration"}),Ae&&(0,w.jsx)("div",{style:{fontSize:"0.875rem",color:s?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginTop:"2px"},className:"config-label",children:Ae.name||ie.config_version})]}),ie.config_version?ie.pending_config_update?(0,w.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:"5px",padding:"4px 12px",borderRadius:"12px",fontSize:"0.8rem",fontWeight:"500",backgroundColor:"#fef9c3",color:"#854d0e"},children:"\u23f3 Pending update"}):(0,w.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:"5px",padding:"4px 12px",borderRadius:"12px",fontSize:"0.8rem",fontWeight:"500",backgroundColor:"#dcfce7",color:"#166534"},children:"\u2713 Synced"}):(0,w.jsx)("span",{style:{color:s?"#a0a0a0":"rgba(0, 0, 0, 0.5)",fontSize:"0.875rem"},className:"config-no-preset",children:"No preset assigned"})]}),ie.config_version&&(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px",fontSize:"0.8rem"},children:[(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:s?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:s?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:s?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Preset ID"}),(0,w.jsx)("div",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:ie.config_version})]}),null!=(null===Ae||void 0===Ae?void 0:Ae.slaves_count)&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:s?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:s?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:s?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Slaves"}),(0,w.jsxs)("div",{style:{fontWeight:"500",color:"inherit"},children:[Ae.slaves_count," device",1!==Ae.slaves_count?"s":""]})]}),null!=ie.config_ack_ver&&null!=(null===Ae||void 0===Ae?void 0:Ae.version)&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:s?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",gridColumn:"1 / -1",border:ie.config_ack_ver===Ae.version?"2px solid #dcfce7":"2px solid #fef9c3"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:s?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"4px"},className:"config-label",children:"Version Status"}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{fontSize:"0.75rem",color:s?"#b0b0b0":"rgba(0, 0, 0, 0.6)"},className:"config-label",children:"Device: "}),(0,w.jsxs)("span",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:["v",ie.config_ack_ver]}),(0,w.jsx)("span",{style:{margin:"0 8px",color:s?"#808080":"rgba(0, 0, 0, 0.4)"},className:"config-arrow",children:"\u2192"}),(0,w.jsx)("span",{style:{fontSize:"0.75rem",color:s?"#b0b0b0":"rgba(0, 0, 0, 0.6)"},className:"config-label",children:"Latest: "}),(0,w.jsxs)("span",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:["v",Ae.version]})]}),ie.config_ack_ver===Ae.version?(0,w.jsx)("span",{style:{color:"#166534",fontSize:"0.75rem",fontWeight:"500"},children:"\u2713 Up to date"}):(0,w.jsx)("span",{style:{color:"#854d0e",fontSize:"0.75rem",fontWeight:"500"},children:"\u27f3 Update available"})]})]}),null!=ie.config_ack_ver&&null==(null===Ae||void 0===Ae?void 0:Ae.version)&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:s?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:s?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:s?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Device Version"}),(0,w.jsxs)("div",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:["v",ie.config_ack_ver]})]}),(null===Ae||void 0===Ae||null===(qe=Ae.gateway_configuration)||void 0===qe||null===(Re=qe.general_settings)||void 0===Re?void 0:Re.last_updated)&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:s?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:s?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:s?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Last Modified"}),(0,w.jsx)("div",{style:{fontWeight:"500",fontSize:"0.75rem",color:"inherit"},children:new Date(Ae.gateway_configuration.general_settings.last_updated).toLocaleDateString()})]}),ie.config_acked_at&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:s?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:s?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)",gridColumn:"1 / -1"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:s?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Last Synced"}),(0,w.jsxs)("div",{style:{fontWeight:"500",fontSize:"0.75rem",color:"inherit"},children:[new Date(ie.config_acked_at).toLocaleString(),(()=>{const e=new Date(ie.config_acked_at),t=(new Date).getTime()-e.getTime(),s=Math.floor(t/6e4),r=Math.floor(s/60),a=Math.floor(r/24);return s<1?" \u2022 just now":s<60?" \u2022 ".concat(s,"m ago"):r<24?" \u2022 ".concat(r,"h ago"):" \u2022 ".concat(a,"d ago")})()]})]}),ie.config_downloaded_at&&ie.config_acked_at&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:s?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:s?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)",gridColumn:"1 / -1"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:s?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Apply Duration"}),(0,w.jsxs)("div",{style:{fontWeight:"500",color:"inherit"},children:[Math.round((new Date(ie.config_acked_at).getTime()-new Date(ie.config_downloaded_at).getTime())/1e3)," seconds",(0,w.jsx)("span",{style:{color:s?"#a0a0a0":"rgba(0, 0, 0, 0.5)",marginLeft:"8px",fontSize:"0.75rem"},className:"config-label",children:"(download \u2192 acknowledge)"})]})]})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Provisioned At:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:ie.provisioned_at?new Date(ie.provisioned_at).toLocaleDateString():"N/A"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Created By:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:ie.created_by_username||"-"})]}),(0,w.jsx)("div",{style:{gridColumn:"1 / -1"},children:(0,w.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[(0,w.jsx)("input",{type:"checkbox",checked:ie.logs_enabled||!1,onChange:e=>(async(e,t)=>{try{await n.K.toggleDeviceLogs(e.id,t),ne((0,r.A)((0,r.A)({},e),{},{logs_enabled:t})),De()}catch(s){console.error("Toggle logs error:",s),y(s instanceof Error?s.message:"Failed to toggle device logs")}})(ie,e.target.checked),style:{background:s?"#1a1a1a":"white",border:s?"1px solid #404040":"1px solid #ced4da"}}),(0,w.jsx)("strong",{children:"Enable Device Logs"}),(0,w.jsx)("span",{style:{fontSize:"0.875rem",color:s?"#b0b0b0":"#9ca3af"},children:"(Device will send logs when enabled)"})]})})]})})]}),(0,w.jsxs)("div",{className:"grid grid-cols-2",style:{gap:"var(--space-6, 24px)",marginTop:"32px"},children:[(0,w.jsxs)("div",{className:"card",children:[(0,w.jsx)("h2",{children:"System Health"}),re&&(0,w.jsx)("p",{className:"error",children:re}),!re&&!Q&&(0,w.jsx)("p",{children:"Loading system health..."}),Q&&(0,w.jsxs)("div",{children:[(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Overall:"})," ",Q.overall_health]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Devices:"})," ",Q.active_devices,"/",Q.total_devices," active"]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Telemetry Points:"})," ",Q.total_telemetry_points.toLocaleString()]})]})]}),(0,w.jsxs)("div",{className:"card",children:[(0,w.jsx)("h2",{children:"Telemetry Snapshot"}),re&&(0,w.jsx)("p",{className:"error",children:re}),!re&&!$&&(0,w.jsx)("p",{children:"Loading telemetry..."}),$&&(0,w.jsxs)("div",{children:[(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Total Points:"})," ",e.length.toLocaleString()]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Data Types:"})," ",new Set(e.map(e=>e.data_type)).size]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Latest:"})," ",t?new Date(t).toLocaleString():"N/A"]})]})]})]}),(0,w.jsxs)("div",{className:"card",style:{marginTop:"48px"},children:[(0,w.jsxs)("div",{className:"card-header",children:[(0,w.jsx)("h2",{children:"Site Configuration"}),!fe&&(0,w.jsx)("button",{className:"btn",onClick:()=>{_e(me?{site_id:me.site_id,display_name:me.display_name,latitude:String(me.latitude),longitude:String(me.longitude),capacity_kw:String(me.capacity_kw),tilt_deg:String(me.tilt_deg),azimuth_deg:String(me.azimuth_deg),timezone:me.timezone,is_active:me.is_active}:{site_id:"",display_name:"",latitude:"",longitude:"",capacity_kw:"",tilt_deg:"18",azimuth_deg:"180",timezone:"Asia/Kolkata",is_active:!0}),Ne(null),be(!0)},children:me?"Edit Site":"Add Site"})]}),(0,w.jsx)("div",{style:{padding:"20px"},children:fe?(0,w.jsx)("p",{style:{color:"var(--text-muted)"},children:"Loading site details\u2026"}):me?(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"15px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Site ID:"}),(0,w.jsx)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.88rem",color:"#00a63e"},children:me.site_id})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Display Name:"}),(0,w.jsx)("p",{style:{margin:"4px 0"},children:me.display_name||"\u2014"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Status:"}),(0,w.jsx)("p",{style:{margin:"4px 0"},children:(0,w.jsx)("span",{className:me.is_active?"status-badge status-badge-success":"status-badge status-badge-danger",children:me.is_active?"Active":"Inactive"})})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Latitude:"}),(0,w.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.88rem"},children:[me.latitude,"\xb0"]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Longitude:"}),(0,w.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.88rem"},children:[me.longitude,"\xb0"]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Timezone:"}),(0,w.jsx)("p",{style:{margin:"4px 0"},children:me.timezone})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Capacity:"}),(0,w.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace"},children:[me.capacity_kw," kW"]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Tilt:"}),(0,w.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace"},children:[me.tilt_deg,"\xb0"]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Azimuth:"}),(0,w.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace"},children:[me.azimuth_deg,"\xb0"]})]})]}):(0,w.jsx)("p",{style:{color:"var(--text-muted)",fontSize:"0.9rem"},children:"No site configured for this device yet."})})]}),me&&(0,w.jsx)("div",{style:{marginTop:"48px"},children:(0,w.jsx)(F,{siteId:me.site_id,autoRefresh:!0})}),(0,w.jsxs)("div",{className:"card",style:{marginTop:"48px",marginBottom:"20px"},children:[(0,w.jsxs)("div",{className:"card-header",children:[(0,w.jsx)("h2",{children:"Device Logs"}),(0,w.jsx)("button",{onClick:()=>Te(ie.id),className:"btn",disabled:ce,children:ce?"Loading...":"\ud83d\udd04 Refresh"})]}),(0,w.jsxs)("div",{style:{padding:"20px"},children:[!ie.logs_enabled&&(0,w.jsx)("p",{style:{color:"var(--text-muted, #9ca3af)",fontStyle:"italic"},children:"Logging is disabled for this device. Enable it in Device Details to receive logs."}),0===oe.length&&ie.logs_enabled&&!ce&&(0,w.jsx)("p",{style:{color:"var(--text-muted, #9ca3af)"},children:"No logs available yet. Logs will appear when device sends them."}),ce&&(0,w.jsx)("p",{style:{color:"var(--text-muted, #9ca3af)"},children:"Loading logs..."}),oe.length>0&&(0,w.jsx)("div",{style:{maxHeight:"400px",overflowY:"auto",fontFamily:"JetBrains Mono, monospace",fontSize:"0.85rem",backgroundColor:"#1e1e1e",padding:"10px",borderRadius:"4px"},children:oe.map(e=>(0,w.jsxs)("div",{style:{marginBottom:"8px",paddingBottom:"8px",borderBottom:"1px solid #333",color:"ERROR"===e.level?"#ff6b6b":"WARNING"===e.level?"#ffa500":"INFO"===e.level?"#4dabf7":"#ced4da"},children:[(0,w.jsxs)("span",{style:{color:"#888"},children:["[",new Date(e.timestamp).toLocaleString(),"]"]}),(0,w.jsxs)("span",{style:{fontWeight:"bold",marginLeft:"8px"},children:["[",e.level,"]"]}),(0,w.jsx)("span",{style:{marginLeft:"8px"},children:e.message})]},e.id))})]})]}),ve&&(0,w.jsx)("div",{className:"modal",children:(0,w.jsxs)("div",{className:"modal-content",children:[(0,w.jsx)("h3",{children:me?"Edit Site: ".concat(me.site_id):"Add Site Configuration"}),(0,w.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),Se(!0),Ne(null);try{const e={site_id:je.site_id.trim(),display_name:je.display_name.trim(),latitude:parseFloat(je.latitude),longitude:parseFloat(je.longitude),capacity_kw:parseFloat(je.capacity_kw),tilt_deg:parseFloat(je.tilt_deg),azimuth_deg:parseFloat(je.azimuth_deg),timezone:je.timezone.trim(),is_active:je.is_active};let t;if(t=me?await n.K.updateDeviceSite(ie.id,e):await n.K.createDeviceSite(ie.id,e),!t||!t.site_id)throw new Error("Invalid response from server \u2014 site data missing");xe(t),be(!1),Se(!1),me||setTimeout(()=>{n.K.getDeviceSite(ie.id).then(e=>{e&&xe(e)}).catch(e=>console.error("Failed to re-fetch site:",e))},500)}catch(t){Ne(t.message||"Failed to save site"),Se(!1)}},children:[(0,w.jsxs)("div",{className:"modal-body",children:[ke&&(0,w.jsx)("p",{style:{color:s?"#fca5a5":"#ef4444",fontSize:"0.875rem",marginBottom:"1rem"},children:ke}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Identification"}),(0,w.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Site ID *"}),(0,w.jsx)("input",{type:"text",required:!0,value:je.site_id,disabled:!!me,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{site_id:e.target.value})),placeholder:"e.g. site_mumbai_01",autoComplete:"off",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}}),!!me&&(0,w.jsx)("small",{className:"form-hint",children:"Site ID cannot be changed after creation."})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Display Name"}),(0,w.jsx)("input",{type:"text",value:je.display_name,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{display_name:e.target.value})),placeholder:"e.g. Mumbai Rooftop",autoComplete:"off",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]})]})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Location"}),(0,w.jsxs)("div",{className:"form-grid form-grid-3",children:[(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Latitude *"}),(0,w.jsx)("input",{type:"number",required:!0,step:"any",value:je.latitude,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{latitude:e.target.value})),placeholder:"19.0760",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Longitude *"}),(0,w.jsx)("input",{type:"number",required:!0,step:"any",value:je.longitude,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{longitude:e.target.value})),placeholder:"72.8777",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Timezone"}),(0,w.jsx)("input",{type:"text",value:je.timezone,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{timezone:e.target.value})),placeholder:"Asia/Kolkata",autoComplete:"off",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]})]})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Panel Configuration"}),(0,w.jsxs)("div",{className:"form-grid form-grid-3",children:[(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Capacity (kW) *"}),(0,w.jsx)("input",{type:"number",required:!0,step:"any",value:je.capacity_kw,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{capacity_kw:e.target.value})),placeholder:"5.0",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Tilt (\xb0)"}),(0,w.jsx)("input",{type:"number",step:"any",value:je.tilt_deg,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{tilt_deg:e.target.value})),style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Azimuth (\xb0)"}),(0,w.jsx)("input",{type:"number",step:"any",value:je.azimuth_deg,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{azimuth_deg:e.target.value})),style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]})]}),(0,w.jsx)("div",{className:"form-group",children:(0,w.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[(0,w.jsx)("input",{type:"checkbox",id:"dev-site-active",checked:je.is_active,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{is_active:e.target.checked})),style:{width:"16px",height:"16px",background:s?"#1a1a1a":"white",border:s?"1px solid #404040":"1px solid #ced4da"}}),"Active"]})})]})]}),(0,w.jsxs)("div",{className:"form-actions",style:{padding:"0 24px 24px 24px"},children:[(0,w.jsx)("button",{type:"submit",className:"btn",disabled:we,children:we?"Saving\u2026":me?"Save Changes":"Add Site"}),(0,w.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>be(!1),disabled:we,children:"Cancel"})]})]})]})}),v&&(0,w.jsx)("div",{className:"modal",children:(0,w.jsxs)("div",{className:"modal-content",children:[(0,w.jsx)("h3",{children:v?"Edit Device: ".concat(v.device_serial):"Register New Device"}),(0,w.jsxs)("form",{onSubmit:e=>{e.preventDefault(),v?Pe():Ie()},children:[(0,w.jsxs)("div",{className:"modal-body",children:[(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Device Identity"}),(0,w.jsx)("div",{className:"form-grid",children:(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Device Serial Number"}),(0,w.jsx)("input",{type:"text",value:v?he.device_serial:pe.device_serial,onChange:e=>v?ue((0,r.A)((0,r.A)({},he),{},{device_serial:e.target.value})):ge((0,r.A)((0,r.A)({},pe),{},{device_serial:e.target.value})),required:!0,autoComplete:"off",placeholder:"SN-12345678",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]})})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Ownership & Assignment"}),(0,w.jsx)("div",{className:"form-grid",children:(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Assigned User"}),(0,w.jsxs)("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("input",{type:"text",placeholder:"Search by name, username, or email...",value:N,onChange:e=>{A(e.target.value),z(!0)},onFocus:()=>z(!0),autoComplete:"off",className:"full-width",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}}),T&&(0,w.jsx)("div",{style:{position:"absolute",top:"100%",left:"0",right:"0",background:"var(--bg-secondary, #1e293b)",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"6px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",zIndex:10,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:C.length>0?C.map(e=>(0,w.jsxs)("div",{onClick:()=>{v?ue((0,r.A)((0,r.A)({},he),{},{user:e.username})):ge((0,r.A)((0,r.A)({},pe),{},{user:e.username})),A("".concat(e.first_name," ").concat(e.last_name," (").concat(e.username,")")),z(!1)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",background:(v?he.user:pe.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",color:"var(--text-primary, #f8fafc)",transition:"all 0.15s ease",fontSize:"0.875rem"},onMouseEnter:e=>e.currentTarget.style.background="rgba(255, 255, 255, 0.06)",onMouseLeave:t=>t.currentTarget.style.background=(v?he.user:pe.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",children:[e.first_name," ",e.last_name," (",e.username,") ",(0,w.jsx)("br",{}),(0,w.jsx)("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary, #94a3b8)"},children:e.email})]},e.id)):(0,w.jsx)("div",{style:{padding:"12px 16px",color:"var(--text-muted, #64748b)",fontSize:"0.875rem"},children:""===N.trim()?"Start typing to search users...":"No users found"})})]})]})})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Configuration"}),(0,w.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Preset Template"}),(0,w.jsxs)("select",{value:v?he.config_version:pe.config_version,onChange:e=>v?ue((0,r.A)((0,r.A)({},he),{},{config_version:e.target.value})):ge((0,r.A)((0,r.A)({},pe),{},{config_version:e.target.value})),className:"full-width",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"},children:[(0,w.jsx)("option",{value:"",children:"-- Manual Configuration --"}),Y&&(0,w.jsx)("option",{value:"",disabled:!0,children:"Loading presets..."}),!Y&&H.map(e=>(0,w.jsxs)("option",{value:We(e),children:[e.name," (",We(e)||"no ID",")"]},e.id))]}),(0,w.jsx)("small",{className:"form-hint",children:"Selecting a preset sets the Config Version ID below."})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Config Version ID"}),(0,w.jsx)("input",{type:"text",value:v?he.config_version:pe.config_version,onChange:e=>v?ue((0,r.A)((0,r.A)({},he),{},{config_version:e.target.value})):ge((0,r.A)((0,r.A)({},pe),{},{config_version:e.target.value})),autoComplete:"off",placeholder:"Manual Config ID",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]})]})]})]}),v&&(0,w.jsx)("div",{style:{padding:"0 24px"},children:(0,w.jsx)(c.A,{createdBy:v.created_by_username,createdAt:v.created_at,updatedBy:v.updated_by_username,updatedAt:v.updated_at})}),(0,w.jsxs)("div",{className:"form-actions",style:{padding:"0 24px 24px 24px"},children:[(0,w.jsx)("button",{type:"submit",className:"btn",children:v?"Save Changes":"Create Device"}),(0,w.jsx)("button",{type:"button",onClick:Oe,className:"btn btn-secondary",children:"Cancel"})]})]})]})})]})}return(0,w.jsxs)("div",{children:[(0,w.jsx)("h1",{children:"Device Management"}),(0,w.jsxs)("div",{className:"card",children:[(0,w.jsxs)("div",{className:"card-header",children:[(0,w.jsxs)("h2",{children:["Devices (",p.length,")"]}),(0,w.jsxs)("div",{className:"card-actions",children:[(0,w.jsx)("input",{type:"text",placeholder:"Search devices...",value:S,onChange:e=>{const t=e.target.value;k(t),R(1),Le(t)},className:"search-input",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}}),I.size>0&&(0,w.jsx)("button",{onClick:async()=>{if(0===I.size)return void y("No devices selected for deletion");const e=Array.from(I).map(e=>h.find(t=>t.id===e)).filter(Boolean),t="Are you sure you want to delete ".concat(I.size," device(s)?\n\n").concat(e.map(e=>null===e||void 0===e?void 0:e.device_serial).join(", "));if(window.confirm(t))try{W(!0),await n.K.deleteDevicesBulk(Array.from(I));const e=h.filter(e=>!I.has(e.id));u(e),g(e.filter(e=>e.device_serial.toLowerCase().includes(S.toLowerCase()))),O(new Set),W(!1)}catch(s){W(!1),console.error("Bulk delete error:",s),y(s instanceof Error?s.message:"Failed to delete devices")}},disabled:E,style:{background:"var(--danger-color, #ef4444)",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:E?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"500",opacity:E?"0.6":"1"},children:E?"Deleting ".concat(I.size,"..."):"Delete Selected (".concat(I.size,")")}),(0,w.jsx)("button",{onClick:()=>{_(!0),A(""),z(!1)},className:"btn",children:"Register New Device"})]})]}),(0,w.jsxs)("table",{className:"table",children:[(0,w.jsx)("thead",{children:(0,w.jsxs)("tr",{children:[(0,w.jsx)("th",{style:{textAlign:"center",width:"40px"},children:(0,w.jsx)("input",{type:"checkbox",checked:I.size===p.length&&p.length>0,onChange:()=>{if(I.size===p.length)O(new Set);else{const e=new Set(p.map(e=>e.id));O(e)}},title:"Select all displayed devices",style:{background:s?"#1a1a1a":"white",border:s?"1px solid #404040":"1px solid #ced4da"}})}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Device Serial"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Status"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"MAC / HW ID"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Model"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Assigned To"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Config Version"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Provisioned At"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Actions"})]})}),(0,w.jsx)("tbody",{children:p.map(e=>(0,w.jsxs)("tr",{onClick:()=>ze(e),style:{background:I.has(e.id)?"rgba(99, 102, 241, 0.1)":"transparent",cursor:"pointer"},className:"clickable-row",children:[(0,w.jsx)("td",{style:{textAlign:"center"},children:(0,w.jsx)("input",{type:"checkbox",checked:I.has(e.id),onChange:()=>(e=>{const t=new Set(I);t.has(e)?t.delete(e):t.add(e),O(t)})(e.id),style:{background:s?"#1a1a1a":"white",border:s?"1px solid #404040":"1px solid #ced4da"}})}),(0,w.jsx)("td",{style:{textAlign:"center",fontFamily:"JetBrains Mono, monospace",fontSize:"0.85rem"},children:e.device_serial}),(0,w.jsx)("td",{style:{textAlign:"center"},children:(0,w.jsx)("span",{style:{display:"inline-block",padding:"4px 8px",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"500",backgroundColor:e.is_online?"#dcfce7":"#fee2e2",color:e.is_online?"#166534":"#991b1b"},children:e.is_online?"\ud83d\udfe2 Online":"\ud83d\udd34 Offline"})}),(0,w.jsx)("td",{style:{textAlign:"center",fontFamily:"JetBrains Mono, monospace",fontSize:"0.82rem",color:e.hw_id?"inherit":"var(--text-muted, #9ca3af)"},children:e.hw_id||"\u2014"}),(0,w.jsx)("td",{style:{textAlign:"center",fontSize:"0.875rem"},children:e.model||(0,w.jsx)("span",{style:{color:"var(--text-muted, #9ca3af)"},children:"\u2014"})}),(0,w.jsx)("td",{style:{textAlign:"center"},children:e.user||"-"}),(0,w.jsx)("td",{style:{textAlign:"center"},children:e.config_version||"-"}),(0,w.jsx)("td",{style:{textAlign:"center"},children:(()=>{if(!e.provisioned_at)return"N/A";const t=new Date(e.provisioned_at);return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString()})()}),(0,w.jsxs)("td",{style:{textAlign:"center"},children:[(0,w.jsx)("button",{onClick:t=>{t.stopPropagation(),Fe(e)},style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-secondary, #94a3b8)",margin:"0 6px"},title:"Edit",children:(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,w.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,w.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,w.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{if(window.confirm("Are you sure you want to delete device ".concat(e.device_serial,"?")))try{await n.K.deleteDevice(e.id);const t=h.filter(t=>t.id!==e.id);u(t),g(t)}catch(t){console.error("Delete error:",t),y(t instanceof Error?t.message:"Failed to delete device")}})(e)},style:{background:"none",border:"none",cursor:"pointer",color:"var(--danger-color, #ef4444)",margin:"0 6px"},title:"Delete",children:(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,w.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,w.jsx)("path",{d:"M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"}),(0,w.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,w.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]},e.id))})]}),J>0&&(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderTop:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",gap:"16px"},children:[(0,w.jsxs)("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary, #94a3b8)"},children:["Showing ",(q-1)*B+1," - ",Math.min(q*B,J)," of ",J," devices"]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,w.jsx)("button",{onClick:()=>R(Math.max(1,q-1)),disabled:1===q,style:{padding:"8px 12px",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"6px",background:1===q?"rgba(148, 163, 184, 0.1)":"transparent",color:"var(--text-primary, #f8fafc)",cursor:1===q?"not-allowed":"pointer",opacity:1===q?"0.5":"1"},children:"\u2190 Previous"}),(0,w.jsx)("div",{style:{display:"flex",gap:"4px",alignItems:"center"},children:(()=>{const e=[];for(let s=1;s<=K;s++){var t;1===s||s===K||Math.abs(s-q)<=1?e.push((0,w.jsx)("button",{onClick:()=>R(s),style:{padding:"6px 10px",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"4px",background:s===q?"rgba(99, 102, 241, 0.2)":"transparent",color:"var(--text-primary, #f8fafc)",cursor:"pointer",fontWeight:s===q?"bold":"normal",minWidth:"32px"},children:s},s)):(null===(t=e[e.length-1])||void 0===t?void 0:t.key)!=="ellipsis-"+Math.floor(s/10)&&e.push((0,w.jsx)("span",{style:{padding:"0 4px",color:"var(--text-secondary, #94a3b8)"},children:"..."},"ellipsis-".concat(Math.floor(s/10))))}return e})()}),(0,w.jsx)("button",{onClick:()=>R(Math.min(K,q+1)),disabled:q===K,style:{padding:"8px 12px",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"6px",background:q===K?"rgba(148, 163, 184, 0.1)":"transparent",color:"var(--text-primary, #f8fafc)",cursor:q===K?"not-allowed":"pointer",opacity:q===K?"0.5":"1"},children:"Next \u2192"})]}),(0,w.jsxs)("select",{value:B,onChange:e=>{M(parseInt(e.target.value)),R(1)},style:{padding:"8px",border:s?"1px solid #404040":"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px",background:s?"#1a1a1a":"#0f172a",color:s?"#e0e0e0":"#f8fafc",cursor:"pointer",fontSize:"0.875rem"},children:[(0,w.jsx)("option",{value:10,children:"10 per page"}),(0,w.jsx)("option",{value:25,children:"25 per page"}),(0,w.jsx)("option",{value:50,children:"50 per page"}),(0,w.jsx)("option",{value:100,children:"100 per page"})]})]})]}),(v||j)&&(0,w.jsx)("div",{className:"modal",children:(0,w.jsxs)("div",{className:"modal-content",children:[(0,w.jsx)("h3",{children:v?"Edit Device: ".concat(v.device_serial):"Register New Device"}),(0,w.jsxs)("form",{onSubmit:e=>{e.preventDefault(),v?Pe():Ie()},children:[(0,w.jsxs)("div",{className:"modal-body",children:[(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Device Identity"}),(0,w.jsx)("div",{className:"form-grid",children:(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Device Serial Number"}),(0,w.jsx)("input",{type:"text",value:v?he.device_serial:pe.device_serial,onChange:e=>v?ue((0,r.A)((0,r.A)({},he),{},{device_serial:e.target.value})):ge((0,r.A)((0,r.A)({},pe),{},{device_serial:e.target.value})),required:!0,autoComplete:"off",placeholder:"SN-12345678",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]})})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Ownership & Assignment"}),(0,w.jsx)("div",{className:"form-grid",children:(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Assigned User"}),(0,w.jsxs)("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("input",{type:"text",placeholder:"Search and select user...",value:N,onChange:e=>{A(e.target.value),z(!0)},onFocus:()=>z(!0),autoComplete:"off",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}}),(v?he.user:pe.user)&&(0,w.jsxs)("div",{style:{marginTop:"8px",fontSize:"0.875rem",color:s?"#b0b0b0":"#94a3b8"},children:[(0,w.jsx)("strong",{children:"Selected:"})," ",null===(e=L.find(e=>e.username===(v?he.user:pe.user)))||void 0===e?void 0:e.first_name," ",null===(t=L.find(e=>e.username===(v?he.user:pe.user)))||void 0===t?void 0:t.last_name," (",v?he.user:pe.user,")",(0,w.jsx)("button",{type:"button",onClick:()=>{v?ue((0,r.A)((0,r.A)({},he),{},{user:""})):ge((0,r.A)((0,r.A)({},pe),{},{user:""})),A("")},className:"btn-icon btn-icon-danger",style:{marginLeft:"10px"},title:"Remove Assignment",children:"\u2715"})]}),T&&(0,w.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--bg-secondary, #0f172a)",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",borderRadius:"8px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"var(--shadow-xl)",marginTop:"4px"},children:C.length>0?C.map(e=>(0,w.jsxs)("div",{onClick:()=>{v?ue((0,r.A)((0,r.A)({},he),{},{user:e.username})):ge((0,r.A)((0,r.A)({},pe),{},{user:e.username})),A("".concat(e.first_name," ").concat(e.last_name," (").concat(e.username,")")),z(!1)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",background:(v?he.user:pe.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",color:"var(--text-primary, #f8fafc)",transition:"all 0.15s ease",fontSize:"0.875rem"},onMouseEnter:e=>e.currentTarget.style.background="rgba(255, 255, 255, 0.06)",onMouseLeave:t=>t.currentTarget.style.background=(v?he.user:pe.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",children:[e.first_name," ",e.last_name," (",e.username,") ",(0,w.jsx)("br",{}),(0,w.jsx)("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary, #94a3b8)"},children:e.email})]},e.id)):(0,w.jsx)("div",{style:{padding:"12px 16px",color:"var(--text-muted, #64748b)",fontSize:"0.875rem"},children:""===N.trim()?"Start typing to search users...":"No users found"})})]})]})})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Configuration"}),(0,w.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Preset Template"}),(0,w.jsxs)("select",{value:v?he.config_version:pe.config_version,onChange:e=>v?ue((0,r.A)((0,r.A)({},he),{},{config_version:e.target.value})):ge((0,r.A)((0,r.A)({},pe),{},{config_version:e.target.value})),className:"full-width",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"},children:[(0,w.jsx)("option",{value:"",children:"-- Manual Configuration --"}),Y&&(0,w.jsx)("option",{value:"",disabled:!0,children:"Loading presets..."}),!Y&&H.map(e=>(0,w.jsxs)("option",{value:We(e),children:[e.name," (",We(e)||"no ID",")"]},e.id))]}),(0,w.jsx)("small",{className:"form-hint",children:"Selecting a preset sets the Config Version ID below."})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Config Version ID"}),(0,w.jsx)("input",{type:"text",value:v?he.config_version:pe.config_version,onChange:e=>v?ue((0,r.A)((0,r.A)({},he),{},{config_version:e.target.value})):ge((0,r.A)((0,r.A)({},pe),{},{config_version:e.target.value})),autoComplete:"off",placeholder:"Manual Config ID",style:{background:s?"#1a1a1a":"white",color:s?"#e0e0e0":"inherit",border:s?"1px solid #404040":"1px solid #ced4da"}})]})]})]})]}),v&&(0,w.jsx)("div",{style:{padding:"0 24px"},children:(0,w.jsx)(c.A,{createdBy:v.created_by_username,createdAt:v.created_at,updatedBy:v.updated_by_username,updatedAt:v.updated_at})}),(0,w.jsxs)("div",{className:"form-actions",style:{padding:"24px"},children:[(0,w.jsx)("button",{type:"submit",className:"btn",children:v?"Save Changes":"Register Device"}),(0,w.jsx)("button",{type:"button",onClick:Oe,className:"btn btn-secondary",children:"Cancel"})]})]})]})})]})}},5560(e,t,s){s.d(t,{K:()=>l});var r=s(2555);class a{constructor(){this.cache=new Map,this.subscribers=new Map}set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.DEFAULT_TTL,r=arguments.length>3?arguments[3]:void 0;this.cache.set(e,{data:t,timestamp:Date.now(),expiresIn:s,staleTime:null!==r&&void 0!==r?r:Math.min(s/2,a.STALE_TIME)}),this.notifySubscribers(e,t)}get(e){const t=this.cache.get(e);if(!t)return null;return Date.now()-t.timestamp>t.expiresIn?(this.cache.delete(e),null):t.data}getWithStaleStatus(e){var t;const s=this.cache.get(e);if(!s)return null;const r=Date.now()-s.timestamp,a=r>s.expiresIn,i=r>(null!==(t=s.staleTime)&&void 0!==t?t:s.expiresIn/2);return a?(this.cache.delete(e),null):{data:s.data,isStale:i,isExpired:!1}}has(e){const t=this.cache.get(e);if(!t)return!1;return!(Date.now()-t.timestamp>t.expiresIn)||(this.cache.delete(e),!1)}isStale(e){var t;const s=this.cache.get(e);if(!s)return!0;return Date.now()-s.timestamp>(null!==(t=s.staleTime)&&void 0!==t?t:s.expiresIn/2)}clear(e){this.cache.delete(e)}clearPattern(e){const t="string"===typeof e?new RegExp(e):e,s=[];this.cache.forEach((e,r)=>{t.test(r)&&s.push(r)}),s.forEach(e=>this.cache.delete(e))}clearAll(){this.cache.clear()}size(){return this.cache.size}subscribe(e,t){this.subscribers.has(e)||this.subscribers.set(e,new Set);const s={callback:t};return this.subscribers.get(e).add(s),()=>{const t=this.subscribers.get(e);t&&(t.delete(s),0===t.size&&this.subscribers.delete(e))}}subscribePattern(e,t){const s="__pattern__".concat(e.source);this.subscribers.has(s)||this.subscribers.set(s,new Set);const r={callback:t,pattern:e};return this.subscribers.get(s).add(r),()=>{const e=this.subscribers.get(s);e&&(e.delete(r),0===e.size&&this.subscribers.delete(s))}}notifySubscribers(e,t){const s=this.subscribers.get(e);s&&s.forEach(s=>{try{s.callback(t)}catch(r){console.error("Cache subscriber error for key ".concat(e,":"),r)}}),this.subscribers.forEach((s,r)=>{r.startsWith("__pattern__")&&s.forEach(s=>{if(s.pattern&&s.pattern.test(e))try{s.callback(t)}catch(r){console.error("Cache pattern subscriber error for key ".concat(e,":"),r)}})})}keys(){return Array.from(this.cache.keys())}getStats(){return{size:this.cache.size,keys:this.keys(),subscribers:Array.from(this.subscribers.values()).reduce((e,t)=>e+t.size,0)}}static getTTL(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short"){case"realtime":return a.REALTIME_TTL;case"long":return a.LONG_TTL;default:return a.DEFAULT_TTL}}}a.DEFAULT_TTL=3e5,a.LONG_TTL=18e5,a.REALTIME_TTL=1e4,a.STALE_TIME=3e4;const i=new a,n=3e5,o="https://smart-solar-django-backend.vercel.app/api";const l=new class{getAuthHeaders(){const e=localStorage.getItem("authTokens");if(e)try{const t=JSON.parse(e);return{Authorization:"Bearer ".concat(t.access),"Content-Type":"application/json"}}catch(t){console.error("Error parsing auth tokens:",t)}return{"Content-Type":"application/json"}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s="".concat(o).concat(e);let a=this.getAuthHeaders(),i=await fetch(s,(0,r.A)((0,r.A)({},t),{},{headers:(0,r.A)((0,r.A)({},a),t.headers)}));if(401===i.status){await this.refreshToken()&&(a=this.getAuthHeaders(),i=await fetch(s,(0,r.A)((0,r.A)({},t),{},{headers:(0,r.A)((0,r.A)({},a),t.headers)})))}if(401===i.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!i.ok){const e=await i.text();throw new Error("API request failed: ".concat(i.status," ").concat(i.statusText," - ").concat(e))}return 204===i.status?null:i.json()}async refreshToken(){const e=localStorage.getItem("authTokens");if(!e)return!1;try{const t=JSON.parse(e),s=await fetch("".concat(o,"/auth/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t.refresh})});if(s.ok){const e={access:(await s.json()).access,refresh:t.refresh};return localStorage.setItem("authTokens",JSON.stringify(e)),!0}}catch(t){console.error("Token refresh failed:",t)}return!1}async getConfiguration(){return this.request("/config/")}async getTelemetry(){return this.request("/telemetry/")}async provisionDevice(e){const t=await fetch("".concat(o,"/devices/provision"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Provisioning failed: ".concat(t.statusText));return t.json()}async getAlerts(){const e="alerts",t=i.get(e);if(t)return t;const s=await this.request("/alerts/");return i.set(e,s,n),s}async getSystemHealth(){const e="system_health",t=i.get(e);if(t)return t;const s=await this.request("/health/");return i.set(e,s,n),s}async getKPIs(){const e="kpis",t=i.get(e);if(t)return t;const s=await this.request("/kpis/");return i.set(e,s,n),s}async getUsers(e){const t="users_".concat(e||"all"),s=i.get(t);if(s)return s;const r=e?"?search=".concat(encodeURIComponent(e)):"",a=await this.request("/users/".concat(r));return i.set(t,a,n),a}async createUser(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify(e)});return i.clear("users_all"),i.clearAll(),t}async createEmployee(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify((0,r.A)((0,r.A)({},e),{},{is_staff:!0}))});return i.clear("users_all"),t}async getUserDevices(e){return this.request("/users/".concat(e,"/devices/"))}async getUserSite(e){return this.request("/users/".concat(e,"/site/"))}async createUserSite(e,t){return this.request("/users/".concat(e,"/site/"),{method:"POST",body:JSON.stringify(t)})}async updateUserSite(e,t){return this.request("/users/".concat(e,"/site/update/"),{method:"PUT",body:JSON.stringify(t)})}async getDeviceSite(e){return this.request("/devices/".concat(e,"/site/"))}async createDeviceSite(e,t){return this.request("/devices/".concat(e,"/site/"),{method:"POST",body:JSON.stringify(t)})}async updateDeviceSite(e,t){return this.request("/devices/".concat(e,"/site/update/"),{method:"PUT",body:JSON.stringify(t)})}async getSiteTelemetry(e,t){const s=new URLSearchParams;null!==t&&void 0!==t&&t.start_date&&s.append("start_date",t.start_date),null!==t&&void 0!==t&&t.end_date&&s.append("end_date",t.end_date),null!==t&&void 0!==t&&t.days&&s.append("days",t.days.toString());const r="/sites/".concat(e,"/telemetry/").concat(s.toString()?"?"+s.toString():"");return this.request(r)}async getSiteForecast(e,t){const s=new URLSearchParams;null!==t&&void 0!==t&&t.date&&s.append("date",t.date),null!==t&&void 0!==t&&t.start_date&&s.append("start_date",t.start_date),null!==t&&void 0!==t&&t.end_date&&s.append("end_date",t.end_date);const r="/sites/".concat(e,"/forecast/").concat(s.toString()?"?"+s.toString():"");return this.request(r)}async getSiteWeather(e){return this.request("/sites/".concat(e,"/weather/"))}async updateUser(e,t){const s=await this.request("/users/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return i.clear("users_all"),s}async deleteUser(e){const t=await this.request("/users/".concat(e,"/delete/"),{method:"DELETE"});return i.clear("users_all"),t}async getProfile(){return this.request("/profile/")}async updateProfile(e){return this.request("/profile/update/",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e){return this.request("/profile/change-password/",{method:"POST",body:JSON.stringify(e)})}async getCustomers(e){const t=e?"?search=".concat(encodeURIComponent(e)):"";return this.request("/customers/".concat(t))}async createCustomer(e){return this.request("/customers/create/",{method:"POST",body:JSON.stringify(e)})}async getCustomer(e){return this.request("/customers/".concat(e,"/"))}async updateCustomer(e,t){return this.request("/customers/".concat(e,"/update/"),{method:"PUT",body:JSON.stringify(t)})}async deleteCustomer(e){return this.request("/customers/".concat(e,"/delete/"),{method:"DELETE"})}async getPresets(){const e="presets",t=i.get(e);if(t)return t;const s=await this.request("/presets/");return i.set(e,s,18e5),s}async createPreset(e){const t=await this.request("/presets/create/",{method:"POST",body:JSON.stringify(e)});return i.clear("presets"),t}async updatePreset(e,t){const s=await this.request("/presets/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return i.clear("presets"),s}async deletePreset(e){const t=await this.request("/presets/".concat(e,"/delete/"),{method:"DELETE"});return i.clear("presets"),t}async getGlobalSlaves(){return this.request("/slaves/")}async createGlobalSlave(e){return this.request("/slaves/create/",{method:"POST",body:JSON.stringify(e)})}async updateGlobalSlave(e,t){return this.request("/slaves/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteGlobalSlave(e){return this.request("/slaves/".concat(e,"/delete/"),{method:"DELETE"})}async getDevices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;const r=new URLSearchParams;e&&r.append("search",e),r.append("page",t.toString()),r.append("page_size",s.toString());const a=r.toString();return this.request("/devices/?".concat(a))}async createDevice(e){return this.request("/devices/create/",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,t){return this.request("/devices/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteDevice(e){return this.request("/devices/".concat(e,"/delete/"),{method:"DELETE"})}async rebootDevice(e){return this.request("/devices/".concat(e,"/reboot/"),{method:"POST"})}async hardResetDevice(e){return this.request("/devices/".concat(e,"/hard-reset/"),{method:"POST"})}async getDeviceLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.request("/devices/".concat(e,"/logs/?limit=").concat(t,"&offset=").concat(s))}async toggleDeviceLogs(e,t){return this.request("/devices/".concat(e,"/logs/toggle/"),{method:"POST",body:JSON.stringify({enabled:t})})}async deleteDevicesBulk(e){return this.request("/devices/delete-bulk/",{method:"POST",body:JSON.stringify({device_ids:e})})}async getSlaves(e){return this.request("/presets/".concat(e,"/slaves/"))}async createSlave(e,t){return this.request("/presets/".concat(e,"/slaves/create/"),{method:"POST",body:JSON.stringify(t)})}async updateSlave(e,t,s){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/"),{method:"PUT",body:JSON.stringify(s)})}async deleteSlave(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/delete/"),{method:"DELETE"})}async addSlavesToPreset(e,t){return this.request("/presets/".concat(e,"/slaves/add/"),{method:"POST",body:JSON.stringify({slave_ids:t})})}async detachSlaveFromPreset(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/detach/"),{method:"POST"})}async getFirmwareVersions(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=new URLSearchParams;return t.append("active",e.toString()),this.request("/ota/firmware/?".concat(t.toString()))}async uploadFirmwareVersion(e){const t="".concat(o,"/ota/firmware/create/"),s=localStorage.getItem("authTokens");if(!s)throw new Error("Authentication required");const r=JSON.parse(s);let a={Authorization:"Bearer ".concat(r.access)},i=await fetch(t,{method:"POST",headers:a,body:e});if(401===i.status){if(await this.refreshToken()){const s=JSON.parse(localStorage.getItem("authTokens")||"{}");a={Authorization:"Bearer ".concat(s.access)},i=await fetch(t,{method:"POST",headers:a,body:e})}}if(401===i.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!i.ok){const e=await i.text();throw new Error("Upload failed: ".concat(i.status," ").concat(i.statusText," - ").concat(e))}return i.json()}async updateFirmwareVersion(e,t){return this.request("/ota/firmware/".concat(e,"/"),{method:"PATCH",body:JSON.stringify(t)})}async deleteFirmwareVersion(e){return this.request("/ota/firmware/".concat(e,"/delete/"),{method:"DELETE"})}async getDeviceUpdateLogs(e){return this.request("/ota/devices/".concat(e,"/logs"))}async getOTAConfig(){return this.request("/ota/config/")}async updateOTAConfig(e){return this.request("/ota/config/update/",{method:"PATCH",body:JSON.stringify(e)})}async getOTAHealth(){return this.request("/ota/health/")}async triggerRollback(e,t){return this.request("/ota/updates/rollback/",{method:"POST",body:JSON.stringify({device_serial:e,notes:t||""})})}async deployFirmware(e,t,s){return this.request("/ota/updates/multiple/",{method:"POST",body:JSON.stringify({firmware_id:e,device_serials:t,notes:s||""})})}async listTargetedUpdates(){return this.request("/ota/updates/")}async getTargetedUpdate(e){return this.request("/ota/updates/".concat(e,"/"))}}}}]);
//# sourceMappingURL=239.f9b1b5fd.chunk.js.map