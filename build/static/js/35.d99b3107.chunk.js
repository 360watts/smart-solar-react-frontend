"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[35],{8035(e,t,s){s.r(t),s.d(t,{default:()=>l});var a=s(2555),r=s(5043),n=s(5560),i=s(579);const l=()=>{var e,t;const[s,l]=(0,r.useState)([]),[o,c]=(0,r.useState)([]),[d,h]=(0,r.useState)(!0),[u,g]=(0,r.useState)(null),[m,p]=(0,r.useState)(null),[x,v]=(0,r.useState)(!1),[f,j]=(0,r.useState)(""),[b,y]=(0,r.useState)(null),[_,N]=(0,r.useState)(null),[A,w]=(0,r.useState)([]),[S,C]=(0,r.useState)(!1),[T,I]=(0,r.useState)(null),[k,E]=(0,r.useState)("none"),[D,O]=(0,r.useState)([]),[P,L]=(0,r.useState)(!1),[q,R]=(0,r.useState)([]),[B,F]=(0,r.useState)(""),[M,U]=(0,r.useState)({config_id:"",name:"",description:"",baud_rate:9600,data_bits:8,stop_bits:1,parity:0}),[J,W]=(0,r.useState)({name:"",description:"",baud_rate:9600,data_bits:8,stop_bits:1,parity:0}),[z,H]=(0,r.useState)({slave_id:"",device_name:"",polling_interval_ms:5e3,timeout_ms:1e3,enabled:!0,registers:[]}),[K,G]=(0,r.useState)({label:"",address:0,num_registers:1,function_code:3,register_type:3,data_type:0,byte_order:0,word_order:0,access_mode:0,scale_factor:1,offset:0,unit:"",decimal_places:2,category:"Electrical",high_alarm_threshold:null,low_alarm_threshold:null,description:"",enabled:!0});(0,r.useEffect)(()=>{Q()},[]),(0,r.useEffect)(()=>{if(!x||"select"!==k)return;(async()=>{try{L(!0);const e=(await n.K.getGlobalSlaves()).map(e=>({id:e.id,slaveId:e.slave_id,deviceName:e.device_name,pollingIntervalMs:e.polling_interval_ms,timeoutMs:e.timeout_ms,enabled:e.enabled,registers:e.registers||[]}));O(e)}catch(e){console.error("Failed to fetch global slaves:",e)}finally{L(!1)}})()},[x,k]);const[V,Y]=(0,r.useState)("");(0,r.useEffect)(()=>{const e=setTimeout(()=>{Y(f)},300);return()=>clearTimeout(e)},[f]),(0,r.useEffect)(()=>{Q(V)},[V]),(0,r.useEffect)(()=>{x&&(H({slave_id:"",device_name:"",polling_interval_ms:5e3,timeout_ms:1e3,enabled:!0,registers:[]}),G({label:"",address:0,num_registers:1,function_code:3,register_type:3,data_type:0,byte_order:0,word_order:0,access_mode:0,scale_factor:1,offset:0,unit:"",decimal_places:2,category:"Electrical",high_alarm_threshold:null,low_alarm_threshold:null,description:"",enabled:!0}))},[x]);const Q=async e=>{try{const t=await n.K.getPresets();let s=t;if(e){const a=e.toLowerCase();s=t.filter(e=>e.name.toLowerCase().includes(a)||e.config_id.toLowerCase().includes(a)||e.description.toLowerCase().includes(a))}l(t),c(s),h(!1)}catch(t){g(t instanceof Error?t.message:"An error occurred"),h(!1)}},X=async()=>{if(m)try{await n.K.updatePreset(m.id,M),p(null),await Q(f)}catch(e){g(e instanceof Error?e.message:"Failed to update preset")}},Z=async()=>{try{var e,t;const s=await n.K.createPreset(J),a=(null===s||void 0===s||null===(e=s.gateway_configuration)||void 0===e||null===(t=e.general_settings)||void 0===t?void 0:t.config_id)||(null===s||void 0===s?void 0:s.config_id)||(null===s||void 0===s?void 0:s.configId)||"";if(a||"none"===k||g("Preset created but config id was not returned. Slave setup skipped."),a&&"create"===k){if(!z.slave_id||!z.device_name)return void g("Slave ID and Device Name are required to create a slave.");await n.K.createSlave(a,{slave_id:parseInt(z.slave_id),device_name:z.device_name,polling_interval_ms:z.polling_interval_ms,timeout_ms:z.timeout_ms,enabled:z.enabled,registers:z.registers})}a&&"select"===k&&q.length>0&&await n.K.addSlavesToPreset(a,q),v(!1),E("none"),R([]),W({name:"",description:"",baud_rate:9600,data_bits:8,stop_bits:1,parity:0}),await Q(f)}catch(s){g(s instanceof Error?s.message:"Failed to create preset")}},$=e=>{var t;return null!==(t={0:"UINT16",1:"INT16",2:"UINT32",3:"INT32",4:"FLOAT32",5:"UINT64",6:"INT64",7:"FLOAT64",8:"BOOL",9:"STRING"}[e])&&void 0!==t?t:"Unknown (".concat(e,")")},ee=async e=>{N(e),await te(e.config_id)},te=async e=>{try{const[t,s]=await Promise.all([n.K.getSlaves(e),n.K.getGlobalSlaves()]),a=new Set(t.map(e=>e.id)),r=(e,t)=>({id:e.id,slaveId:e.slave_id,deviceName:e.device_name,pollingIntervalMs:e.polling_interval_ms,timeoutMs:e.timeout_ms,enabled:e.enabled,attached:t,registers:(e.registers||[]).map(e=>({id:e.id,label:e.label,address:e.address,numRegisters:e.num_registers,functionCode:e.function_code,dataType:e.data_type,scaleFactor:e.scale_factor,offset:e.offset,enabled:e.enabled}))}),i=t.map(e=>r(e,!0)),l=(s||[]).filter(e=>!a.has(e.id)).map(e=>r(e,!1));w([...i,...l])}catch(t){console.error("Failed to fetch slaves:",t),g("Failed to load slaves for this preset")}},se=(e,t)=>{const r=s.map(s=>s.config_id===e?(0,a.A)((0,a.A)({},s),{},{slaves_count:t}):s);l(r);const n=f.toLowerCase(),i=r.filter(e=>e.name.toLowerCase().includes(n)||e.config_id.toLowerCase().includes(n)||e.description.toLowerCase().includes(n));c(i),_&&_.config_id===e&&N((0,a.A)((0,a.A)({},_),{},{slaves_count:t}))},ae=async()=>{if(_){if(!T){const e=parseInt(z.slave_id);if(A.find(t=>t.slaveId===e))return void g("Slave ID ".concat(e," already exists for this configuration. Please choose a different ID."))}try{const e={slave_id:parseInt(z.slave_id),device_name:z.device_name,polling_interval_ms:z.polling_interval_ms,timeout_ms:z.timeout_ms,enabled:z.enabled,registers:z.registers};if(T){const t=await n.K.updateSlave(_.config_id,T.slaveId,e),s={id:t.id,slaveId:t.slave_id,deviceName:t.device_name,pollingIntervalMs:t.polling_interval_ms,timeoutMs:t.timeout_ms,enabled:t.enabled,registers:t.registers.map(e=>({id:e.id,label:e.label,address:e.address,numRegisters:e.num_registers,functionCode:e.function_code,dataType:e.data_type,scaleFactor:e.scale_factor,offset:e.offset,enabled:e.enabled}))},a=A.map(e=>e.slaveId===T.slaveId?s:e);w(a),se(_.config_id,a.length),I(null)}else{const t=await n.K.createSlave(_.config_id,e),s={id:t.id,slaveId:t.slave_id,deviceName:t.device_name,pollingIntervalMs:t.polling_interval_ms,timeoutMs:t.timeout_ms,enabled:t.enabled,registers:t.registers.map(e=>({id:e.id,label:e.label,address:e.address,numRegisters:e.num_registers,functionCode:e.function_code,dataType:e.data_type,scaleFactor:e.scale_factor,offset:e.offset,enabled:e.enabled}))},a=[...A,s];w(a),se(_.config_id,a.length),C(!1)}H({slave_id:"",device_name:"",polling_interval_ms:5e3,timeout_ms:1e3,enabled:!0,registers:[]})}catch(e){g(e instanceof Error?e.message:"Failed to save slave")}}};return d?(0,i.jsx)("div",{className:"loading",children:"Loading presets..."}):u?(0,i.jsxs)("div",{className:"error",children:["Error: ",u]}):(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{children:"Device Presets"}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("div",{className:"card-header",children:[(0,i.jsxs)("h2",{children:["Presets (",o.length,")"]}),(0,i.jsxs)("div",{className:"card-actions",children:[(0,i.jsx)("input",{type:"text",placeholder:"Search presets...",value:f,onChange:e=>{j(e.target.value)},className:"search-input"}),(0,i.jsx)("button",{onClick:()=>v(!0),className:"btn",children:"Create New Preset"})]})]}),(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{textAlign:"center"},children:"Name"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Config ID"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Description"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Slaves"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Actions"})]})}),(0,i.jsx)("tbody",{children:o.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{textAlign:"center"},children:e.name}),(0,i.jsx)("td",{style:{textAlign:"center"},children:e.config_id}),(0,i.jsx)("td",{style:{textAlign:"center"},children:e.description}),(0,i.jsx)("td",{style:{textAlign:"center"},children:e.slaves_count||0}),(0,i.jsxs)("td",{style:{textAlign:"center"},children:[(0,i.jsx)("button",{onClick:()=>(e=>{y(e)})(e),style:{background:"none",border:"none",cursor:"pointer",color:"#94a3b8",margin:"0 6px"},title:"View Details",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,i.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}),(0,i.jsx)("button",{onClick:()=>ee(e),style:{background:"none",border:"none",cursor:"pointer",color:"#6366f1",margin:"0 6px"},title:"Configure Slaves",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,i.jsx)("line",{x1:"9",y1:"9",x2:"15",y2:"15"}),(0,i.jsx)("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),(0,i.jsx)("line",{x1:"21",y1:"3",x2:"3",y2:"21"})]})}),(0,i.jsx)("button",{onClick:()=>(e=>{p(e),U({config_id:e.gateway_configuration.general_settings.config_id,name:e.name,description:e.description,baud_rate:e.gateway_configuration.uart_configuration.baud_rate,data_bits:e.gateway_configuration.uart_configuration.data_bits,stop_bits:e.gateway_configuration.uart_configuration.stop_bits,parity:"None"===e.gateway_configuration.uart_configuration.parity?0:"Odd"===e.gateway_configuration.uart_configuration.parity?1:2}),te(e.gateway_configuration.general_settings.config_id).catch(e=>{console.error("Failed to load slaves for preset edit:",e)})})(e),style:{background:"none",border:"none",cursor:"pointer",color:"#f8fafc",margin:"0 6px"},title:"Edit",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,i.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,i.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete preset ".concat(e.name,"?")))try{await n.K.deletePreset(e.id);const t=s.filter(t=>t.id!==e.id);l(t);const a=f.toLowerCase(),r=t.filter(e=>e.name.toLowerCase().includes(a)||e.config_id.toLowerCase().includes(a)||e.description.toLowerCase().includes(a));c(r)}catch(t){g(t instanceof Error?t.message:"Failed to delete preset")}})(e),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444",margin:"0 6px"},title:"Delete",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,i.jsx)("path",{d:"M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"}),(0,i.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,i.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]},e.id))})]})]}),(m||x)&&(0,i.jsx)("div",{className:"modal",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsx)("h3",{children:m?"Edit Preset: ".concat(m.name):"Create New Preset"}),(0,i.jsx)("div",{className:"modal-body",children:(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),m?X():Z()},children:[(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Preset Details"}),(0,i.jsxs)("div",{className:"form-grid form-grid-2",children:[m&&(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Config ID"}),(0,i.jsx)("input",{type:"text",value:M.config_id,onChange:e=>U((0,a.A)((0,a.A)({},M),{},{config_id:e.target.value})),required:!0,autoComplete:"off",readOnly:!0,className:"form-control-readonly"})]}),(0,i.jsxs)("div",{className:"form-group",style:m?{}:{gridColumn:"1 / -1"},children:[(0,i.jsx)("label",{children:"Preset Name"}),(0,i.jsx)("input",{type:"text",value:m?M.name:J.name,onChange:e=>m?U((0,a.A)((0,a.A)({},M),{},{name:e.target.value})):W((0,a.A)((0,a.A)({},J),{},{name:e.target.value})),required:!0,autoComplete:"off",placeholder:"e.g., Standard Gateway Config"})]}),(0,i.jsxs)("div",{className:"form-group full-width",children:[(0,i.jsx)("label",{children:"Description"}),(0,i.jsx)("textarea",{value:m?M.description:J.description,onChange:e=>m?U((0,a.A)((0,a.A)({},M),{},{description:e.target.value})):W((0,a.A)((0,a.A)({},J),{},{description:e.target.value})),autoComplete:"off",placeholder:"Describe the purpose of this preset...",rows:2})]})]})]}),(0,i.jsxs)("div",{className:"form-section compact-inputs",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"UART Configuration"}),(0,i.jsxs)("div",{className:"form-grid form-grid-4",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Baud Rate"}),(0,i.jsxs)("select",{value:m?M.baud_rate:J.baud_rate,onChange:e=>m?U((0,a.A)((0,a.A)({},M),{},{baud_rate:parseInt(e.target.value)})):W((0,a.A)((0,a.A)({},J),{},{baud_rate:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:9600,children:"9600"}),(0,i.jsx)("option",{value:19200,children:"19200"}),(0,i.jsx)("option",{value:38400,children:"38400"}),(0,i.jsx)("option",{value:57600,children:"57600"}),(0,i.jsx)("option",{value:115200,children:"115200"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Data Bits"}),(0,i.jsxs)("select",{value:m?M.data_bits:J.data_bits,onChange:e=>m?U((0,a.A)((0,a.A)({},M),{},{data_bits:parseInt(e.target.value)})):W((0,a.A)((0,a.A)({},J),{},{data_bits:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:7,children:"7"}),(0,i.jsx)("option",{value:8,children:"8"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Stop Bits"}),(0,i.jsxs)("select",{value:m?M.stop_bits:J.stop_bits,onChange:e=>m?U((0,a.A)((0,a.A)({},M),{},{stop_bits:parseInt(e.target.value)})):W((0,a.A)((0,a.A)({},J),{},{stop_bits:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:1,children:"1"}),(0,i.jsx)("option",{value:2,children:"2"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Parity"}),(0,i.jsxs)("select",{value:m?M.parity:J.parity,onChange:e=>m?U((0,a.A)((0,a.A)({},M),{},{parity:parseInt(e.target.value)})):W((0,a.A)((0,a.A)({},J),{},{parity:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:0,children:"None"}),(0,i.jsx)("option",{value:1,children:"Odd"}),(0,i.jsx)("option",{value:2,children:"Even"})]})]})]})]}),x&&(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Initial Slave Setup"}),(0,i.jsx)("p",{className:"form-section-desc",children:"Optionally configure a slave device for this preset immediately."}),(0,i.jsxs)("div",{className:"slave-options-container",children:[(0,i.jsxs)("div",{className:"slave-option-card",children:[(0,i.jsx)("div",{className:"slave-option-header",children:(0,i.jsxs)("label",{className:"radio-card-label",children:[(0,i.jsx)("input",{type:"radio",name:"slaveMode",checked:"create"===k,onChange:()=>E("create")}),(0,i.jsx)("span",{children:"Create New Slave"})]})}),(0,i.jsxs)("div",{className:"slave-option-content ".concat("create"===k?"active":""),children:[(0,i.jsx)("p",{className:"text-sm text-muted",children:"Define a new slave device configuration from scratch."}),"create"===k&&(0,i.jsx)("div",{className:"nested-form",children:(0,i.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Slave ID"}),(0,i.jsx)("input",{type:"number",value:z.slave_id,onChange:e=>H((0,a.A)((0,a.A)({},z),{},{slave_id:e.target.value})),required:!0,placeholder:"1-247"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Device Name"}),(0,i.jsx)("input",{type:"text",value:z.device_name,onChange:e=>H((0,a.A)((0,a.A)({},z),{},{device_name:e.target.value})),required:!0,placeholder:"Device Name"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Polling (ms)"}),(0,i.jsx)("input",{type:"number",value:z.polling_interval_ms,onChange:e=>H((0,a.A)((0,a.A)({},z),{},{polling_interval_ms:parseInt(e.target.value)})),placeholder:"5000"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Timeout (ms)"}),(0,i.jsx)("input",{type:"number",value:z.timeout_ms,onChange:e=>H((0,a.A)((0,a.A)({},z),{},{timeout_ms:parseInt(e.target.value)})),placeholder:"1000"})]})]})})]})]}),(0,i.jsxs)("div",{className:"slave-option-card",children:[(0,i.jsx)("div",{className:"slave-option-header",children:(0,i.jsxs)("label",{className:"radio-card-label",children:[(0,i.jsx)("input",{type:"radio",name:"slaveMode",checked:"select"===k,onChange:()=>E("select")}),(0,i.jsx)("span",{children:"Link Existing Slave"})]})}),(0,i.jsxs)("div",{className:"slave-option-content ".concat("select"===k?"active":""),children:[(0,i.jsx)("p",{className:"text-sm text-muted",children:"Select an existing slave configuration to reuse."}),"select"===k&&(0,i.jsx)("div",{style:{marginTop:"10px"},children:P?(0,i.jsx)("p",{className:"text-sm text-muted",children:"Loading slaves..."}):0===D.length?(0,i.jsx)("p",{className:"text-sm text-muted",children:"No existing slaves found."}):(()=>{const e=D.filter(e=>e.deviceName.toLowerCase().includes(B.toLowerCase())||String(e.slaveId).includes(B));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{type:"text",placeholder:"Search by name or slave ID\u2026",value:B,onChange:e=>F(e.target.value),style:{width:"100%",marginBottom:"8px",padding:"6px 10px",borderRadius:"4px",border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.6)",color:"#f8fafc",fontSize:"0.875rem",boxSizing:"border-box"}}),(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"6px",maxHeight:"200px",overflowY:"auto",border:"1px solid rgba(148,163,184,0.15)",borderRadius:"4px",padding:"8px"},children:0===e.length?(0,i.jsx)("p",{style:{margin:0,color:"#94a3b8",fontSize:"0.85em"},children:"No slaves match your search."}):e.map(e=>(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",padding:"4px 6px",borderRadius:"3px",background:q.includes(e.id)?"rgba(99,102,241,0.2)":"transparent"},children:[(0,i.jsx)("input",{type:"checkbox",checked:q.includes(e.id),onChange:t=>{t.target.checked?R([...q,e.id]):R(q.filter(t=>t!==e.id))}}),(0,i.jsxs)("span",{children:[(0,i.jsx)("strong",{children:e.deviceName})," ",(0,i.jsxs)("span",{style:{color:"#94a3b8",fontSize:"0.85em"},children:["(Slave ID: ",e.slaveId,")"]})]})]},e.id))}),(0,i.jsxs)("small",{className:"form-hint",style:{marginTop:"4px",display:"block"},children:[e.length," of ",D.length," shown",q.length>0&&(0,i.jsxs)("span",{className:"form-hint-accent",children:[" \xb7 ",q.length," selected"]})]})]})})()})]})]}),(0,i.jsxs)("div",{className:"slave-option-card",children:[(0,i.jsx)("div",{className:"slave-option-header",children:(0,i.jsxs)("label",{className:"radio-card-label",children:[(0,i.jsx)("input",{type:"radio",name:"slaveMode",checked:"none"===k,onChange:()=>E("none")}),(0,i.jsx)("span",{children:"Skip for Now"})]})}),(0,i.jsx)("div",{className:"slave-option-content",children:(0,i.jsx)("p",{className:"text-sm text-muted",children:"Create preset without any initial slave configuration."})})]})]})]}),m&&(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Preset Slave Devices"}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("div",{className:"card-header",children:[(0,i.jsxs)("h5",{children:["Slaves (",A.length,")"]}),(0,i.jsx)("button",{type:"button",onClick:()=>ee(m),className:"btn btn-sm",children:"Configure Slaves"})]}),0===A.length?(0,i.jsx)("div",{style:{textAlign:"center",padding:"10px",color:"#666"},children:(0,i.jsx)("p",{children:"No slave devices for this preset."})}):(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{textAlign:"center"},children:"Slave ID"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Device Name"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Polling"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Timeout"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Registers"})]})}),(0,i.jsx)("tbody",{children:A.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{textAlign:"center"},children:e.slaveId}),(0,i.jsx)("td",{children:e.deviceName}),(0,i.jsxs)("td",{style:{textAlign:"center"},children:[e.pollingIntervalMs,"ms"]}),(0,i.jsxs)("td",{style:{textAlign:"center"},children:[e.timeoutMs,"ms"]}),(0,i.jsx)("td",{style:{textAlign:"center"},children:e.registers.length})]},e.id))})]})]})]})]})}),(0,i.jsxs)("div",{className:"form-actions",children:[(0,i.jsx)("button",{type:"submit",className:"btn",onClick:e=>{e.preventDefault(),m?X():Z()},children:m?"Save":"Create"}),(0,i.jsx)("button",{type:"button",onClick:()=>{p(null),v(!1),E("none"),R([]),F("")},className:"btn btn-secondary",children:"Cancel"})]})]})}),b&&(0,i.jsx)("div",{className:"modal",children:(0,i.jsxs)("div",{className:"modal-content",style:{maxWidth:"700px"},children:[(0,i.jsxs)("h3",{style:{marginBottom:12},children:["Gateway Configuration: ",b.name]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginBottom:16,paddingLeft:20},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{style:{marginBottom:8},children:"General Settings"}),(0,i.jsxs)("div",{style:{paddingLeft:0},children:[(0,i.jsxs)("p",{style:{margin:"6px 0",wordBreak:"break-word"},children:[(0,i.jsx)("strong",{children:"Config ID:"})," ",b.gateway_configuration.general_settings.config_id]}),(0,i.jsxs)("p",{style:{margin:"6px 0"},children:[(0,i.jsx)("strong",{children:"Schema Version:"})," ",b.gateway_configuration.general_settings.schema_version]}),(0,i.jsxs)("p",{style:{margin:"6px 0"},children:[(0,i.jsx)("strong",{children:"Last Updated:"})," ",b.gateway_configuration.general_settings.last_updated]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{style:{marginBottom:8},children:"UART Configuration"}),(0,i.jsxs)("div",{style:{paddingLeft:0},children:[(0,i.jsxs)("p",{style:{margin:"6px 0"},children:[(0,i.jsx)("strong",{children:"Baud Rate:"})," ",b.gateway_configuration.uart_configuration.baud_rate]}),(0,i.jsxs)("p",{style:{margin:"6px 0"},children:[(0,i.jsx)("strong",{children:"Data Bits:"})," ",b.gateway_configuration.uart_configuration.data_bits]}),(0,i.jsxs)("p",{style:{margin:"6px 0"},children:[(0,i.jsx)("strong",{children:"Stop Bits:"})," ",b.gateway_configuration.uart_configuration.stop_bits]}),(0,i.jsxs)("p",{style:{margin:"6px 0"},children:[(0,i.jsx)("strong",{children:"Parity:"})," ",b.gateway_configuration.uart_configuration.parity]})]})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"20px",paddingLeft:20},children:[(0,i.jsxs)("p",{style:{margin:"6px 0",wordBreak:"break-word"},children:[(0,i.jsx)("strong",{children:"Description:"})," ",b.description||(0,i.jsx)("em",{children:"No description"})]}),(0,i.jsxs)("p",{style:{margin:"6px 0"},children:[(0,i.jsx)("strong",{children:"Slave Devices:"})," ",b.slaves_count]})]}),(0,i.jsx)("div",{className:"form-actions",children:(0,i.jsx)("button",{onClick:()=>{y(null)},className:"btn btn-secondary",children:"Close"})})]})}),_&&(0,i.jsx)("div",{className:"modal",children:(0,i.jsxs)("div",{className:"modal-content",style:{maxWidth:"1200px",maxHeight:"90vh",overflow:"auto"},children:[(0,i.jsxs)("h3",{children:["Configure Slaves: ",_.name]}),u&&(0,i.jsxs)("div",{className:"error",style:{marginBottom:"20px",padding:"10px",backgroundColor:"#f8d7da",border:"1px solid #f5c6cb",borderRadius:"4px",color:"#721c24"},children:[(0,i.jsx)("strong",{children:"Error:"})," ",u,(0,i.jsx)("button",{onClick:()=>g(null),style:{float:"right",background:"none",border:"none",color:"#721c24",cursor:"pointer",fontSize:"16px"},title:"Close error",children:"\xd7"})]}),(0,i.jsxs)("div",{className:"card",style:{marginBottom:"20px"},children:[(0,i.jsxs)("div",{className:"card-header",children:[(0,i.jsxs)("h4",{children:["Slave Devices (",A.length,")"]}),(0,i.jsx)("button",{onClick:()=>{H({slave_id:"",device_name:"",polling_interval_ms:5e3,timeout_ms:1e3,enabled:!0,registers:[]}),I(null),C(!0)},className:"btn",children:"Add Slave"})]}),0===A.length?(0,i.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#666"},children:[(0,i.jsx)("p",{children:"No slave devices configured yet."}),(0,i.jsx)("p",{children:'Click "Add Slave" to configure your first slave device.'})]}):(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{textAlign:"center"},children:"Slave ID"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Device Name"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Polling Interval"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Timeout"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Status"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Registers"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Actions"})]})}),(0,i.jsx)("tbody",{children:A.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{textAlign:"center"},children:e.slaveId}),(0,i.jsx)("td",{children:e.deviceName}),(0,i.jsxs)("td",{style:{textAlign:"center"},children:[e.pollingIntervalMs,"ms"]}),(0,i.jsxs)("td",{style:{textAlign:"center"},children:[e.timeoutMs,"ms"]}),(0,i.jsx)("td",{style:{textAlign:"center"},children:(0,i.jsx)("span",{className:e.enabled?"status-online":"status-offline",children:e.enabled?"Enabled":"Disabled"})}),(0,i.jsx)("td",{style:{textAlign:"center"},children:e.registers.length}),(0,i.jsxs)("td",{style:{textAlign:"center"},children:[e.attached?(0,i.jsx)("button",{onClick:()=>(async e=>{if(_)try{await n.K.detachSlaveFromPreset(_.config_id,e.slaveId),await te(_.config_id),se(_.config_id,A.filter(e=>e.attached).length-1)}catch(t){g(t instanceof Error?t.message:"Failed to detach slave from preset")}})(e),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444",marginRight:"8px"},title:"Remove from preset",children:"Remove"}):(0,i.jsx)("button",{onClick:()=>(async e=>{if(_)try{await n.K.addSlavesToPreset(_.config_id,[e.id]),await te(_.config_id),se(_.config_id,A.filter(e=>e.attached).length+1)}catch(t){g(t instanceof Error?t.message:"Failed to attach slave to preset")}})(e),style:{background:"none",border:"none",cursor:"pointer",color:"#10b981",marginRight:"8px"},title:"Add to preset",children:"Add"}),(0,i.jsx)("button",{onClick:()=>(e=>{H({slave_id:e.slaveId.toString(),device_name:e.deviceName,polling_interval_ms:e.pollingIntervalMs,timeout_ms:e.timeoutMs,enabled:e.enabled,registers:[...e.registers]}),I(e)})(e),style:{background:"none",border:"none",cursor:"pointer",color:"#f8fafc",marginRight:"10px"},title:"Edit",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,i.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,i.jsx)("button",{onClick:()=>(async e=>{if(_&&window.confirm("Are you sure you want to delete slave ".concat(e.deviceName,"?")))try{await n.K.deleteSlave(_.config_id,e.slaveId);const t=A.filter(t=>t.id!==e.id);w(t),se(_.config_id,t.length)}catch(t){g(t instanceof Error?t.message:"Failed to delete slave")}})(e),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444"},title:"Delete",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,i.jsx)("path",{d:"M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"}),(0,i.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,i.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]},e.id))})]})]}),(0,i.jsx)("div",{className:"form-actions",children:(0,i.jsx)("button",{onClick:()=>{N(null),w([]),C(!1),I(null),H({slave_id:"",device_name:"",polling_interval_ms:5e3,timeout_ms:1e3,enabled:!0,registers:[]})},className:"btn btn-secondary",children:"Close"})})]})}),(S||T)&&_&&(0,i.jsx)("div",{className:"modal",children:(0,i.jsxs)("div",{className:"modal-content large-modal",children:[(0,i.jsx)("h3",{children:T?"Edit Slave: ".concat(T.deviceName):"Configure New Slave"}),(0,i.jsx)("div",{className:"modal-body",children:(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),ae()},children:[(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Basic Information"}),(0,i.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Slave ID"}),(0,i.jsx)("input",{type:"number",value:z.slave_id,onChange:e=>H((0,a.A)((0,a.A)({},z),{},{slave_id:e.target.value})),required:!0,min:"1",max:"247",placeholder:"1-247"}),(0,i.jsxs)("small",{className:"form-hint",children:["Unique identifier (1-247)",A.length>0&&(0,i.jsxs)("span",{className:"form-hint-accent",children:["Existing: ",A.map(e=>e.slaveId).join(", ")]})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Device Name"}),(0,i.jsx)("input",{type:"text",value:z.device_name,onChange:e=>H((0,a.A)((0,a.A)({},z),{},{device_name:e.target.value})),required:!0,placeholder:"e.g., Solar Inverter"})]})]})]}),(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Communication Settings"}),(0,i.jsxs)("div",{className:"form-grid form-grid-3",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Polling Interval (ms)"}),(0,i.jsx)("input",{type:"number",value:z.polling_interval_ms,onChange:e=>H((0,a.A)((0,a.A)({},z),{},{polling_interval_ms:parseInt(e.target.value)})),min:"100",placeholder:"5000"}),(0,i.jsx)("small",{className:"form-hint",children:"How often to poll"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Timeout (ms)"}),(0,i.jsx)("input",{type:"number",value:z.timeout_ms,onChange:e=>H((0,a.A)((0,a.A)({},z),{},{timeout_ms:parseInt(e.target.value)})),min:"100",placeholder:"1000"}),(0,i.jsx)("small",{className:"form-hint",children:"Response timeout"})]}),(0,i.jsxs)("div",{className:"form-group checkbox-group",children:[(0,i.jsx)("label",{children:"Status"}),(0,i.jsxs)("label",{className:"checkbox-label checkbox-vertical",children:[(0,i.jsx)("input",{type:"checkbox",checked:z.enabled,onChange:e=>H((0,a.A)((0,a.A)({},z),{},{enabled:e.target.checked}))}),(0,i.jsx)("span",{className:z.enabled?"status-text-enabled":"status-text-disabled",children:z.enabled?"Enabled":"Disabled"})]})]})]})]}),(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Register Mappings"}),(0,i.jsx)("p",{className:"form-section-desc",children:"Configure the Modbus registers to read from this slave device."}),(0,i.jsxs)("div",{className:"form-subsection",children:[(0,i.jsx)("h5",{className:"form-subsection-title",children:"Add New Register"}),(0,i.jsxs)("div",{className:"form-grid form-grid-auto",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Label *"}),(0,i.jsx)("input",{type:"text",placeholder:"e.g., Battery_Voltage",value:K.label,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{label:e.target.value}))})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Address *"}),(0,i.jsx)("input",{type:"number",placeholder:"40001",value:K.address,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{address:parseInt(e.target.value)})),min:"1"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Num Registers"}),(0,i.jsx)("input",{type:"number",placeholder:"1",value:K.num_registers||1,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{num_registers:parseInt(e.target.value)})),min:"1",max:"125"}),(0,i.jsx)("small",{className:"form-hint",children:"Count (1-125)"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Function Code *"}),(0,i.jsxs)("select",{value:K.function_code||3,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{function_code:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:1,children:"0x01 - Read Coils"}),(0,i.jsx)("option",{value:2,children:"0x02 - Read Discrete Inputs"}),(0,i.jsx)("option",{value:3,children:"0x03 - Read Holding Registers"}),(0,i.jsx)("option",{value:4,children:"0x04 - Read Input Registers"}),(0,i.jsx)("option",{value:5,children:"0x05 - Write Single Coil"}),(0,i.jsx)("option",{value:6,children:"0x06 - Write Single Register"}),(0,i.jsx)("option",{value:15,children:"0x0F - Write Multiple Coils"}),(0,i.jsx)("option",{value:16,children:"0x10 - Write Multiple Registers"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Register Type"}),(0,i.jsxs)("select",{value:K.register_type||3,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{register_type:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:0,children:"Coil (0x - R/W Discrete)"}),(0,i.jsx)("option",{value:1,children:"Discrete Input (1x - RO Discrete)"}),(0,i.jsx)("option",{value:2,children:"Input Register (3x - RO Analog)"}),(0,i.jsx)("option",{value:3,children:"Holding Register (4x - R/W Analog)"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Data Type *"}),(0,i.jsxs)("select",{value:K.data_type,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{data_type:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:0,children:"UINT16 (16-bit Unsigned)"}),(0,i.jsx)("option",{value:1,children:"INT16 (16-bit Signed)"}),(0,i.jsx)("option",{value:2,children:"UINT32 (32-bit Unsigned)"}),(0,i.jsx)("option",{value:3,children:"INT32 (32-bit Signed)"}),(0,i.jsx)("option",{value:4,children:"FLOAT32 (32-bit Float)"}),(0,i.jsx)("option",{value:5,children:"UINT64 (64-bit Unsigned)"}),(0,i.jsx)("option",{value:6,children:"INT64 (64-bit Signed)"}),(0,i.jsx)("option",{value:7,children:"FLOAT64 (64-bit Float)"}),(0,i.jsx)("option",{value:8,children:"BOOL (Single Bit)"}),(0,i.jsx)("option",{value:9,children:"STRING (ASCII)"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Byte Order"}),(0,i.jsxs)("select",{value:K.byte_order||0,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{byte_order:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:0,children:"Big Endian (AB)"}),(0,i.jsx)("option",{value:1,children:"Little Endian (BA)"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Word Order"}),(0,i.jsxs)("select",{value:K.word_order||0,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{word_order:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:0,children:"Big Endian (AB CD)"}),(0,i.jsx)("option",{value:1,children:"Little Endian (CD AB)"}),(0,i.jsx)("option",{value:2,children:"Mid-Big Endian (BA DC)"}),(0,i.jsx)("option",{value:3,children:"Mid-Little Endian (DC BA)"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Decimal Places"}),(0,i.jsx)("input",{type:"number",placeholder:"2",value:K.decimal_places||2,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{decimal_places:parseInt(e.target.value)})),min:"0",max:"6"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Access Mode"}),(0,i.jsxs)("select",{value:K.access_mode||0,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{access_mode:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:0,children:"Read Only"}),(0,i.jsx)("option",{value:1,children:"Read/Write"}),(0,i.jsx)("option",{value:2,children:"Write Only"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Scale Factor"}),(0,i.jsx)("input",{type:"number",placeholder:"1.0",value:K.scale_factor,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{scale_factor:parseFloat(e.target.value)})),step:"0.001"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Offset"}),(0,i.jsx)("input",{type:"number",placeholder:"0.0",value:K.offset,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{offset:parseFloat(e.target.value)})),step:"0.01"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Unit"}),(0,i.jsx)("input",{type:"text",placeholder:"V, A, W, \xb0C, etc.",value:K.unit||"",onChange:e=>G((0,a.A)((0,a.A)({},K),{},{unit:e.target.value}))})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Category"}),(0,i.jsxs)("select",{value:K.category||"Electrical",onChange:e=>G((0,a.A)((0,a.A)({},K),{},{category:e.target.value})),children:[(0,i.jsx)("option",{value:"Electrical",children:"Electrical"}),(0,i.jsx)("option",{value:"Temperature",children:"Temperature"}),(0,i.jsx)("option",{value:"Status",children:"Status"}),(0,i.jsx)("option",{value:"Control",children:"Control"}),(0,i.jsx)("option",{value:"Energy",children:"Energy"}),(0,i.jsx)("option",{value:"Power",children:"Power"}),(0,i.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"High Alarm"}),(0,i.jsx)("input",{type:"number",placeholder:"Optional",value:null!==(e=K.high_alarm_threshold)&&void 0!==e?e:"",onChange:e=>G((0,a.A)((0,a.A)({},K),{},{high_alarm_threshold:e.target.value?parseFloat(e.target.value):null})),step:"0.01"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Low Alarm"}),(0,i.jsx)("input",{type:"number",placeholder:"Optional",value:null!==(t=K.low_alarm_threshold)&&void 0!==t?t:"",onChange:e=>G((0,a.A)((0,a.A)({},K),{},{low_alarm_threshold:e.target.value?parseFloat(e.target.value):null})),step:"0.01"})]}),(0,i.jsxs)("div",{className:"form-group checkbox-group",children:[(0,i.jsx)("label",{children:"Enabled"}),(0,i.jsxs)("label",{className:"checkbox-label checkbox-vertical",children:[(0,i.jsx)("input",{type:"checkbox",checked:K.enabled,onChange:e=>G((0,a.A)((0,a.A)({},K),{},{enabled:e.target.checked}))}),(0,i.jsx)("span",{children:K.enabled?"Yes":"No"})]})]}),(0,i.jsx)("div",{className:"form-group form-group-btn",children:(0,i.jsx)("button",{type:"button",onClick:()=>{const e={id:Date.now(),label:K.label,address:K.address,numRegisters:K.num_registers,functionCode:K.function_code,registerType:K.register_type,dataType:K.data_type,byteOrder:K.byte_order,wordOrder:K.word_order,accessMode:K.access_mode,scaleFactor:K.scale_factor,offset:K.offset,unit:K.unit,decimalPlaces:K.decimal_places,category:K.category,highAlarmThreshold:K.high_alarm_threshold,lowAlarmThreshold:K.low_alarm_threshold,description:K.description,enabled:K.enabled};H((0,a.A)((0,a.A)({},z),{},{registers:[...z.registers,e]})),G({label:"",address:0,num_registers:1,function_code:3,register_type:3,data_type:0,byte_order:0,word_order:0,access_mode:0,scale_factor:1,offset:0,unit:"",decimal_places:2,category:"Electrical",high_alarm_threshold:null,low_alarm_threshold:null,description:"",enabled:!0})},className:"btn btn-sm",children:"Add Register"})})]}),(0,i.jsxs)("div",{className:"form-group",style:{marginTop:"10px"},children:[(0,i.jsx)("label",{children:"Description"}),(0,i.jsx)("input",{type:"text",placeholder:"e.g., 0=Off, 1=On, 2=Standby",value:K.description||"",onChange:e=>G((0,a.A)((0,a.A)({},K),{},{description:e.target.value})),style:{width:"100%"}})]})]}),z.registers.length>0?(0,i.jsxs)("div",{className:"registers-table-wrapper",children:[(0,i.jsxs)("h5",{className:"form-subsection-title",children:["Configured Registers (",z.registers.length,")"]}),(0,i.jsxs)("table",{className:"table registers-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Label"}),(0,i.jsx)("th",{children:"Address"}),(0,i.jsx)("th",{children:"Function"}),(0,i.jsx)("th",{children:"Data Type"}),(0,i.jsx)("th",{children:"Unit"}),(0,i.jsx)("th",{children:"Scale"}),(0,i.jsx)("th",{children:"Offset"}),(0,i.jsx)("th",{children:"Category"}),(0,i.jsx)("th",{children:"Alarms"}),(0,i.jsx)("th",{children:"Status"}),(0,i.jsx)("th",{children:"Actions"})]})}),(0,i.jsx)("tbody",{children:z.registers.map((e,t)=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.label}),(0,i.jsx)("td",{children:e.address}),(0,i.jsx)("td",{children:e.functionCode||3}),(0,i.jsx)("td",{children:$(e.dataType)}),(0,i.jsx)("td",{children:e.unit||"-"}),(0,i.jsx)("td",{children:e.scaleFactor}),(0,i.jsx)("td",{children:e.offset}),(0,i.jsx)("td",{children:e.category||"-"}),(0,i.jsx)("td",{children:e.highAlarmThreshold||e.lowAlarmThreshold?(0,i.jsxs)("small",{children:[e.highAlarmThreshold&&"H:".concat(e.highAlarmThreshold),e.highAlarmThreshold&&e.lowAlarmThreshold&&" / ",e.lowAlarmThreshold&&"L:".concat(e.lowAlarmThreshold)]}):"-"}),(0,i.jsx)("td",{children:(0,i.jsx)("span",{className:"status-badge ".concat(e.enabled?"status-badge-success":"status-badge-danger"),children:e.enabled?"Enabled":"Disabled"})}),(0,i.jsx)("td",{children:(0,i.jsx)("button",{type:"button",onClick:()=>(e=>{H((0,a.A)((0,a.A)({},z),{},{registers:z.registers.filter((t,s)=>s!==e)}))})(t),className:"btn-icon btn-icon-danger",title:"Remove",children:"\u2715"})})]},t))})]})]}):(0,i.jsx)("div",{className:"empty-state",children:"No registers configured yet. Add registers above to define what data to read from this slave device."})]})]})}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-primary",onClick:e=>{e.preventDefault(),ae()},children:T?"Save Changes":"Create Slave"}),(0,i.jsx)("button",{type:"button",onClick:()=>{C(!1),I(null)},className:"btn btn-secondary",children:"Cancel"})]})]})})]})}},5560(e,t,s){s.d(t,{K:()=>o});var a=s(2555);class r{constructor(){this.cache=new Map,this.subscribers=new Map}set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.DEFAULT_TTL,a=arguments.length>3?arguments[3]:void 0;this.cache.set(e,{data:t,timestamp:Date.now(),expiresIn:s,staleTime:null!==a&&void 0!==a?a:Math.min(s/2,r.STALE_TIME)}),this.notifySubscribers(e,t)}get(e){const t=this.cache.get(e);if(!t)return null;return Date.now()-t.timestamp>t.expiresIn?(this.cache.delete(e),null):t.data}getWithStaleStatus(e){var t;const s=this.cache.get(e);if(!s)return null;const a=Date.now()-s.timestamp,r=a>s.expiresIn,n=a>(null!==(t=s.staleTime)&&void 0!==t?t:s.expiresIn/2);return r?(this.cache.delete(e),null):{data:s.data,isStale:n,isExpired:!1}}has(e){const t=this.cache.get(e);if(!t)return!1;return!(Date.now()-t.timestamp>t.expiresIn)||(this.cache.delete(e),!1)}isStale(e){var t;const s=this.cache.get(e);if(!s)return!0;return Date.now()-s.timestamp>(null!==(t=s.staleTime)&&void 0!==t?t:s.expiresIn/2)}clear(e){this.cache.delete(e)}clearPattern(e){const t="string"===typeof e?new RegExp(e):e,s=[];this.cache.forEach((e,a)=>{t.test(a)&&s.push(a)}),s.forEach(e=>this.cache.delete(e))}clearAll(){this.cache.clear()}size(){return this.cache.size}subscribe(e,t){this.subscribers.has(e)||this.subscribers.set(e,new Set);const s={callback:t};return this.subscribers.get(e).add(s),()=>{const t=this.subscribers.get(e);t&&(t.delete(s),0===t.size&&this.subscribers.delete(e))}}subscribePattern(e,t){const s="__pattern__".concat(e.source);this.subscribers.has(s)||this.subscribers.set(s,new Set);const a={callback:t,pattern:e};return this.subscribers.get(s).add(a),()=>{const e=this.subscribers.get(s);e&&(e.delete(a),0===e.size&&this.subscribers.delete(s))}}notifySubscribers(e,t){const s=this.subscribers.get(e);s&&s.forEach(s=>{try{s.callback(t)}catch(a){console.error("Cache subscriber error for key ".concat(e,":"),a)}}),this.subscribers.forEach((s,a)=>{a.startsWith("__pattern__")&&s.forEach(s=>{if(s.pattern&&s.pattern.test(e))try{s.callback(t)}catch(a){console.error("Cache pattern subscriber error for key ".concat(e,":"),a)}})})}keys(){return Array.from(this.cache.keys())}getStats(){return{size:this.cache.size,keys:this.keys(),subscribers:Array.from(this.subscribers.values()).reduce((e,t)=>e+t.size,0)}}static getTTL(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short"){case"realtime":return r.REALTIME_TTL;case"long":return r.LONG_TTL;default:return r.DEFAULT_TTL}}}r.DEFAULT_TTL=3e5,r.LONG_TTL=18e5,r.REALTIME_TTL=1e4,r.STALE_TIME=3e4;const n=new r,i=3e5,l="https://smart-solar-django-backend.vercel.app/api";const o=new class{getAuthHeaders(){const e=localStorage.getItem("authTokens");if(e)try{const t=JSON.parse(e);return{Authorization:"Bearer ".concat(t.access),"Content-Type":"application/json"}}catch(t){console.error("Error parsing auth tokens:",t)}return{"Content-Type":"application/json"}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s="".concat(l).concat(e);let r=this.getAuthHeaders(),n=await fetch(s,(0,a.A)((0,a.A)({},t),{},{headers:(0,a.A)((0,a.A)({},r),t.headers)}));if(401===n.status){await this.refreshToken()&&(r=this.getAuthHeaders(),n=await fetch(s,(0,a.A)((0,a.A)({},t),{},{headers:(0,a.A)((0,a.A)({},r),t.headers)})))}if(401===n.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!n.ok){const e=await n.text();throw new Error("API request failed: ".concat(n.status," ").concat(n.statusText," - ").concat(e))}return n.json()}async refreshToken(){const e=localStorage.getItem("authTokens");if(!e)return!1;try{const t=JSON.parse(e),s=await fetch("".concat(l,"/auth/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t.refresh})});if(s.ok){const e={access:(await s.json()).access,refresh:t.refresh};return localStorage.setItem("authTokens",JSON.stringify(e)),!0}}catch(t){console.error("Token refresh failed:",t)}return!1}async getConfiguration(){return this.request("/config/")}async getTelemetry(){return this.request("/telemetry/")}async provisionDevice(e){const t=await fetch("".concat(l,"/devices/provision"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Provisioning failed: ".concat(t.statusText));return t.json()}async getAlerts(){const e="alerts",t=n.get(e);if(t)return t;const s=await this.request("/alerts/");return n.set(e,s,i),s}async getSystemHealth(){const e="system_health",t=n.get(e);if(t)return t;const s=await this.request("/health/");return n.set(e,s,i),s}async getKPIs(){const e="kpis",t=n.get(e);if(t)return t;const s=await this.request("/kpis/");return n.set(e,s,i),s}async getUsers(e){const t="users_".concat(e||"all"),s=n.get(t);if(s)return s;const a=e?"?search=".concat(encodeURIComponent(e)):"",r=await this.request("/users/".concat(a));return n.set(t,r,i),r}async createUser(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("users_all"),n.clearAll(),t}async createEmployee(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify((0,a.A)((0,a.A)({},e),{},{is_staff:!0}))});return n.clear("users_all"),t}async getUserDevices(e){return this.request("/users/".concat(e,"/devices/"))}async updateUser(e,t){const s=await this.request("/users/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("users_all"),s}async deleteUser(e){const t=await this.request("/users/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("users_all"),t}async getProfile(){return this.request("/profile/")}async updateProfile(e){return this.request("/profile/update/",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e){return this.request("/profile/change-password/",{method:"POST",body:JSON.stringify(e)})}async getCustomers(e){const t=e?"?search=".concat(encodeURIComponent(e)):"";return this.request("/customers/".concat(t))}async createCustomer(e){return this.request("/customers/create/",{method:"POST",body:JSON.stringify(e)})}async getCustomer(e){return this.request("/customers/".concat(e,"/"))}async updateCustomer(e,t){return this.request("/customers/".concat(e,"/update/"),{method:"PUT",body:JSON.stringify(t)})}async deleteCustomer(e){return this.request("/customers/".concat(e,"/delete/"),{method:"DELETE"})}async getPresets(){const e="presets",t=n.get(e);if(t)return t;const s=await this.request("/presets/");return n.set(e,s,18e5),s}async createPreset(e){const t=await this.request("/presets/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("presets"),t}async updatePreset(e,t){const s=await this.request("/presets/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("presets"),s}async deletePreset(e){const t=await this.request("/presets/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("presets"),t}async getGlobalSlaves(){return this.request("/slaves/")}async createGlobalSlave(e){return this.request("/slaves/create/",{method:"POST",body:JSON.stringify(e)})}async updateGlobalSlave(e,t){return this.request("/slaves/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteGlobalSlave(e){return this.request("/slaves/".concat(e,"/delete/"),{method:"DELETE"})}async getDevices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;const a=new URLSearchParams;e&&a.append("search",e),a.append("page",t.toString()),a.append("page_size",s.toString());const r=a.toString();return this.request("/devices/?".concat(r))}async createDevice(e){return this.request("/devices/create/",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,t){return this.request("/devices/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteDevice(e){return this.request("/devices/".concat(e,"/delete/"),{method:"DELETE"})}async deleteDevicesBulk(e){return this.request("/devices/delete-bulk/",{method:"POST",body:JSON.stringify({device_ids:e})})}async getSlaves(e){return this.request("/presets/".concat(e,"/slaves/"))}async createSlave(e,t){return this.request("/presets/".concat(e,"/slaves/create/"),{method:"POST",body:JSON.stringify(t)})}async updateSlave(e,t,s){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/"),{method:"PUT",body:JSON.stringify(s)})}async deleteSlave(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/delete/"),{method:"DELETE"})}async addSlavesToPreset(e,t){return this.request("/presets/".concat(e,"/slaves/add/"),{method:"POST",body:JSON.stringify({slave_ids:t})})}async detachSlaveFromPreset(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/detach/"),{method:"POST"})}async getFirmwareVersions(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=new URLSearchParams;return t.append("active",e.toString()),this.request("/ota/firmware/?".concat(t.toString()))}async uploadFirmwareVersion(e){const t="".concat(l,"/ota/firmware/create/"),s=localStorage.getItem("authTokens");if(!s)throw new Error("Authentication required");const a=JSON.parse(s);let r={Authorization:"Bearer ".concat(a.access)},n=await fetch(t,{method:"POST",headers:r,body:e});if(401===n.status){if(await this.refreshToken()){const s=JSON.parse(localStorage.getItem("authTokens")||"{}");r={Authorization:"Bearer ".concat(s.access)},n=await fetch(t,{method:"POST",headers:r,body:e})}}if(401===n.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!n.ok){const e=await n.text();throw new Error("Upload failed: ".concat(n.status," ").concat(n.statusText," - ").concat(e))}return n.json()}async updateFirmwareVersion(e,t){return this.request("/ota/firmware/".concat(e,"/"),{method:"PATCH",body:JSON.stringify(t)})}async deleteFirmwareVersion(e){return this.request("/ota/firmware/".concat(e,"/delete/"),{method:"DELETE"})}async getDeviceUpdateLogs(e){return this.request("/ota/devices/".concat(e,"/logs"))}async getOTAConfig(){return this.request("/ota/config/")}async updateOTAConfig(e){return this.request("/ota/config/update/",{method:"PATCH",body:JSON.stringify(e)})}async getOTAHealth(){return this.request("/ota/health/")}}}}]);
//# sourceMappingURL=35.d99b3107.chunk.js.map