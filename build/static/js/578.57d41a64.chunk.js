"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[578],{5578(e,t,s){s.r(t),s.d(t,{default:()=>c});var r=s(2555),a=s(5043),n=s(9066),o=s(5560),i=s(579);const c=()=>{const{user:e,updateUser:t}=(0,n.A)(),[s,c]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0),[u,h]=(0,a.useState)(null),[m,p]=(0,a.useState)(null),[g,f]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),[x,w]=(0,a.useState)({first_name:"",last_name:"",email:"",mobile_number:"",address:""}),[v,j]=(0,a.useState)({current_password:"",new_password:"",confirm_password:""});(0,a.useEffect)(()=>{S()},[]);const S=async()=>{try{d(!0);const e=await o.K.getProfile();c(e),w({first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",mobile_number:e.mobile_number||"",address:e.address||""}),h(null)}catch(e){console.error("Profile fetch error:",e),h(e instanceof Error?e.message:"Failed to load profile")}finally{d(!1)}};return l?(0,i.jsx)("div",{className:"loading",children:"Loading profile..."}):(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{children:"My Profile"}),u&&(0,i.jsxs)("div",{className:"alert alert-error",style:{marginBottom:"20px",padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px"},children:[u,(0,i.jsx)("button",{onClick:()=>h(null),style:{float:"right",background:"none",border:"none",cursor:"pointer"},children:"\xd7"})]}),m&&(0,i.jsx)("div",{className:"alert alert-success",style:{marginBottom:"20px",padding:"10px",backgroundColor:"#e8f5e9",color:"#2e7d32",borderRadius:"4px"},children:m}),(0,i.jsxs)("div",{className:"card",style:{marginBottom:"20px"},children:[(0,i.jsxs)("div",{className:"card-header",children:[(0,i.jsx)("h2",{children:"Account Information"}),!g&&(0,i.jsx)("button",{onClick:()=>f(!0),className:"btn",children:"Edit Profile"})]}),g?(0,i.jsxs)("form",{onSubmit:async s=>{s.preventDefault();try{const s=await o.K.updateProfile(x);c(s),f(!1),p("Profile updated successfully!"),t&&t((0,r.A)((0,r.A)({},e),{},{first_name:s.first_name,last_name:s.last_name,email:s.email})),setTimeout(()=>p(null),3e3)}catch(a){h(a instanceof Error?a.message:"Failed to update profile")}},style:{padding:"20px"},children:[(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Account Information"}),(0,i.jsx)("div",{className:"form-grid",children:(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Username"}),(0,i.jsx)("input",{type:"text",value:(null===s||void 0===s?void 0:s.username)||"",disabled:!0,className:"input-disabled"}),(0,i.jsx)("small",{className:"form-hint",children:"Username cannot be changed"})]})})]}),(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Personal Details"}),(0,i.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"First Name"}),(0,i.jsx)("input",{type:"text",value:x.first_name,onChange:e=>w((0,r.A)((0,r.A)({},x),{},{first_name:e.target.value})),required:!0,placeholder:"John"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Last Name"}),(0,i.jsx)("input",{type:"text",value:x.last_name,onChange:e=>w((0,r.A)((0,r.A)({},x),{},{last_name:e.target.value})),required:!0,placeholder:"Doe"})]})]})]}),(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Contact Information"}),(0,i.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Email Address"}),(0,i.jsx)("input",{type:"email",value:x.email,onChange:e=>w((0,r.A)((0,r.A)({},x),{},{email:e.target.value})),required:!0,placeholder:"john.doe@example.com"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Mobile Number"}),(0,i.jsx)("input",{type:"tel",value:x.mobile_number,onChange:e=>w((0,r.A)((0,r.A)({},x),{},{mobile_number:e.target.value})),placeholder:"+1 (555) 000-0000"})]}),(0,i.jsxs)("div",{className:"form-group full-width",children:[(0,i.jsx)("label",{children:"Address"}),(0,i.jsx)("textarea",{value:x.address,onChange:e=>w((0,r.A)((0,r.A)({},x),{},{address:e.target.value})),rows:3,placeholder:"123 Solar Street..."})]})]})]}),(0,i.jsxs)("div",{className:"form-actions",children:[(0,i.jsx)("button",{type:"submit",className:"btn",children:"Save Changes"}),(0,i.jsx)("button",{type:"button",onClick:()=>{f(!1),s&&w({first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",mobile_number:s.mobile_number||"",address:s.address||""})},className:"btn btn-secondary",children:"Cancel"})]})]}):(0,i.jsx)("div",{style:{padding:"20px"},children:(0,i.jsx)("table",{className:"profile-table",style:{width:"100%",borderCollapse:"collapse"},children:(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:"10px",fontWeight:"bold",width:"150px"},children:"Username:"}),(0,i.jsx)("td",{style:{padding:"10px"},children:null===s||void 0===s?void 0:s.username})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:"10px",fontWeight:"bold"},children:"Name:"}),(0,i.jsxs)("td",{style:{padding:"10px"},children:[null===s||void 0===s?void 0:s.first_name," ",null===s||void 0===s?void 0:s.last_name]})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:"10px",fontWeight:"bold"},children:"Email:"}),(0,i.jsx)("td",{style:{padding:"10px"},children:null===s||void 0===s?void 0:s.email})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:"10px",fontWeight:"bold"},children:"Mobile:"}),(0,i.jsx)("td",{style:{padding:"10px"},children:(null===s||void 0===s?void 0:s.mobile_number)||"-"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:"10px",fontWeight:"bold"},children:"Address:"}),(0,i.jsx)("td",{style:{padding:"10px"},children:(null===s||void 0===s?void 0:s.address)||"-"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:"10px",fontWeight:"bold"},children:"Role:"}),(0,i.jsx)("td",{style:{padding:"10px"},children:null!==s&&void 0!==s&&s.is_superuser?"Administrator":null!==s&&void 0!==s&&s.is_staff?"Employee":"User"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:"10px",fontWeight:"bold"},children:"Member Since:"}),(0,i.jsx)("td",{style:{padding:"10px"},children:null!==s&&void 0!==s&&s.date_joined?new Date(s.date_joined).toLocaleDateString():"-"})]})]})})})]}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("div",{className:"card-header",children:[(0,i.jsx)("h2",{children:"Security"}),!y&&(0,i.jsx)("button",{onClick:()=>b(!0),className:"btn",children:"Change Password"})]}),y?(0,i.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),v.new_password===v.confirm_password)if(v.new_password.length<8)h("Password must be at least 8 characters long");else try{await o.K.changePassword({current_password:v.current_password,new_password:v.new_password}),b(!1),j({current_password:"",new_password:"",confirm_password:""}),p("Password changed successfully!"),setTimeout(()=>p(null),3e3)}catch(t){h(t instanceof Error?t.message:"Failed to change password")}else h("New passwords do not match")},style:{padding:"20px"},children:[(0,i.jsxs)("div",{className:"form-group",style:{marginBottom:"15px"},children:[(0,i.jsx)("label",{children:"Current Password:"}),(0,i.jsx)("input",{type:"password",value:v.current_password,onChange:e=>j((0,r.A)((0,r.A)({},v),{},{current_password:e.target.value})),required:!0,autoComplete:"current-password"})]}),(0,i.jsxs)("div",{className:"form-group",style:{marginBottom:"15px"},children:[(0,i.jsx)("label",{children:"New Password:"}),(0,i.jsx)("input",{type:"password",value:v.new_password,onChange:e=>j((0,r.A)((0,r.A)({},v),{},{new_password:e.target.value})),required:!0,autoComplete:"new-password",minLength:8}),(0,i.jsx)("small",{style:{color:"#666"},children:"Must be at least 8 characters"})]}),(0,i.jsxs)("div",{className:"form-group",style:{marginBottom:"15px"},children:[(0,i.jsx)("label",{children:"Confirm New Password:"}),(0,i.jsx)("input",{type:"password",value:v.confirm_password,onChange:e=>j((0,r.A)((0,r.A)({},v),{},{confirm_password:e.target.value})),required:!0,autoComplete:"new-password"})]}),(0,i.jsxs)("div",{className:"form-actions",children:[(0,i.jsx)("button",{type:"submit",className:"btn",children:"Change Password"}),(0,i.jsx)("button",{type:"button",onClick:()=>{b(!1),j({current_password:"",new_password:"",confirm_password:""})},className:"btn btn-secondary",children:"Cancel"})]})]}):(0,i.jsxs)("div",{style:{padding:"20px"},children:[(0,i.jsx)("p",{children:"You can change your password here for security purposes."}),(0,i.jsx)("p",{style:{color:"#666",fontSize:"14px"},children:"It's recommended to use a strong password that you don't use on other websites."})]})]})]})}},5560(e,t,s){s.d(t,{K:()=>c});var r=s(2555);class a{constructor(){this.cache=new Map,this.subscribers=new Map}set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.DEFAULT_TTL,r=arguments.length>3?arguments[3]:void 0;this.cache.set(e,{data:t,timestamp:Date.now(),expiresIn:s,staleTime:null!==r&&void 0!==r?r:Math.min(s/2,a.STALE_TIME)}),this.notifySubscribers(e,t)}get(e){const t=this.cache.get(e);if(!t)return null;return Date.now()-t.timestamp>t.expiresIn?(this.cache.delete(e),null):t.data}getWithStaleStatus(e){var t;const s=this.cache.get(e);if(!s)return null;const r=Date.now()-s.timestamp,a=r>s.expiresIn,n=r>(null!==(t=s.staleTime)&&void 0!==t?t:s.expiresIn/2);return a?(this.cache.delete(e),null):{data:s.data,isStale:n,isExpired:!1}}has(e){const t=this.cache.get(e);if(!t)return!1;return!(Date.now()-t.timestamp>t.expiresIn)||(this.cache.delete(e),!1)}isStale(e){var t;const s=this.cache.get(e);if(!s)return!0;return Date.now()-s.timestamp>(null!==(t=s.staleTime)&&void 0!==t?t:s.expiresIn/2)}clear(e){this.cache.delete(e)}clearPattern(e){const t="string"===typeof e?new RegExp(e):e,s=[];this.cache.forEach((e,r)=>{t.test(r)&&s.push(r)}),s.forEach(e=>this.cache.delete(e))}clearAll(){this.cache.clear()}size(){return this.cache.size}subscribe(e,t){this.subscribers.has(e)||this.subscribers.set(e,new Set);const s={callback:t};return this.subscribers.get(e).add(s),()=>{const t=this.subscribers.get(e);t&&(t.delete(s),0===t.size&&this.subscribers.delete(e))}}subscribePattern(e,t){const s="__pattern__".concat(e.source);this.subscribers.has(s)||this.subscribers.set(s,new Set);const r={callback:t,pattern:e};return this.subscribers.get(s).add(r),()=>{const e=this.subscribers.get(s);e&&(e.delete(r),0===e.size&&this.subscribers.delete(s))}}notifySubscribers(e,t){const s=this.subscribers.get(e);s&&s.forEach(s=>{try{s.callback(t)}catch(r){console.error("Cache subscriber error for key ".concat(e,":"),r)}}),this.subscribers.forEach((s,r)=>{r.startsWith("__pattern__")&&s.forEach(s=>{if(s.pattern&&s.pattern.test(e))try{s.callback(t)}catch(r){console.error("Cache pattern subscriber error for key ".concat(e,":"),r)}})})}keys(){return Array.from(this.cache.keys())}getStats(){return{size:this.cache.size,keys:this.keys(),subscribers:Array.from(this.subscribers.values()).reduce((e,t)=>e+t.size,0)}}static getTTL(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short"){case"realtime":return a.REALTIME_TTL;case"long":return a.LONG_TTL;default:return a.DEFAULT_TTL}}}a.DEFAULT_TTL=3e5,a.LONG_TTL=18e5,a.REALTIME_TTL=1e4,a.STALE_TIME=3e4;const n=new a,o=3e5,i="https://smart-solar-django-backend.vercel.app/api";const c=new class{getAuthHeaders(){const e=localStorage.getItem("authTokens");if(e)try{const t=JSON.parse(e);return{Authorization:"Bearer ".concat(t.access),"Content-Type":"application/json"}}catch(t){console.error("Error parsing auth tokens:",t)}return{"Content-Type":"application/json"}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s="".concat(i).concat(e);let a=this.getAuthHeaders(),n=await fetch(s,(0,r.A)((0,r.A)({},t),{},{headers:(0,r.A)((0,r.A)({},a),t.headers)}));if(401===n.status){await this.refreshToken()&&(a=this.getAuthHeaders(),n=await fetch(s,(0,r.A)((0,r.A)({},t),{},{headers:(0,r.A)((0,r.A)({},a),t.headers)})))}if(401===n.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!n.ok){const e=await n.text();throw new Error("API request failed: ".concat(n.status," ").concat(n.statusText," - ").concat(e))}return n.json()}async refreshToken(){const e=localStorage.getItem("authTokens");if(!e)return!1;try{const t=JSON.parse(e),s=await fetch("".concat(i,"/auth/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t.refresh})});if(s.ok){const e={access:(await s.json()).access,refresh:t.refresh};return localStorage.setItem("authTokens",JSON.stringify(e)),!0}}catch(t){console.error("Token refresh failed:",t)}return!1}async getConfiguration(){return this.request("/config/")}async getTelemetry(){return this.request("/telemetry/")}async provisionDevice(e){const t=await fetch("".concat(i,"/devices/provision"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Provisioning failed: ".concat(t.statusText));return t.json()}async getAlerts(){const e="alerts",t=n.get(e);if(t)return t;const s=await this.request("/alerts/");return n.set(e,s,o),s}async getSystemHealth(){const e="system_health",t=n.get(e);if(t)return t;const s=await this.request("/health/");return n.set(e,s,o),s}async getKPIs(){const e="kpis",t=n.get(e);if(t)return t;const s=await this.request("/kpis/");return n.set(e,s,o),s}async getUsers(e){const t="users_".concat(e||"all"),s=n.get(t);if(s)return s;const r=e?"?search=".concat(encodeURIComponent(e)):"",a=await this.request("/users/".concat(r));return n.set(t,a,o),a}async createUser(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("users_all"),n.clearAll(),t}async createEmployee(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify((0,r.A)((0,r.A)({},e),{},{is_staff:!0}))});return n.clear("users_all"),t}async getUserDevices(e){return this.request("/users/".concat(e,"/devices/"))}async updateUser(e,t){const s=await this.request("/users/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("users_all"),s}async deleteUser(e){const t=await this.request("/users/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("users_all"),t}async getProfile(){return this.request("/profile/")}async updateProfile(e){return this.request("/profile/update/",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e){return this.request("/profile/change-password/",{method:"POST",body:JSON.stringify(e)})}async getCustomers(e){const t=e?"?search=".concat(encodeURIComponent(e)):"";return this.request("/customers/".concat(t))}async createCustomer(e){return this.request("/customers/create/",{method:"POST",body:JSON.stringify(e)})}async getCustomer(e){return this.request("/customers/".concat(e,"/"))}async updateCustomer(e,t){return this.request("/customers/".concat(e,"/update/"),{method:"PUT",body:JSON.stringify(t)})}async deleteCustomer(e){return this.request("/customers/".concat(e,"/delete/"),{method:"DELETE"})}async getPresets(){const e="presets",t=n.get(e);if(t)return t;const s=await this.request("/presets/");return n.set(e,s,18e5),s}async createPreset(e){const t=await this.request("/presets/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("presets"),t}async updatePreset(e,t){const s=await this.request("/presets/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("presets"),s}async deletePreset(e){const t=await this.request("/presets/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("presets"),t}async getGlobalSlaves(){return this.request("/slaves/")}async createGlobalSlave(e){return this.request("/slaves/create/",{method:"POST",body:JSON.stringify(e)})}async updateGlobalSlave(e,t){return this.request("/slaves/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteGlobalSlave(e){return this.request("/slaves/".concat(e,"/delete/"),{method:"DELETE"})}async getDevices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;const r=new URLSearchParams;e&&r.append("search",e),r.append("page",t.toString()),r.append("page_size",s.toString());const a=r.toString();return this.request("/devices/?".concat(a))}async createDevice(e){return this.request("/devices/create/",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,t){return this.request("/devices/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteDevice(e){return this.request("/devices/".concat(e,"/delete/"),{method:"DELETE"})}async deleteDevicesBulk(e){return this.request("/devices/delete-bulk/",{method:"POST",body:JSON.stringify({device_ids:e})})}async getSlaves(e){return this.request("/presets/".concat(e,"/slaves/"))}async createSlave(e,t){return this.request("/presets/".concat(e,"/slaves/create/"),{method:"POST",body:JSON.stringify(t)})}async updateSlave(e,t,s){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/"),{method:"PUT",body:JSON.stringify(s)})}async deleteSlave(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/delete/"),{method:"DELETE"})}async addSlavesToPreset(e,t){return this.request("/presets/".concat(e,"/slaves/add/"),{method:"POST",body:JSON.stringify({slave_ids:t})})}async detachSlaveFromPreset(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/detach/"),{method:"POST"})}async getFirmwareVersions(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=new URLSearchParams;return t.append("active",e.toString()),this.request("/ota/firmware/?".concat(t.toString()))}async uploadFirmwareVersion(e){const t="".concat(i,"/ota/firmware/create/"),s=localStorage.getItem("authTokens");if(!s)throw new Error("Authentication required");const r=JSON.parse(s);let a={Authorization:"Bearer ".concat(r.access)},n=await fetch(t,{method:"POST",headers:a,body:e});if(401===n.status){if(await this.refreshToken()){const s=JSON.parse(localStorage.getItem("authTokens")||"{}");a={Authorization:"Bearer ".concat(s.access)},n=await fetch(t,{method:"POST",headers:a,body:e})}}if(401===n.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!n.ok){const e=await n.text();throw new Error("Upload failed: ".concat(n.status," ").concat(n.statusText," - ").concat(e))}return n.json()}async updateFirmwareVersion(e,t){return this.request("/ota/firmware/".concat(e,"/"),{method:"PATCH",body:JSON.stringify(t)})}async deleteFirmwareVersion(e){return this.request("/ota/firmware/".concat(e,"/delete/"),{method:"DELETE"})}async getDeviceUpdateLogs(e){return this.request("/ota/devices/".concat(e,"/logs"))}async getOTAConfig(){return this.request("/ota/config/")}async updateOTAConfig(e){return this.request("/ota/config/update/",{method:"PATCH",body:JSON.stringify(e)})}async getOTAHealth(){return this.request("/ota/health/")}}}}]);
//# sourceMappingURL=578.57d41a64.chunk.js.map