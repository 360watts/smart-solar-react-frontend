"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[239],{4239(e,t,i){i.r(t),i.d(t,{default:()=>E});var r=i(9379),a=i(5043),n=i(5475),s=i(5560);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;const[i,r]=(0,a.useState)(null),n=(0,a.useCallback)(function(){for(var a=arguments.length,n=new Array(a),s=0;s<a;s++)n[s]=arguments[s];i&&clearTimeout(i);const o=setTimeout(()=>{e(...n)},t);r(o)},[e,t,i]);return(0,a.useEffect)(()=>()=>{i&&clearTimeout(i)},[i]),n}var l=i(8421),d=i(9550),c=i(1180),p=i(877),g=i(7734),h=i(2185),m=i(6026),u=i(379),x=i(95),f=i(1385),y=i(5344),b=i(208),v=i(5239),j=i.n(v),_=i(579);const w=e=>{let{active:t,payload:i,label:r}=e;return t&&i&&i.length?(0,_.jsxs)("div",{style:{background:"rgba(255,255,255,0.97)",backdropFilter:"blur(8px)",border:"1px solid #f3f4f6",borderRadius:12,padding:"0.75rem 1rem",boxShadow:"0 10px 15px -3px rgba(0,0,0,0.1)",minWidth:175},children:[(0,_.jsx)("div",{style:{fontFamily:"Urbanist, sans-serif",fontWeight:700,color:"#111827",fontSize:"0.85rem",marginBottom:"0.4rem",borderBottom:"1px solid #f3f4f6",paddingBottom:"0.25rem"},children:r}),(0,_.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.2rem"},children:i.map(e=>{var t,i,r;const a=null!==(t=e.name)&&void 0!==t&&t.includes("Temp")?"\xb0C":null!==(i=e.name)&&void 0!==i&&i.includes("GHI")?"W/m\xb2":"kW";return(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem",fontSize:"0.78rem",fontFamily:"Inter, sans-serif",color:"#374151"},children:[(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:[(0,_.jsx)("span",{style:{width:7,height:7,borderRadius:"50%",background:e.color||e.stroke||e.fill,flexShrink:0}}),(0,_.jsx)("span",{style:{fontWeight:600},children:null===(r=e.name)||void 0===r?void 0:r.split(" ")[0]})]}),(0,_.jsxs)("span",{style:{fontFamily:"JetBrains Mono, monospace",fontWeight:600,color:"#111827"},children:[Number(e.value).toFixed(3)," ",a]})]},e.name)})})]}):null};function k(e,t){try{const i=new Date(e);return"24h"===t?i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"7d"===t?i.toLocaleDateString([],{weekday:"short"})+" "+i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):i.toLocaleDateString([],{month:"short",day:"numeric"})}catch(i){return e}}const S={background:"rgba(255,255,255,0.97)",border:"1px solid rgba(0,166,62,0.15)",borderRadius:10,color:"#0a0a0a",boxShadow:"0 8px 24px rgba(0,0,0,0.1)",fontSize:12},N=()=>(0,_.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#F07522",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,_.jsx)("circle",{cx:"12",cy:"12",r:"5",fill:"#FFD600",stroke:"#F07522",strokeWidth:"1.5"}),(0,_.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),(0,_.jsx)("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),(0,_.jsx)("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),(0,_.jsx)("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),(0,_.jsx)("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),(0,_.jsx)("line",{x1:"21",y1:"12",x2:"23",y2:"12"})]}),C=()=>(0,_.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,_.jsx)("rect",{x:"1",y:"6",width:"18",height:"12",rx:"2"}),(0,_.jsx)("line",{x1:"23",y1:"13",x2:"23",y2:"11"}),(0,_.jsx)("rect",{x:"3",y:"8",width:"10",height:"8",fill:"currentColor",rx:"1"})]}),A=()=>(0,_.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,_.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),(0,_.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]}),D=()=>(0,_.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,_.jsx)("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),F=()=>(0,_.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,_.jsx)("path",{d:"M18 10h-1.26A8 8 0 109 20h9a5 5 0 000-10z"})}),z=()=>(0,_.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,_.jsx)("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})}),W=()=>(0,_.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,_.jsx)("path",{d:"M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"})}),I=e=>{let{label:t,value:i,unit:r,sub:a,accent:n,icon:s,badge:o}=e;return(0,_.jsxs)("div",{className:"card",style:{padding:"1.1rem",flex:1,minWidth:140},children:[(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.4rem"},children:[(0,_.jsx)("span",{style:{fontSize:"0.7rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:t}),(0,_.jsx)("span",{style:{width:28,height:28,borderRadius:"50%",background:"".concat(n,"18"),display:"flex",alignItems:"center",justifyContent:"center",color:n,flexShrink:0},children:s})]}),(0,_.jsxs)("p",{style:{margin:0,fontFamily:"JetBrains Mono, monospace",fontSize:"1.5rem",fontWeight:800,color:"#0a0a0a",lineHeight:1},children:[i,r&&(0,_.jsx)("span",{style:{fontSize:"0.78rem",fontWeight:500,color:"#9ca3af",marginLeft:4},children:r})]}),a&&(0,_.jsx)("p",{style:{margin:"0.2rem 0 0",fontSize:"0.7rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:a}),o&&(0,_.jsx)("div",{style:{marginTop:"0.3rem"},children:o})]})},L=e=>{let{hourly:t}=e;if(!t||0===t.length)return null;return(0,_.jsxs)("div",{className:"card",style:{padding:"1rem 1.25rem",marginBottom:"1rem"},children:[(0,_.jsx)("p",{style:{margin:"0 0 0.65rem",fontSize:"0.68rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.07em",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:"24 h Weather Outlook"}),(0,_.jsx)("div",{style:{overflowX:"auto",paddingTop:14,paddingBottom:2},children:(0,_.jsx)("div",{style:{display:"flex",gap:"0.45rem",minWidth:"max-content"},children:t.map((e,t)=>{var i,r,a,n;const s=(()=>{try{return new Date(e.forecast_for).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(t){return""}})(),o=null!==(i=e.cloud_cover_pct)&&void 0!==i?i:0,l=null!==(r=e.ghi_wm2)&&void 0!==r?r:0,d=Number(null!==(a=e.temperature_c)&&void 0!==a?a:0),c=Number(null!==(n=e.wind_speed_ms)&&void 0!==n?n:0),p=null!=e.humidity_pct?Number(e.humidity_pct):null,g=Math.min(100,l/900*100),h=null!=p?Math.min(100,p):null,m=0===t,u=((e,t)=>t<10?"\ud83c\udf19":e>75?"\u2601\ufe0f":e>40?"\u26c5":"\u2600\ufe0f")(o,l),x=l>600?"#F07522":l>200?"#f59e0b":"#d1d5db",f=null==p?"#d1d5db":p>80?"#3b82f6":p>50?"#60a5fa":"#93c5fd";return(0,_.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",background:m?"rgba(0,166,62,0.09)":"rgba(0,0,0,0.025)",border:"1px solid ".concat(m?"rgba(0,166,62,0.28)":"rgba(0,0,0,0.07)"),borderRadius:10,padding:"0.45rem 0.65rem",minWidth:64,gap:"0.1rem",position:"relative"},children:[m&&(0,_.jsx)("span",{style:{position:"absolute",top:-9,fontSize:"0.55rem",fontWeight:700,background:"#00a63e",color:"#fff",padding:"1px 5px",borderRadius:4,fontFamily:"Poppins, sans-serif"},children:"NOW"}),(0,_.jsx)("span",{style:{fontSize:"0.65rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif",fontWeight:600},children:s}),(0,_.jsx)("span",{style:{fontSize:"1.1rem",lineHeight:1.4},children:u}),(0,_.jsxs)("span",{style:{fontSize:"0.8rem",fontFamily:"JetBrains Mono, monospace",fontWeight:700,color:"#111827"},children:[d.toFixed(1),"\xb0"]}),(0,_.jsx)("div",{title:"GHI ".concat(Math.round(l)," W/m\xb2"),style:{width:"100%",height:3,background:"rgba(0,0,0,0.08)",borderRadius:2,overflow:"hidden",margin:"2px 0"},children:(0,_.jsx)("div",{style:{width:"".concat(g,"%"),height:"100%",background:x,borderRadius:2}})}),(0,_.jsxs)("span",{style:{fontSize:"0.6rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:[Math.round(l)," W/m\xb2"]}),null!=h&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("div",{title:"Humidity ".concat(Math.round(h),"%"),style:{width:"100%",height:3,background:"rgba(0,0,0,0.06)",borderRadius:2,overflow:"hidden",margin:"2px 0"},children:(0,_.jsx)("div",{style:{width:"".concat(h,"%"),height:"100%",background:f,borderRadius:2}})}),(0,_.jsxs)("span",{style:{fontSize:"0.6rem",color:f,fontFamily:"Poppins, sans-serif",fontWeight:600},children:["\ud83d\udca7",Math.round(h),"%"]})]}),(0,_.jsxs)("span",{style:{fontSize:"0.6rem",color:"#b0bec5",fontFamily:"Poppins, sans-serif"},children:[c.toFixed(1)," m/s"]})]},t)})})})]})},T=e=>{let{latest:t}=e;if(!t)return null;const i=[{label:"PV Yield",value:t.pv_today_kwh,color:"#F07522",bg:"#F0752212",icon:"\u2600"},{label:"Grid In",value:t.grid_buy_today_kwh,color:"#3b82f6",bg:"#3b82f612",icon:"\u2b07"},{label:"Grid Out",value:t.grid_sell_today_kwh,color:"#10b981",bg:"#10b98112",icon:"\u2b06"},{label:"Batt Chg",value:t.batt_charge_today_kwh,color:"#8b5cf6",bg:"#8b5cf612",icon:"\u2191"},{label:"Batt Dchg",value:t.batt_discharge_today_kwh,color:"#ec4899",bg:"#ec489912",icon:"\u2193"},{label:"Consumption",value:t.load_today_kwh,color:"#6b7280",bg:"#6b728012",icon:"\u2302"}].filter(e=>null!=e.value);return i.length?(0,_.jsxs)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"1rem",alignItems:"center"},children:[(0,_.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:"#9ca3af",fontFamily:"Poppins, sans-serif",alignSelf:"center",minWidth:40},children:"Today"}),i.map(e=>(0,_.jsxs)("span",{style:{fontSize:"0.72rem",fontWeight:600,fontFamily:"Poppins, sans-serif",padding:"0.2rem 0.65rem",borderRadius:99,background:e.bg,border:"1px solid ".concat(e.color,"28"),color:e.color,display:"flex",alignItems:"center",gap:"0.3rem"},children:[(0,_.jsx)("span",{style:{opacity:.85},children:e.icon}),e.label,":\xa0",(0,_.jsx)("span",{style:{fontFamily:"JetBrains Mono, monospace",color:"#0a0a0a"},children:Number(e.value).toFixed(2)}),(0,_.jsx)("span",{style:{fontSize:"0.6rem",color:"#9ca3af"},children:"kWh"})]},e.label))]}):null},B=e=>{var t,i,r;let{latest:a}=e;if(!a)return null;const n=Number(null!==(t=a.pv_today_kwh)&&void 0!==t?t:0),s=Number(null!==(i=a.load_today_kwh)&&void 0!==i?i:0),o=Number(null!==(r=a.grid_buy_today_kwh)&&void 0!==r?r:0);if(0===n&&0===s)return null;const l=.82*n,d=s>0?Math.max(0,Math.min(100,Math.round((s-o)/s*100))):null,c=s>0?Math.max(0,Math.min(100,Math.round(o/s*100))):null,p=[];if(n>0&&p.push({icon:"\ud83c\udf3f",label:"CO\u2082 Avoided",value:l>=1?"".concat(l.toFixed(2)," kg"):"".concat((1e3*l).toFixed(0)," g"),sub:"vs grid (0.82 kg/kWh)",color:"#10b981",bg:"#10b98110"}),null!=d){const e=d>=70?"#00a63e":d>=40?"#f59e0b":"#ef4444";p.push({icon:"\u26a1",label:"Self-Sufficiency",value:"".concat(d,"%"),sub:"load met by solar+battery",color:e,bg:"".concat(e,"10")})}if(null!=c){const e=c<=20?"#10b981":c<=50?"#f59e0b":"#ef4444";p.push({icon:"\ud83d\udd0c",label:"Grid Dependency",value:"".concat(c,"%"),sub:"portion from grid",color:e,bg:"".concat(e,"10")})}return p.length?(0,_.jsxs)("div",{style:{display:"flex",gap:"0.6rem",flexWrap:"wrap",marginBottom:"1rem"},children:[(0,_.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:"#9ca3af",fontFamily:"Poppins, sans-serif",alignSelf:"center",minWidth:40},children:"Insights"}),p.map(e=>(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.55rem",padding:"0.35rem 0.85rem",borderRadius:10,background:e.bg,border:"1px solid ".concat(e.color,"28"),flexShrink:0},children:[(0,_.jsx)("span",{style:{fontSize:"1rem",lineHeight:1},children:e.icon}),(0,_.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:1},children:[(0,_.jsx)("span",{style:{fontSize:"0.62rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.04em"},children:e.label}),(0,_.jsx)("span",{style:{fontFamily:"JetBrains Mono, monospace",fontWeight:800,color:e.color,fontSize:"0.88rem",lineHeight:1},children:e.value}),e.sub&&(0,_.jsx)("span",{style:{fontSize:"0.58rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:e.sub})]})]},e.label))]}):null},R={night:{bg:"#1e293b1a",color:"#475569"},ramp:{bg:"#f59e0b18",color:"#d97706"},midday:{bg:"#F0752218",color:"#c2410c"}},M=e=>{let{data:t}=e;return(0,_.jsx)("div",{style:{maxHeight:300,overflowY:"auto"},children:(0,_.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.8rem",fontFamily:"Inter, sans-serif"},children:[(0,_.jsx)("thead",{style:{position:"sticky",top:0,background:"#f9fafb",zIndex:1},children:(0,_.jsxs)("tr",{children:[(0,_.jsx)("th",{style:{padding:"0.7rem 1rem",textAlign:"left",fontWeight:600,color:"#4b5563",borderBottom:"1px solid #e5e7eb"},children:"Time"}),(0,_.jsx)("th",{style:{padding:"0.7rem 0.6rem",textAlign:"center",fontWeight:600,color:"#6b7280",borderBottom:"1px solid #e5e7eb"},children:"Regime"}),(0,_.jsx)("th",{style:{padding:"0.7rem 0.8rem",textAlign:"right",fontWeight:600,color:"#f59e0b",borderBottom:"1px solid #e5e7eb"},children:"P10 \u2193"}),(0,_.jsx)("th",{style:{padding:"0.7rem 0.8rem",textAlign:"right",fontWeight:600,color:"#00a63e",borderBottom:"1px solid #e5e7eb"},children:"P50"}),(0,_.jsx)("th",{style:{padding:"0.7rem 0.8rem",textAlign:"right",fontWeight:600,color:"#3b82f6",borderBottom:"1px solid #e5e7eb"},children:"P90 \u2191"}),(0,_.jsx)("th",{style:{padding:"0.7rem 0.8rem",textAlign:"right",fontWeight:600,color:"#9ca3af",borderBottom:"1px solid #e5e7eb"},children:"Physics"}),(0,_.jsx)("th",{style:{padding:"0.7rem 0.8rem",textAlign:"right",fontWeight:600,color:"#eab308",borderBottom:"1px solid #e5e7eb"},children:"GHI W/m\xb2"})]})}),(0,_.jsx)("tbody",{children:t.map((e,t)=>{var i,r,a,n,s,o,l,d,c,p,g;const h=e.regime?null!==(i=R[e.regime])&&void 0!==i?i:{bg:"transparent",color:"#6b7280"}:null;return(0,_.jsxs)("tr",{style:{borderBottom:"1px solid #f3f4f6"},children:[(0,_.jsx)("td",{style:{padding:"0.55rem 1rem",color:"#111827",fontFamily:"JetBrains Mono, monospace"},children:e.time}),(0,_.jsx)("td",{style:{padding:"0.4rem 0.6rem",textAlign:"center"},children:e.regime&&h&&(0,_.jsx)("span",{style:{fontSize:"0.62rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.04em",background:h.bg,color:h.color,padding:"2px 6px",borderRadius:4,fontFamily:"Poppins, sans-serif"},children:e.regime})}),(0,_.jsx)("td",{style:{padding:"0.55rem 0.8rem",textAlign:"right",color:"#4b5563"},children:null!==(r=null===(a=e.p10)||void 0===a?void 0:a.toFixed(3))&&void 0!==r?r:"\u2014"}),(0,_.jsx)("td",{style:{padding:"0.55rem 0.8rem",textAlign:"right",fontWeight:600,color:"#111827"},children:null!==(n=null===(s=e.p50)||void 0===s?void 0:s.toFixed(3))&&void 0!==n?n:"\u2014"}),(0,_.jsx)("td",{style:{padding:"0.55rem 0.8rem",textAlign:"right",color:"#4b5563"},children:null!==(o=null===(l=e.p90)||void 0===l?void 0:l.toFixed(3))&&void 0!==o?o:"\u2014"}),(0,_.jsx)("td",{style:{padding:"0.55rem 0.8rem",textAlign:"right",color:"#9ca3af",fontStyle:"italic"},children:null!==(d=null===(c=e.physics)||void 0===c?void 0:c.toFixed(3))&&void 0!==d?d:"\u2014"}),(0,_.jsx)("td",{style:{padding:"0.55rem 0.8rem",textAlign:"right",color:"#4b5563"},children:null!==(p=null===(g=e.ghi)||void 0===g?void 0:g.toFixed(0))&&void 0!==p?p:"\u2014"})]},t)})})]})})},P=e=>{var t,i,n,o,l,d,v,R,P,E;let{siteId:O,autoRefresh:G=!1}=e;const[K,H]=(0,a.useState)([]),[J,V]=(0,a.useState)([]),[q,U]=(0,a.useState)(null),[Y,Q]=(0,a.useState)(!0),[Z,X]=(0,a.useState)(null),[$,ee]=(0,a.useState)(null),[te,ie]=(0,a.useState)({P10:!0,P50:!0,P90:!0}),[re,ae]=(0,a.useState)("24h"),[ne,se]=(0,a.useState)(""),[oe,le]=(0,a.useState)(""),[de,ce]=(0,a.useState)("chart"),pe=(0,a.useCallback)(async()=>{try{let e={};"custom"===re&&ne&&oe?e={start_date:new Date(ne).toISOString(),end_date:new Date(oe).toISOString()}:"7d"===re?e={days:7}:"30d"===re&&(e={days:30});let t={};if("custom"===re&&ne&&oe)t={start_date:new Date(ne).toISOString(),end_date:new Date(oe).toISOString()};else if("7d"===re||"30d"===re){const e="7d"===re?6:29,i=new Date,r=new Date;r.setDate(i.getDate()-e),t={start_date:r.toISOString().split("T")[0]+"T00:00:00Z",end_date:i.toISOString().split("T")[0]+"T23:59:59Z"}}const[i,r,a]=await Promise.all([s.K.getSiteTelemetry(O,e),s.K.getSiteForecast(O,t),s.K.getSiteWeather(O)]);H(Array.isArray(i)?i:[]),V(Array.isArray(r)?r:[]),U(a||null),ee(new Date),X(null)}catch(e){X(e instanceof Error?e.message:"Failed to load site data")}finally{Q(!1)}},[O,re,ne,oe]);(0,a.useEffect)(()=>{if(Q(!0),pe(),!G)return;const e=setInterval(pe,6e4);return()=>clearInterval(e)},[pe,G]);const ge=K.length>0?K[K.length-1]:null,he=ge?((null!==(t=ge.pv1_power_w)&&void 0!==t?t:0)+(null!==(i=ge.pv2_power_w)&&void 0!==i?i:0))/1e3:null,me=null!==(n=null===ge||void 0===ge?void 0:ge.battery_soc_percent)&&void 0!==n?n:null,ue=ge?(null!==(o=ge.load_power_w)&&void 0!==o?o:0)/1e3:null,xe=null!==(l=null===ge||void 0===ge?void 0:ge.pv_today_kwh)&&void 0!==l?l:null,fe=ge?(null!==(d=ge.grid_power_w)&&void 0!==d?d:0)/1e3:null,ye=ge?(null!==(v=ge.battery_power_w)&&void 0!==v?v:0)/1e3:null,be=null!==(R=null===ge||void 0===ge?void 0:ge.inverter_temp_c)&&void 0!==R?R:null,ve=null!==(P=null===ge||void 0===ge?void 0:ge.battery_voltage_v)&&void 0!==P?P:null,je=null===ge||void 0===ge?void 0:ge.run_state,_e=null!=fe&&fe>.01,we=null!=fe&&fe<-.01,ke=null!=ye&&ye>.01,Se=null!=je?0===je?{label:"Standby",color:"#9ca3af"}:1===je?{label:"Online",color:"#00a63e"}:2===je?{label:"Warning",color:"#f59e0b"}:3===je?{label:"Fault",color:"#ef4444"}:{label:"State ".concat(je),color:"#6b7280"}:null,Ne=null==be?"#9ca3af":be>60?"#ef4444":be>45?"#f59e0b":"#10b981",Ce=function(e,t){if(!e.length)return[];if("24h"===t)return e.filter((t,i)=>i%2===0||i===e.length-1);const i="7d"!==t,r=new Map;return e.forEach(e=>{const t=new Date(e.timestamp),a=i?"".concat(t.getFullYear(),"-").concat(t.getMonth(),"-").concat(t.getDate()):"".concat(t.getFullYear(),"-").concat(t.getMonth(),"-").concat(t.getDate(),"-").concat(t.getHours());r.has(a)||r.set(a,[]),r.get(a).push(e)}),Array.from(r.values()).map(e=>{const t=t=>e.reduce((e,i)=>{var r;return e+(null!==(r=i[t])&&void 0!==r?r:0)},0)/e.length,r=e[0];return{timestamp:r.timestamp,pv1_power_w:t("pv1_power_w"),pv2_power_w:t("pv2_power_w"),load_power_w:t("load_power_w"),grid_power_w:t("grid_power_w"),battery_soc_percent:t("battery_soc_percent"),battery_power_w:t("battery_power_w"),pv_today_kwh:i?Math.max(...e.map(e=>{var t;return null!==(t=e.pv_today_kwh)&&void 0!==t?t:0})):r.pv_today_kwh}})}(K,re).map(e=>{var t,i,r,a,n;return{time:k(e.timestamp,re),"PV (kW)":+(((null!==(t=e.pv1_power_w)&&void 0!==t?t:0)+(null!==(i=e.pv2_power_w)&&void 0!==i?i:0))/1e3).toFixed(2),"Load (kW)":+((null!==(r=e.load_power_w)&&void 0!==r?r:0)/1e3).toFixed(2),"Grid (kW)":+((null!==(a=e.grid_power_w)&&void 0!==a?a:0)/1e3).toFixed(2),"Batt SOC (%)":null!==(n=e.battery_soc_percent)&&void 0!==n?n:null}}),Ae=J.map(e=>{var t;let i="";if("24h"!==re){const t=e.forecast_for||e.timestamp.replace("FORECAST#",""),r=new Date(t);i=r.toLocaleDateString([],{month:"short",day:"numeric"})+" "+r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}else i=function(e,t){const i=t||e.replace("FORECAST#","");try{return new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(r){return i}}(e.timestamp,e.forecast_for);return{time:i,p50:null!=e.p50_kw?+Number(e.p50_kw).toFixed(3):null,p10:null!=e.p10_kw?+Number(e.p10_kw).toFixed(3):null,p90:null!=e.p90_kw?+Number(e.p90_kw).toFixed(3):null,physics:null!=e.physics_baseline_kw?+Number(e.physics_baseline_kw).toFixed(3):null,ghi:null!=e.ghi_input_wm2?+e.ghi_input_wm2:null,temp:null!=e.temperature_c?+e.temperature_c:null,regime:null!==(t=e.regime)&&void 0!==t?t:null}});let De=0,Fe=0,ze=0,We=null;if(J.length>1){const e=J[0];e.generated_at?We=new Date(e.generated_at):e.timestamp&&(We=new Date(e.timestamp.replace("FORECAST#","").split("T")[0]+"T00:00:00Z"));for(let t=0;t<J.length-1;t++){const e=Math.abs(new Date(J[t+1].timestamp.replace("FORECAST#","")).getTime()-new Date(J[t].timestamp.replace("FORECAST#","")).getTime())/36e5;null!=J[t].p10_kw&&null!=J[t+1].p10_kw&&(De+=(J[t].p10_kw+J[t+1].p10_kw)/2*e),null!=J[t].p50_kw&&null!=J[t+1].p50_kw&&(Fe+=(J[t].p50_kw+J[t+1].p50_kw)/2*e),null!=J[t].p90_kw&&null!=J[t+1].p90_kw&&(ze+=(J[t].p90_kw+J[t+1].p90_kw)/2*e)}}const Ie=null!=xe&&Fe>0?Math.min(999,Math.round(xe/Fe*100)):null;if(Y)return(0,_.jsxs)("div",{style:{padding:"1.5rem 0"},children:[(0,_.jsx)("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem",flexWrap:"wrap"},children:[...Array(6)].map((e,t)=>(0,_.jsx)("div",{className:"card skeleton",style:{flex:1,minWidth:140,height:100}},t))}),(0,_.jsx)("div",{className:"card skeleton",style:{height:52,marginBottom:"0.75rem"}}),(0,_.jsx)("div",{className:"card skeleton",style:{height:130,marginBottom:"1rem"}}),(0,_.jsx)("div",{className:"card skeleton",style:{height:240,marginBottom:"1rem"}}),(0,_.jsx)("div",{className:"card skeleton",style:{height:200}})]});if(Z)return(0,_.jsxs)("div",{style:{padding:"1.5rem",color:"#ef4444",fontSize:"0.85rem",background:"rgba(239,68,68,0.06)",borderRadius:10,marginTop:"1rem"},children:["Failed to load DynamoDB data for ",(0,_.jsx)("strong",{children:O}),": ",Z]});const Le=0===K.length&&0===J.length&&!q;return(0,_.jsxs)("div",{style:{marginTop:"1.5rem"},children:[(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.75rem",gap:"1rem",flexWrap:"wrap"},children:[(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[(0,_.jsxs)("p",{className:"dash-section-label",style:{margin:0},children:["Live Site Intelligence \u2014 ",(0,_.jsx)("span",{style:{fontFamily:"JetBrains Mono, monospace",color:"#00a63e"},children:O})]}),Se&&(0,_.jsxs)("span",{style:{fontSize:"0.65rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",background:"".concat(Se.color,"18"),color:Se.color,padding:"2px 8px",borderRadius:99,fontFamily:"Poppins, sans-serif",border:"1px solid ".concat(Se.color,"30")},children:["\u25cf ",Se.label]})]}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,_.jsxs)("select",{value:re,onChange:e=>ae(e.target.value),style:{background:"var(--card-bg,#fff)",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.3rem 0.6rem",fontSize:"0.72rem",color:"var(--text-color,#0a0a0a)",cursor:"pointer",fontFamily:"Poppins, sans-serif",fontWeight:600},children:[(0,_.jsx)("option",{value:"24h",children:"Today"}),(0,_.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,_.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,_.jsx)("option",{value:"custom",children:"Custom range"})]}),"custom"===re&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("input",{type:"date",value:ne,onChange:e=>se(e.target.value),style:{background:"var(--card-bg,#fff)",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.3rem 0.6rem",fontSize:"0.72rem",color:"var(--text-color,#0a0a0a)",fontFamily:"Poppins, sans-serif",fontWeight:600}}),(0,_.jsx)("span",{style:{color:"#9ca3af",fontSize:"0.7rem"},children:"to"}),(0,_.jsx)("input",{type:"date",value:oe,onChange:e=>le(e.target.value),style:{background:"var(--card-bg,#fff)",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.3rem 0.6rem",fontSize:"0.72rem",color:"var(--text-color,#0a0a0a)",fontFamily:"Poppins, sans-serif",fontWeight:600}})]})]}),$&&(0,_.jsxs)("span",{style:{fontSize:"0.7rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:["Updated ",$.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),(0,_.jsx)("button",{onClick:()=>{Q(!0),pe()},style:{background:"none",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.2rem 0.6rem",fontSize:"0.72rem",color:"#00a63e",cursor:"pointer",fontFamily:"Poppins, sans-serif",fontWeight:600},children:"\u21bb Refresh"})]})]}),Le?(0,_.jsxs)("div",{style:{padding:"2rem",textAlign:"center",color:"#9ca3af",fontSize:"0.875rem",background:"rgba(0,166,62,0.03)",borderRadius:12,border:"1px dashed rgba(0,166,62,0.15)"},children:["No DynamoDB data found for site ",(0,_.jsx)("strong",{style:{color:"#00a63e"},children:O})," in the ","24h"===re?"today":"7d"===re?"last 7 days":"30d"===re?"last 30 days":"selected date range",".",(0,_.jsx)("br",{}),(0,_.jsx)("span",{style:{fontSize:"0.78rem"},children:"Data is written by the ML forecast scheduler when the device is actively posting telemetry."})]}):(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap",marginBottom:"0.75rem"},children:[(0,_.jsx)(I,{label:"PV Power",value:null!=he?he.toFixed(2):"\u2014",unit:"kW",sub:null!=(null===ge||void 0===ge?void 0:ge.pv1_power_w)&&null!=(null===ge||void 0===ge?void 0:ge.pv2_power_w)?"S1: ".concat((ge.pv1_power_w/1e3).toFixed(2)," \xb7 S2: ").concat((ge.pv2_power_w/1e3).toFixed(2)," kW"):"Current generation",accent:"#F07522",icon:(0,_.jsx)(N,{})}),(0,_.jsx)(I,{label:"Battery",value:null!=me?me.toFixed(1):"\u2014",unit:"%",sub:null!=ve?"".concat(ve.toFixed(1)," V"):"State of charge",accent:"#00a63e",icon:(0,_.jsx)(C,{}),badge:null!=ye&&Math.abs(ye)>.01?(0,_.jsxs)("span",{style:{fontSize:"0.65rem",fontWeight:700,color:ke?"#00a63e":"#ec4899",fontFamily:"Poppins, sans-serif"},children:[ke?"\u26a1 Charging":"\u2b07 Discharging"," ",Math.abs(ye).toFixed(2)," kW"]}):(0,_.jsx)("span",{style:{fontSize:"0.65rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:"Idle"})}),(0,_.jsx)(I,{label:"Load",value:null!=ue?ue.toFixed(2):"\u2014",unit:"kW",sub:"Current consumption",accent:"#8b5cf6",icon:(0,_.jsx)(A,{})}),(0,_.jsx)(I,{label:"Energy Today",value:null!=xe?xe.toFixed(2):"\u2014",unit:"kWh",sub:"Solar yield today",accent:"#10b981",icon:(0,_.jsx)(D,{})}),(0,_.jsx)(I,{label:"Grid",value:null!=fe?Math.abs(fe).toFixed(2):"\u2014",unit:"kW",sub:null!=(null===ge||void 0===ge?void 0:ge.grid_voltage_v)?"".concat(Number(ge.grid_voltage_v).toFixed(0)," V \xb7 ").concat(Number(null!==(E=ge.grid_frequency_hz)&&void 0!==E?E:0).toFixed(1)," Hz"):"Grid power",accent:"#3b82f6",icon:(0,_.jsx)(z,{}),badge:null!=fe?(0,_.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:700,color:_e?"#3b82f6":we?"#10b981":"#9ca3af",fontFamily:"Poppins, sans-serif"},children:_e?"\u2b07 Importing":we?"\u2b06 Exporting":"\u2194 Standby"}):void 0}),(0,_.jsx)(I,{label:"Inv. Temp",value:null!=be?be.toFixed(1):"\u2014",unit:"\xb0C",sub:null!=be?be>60?"\ud83d\udd34 Hot \u2014 check cooling":be>45?"\ud83d\udfe1 Warm":"\ud83d\udfe2 Normal":"No data",accent:Ne,icon:(0,_.jsx)(W,{})})]}),(0,_.jsx)(T,{latest:ge}),(0,_.jsx)(B,{latest:ge}),(null===q||void 0===q?void 0:q.current)&&(0,_.jsxs)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.75rem",alignItems:"center"},children:[(0,_.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:"Now"}),[{label:"Temp",value:null!=q.current.temperature_c?"".concat(Number(q.current.temperature_c).toFixed(1)," \xb0C"):null},{label:"Humidity",value:null!=q.current.humidity_pct?"".concat(q.current.humidity_pct," %"):null},{label:"Cloud",value:null!=q.current.cloud_cover_pct?"".concat(q.current.cloud_cover_pct," %"):null,icon:(0,_.jsx)(F,{})},{label:"Wind",value:null!=q.current.wind_speed_ms?"".concat(Number(q.current.wind_speed_ms).toFixed(1)," m/s"):null},{label:"GHI",value:null!=q.current.ghi_wm2?"".concat(Math.round(q.current.ghi_wm2)," W/m\xb2"):null}].filter(e=>e.value).map(e=>(0,_.jsxs)("span",{style:{fontSize:"0.72rem",fontWeight:600,fontFamily:"Poppins, sans-serif",padding:"0.2rem 0.65rem",borderRadius:99,background:"rgba(0,166,62,0.07)",border:"1px solid rgba(0,166,62,0.12)",color:"#007a55",display:"flex",alignItems:"center",gap:"0.3rem"},children:[e.icon,e.label,": ",(0,_.jsx)("span",{style:{fontFamily:"JetBrains Mono, monospace",color:"#0a0a0a"},children:e.value})]},e.label))]}),(null===q||void 0===q?void 0:q.hourly_forecast)&&q.hourly_forecast.length>0&&(0,_.jsx)(L,{hourly:q.hourly_forecast}),Ce.length>0&&(0,_.jsxs)("div",{className:"card",style:{padding:"1.25rem",marginBottom:"1rem"},children:[(0,_.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,_.jsxs)("h3",{style:{margin:"0 0 0.2rem",fontSize:"0.9rem",fontFamily:"Urbanist, sans-serif",color:"#0a0a0a"},children:["Power History \u2014 ","24h"===re?"Today":"7d"===re?"Last 7 days":"30d"===re?"Last 30 days":ne&&oe?"".concat(new Date(ne).toLocaleDateString()," \u2013 ").concat(new Date(oe).toLocaleDateString()):"Custom range"]}),(0,_.jsxs)("p",{style:{margin:0,fontSize:"0.68rem",color:"#9ca3af",fontFamily:"Poppins, sans-serif"},children:["7d"===re?"Hourly aggregates":"24h"!==re?"Daily aggregates":"30-min samples"," \xb7 Battery SOC on right axis"]})]}),(0,_.jsx)("div",{style:{height:240},children:(0,_.jsx)(c.u,{width:"100%",height:"100%",children:(0,_.jsxs)(p.Q,{data:Ce,margin:{top:4,right:44,left:0,bottom:"7d"===re||"30d"===re?20:0},children:[(0,_.jsxs)("defs",{children:[(0,_.jsxs)("linearGradient",{id:"pvGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,_.jsx)("stop",{offset:"5%",stopColor:"#F07522",stopOpacity:.22}),(0,_.jsx)("stop",{offset:"95%",stopColor:"#F07522",stopOpacity:0})]}),(0,_.jsxs)("linearGradient",{id:"loadGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,_.jsx)("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.18}),(0,_.jsx)("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]})]}),(0,_.jsx)(g.d,{strokeDasharray:"3 3",stroke:"rgba(0,166,62,0.08)"}),(0,_.jsx)(h.W,{dataKey:"time",stroke:"#9ca3af",interval:"24h"===re?"preserveStartEnd":Math.ceil(Ce.length/10),angle:"7d"===re||"30d"===re?-15:0,textAnchor:"7d"===re||"30d"===re?"end":"middle",tick:{fontSize:"30d"===re?9:10,fill:"#9ca3af"}}),(0,_.jsx)(m.h,{yAxisId:"power",stroke:"#9ca3af",tickFormatter:e=>"".concat(e,"kW"),tick:{fontSize:10,fill:"#9ca3af"}}),(0,_.jsx)(m.h,{yAxisId:"soc",orientation:"right",stroke:"#9ca3af",domain:[0,100],tickFormatter:e=>"".concat(e,"%"),width:36,tick:{fontSize:10,fill:"#9ca3af"}}),(0,_.jsx)(u.m,{contentStyle:S,formatter:(e,t)=>["".concat(e," ").concat(String(t).includes("%")?"%":"kW"),t]}),(0,_.jsx)(x.s,{iconType:"circle",iconSize:8,wrapperStyle:{fontSize:11,fontFamily:"Poppins, sans-serif"}}),(0,_.jsx)(f.Gk,{yAxisId:"power",type:"monotone",dataKey:"PV (kW)",stroke:"#F07522",strokeWidth:2,fill:"url(#pvGrad)",dot:!1}),(0,_.jsx)(f.Gk,{yAxisId:"power",type:"monotone",dataKey:"Load (kW)",stroke:"#8b5cf6",strokeWidth:2,fill:"url(#loadGrad)",dot:!1}),(0,_.jsx)(y.N1,{yAxisId:"power",type:"monotone",dataKey:"Grid (kW)",stroke:"#3b82f6",strokeWidth:1.5,dot:!1,strokeDasharray:"4 3"}),(0,_.jsx)(y.N1,{yAxisId:"soc",type:"monotone",dataKey:"Batt SOC (%)",stroke:"#00a63e",strokeWidth:1.5,dot:!1,strokeDasharray:"2 3"})]})})})]}),Ae.length>0&&(0,_.jsxs)("div",{className:"card",style:{padding:0,boxShadow:"0 10px 30px -5px rgba(0,0,0,0.1)",border:"1px solid #e5e7eb",borderRadius:16,background:"#ffffff",overflow:"hidden"},children:[(0,_.jsxs)("div",{style:{padding:"1.25rem 1.5rem",borderBottom:"1px solid #f3f4f6",display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center",justifyContent:"space-between",background:"linear-gradient(to right,#ffffff,#f9fafb)"},children:[(0,_.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,_.jsx)("div",{style:{width:32,height:32,borderRadius:8,background:"rgba(0,166,62,0.1)",color:"#00a63e",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.1rem"},children:"\ud83d\udd06"}),(0,_.jsx)("h3",{style:{margin:0,fontSize:"1.1rem",fontFamily:"Urbanist, sans-serif",color:"#111827",fontWeight:700},children:"Solar Forecast"})]}),Fe>0&&(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.6rem",marginLeft:"2.5rem",flexWrap:"wrap"},children:[(0,_.jsx)("span",{style:{fontSize:"0.82rem",color:"#6b7280",fontFamily:"Inter, sans-serif"},children:"Est. Yield:"}),(0,_.jsxs)("span",{style:{fontFamily:"JetBrains Mono, monospace",fontSize:"0.82rem",fontWeight:600,color:"#111827",background:"#f3f4f6",padding:"2px 7px",borderRadius:4},children:[De.toFixed(1)," ",(0,_.jsx)("span",{style:{color:"#9ca3af"},children:"/"})," ",(0,_.jsx)("span",{style:{color:"#00a63e"},children:Fe.toFixed(1)})," ",(0,_.jsx)("span",{style:{color:"#9ca3af"},children:"/"})," ",ze.toFixed(1)," kWh"]}),null!=Ie&&(0,_.jsxs)("span",{style:{fontSize:"0.72rem",fontWeight:700,fontFamily:"Poppins, sans-serif",padding:"2px 8px",borderRadius:99,background:Ie>=80?"#10b98118":Ie>=40?"#f59e0b18":"#e5e7eb",color:Ie>=80?"#059669":Ie>=40?"#d97706":"#9ca3af",border:"1px solid ".concat(Ie>=80?"#10b98128":Ie>=40?"#f59e0b28":"#d1d5db")},children:[Ie,"% achieved"]})]})]}),(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[(0,_.jsx)("div",{style:{display:"flex",background:"#f3f4f6",borderRadius:8,padding:3},children:["chart","table"].map(e=>(0,_.jsx)("button",{onClick:()=>ce(e),style:{border:"none",background:de===e?"#fff":"transparent",color:de===e?"#00a63e":"#6b7280",borderRadius:6,padding:"0.35rem 0.75rem",fontSize:"0.75rem",fontWeight:600,cursor:"pointer",boxShadow:de===e?"0 1px 3px rgba(0,0,0,0.1)":"none",textTransform:"capitalize"},children:e},e))}),"chart"===de&&(0,_.jsx)("div",{style:{display:"flex",background:"#f3f4f6",padding:3,borderRadius:8},children:[{label:"P10",color:"#f59e0b"},{label:"P50",color:"#00a63e"},{label:"P90",color:"#3b82f6"}].map(e=>(0,_.jsxs)("button",{onClick:()=>ie(t=>(0,r.A)((0,r.A)({},t),{},{[e.label]:!t[e.label]})),style:{border:"none",background:te[e.label]?"#ffffff":"transparent",color:te[e.label]?e.color:"#9ca3af",boxShadow:te[e.label]?"0 2px 4px rgba(0,0,0,0.05)":"none",borderRadius:6,padding:"0.35rem 0.75rem",fontSize:"0.75rem",fontWeight:600,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:4},children:[(0,_.jsx)("span",{style:{width:6,height:6,borderRadius:"50%",background:te[e.label]?e.color:"#d1d5db"}}),e.label]},e.label))}),(0,_.jsxs)("button",{onClick:async()=>{const e=document.getElementById("forecast-chart-container");if(e){const t=await j()(e,{background:"#ffffff",scale:2}),i=document.createElement("a");i.download="solar-forecast-".concat((new Date).toISOString().slice(0,10),".png"),i.href=t.toDataURL(),i.click()}},style:{background:"transparent",border:"1px solid #e5e7eb",color:"#374151",borderRadius:8,padding:"0.4rem 0.8rem",fontSize:"0.8rem",fontWeight:600,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6},onMouseOver:e=>e.currentTarget.style.background="#f9fafb",onMouseOut:e=>e.currentTarget.style.background="transparent",children:[(0,_.jsx)("span",{children:"\ud83d\udcf7"}),(0,_.jsx)("span",{children:"Save"})]})]})]}),(0,_.jsxs)("div",{id:"forecast-chart-container",style:{padding:"0 1.5rem 1.5rem 0.5rem",background:"#ffffff",position:"relative"},children:["chart"===de?(0,_.jsxs)("div",{style:{height:300,width:"100%",userSelect:"none"},children:[(0,_.jsx)(c.u,{children:(0,_.jsxs)(p.Q,{data:Ae,margin:{top:20,right:10,left:0,bottom:0},children:[(0,_.jsxs)("defs",{children:[(0,_.jsxs)("linearGradient",{id:"p50Grad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,_.jsx)("stop",{offset:"5%",stopColor:"#00a63e",stopOpacity:.2}),(0,_.jsx)("stop",{offset:"95%",stopColor:"#00a63e",stopOpacity:0})]}),(0,_.jsxs)("linearGradient",{id:"p90Grad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,_.jsx)("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.14}),(0,_.jsx)("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]}),(0,_.jsxs)("linearGradient",{id:"p10Grad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,_.jsx)("stop",{offset:"5%",stopColor:"#f59e0b",stopOpacity:.14}),(0,_.jsx)("stop",{offset:"95%",stopColor:"#f59e0b",stopOpacity:0})]})]}),(0,_.jsx)(g.d,{strokeDasharray:"3 3",stroke:"#f3f4f6",vertical:!1}),(0,_.jsx)(h.W,{dataKey:"time",stroke:"#9ca3af",tickLine:!1,axisLine:!1,minTickGap:30,tickMargin:12,tick:{fill:"#6b7280",fontSize:11,fontFamily:"Inter, sans-serif"},textAnchor:"middle",allowDataOverflow:!0,type:"category",tickFormatter:e=>{if("24h"===re)return e;const t=e.split(" ");return t.length>=3?"".concat(t[0]," ").concat(t[1]):e}}),(0,_.jsx)(m.h,{stroke:"#9ca3af",tickLine:!1,axisLine:!1,width:40,allowDataOverflow:!0,tick:{fontSize:11,fontFamily:"Inter, sans-serif",fill:"#9ca3af"},label:{value:"kW",angle:-90,position:"insideLeft",fill:"#9ca3af",fontSize:10}}),(0,_.jsx)(u.m,{content:(0,_.jsx)(w,{}),cursor:{stroke:"#00a63e",strokeWidth:1,strokeDasharray:"4 4"},animationDuration:300,wrapperStyle:{pointerEvents:"none"}}),(0,_.jsx)(x.s,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,wrapperStyle:{right:0,top:0,fontSize:12,color:"#6b7280",fontFamily:"Inter, sans-serif"}}),te.P90&&(0,_.jsx)(f.Gk,{type:"monotone",dataKey:"p90",stroke:"#3b82f6",strokeWidth:1,strokeDasharray:"3 3",fill:"url(#p90Grad)",activeDot:!1,name:"P90 (Optimistic)",animationDuration:500}),te.P10&&(0,_.jsx)(f.Gk,{type:"monotone",dataKey:"p10",stroke:"#f59e0b",strokeWidth:1,strokeDasharray:"3 3",fill:"url(#p10Grad)",activeDot:!1,name:"P10 (Conservative)",animationDuration:500}),te.P50&&(0,_.jsx)(f.Gk,{type:"monotone",dataKey:"p50",stroke:"#00a63e",strokeWidth:2.5,fill:"url(#p50Grad)",activeDot:{r:4,strokeWidth:0},name:"P50 (Median)",animationDuration:800}),(0,_.jsx)(y.N1,{type:"monotone",dataKey:"physics",stroke:"#d1d5db",strokeWidth:1.5,strokeDasharray:"5 3",dot:!1,name:"Physics Baseline",activeDot:!1}),(0,_.jsx)(b.e_,{x:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),stroke:"#ef4444",strokeDasharray:"3 3",label:(0,_.jsx)("span",{style:{color:"#ef4444",fontSize:10,fontWeight:700},children:"NOW"})})]})}),(0,_.jsx)("div",{style:{position:"absolute",bottom:10,left:24,fontSize:"0.62rem",color:"#9ca3af",background:"rgba(255,255,255,0.85)",padding:"2px 6px",borderRadius:4,pointerEvents:"none"},children:"Dashed grey = physics baseline (ideal clear-sky output)"})]}):(0,_.jsx)(M,{data:Ae}),We&&(0,_.jsxs)("div",{style:{textAlign:"right",fontSize:"0.7rem",color:"#9ca3af",marginTop:"0.5rem",fontFamily:"Inter, sans-serif",padding:"0 1rem 1rem"},children:["Forecast generated: ",We.toLocaleDateString()," ",We.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})]})]})},E=()=>{var e,t;const{isDark:i}=(0,l.D)(),[c]=(0,n.ok)(),[p,g]=(0,a.useState)([]),[h,m]=(0,a.useState)([]),[u,x]=(0,a.useState)(!0),[f,y]=(0,a.useState)(null),[b,v]=(0,a.useState)(null),[j,w]=(0,a.useState)(!1),[k,S]=(0,a.useState)(""),[N,C]=(0,a.useState)(""),[A,D]=(0,a.useState)([]),[F,z]=(0,a.useState)(!1),[W,I]=(0,a.useState)([]),[L,T]=(0,a.useState)(new Set),[B,R]=(0,a.useState)(!1),[M,E]=(0,a.useState)(1),[O,G]=(0,a.useState)(25),[K,H]=(0,a.useState)(0),[J,V]=(0,a.useState)(0),[q,U]=(0,a.useState)([]),[Y,Q]=(0,a.useState)(!0),[Z,X]=(0,a.useState)(null),[$,ee]=(0,a.useState)(null),[te,ie]=(0,a.useState)([]),[re,ae]=(0,a.useState)(null),[ne,se]=(0,a.useState)(null),[oe,le]=(0,a.useState)([]),[de,ce]=(0,a.useState)(!1),[pe,ge]=(0,a.useState)({device_serial:"",user:"",config_version:""}),[he,me]=(0,a.useState)({device_serial:"",user:"",config_version:""}),[ue,xe]=(0,a.useState)(null),[fe,ye]=(0,a.useState)(!1),[be,ve]=(0,a.useState)(!1),[je,_e]=(0,a.useState)({site_id:"",display_name:"",latitude:"",longitude:"",capacity_kw:"",tilt_deg:"18",azimuth_deg:"180",timezone:"Asia/Kolkata",is_active:!0}),[we,ke]=(0,a.useState)(!1),[Se,Ne]=(0,a.useState)(null),[Ce,Ae]=(0,a.useState)(null),De=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{x(!0);const i=await s.K.getDevices(t||void 0,e,O);i.results?(g(i.results),m(i.results),H(i.count),V(i.total_pages),E(i.current_page)):(g(Array.isArray(i)?i:[]),m(Array.isArray(i)?i:[]),H(Array.isArray(i)?i.length:0),V(1),E(1)),x(!1)}catch(i){y(i instanceof Error?i.message:"An error occurred"),x(!1)}},[O]),Fe=(0,a.useCallback)(async e=>{ce(!0);try{const t=await s.K.getDeviceLogs(e,50,0);le(t.logs||[])}catch(t){console.error("Failed to fetch device logs:",t),le([])}finally{ce(!1)}},[]),ze=(0,a.useCallback)(e=>{if(se(e),xe(null),ye(!0),le([]),e.config_version){const t=q.find(t=>t.config_id===e.config_version);Ae(t||null)}else Ae(null);Promise.all([s.K.getDeviceSite(e.id).then(e=>xe(e)).catch(t=>{console.error("Failed to fetch site for device",e.id,":",t),xe(null)}),Fe(e.id)]).finally(()=>ye(!1))},[Fe,q]);(0,a.useEffect)(()=>{(async()=>{try{const e=(await s.K.getUsers()).filter(e=>!e.is_staff&&!e.is_superuser);I(e)}catch(e){console.error("Failed to fetch users:",e),y("Failed to load users for device assignment")}})(),(async()=>{try{const e=await s.K.getPresets();U(Array.isArray(e)?e:[])}catch(e){console.error("Failed to fetch presets:",e)}finally{Q(!1)}})(),(async()=>{try{const[e,t]=await Promise.all([s.K.getSystemHealth(),s.K.getTelemetry()]);X(e||null);const i=Array.isArray(t)?t:[];ie(i);const r=i.reduce((e,t)=>{if(null===t||void 0===t||!t.timestamp)return e;const i=new Date(t.timestamp);return Number.isNaN(i.getTime())?e:e?i>new Date(e)?t.timestamp:e:t.timestamp},null),a=new Set(i.map(e=>e.deviceId)).size;ee({totalPoints:i.length,deviceCount:a,latestTimestamp:r})}catch(e){console.error("Failed to fetch dashboard data:",e),ae("Failed to load device dashboards")}})()},[]),(0,a.useEffect)(()=>{const e=c.get("deviceId");if(e){const t=parseInt(e,10);if(!isNaN(t)){const e=p.find(e=>e.id===t);e&&ze(e)}}},[c,p,ze]),(0,a.useEffect)(()=>{De(M,k)},[M,k,O,De]),(0,a.useEffect)(()=>{const e=()=>{z(!1)};return F&&document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[F]),(0,a.useEffect)(()=>{if(""===N.trim())D(W);else{const e=N.toLowerCase(),t=W.filter(t=>{const i="".concat(t.first_name," ").concat(t.last_name).toLowerCase();return t.username.toLowerCase().includes(e)||t.first_name.toLowerCase().includes(e)||t.last_name.toLowerCase().includes(e)||i.includes(e)||t.email.toLowerCase().includes(e)});D(t)}},[W,N]);const We=o(e=>{},300),Ie=e=>{var t,i;v(e),ge({device_serial:e.device_serial,user:e.user||"",config_version:e.config_version||""}),C(e.user?"".concat(null===(t=W.find(t=>t.username===e.user))||void 0===t?void 0:t.first_name," ").concat(null===(i=W.find(t=>t.username===e.user))||void 0===i?void 0:i.last_name," (").concat(e.user,")"):""),z(!1)},Le=async()=>{if(b)try{await s.K.updateDevice(b.id,pe),v(null),await De(M,k)}catch(e){y(e instanceof Error?e.message:"Failed to update device")}},Te=async()=>{try{await s.K.createDevice(he),w(!1),me({device_serial:"",user:"",config_version:""}),await De(M,k)}catch(e){y(e instanceof Error?e.message:"Failed to create device")}},Be=()=>{v(null),w(!1),C(""),z(!1)},Re=()=>{se(null),xe(null),ve(!1)};if(u)return(0,_.jsx)("div",{className:"loading",children:"Loading devices..."});if(f)return(0,_.jsxs)("div",{className:"error",children:["Error: ",f]});const Me=e=>{var t,i;return(null===(t=e.gateway_configuration)||void 0===t||null===(i=t.general_settings)||void 0===i?void 0:i.config_id)||e.config_id||""};if(ne){var Pe,Ee;const e=te.filter(e=>e.deviceId===ne.device_serial),t=e.reduce((e,t)=>{if(null===t||void 0===t||!t.timestamp)return e;const i=new Date(t.timestamp);if(Number.isNaN(i.getTime()))return e;if(!e)return t.timestamp;return i>new Date(e)?t.timestamp:e},null);return(0,_.jsxs)("div",{children:[(0,_.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[(0,_.jsx)("button",{onClick:Re,className:"btn btn-secondary",style:{marginRight:"15px"},children:"\u2190 Back to Devices"}),(0,_.jsxs)("h1",{style:{margin:0},children:[ne.device_serial," Dashboard"]})]}),(0,_.jsxs)("div",{className:"card",style:{marginBottom:"20px"},children:[(0,_.jsxs)("div",{className:"card-header",children:[(0,_.jsx)("h2",{children:"Device Details"}),(0,_.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,_.jsx)("button",{onClick:()=>Ie(ne),className:"btn",children:"Edit Device"}),(0,_.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to reboot device ".concat(e.device_serial,"? The device will restart on its next heartbeat.")))try{await s.K.rebootDevice(e.id),alert("Reboot command queued for ".concat(e.device_serial,". Device will reboot on next heartbeat."))}catch(t){console.error("Reboot error:",t),y(t instanceof Error?t.message:"Failed to queue reboot command")}})(ne),className:"btn",style:{backgroundColor:"#f59e0b",color:"white",border:"none"},title:"Queue reboot command for device",children:"\ud83d\udd04 Reboot"}),(0,_.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\u26a0\ufe0f WARNING: Hard reset will erase device configuration and restart it.\n\nAre you sure you want to hard reset device ".concat(e.device_serial,"?")))try{await s.K.hardResetDevice(e.id),alert("Hard reset command queued for ".concat(e.device_serial,". Device will reset on next heartbeat."))}catch(t){console.error("Hard reset error:",t),y(t instanceof Error?t.message:"Failed to queue hard reset command")}})(ne),className:"btn",style:{backgroundColor:"#dc2626",color:"white",border:"none"},title:"Queue hard reset command for device (erases config)",children:"\u26a0\ufe0f Hard Reset"}),(0,_.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\u26a0\ufe0f WARNING: This will permanently delete device ".concat(e.device_serial," and all its data.\n\nAre you sure you want to delete this device?")))try{await s.K.deleteDevice(e.id),alert("Device ".concat(e.device_serial," deleted successfully.")),se(null),De()}catch(t){console.error("Delete device error:",t),y(t instanceof Error?t.message:"Failed to delete device")}})(ne),className:"btn",style:{backgroundColor:"#7f1d1d",color:"white",border:"none"},title:"Permanently delete device and all its data",children:"\ud83d\uddd1\ufe0f Delete"})]})]}),(0,_.jsx)("div",{style:{padding:"20px"},children:(0,_.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"15px"},children:[(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Status:"}),(0,_.jsx)("p",{style:{margin:"5px 0"},children:(0,_.jsx)("span",{style:{display:"inline-block",padding:"4px 12px",borderRadius:"12px",fontSize:"0.875rem",fontWeight:"500",backgroundColor:ne.is_online?"#dcfce7":"#fee2e2",color:ne.is_online?"#166534":"#991b1b"},children:ne.is_online?"\ud83d\udfe2 Online":"\ud83d\udd34 Offline"})})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Last Heartbeat:"}),(0,_.jsx)("p",{style:{margin:"5px 0"},children:ne.last_heartbeat?new Date(ne.last_heartbeat).toLocaleString():"Never"})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"MAC / HW ID:"}),(0,_.jsx)("p",{style:{margin:"5px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.9rem"},children:ne.hw_id||"\u2014"})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Model:"}),(0,_.jsx)("p",{style:{margin:"5px 0"},children:ne.model||"\u2014"})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Assigned User:"}),(0,_.jsx)("p",{style:{margin:"5px 0"},children:ne.user||"-"})]}),(0,_.jsxs)("div",{style:{gridColumn:"1 / -1",padding:"15px",backgroundColor:"transparent",borderRadius:"8px",border:i?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-sync-card",children:[(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{style:{fontSize:"0.95rem",color:"inherit"},className:"config-heading",children:"Configuration"}),Ce&&(0,_.jsx)("div",{style:{fontSize:"0.875rem",color:i?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginTop:"2px"},className:"config-label",children:Ce.name||ne.config_version})]}),ne.config_version?ne.pending_config_update?(0,_.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:"5px",padding:"4px 12px",borderRadius:"12px",fontSize:"0.8rem",fontWeight:"500",backgroundColor:"#fef9c3",color:"#854d0e"},children:"\u23f3 Pending update"}):(0,_.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:"5px",padding:"4px 12px",borderRadius:"12px",fontSize:"0.8rem",fontWeight:"500",backgroundColor:"#dcfce7",color:"#166534"},children:"\u2713 Synced"}):(0,_.jsx)("span",{style:{color:i?"#a0a0a0":"rgba(0, 0, 0, 0.5)",fontSize:"0.875rem"},className:"config-no-preset",children:"No preset assigned"})]}),ne.config_version&&(0,_.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px",fontSize:"0.8rem"},children:[(0,_.jsxs)("div",{style:{padding:"8px",backgroundColor:i?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:i?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,_.jsx)("div",{style:{color:i?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Preset ID"}),(0,_.jsx)("div",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:ne.config_version})]}),null!=(null===Ce||void 0===Ce?void 0:Ce.slaves_count)&&(0,_.jsxs)("div",{style:{padding:"8px",backgroundColor:i?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:i?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,_.jsx)("div",{style:{color:i?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Slaves"}),(0,_.jsxs)("div",{style:{fontWeight:"500",color:"inherit"},children:[Ce.slaves_count," device",1!==Ce.slaves_count?"s":""]})]}),null!=ne.config_ack_ver&&null!=(null===Ce||void 0===Ce?void 0:Ce.version)&&(0,_.jsxs)("div",{style:{padding:"8px",backgroundColor:i?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",gridColumn:"1 / -1",border:ne.config_ack_ver===Ce.version?"2px solid #dcfce7":"2px solid #fef9c3"},className:"config-info-box",children:[(0,_.jsx)("div",{style:{color:i?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"4px"},className:"config-label",children:"Version Status"}),(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,_.jsxs)("div",{children:[(0,_.jsx)("span",{style:{fontSize:"0.75rem",color:i?"#b0b0b0":"rgba(0, 0, 0, 0.6)"},className:"config-label",children:"Device: "}),(0,_.jsxs)("span",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:["v",ne.config_ack_ver]}),(0,_.jsx)("span",{style:{margin:"0 8px",color:i?"#808080":"rgba(0, 0, 0, 0.4)"},className:"config-arrow",children:"\u2192"}),(0,_.jsx)("span",{style:{fontSize:"0.75rem",color:i?"#b0b0b0":"rgba(0, 0, 0, 0.6)"},className:"config-label",children:"Latest: "}),(0,_.jsxs)("span",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:["v",Ce.version]})]}),ne.config_ack_ver===Ce.version?(0,_.jsx)("span",{style:{color:"#166534",fontSize:"0.75rem",fontWeight:"500"},children:"\u2713 Up to date"}):(0,_.jsx)("span",{style:{color:"#854d0e",fontSize:"0.75rem",fontWeight:"500"},children:"\u27f3 Update available"})]})]}),null!=ne.config_ack_ver&&null==(null===Ce||void 0===Ce?void 0:Ce.version)&&(0,_.jsxs)("div",{style:{padding:"8px",backgroundColor:i?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:i?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,_.jsx)("div",{style:{color:i?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Device Version"}),(0,_.jsxs)("div",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:["v",ne.config_ack_ver]})]}),(null===Ce||void 0===Ce||null===(Pe=Ce.gateway_configuration)||void 0===Pe||null===(Ee=Pe.general_settings)||void 0===Ee?void 0:Ee.last_updated)&&(0,_.jsxs)("div",{style:{padding:"8px",backgroundColor:i?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:i?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,_.jsx)("div",{style:{color:i?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Last Modified"}),(0,_.jsx)("div",{style:{fontWeight:"500",fontSize:"0.75rem",color:"inherit"},children:new Date(Ce.gateway_configuration.general_settings.last_updated).toLocaleDateString()})]}),ne.config_acked_at&&(0,_.jsxs)("div",{style:{padding:"8px",backgroundColor:i?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:i?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)",gridColumn:"1 / -1"},className:"config-info-box",children:[(0,_.jsx)("div",{style:{color:i?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Last Synced"}),(0,_.jsxs)("div",{style:{fontWeight:"500",fontSize:"0.75rem",color:"inherit"},children:[new Date(ne.config_acked_at).toLocaleString(),(()=>{const e=new Date(ne.config_acked_at),t=(new Date).getTime()-e.getTime(),i=Math.floor(t/6e4),r=Math.floor(i/60),a=Math.floor(r/24);return i<1?" \u2022 just now":i<60?" \u2022 ".concat(i,"m ago"):r<24?" \u2022 ".concat(r,"h ago"):" \u2022 ".concat(a,"d ago")})()]})]}),ne.config_downloaded_at&&ne.config_acked_at&&(0,_.jsxs)("div",{style:{padding:"8px",backgroundColor:i?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:i?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)",gridColumn:"1 / -1"},className:"config-info-box",children:[(0,_.jsx)("div",{style:{color:i?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Apply Duration"}),(0,_.jsxs)("div",{style:{fontWeight:"500",color:"inherit"},children:[Math.round((new Date(ne.config_acked_at).getTime()-new Date(ne.config_downloaded_at).getTime())/1e3)," seconds",(0,_.jsx)("span",{style:{color:i?"#a0a0a0":"rgba(0, 0, 0, 0.5)",marginLeft:"8px",fontSize:"0.75rem"},className:"config-label",children:"(download \u2192 acknowledge)"})]})]})]})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Provisioned At:"}),(0,_.jsx)("p",{style:{margin:"5px 0"},children:ne.provisioned_at?new Date(ne.provisioned_at).toLocaleDateString():"N/A"})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Created By:"}),(0,_.jsx)("p",{style:{margin:"5px 0"},children:ne.created_by_username||"-"})]}),(0,_.jsx)("div",{style:{gridColumn:"1 / -1"},children:(0,_.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[(0,_.jsx)("input",{type:"checkbox",checked:ne.logs_enabled||!1,onChange:e=>(async(e,t)=>{try{await s.K.toggleDeviceLogs(e.id,t),se((0,r.A)((0,r.A)({},e),{},{logs_enabled:t})),De()}catch(i){console.error("Toggle logs error:",i),y(i instanceof Error?i.message:"Failed to toggle device logs")}})(ne,e.target.checked),style:{background:i?"#1a1a1a":"white",border:i?"1px solid #404040":"1px solid #ced4da"}}),(0,_.jsx)("strong",{children:"Enable Device Logs"}),(0,_.jsx)("span",{style:{fontSize:"0.875rem",color:i?"#b0b0b0":"#9ca3af"},children:"(Device will send logs when enabled)"})]})})]})})]}),(0,_.jsxs)("div",{className:"grid grid-cols-2",style:{gap:"var(--space-6, 24px)",marginTop:"32px"},children:[(0,_.jsxs)("div",{className:"card",children:[(0,_.jsx)("h2",{children:"System Health"}),re&&(0,_.jsx)("p",{className:"error",children:re}),!re&&!Z&&(0,_.jsx)("p",{children:"Loading system health..."}),Z&&(0,_.jsxs)("div",{children:[(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"Overall:"})," ",Z.overall_health]}),(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"Devices:"})," ",Z.active_devices,"/",Z.total_devices," active"]}),(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"Telemetry Points:"})," ",Z.total_telemetry_points.toLocaleString()]})]})]}),(0,_.jsxs)("div",{className:"card",children:[(0,_.jsx)("h2",{children:"Telemetry Snapshot"}),re&&(0,_.jsx)("p",{className:"error",children:re}),!re&&!$&&(0,_.jsx)("p",{children:"Loading telemetry..."}),$&&(0,_.jsxs)("div",{children:[(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"Total Points:"})," ",e.length.toLocaleString()]}),(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"Data Types:"})," ",new Set(e.map(e=>e.data_type)).size]}),(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"Latest:"})," ",t?new Date(t).toLocaleString():"N/A"]})]})]})]}),(0,_.jsxs)("div",{className:"card",style:{marginTop:"48px"},children:[(0,_.jsxs)("div",{className:"card-header",children:[(0,_.jsx)("h2",{children:"Site Configuration"}),!fe&&(0,_.jsx)("button",{className:"btn",onClick:()=>{_e(ue?{site_id:ue.site_id,display_name:ue.display_name,latitude:String(ue.latitude),longitude:String(ue.longitude),capacity_kw:String(ue.capacity_kw),tilt_deg:String(ue.tilt_deg),azimuth_deg:String(ue.azimuth_deg),timezone:ue.timezone,is_active:ue.is_active}:{site_id:"",display_name:"",latitude:"",longitude:"",capacity_kw:"",tilt_deg:"18",azimuth_deg:"180",timezone:"Asia/Kolkata",is_active:!0}),Ne(null),ve(!0)},children:ue?"Edit Site":"Add Site"})]}),(0,_.jsx)("div",{style:{padding:"20px"},children:fe?(0,_.jsx)("p",{style:{color:"var(--text-muted)"},children:"Loading site details\u2026"}):ue?(0,_.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"15px"},children:[(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Site ID:"}),(0,_.jsx)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.88rem",color:"#00a63e"},children:ue.site_id})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Display Name:"}),(0,_.jsx)("p",{style:{margin:"4px 0"},children:ue.display_name||"\u2014"})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Status:"}),(0,_.jsx)("p",{style:{margin:"4px 0"},children:(0,_.jsx)("span",{className:ue.is_active?"status-badge status-badge-success":"status-badge status-badge-danger",children:ue.is_active?"Active":"Inactive"})})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Latitude:"}),(0,_.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.88rem"},children:[ue.latitude,"\xb0"]})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Longitude:"}),(0,_.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.88rem"},children:[ue.longitude,"\xb0"]})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Timezone:"}),(0,_.jsx)("p",{style:{margin:"4px 0"},children:ue.timezone})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Capacity:"}),(0,_.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace"},children:[ue.capacity_kw," kW"]})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Tilt:"}),(0,_.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace"},children:[ue.tilt_deg,"\xb0"]})]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("strong",{children:"Azimuth:"}),(0,_.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace"},children:[ue.azimuth_deg,"\xb0"]})]})]}):(0,_.jsx)("p",{style:{color:"var(--text-muted)",fontSize:"0.9rem"},children:"No site configured for this device yet."})})]}),ue&&(0,_.jsx)("div",{style:{marginTop:"48px"},children:(0,_.jsx)(P,{siteId:ue.site_id,autoRefresh:!0})}),(0,_.jsxs)("div",{className:"card",style:{marginTop:"48px",marginBottom:"20px"},children:[(0,_.jsxs)("div",{className:"card-header",children:[(0,_.jsx)("h2",{children:"Device Logs"}),(0,_.jsx)("button",{onClick:()=>Fe(ne.id),className:"btn",disabled:de,children:de?"Loading...":"\ud83d\udd04 Refresh"})]}),(0,_.jsxs)("div",{style:{padding:"20px"},children:[!ne.logs_enabled&&(0,_.jsx)("p",{style:{color:"var(--text-muted, #9ca3af)",fontStyle:"italic"},children:"Logging is disabled for this device. Enable it in Device Details to receive logs."}),0===oe.length&&ne.logs_enabled&&!de&&(0,_.jsx)("p",{style:{color:"var(--text-muted, #9ca3af)"},children:"No logs available yet. Logs will appear when device sends them."}),de&&(0,_.jsx)("p",{style:{color:"var(--text-muted, #9ca3af)"},children:"Loading logs..."}),oe.length>0&&(0,_.jsx)("div",{style:{maxHeight:"400px",overflowY:"auto",fontFamily:"JetBrains Mono, monospace",fontSize:"0.85rem",backgroundColor:"#1e1e1e",padding:"10px",borderRadius:"4px"},children:oe.map(e=>(0,_.jsxs)("div",{style:{marginBottom:"8px",paddingBottom:"8px",borderBottom:"1px solid #333",color:"ERROR"===e.level?"#ff6b6b":"WARNING"===e.level?"#ffa500":"INFO"===e.level?"#4dabf7":"#ced4da"},children:[(0,_.jsxs)("span",{style:{color:"#888"},children:["[",new Date(e.timestamp).toLocaleString(),"]"]}),(0,_.jsxs)("span",{style:{fontWeight:"bold",marginLeft:"8px"},children:["[",e.level,"]"]}),(0,_.jsx)("span",{style:{marginLeft:"8px"},children:e.message})]},e.id))})]})]}),be&&(0,_.jsx)("div",{className:"modal",children:(0,_.jsxs)("div",{className:"modal-content",children:[(0,_.jsx)("h3",{children:ue?"Edit Site: ".concat(ue.site_id):"Add Site Configuration"}),(0,_.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),ke(!0),Ne(null);try{const e={site_id:je.site_id.trim(),display_name:je.display_name.trim(),latitude:parseFloat(je.latitude),longitude:parseFloat(je.longitude),capacity_kw:parseFloat(je.capacity_kw),tilt_deg:parseFloat(je.tilt_deg),azimuth_deg:parseFloat(je.azimuth_deg),timezone:je.timezone.trim(),is_active:je.is_active};let t;if(t=ue?await s.K.updateDeviceSite(ne.id,e):await s.K.createDeviceSite(ne.id,e),!t||!t.site_id)throw new Error("Invalid response from server \u2014 site data missing");xe(t),ve(!1),ke(!1),ue||setTimeout(()=>{s.K.getDeviceSite(ne.id).then(e=>{e&&xe(e)}).catch(e=>console.error("Failed to re-fetch site:",e))},500)}catch(t){Ne(t.message||"Failed to save site"),ke(!1)}},children:[(0,_.jsxs)("div",{className:"modal-body",children:[Se&&(0,_.jsx)("p",{style:{color:i?"#fca5a5":"#ef4444",fontSize:"0.875rem",marginBottom:"1rem"},children:Se}),(0,_.jsxs)("div",{className:"form-section",children:[(0,_.jsx)("h4",{className:"form-section-title",children:"Identification"}),(0,_.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Site ID *"}),(0,_.jsx)("input",{type:"text",required:!0,value:je.site_id,disabled:!!ue,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{site_id:e.target.value})),placeholder:"e.g. site_mumbai_01",autoComplete:"off",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}}),!!ue&&(0,_.jsx)("small",{className:"form-hint",children:"Site ID cannot be changed after creation."})]}),(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Display Name"}),(0,_.jsx)("input",{type:"text",value:je.display_name,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{display_name:e.target.value})),placeholder:"e.g. Mumbai Rooftop",autoComplete:"off",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]})]})]}),(0,_.jsxs)("div",{className:"form-section",children:[(0,_.jsx)("h4",{className:"form-section-title",children:"Location"}),(0,_.jsxs)("div",{className:"form-grid form-grid-3",children:[(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Latitude *"}),(0,_.jsx)("input",{type:"number",required:!0,step:"any",value:je.latitude,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{latitude:e.target.value})),placeholder:"19.0760",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]}),(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Longitude *"}),(0,_.jsx)("input",{type:"number",required:!0,step:"any",value:je.longitude,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{longitude:e.target.value})),placeholder:"72.8777",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]}),(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Timezone"}),(0,_.jsx)("input",{type:"text",value:je.timezone,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{timezone:e.target.value})),placeholder:"Asia/Kolkata",autoComplete:"off",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]})]})]}),(0,_.jsxs)("div",{className:"form-section",children:[(0,_.jsx)("h4",{className:"form-section-title",children:"Panel Configuration"}),(0,_.jsxs)("div",{className:"form-grid form-grid-3",children:[(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Capacity (kW) *"}),(0,_.jsx)("input",{type:"number",required:!0,step:"any",value:je.capacity_kw,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{capacity_kw:e.target.value})),placeholder:"5.0",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]}),(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Tilt (\xb0)"}),(0,_.jsx)("input",{type:"number",step:"any",value:je.tilt_deg,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{tilt_deg:e.target.value})),style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]}),(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Azimuth (\xb0)"}),(0,_.jsx)("input",{type:"number",step:"any",value:je.azimuth_deg,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{azimuth_deg:e.target.value})),style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]})]}),(0,_.jsx)("div",{className:"form-group",children:(0,_.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[(0,_.jsx)("input",{type:"checkbox",id:"dev-site-active",checked:je.is_active,onChange:e=>_e((0,r.A)((0,r.A)({},je),{},{is_active:e.target.checked})),style:{width:"16px",height:"16px",background:i?"#1a1a1a":"white",border:i?"1px solid #404040":"1px solid #ced4da"}}),"Active"]})})]})]}),(0,_.jsxs)("div",{className:"form-actions",style:{padding:"0 24px 24px 24px"},children:[(0,_.jsx)("button",{type:"submit",className:"btn",disabled:we,children:we?"Saving\u2026":ue?"Save Changes":"Add Site"}),(0,_.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>ve(!1),disabled:we,children:"Cancel"})]})]})]})}),b&&(0,_.jsx)("div",{className:"modal",children:(0,_.jsxs)("div",{className:"modal-content",children:[(0,_.jsx)("h3",{children:b?"Edit Device: ".concat(b.device_serial):"Register New Device"}),(0,_.jsxs)("form",{onSubmit:e=>{e.preventDefault(),b?Le():Te()},children:[(0,_.jsxs)("div",{className:"modal-body",children:[(0,_.jsxs)("div",{className:"form-section",children:[(0,_.jsx)("h4",{className:"form-section-title",children:"Device Identity"}),(0,_.jsx)("div",{className:"form-grid",children:(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Device Serial Number"}),(0,_.jsx)("input",{type:"text",value:b?pe.device_serial:he.device_serial,onChange:e=>b?ge((0,r.A)((0,r.A)({},pe),{},{device_serial:e.target.value})):me((0,r.A)((0,r.A)({},he),{},{device_serial:e.target.value})),required:!0,autoComplete:"off",placeholder:"SN-12345678",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]})})]}),(0,_.jsxs)("div",{className:"form-section",children:[(0,_.jsx)("h4",{className:"form-section-title",children:"Ownership & Assignment"}),(0,_.jsx)("div",{className:"form-grid",children:(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Assigned User"}),(0,_.jsxs)("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,_.jsx)("input",{type:"text",placeholder:"Search by name, username, or email...",value:N,onChange:e=>{C(e.target.value),z(!0)},onFocus:()=>z(!0),autoComplete:"off",className:"full-width",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}}),F&&(0,_.jsx)("div",{style:{position:"absolute",top:"100%",left:"0",right:"0",background:"var(--bg-secondary, #1e293b)",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"6px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",zIndex:10,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:A.length>0?A.map(e=>(0,_.jsxs)("div",{onClick:()=>{b?ge((0,r.A)((0,r.A)({},pe),{},{user:e.username})):me((0,r.A)((0,r.A)({},he),{},{user:e.username})),C("".concat(e.first_name," ").concat(e.last_name," (").concat(e.username,")")),z(!1)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",background:(b?pe.user:he.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",color:"var(--text-primary, #f8fafc)",transition:"all 0.15s ease",fontSize:"0.875rem"},onMouseEnter:e=>e.currentTarget.style.background="rgba(255, 255, 255, 0.06)",onMouseLeave:t=>t.currentTarget.style.background=(b?pe.user:he.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",children:[e.first_name," ",e.last_name," (",e.username,") ",(0,_.jsx)("br",{}),(0,_.jsx)("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary, #94a3b8)"},children:e.email})]},e.id)):(0,_.jsx)("div",{style:{padding:"12px 16px",color:"var(--text-muted, #64748b)",fontSize:"0.875rem"},children:""===N.trim()?"Start typing to search users...":"No users found"})})]})]})})]}),(0,_.jsxs)("div",{className:"form-section",children:[(0,_.jsx)("h4",{className:"form-section-title",children:"Configuration"}),(0,_.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Preset Template"}),(0,_.jsxs)("select",{value:b?pe.config_version:he.config_version,onChange:e=>b?ge((0,r.A)((0,r.A)({},pe),{},{config_version:e.target.value})):me((0,r.A)((0,r.A)({},he),{},{config_version:e.target.value})),className:"full-width",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"},children:[(0,_.jsx)("option",{value:"",children:"-- Manual Configuration --"}),Y&&(0,_.jsx)("option",{value:"",disabled:!0,children:"Loading presets..."}),!Y&&q.map(e=>(0,_.jsxs)("option",{value:Me(e),children:[e.name," (",Me(e)||"no ID",")"]},e.id))]}),(0,_.jsx)("small",{className:"form-hint",children:"Selecting a preset sets the Config Version ID below."})]}),(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Config Version ID"}),(0,_.jsx)("input",{type:"text",value:b?pe.config_version:he.config_version,onChange:e=>b?ge((0,r.A)((0,r.A)({},pe),{},{config_version:e.target.value})):me((0,r.A)((0,r.A)({},he),{},{config_version:e.target.value})),autoComplete:"off",placeholder:"Manual Config ID",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]})]})]})]}),b&&(0,_.jsx)("div",{style:{padding:"0 24px"},children:(0,_.jsx)(d.A,{createdBy:b.created_by_username,createdAt:b.created_at,updatedBy:b.updated_by_username,updatedAt:b.updated_at})}),(0,_.jsxs)("div",{className:"form-actions",style:{padding:"0 24px 24px 24px"},children:[(0,_.jsx)("button",{type:"submit",className:"btn",children:b?"Save Changes":"Create Device"}),(0,_.jsx)("button",{type:"button",onClick:Be,className:"btn btn-secondary",children:"Cancel"})]})]})]})})]})}return(0,_.jsxs)("div",{children:[(0,_.jsx)("h1",{children:"Device Management"}),(0,_.jsxs)("div",{className:"card",children:[(0,_.jsxs)("div",{className:"card-header",children:[(0,_.jsxs)("h2",{children:["Devices (",h.length,")"]}),(0,_.jsxs)("div",{className:"card-actions",children:[(0,_.jsx)("input",{type:"text",placeholder:"Search devices...",value:k,onChange:e=>{const t=e.target.value;S(t),E(1),We(t)},className:"search-input",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}}),L.size>0&&(0,_.jsx)("button",{onClick:async()=>{if(0===L.size)return void y("No devices selected for deletion");const e=Array.from(L).map(e=>p.find(t=>t.id===e)).filter(Boolean),t="Are you sure you want to delete ".concat(L.size," device(s)?\n\n").concat(e.map(e=>null===e||void 0===e?void 0:e.device_serial).join(", "));if(window.confirm(t))try{R(!0),await s.K.deleteDevicesBulk(Array.from(L));const e=p.filter(e=>!L.has(e.id));g(e),m(e.filter(e=>e.device_serial.toLowerCase().includes(k.toLowerCase()))),T(new Set),R(!1)}catch(i){R(!1),console.error("Bulk delete error:",i),y(i instanceof Error?i.message:"Failed to delete devices")}},disabled:B,style:{background:"var(--danger-color, #ef4444)",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:B?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"500",opacity:B?"0.6":"1"},children:B?"Deleting ".concat(L.size,"..."):"Delete Selected (".concat(L.size,")")}),(0,_.jsx)("button",{onClick:()=>{w(!0),C(""),z(!1)},className:"btn",children:"Register New Device"})]})]}),(0,_.jsxs)("table",{className:"table",children:[(0,_.jsx)("thead",{children:(0,_.jsxs)("tr",{children:[(0,_.jsx)("th",{style:{textAlign:"center",width:"40px"},children:(0,_.jsx)("input",{type:"checkbox",checked:L.size===h.length&&h.length>0,onChange:()=>{if(L.size===h.length)T(new Set);else{const e=new Set(h.map(e=>e.id));T(e)}},title:"Select all displayed devices",style:{background:i?"#1a1a1a":"white",border:i?"1px solid #404040":"1px solid #ced4da"}})}),(0,_.jsx)("th",{style:{textAlign:"center"},children:"Device Serial"}),(0,_.jsx)("th",{style:{textAlign:"center"},children:"Status"}),(0,_.jsx)("th",{style:{textAlign:"center"},children:"MAC / HW ID"}),(0,_.jsx)("th",{style:{textAlign:"center"},children:"Model"}),(0,_.jsx)("th",{style:{textAlign:"center"},children:"Assigned To"}),(0,_.jsx)("th",{style:{textAlign:"center"},children:"Config Version"}),(0,_.jsx)("th",{style:{textAlign:"center"},children:"Provisioned At"}),(0,_.jsx)("th",{style:{textAlign:"center"},children:"Actions"})]})}),(0,_.jsx)("tbody",{children:h.map(e=>(0,_.jsxs)("tr",{onClick:()=>ze(e),style:{background:L.has(e.id)?"rgba(99, 102, 241, 0.1)":"transparent",cursor:"pointer"},className:"clickable-row",children:[(0,_.jsx)("td",{style:{textAlign:"center"},children:(0,_.jsx)("input",{type:"checkbox",checked:L.has(e.id),onChange:()=>(e=>{const t=new Set(L);t.has(e)?t.delete(e):t.add(e),T(t)})(e.id),style:{background:i?"#1a1a1a":"white",border:i?"1px solid #404040":"1px solid #ced4da"}})}),(0,_.jsx)("td",{style:{textAlign:"center",fontFamily:"JetBrains Mono, monospace",fontSize:"0.85rem"},children:e.device_serial}),(0,_.jsx)("td",{style:{textAlign:"center"},children:(0,_.jsx)("span",{style:{display:"inline-block",padding:"4px 8px",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"500",backgroundColor:e.is_online?"#dcfce7":"#fee2e2",color:e.is_online?"#166534":"#991b1b"},children:e.is_online?"\ud83d\udfe2 Online":"\ud83d\udd34 Offline"})}),(0,_.jsx)("td",{style:{textAlign:"center",fontFamily:"JetBrains Mono, monospace",fontSize:"0.82rem",color:e.hw_id?"inherit":"var(--text-muted, #9ca3af)"},children:e.hw_id||"\u2014"}),(0,_.jsx)("td",{style:{textAlign:"center",fontSize:"0.875rem"},children:e.model||(0,_.jsx)("span",{style:{color:"var(--text-muted, #9ca3af)"},children:"\u2014"})}),(0,_.jsx)("td",{style:{textAlign:"center"},children:e.user||"-"}),(0,_.jsx)("td",{style:{textAlign:"center"},children:e.config_version||"-"}),(0,_.jsx)("td",{style:{textAlign:"center"},children:(()=>{if(!e.provisioned_at)return"N/A";const t=new Date(e.provisioned_at);return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString()})()}),(0,_.jsxs)("td",{style:{textAlign:"center"},children:[(0,_.jsx)("button",{onClick:t=>{t.stopPropagation(),Ie(e)},style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-secondary, #94a3b8)",margin:"0 6px"},title:"Edit",children:(0,_.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,_.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,_.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,_.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{if(window.confirm("Are you sure you want to delete device ".concat(e.device_serial,"?")))try{await s.K.deleteDevice(e.id);const t=p.filter(t=>t.id!==e.id);g(t),m(t)}catch(t){console.error("Delete error:",t),y(t instanceof Error?t.message:"Failed to delete device")}})(e)},style:{background:"none",border:"none",cursor:"pointer",color:"var(--danger-color, #ef4444)",margin:"0 6px"},title:"Delete",children:(0,_.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,_.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,_.jsx)("path",{d:"M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"}),(0,_.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,_.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]},e.id))})]}),K>0&&(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderTop:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",gap:"16px"},children:[(0,_.jsxs)("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary, #94a3b8)"},children:["Showing ",(M-1)*O+1," - ",Math.min(M*O,K)," of ",K," devices"]}),(0,_.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,_.jsx)("button",{onClick:()=>E(Math.max(1,M-1)),disabled:1===M,style:{padding:"8px 12px",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"6px",background:1===M?"rgba(148, 163, 184, 0.1)":"transparent",color:"var(--text-primary, #f8fafc)",cursor:1===M?"not-allowed":"pointer",opacity:1===M?"0.5":"1"},children:"\u2190 Previous"}),(0,_.jsx)("div",{style:{display:"flex",gap:"4px",alignItems:"center"},children:(()=>{const e=[];for(let i=1;i<=J;i++){var t;1===i||i===J||Math.abs(i-M)<=1?e.push((0,_.jsx)("button",{onClick:()=>E(i),style:{padding:"6px 10px",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"4px",background:i===M?"rgba(99, 102, 241, 0.2)":"transparent",color:"var(--text-primary, #f8fafc)",cursor:"pointer",fontWeight:i===M?"bold":"normal",minWidth:"32px"},children:i},i)):(null===(t=e[e.length-1])||void 0===t?void 0:t.key)!=="ellipsis-"+Math.floor(i/10)&&e.push((0,_.jsx)("span",{style:{padding:"0 4px",color:"var(--text-secondary, #94a3b8)"},children:"..."},"ellipsis-".concat(Math.floor(i/10))))}return e})()}),(0,_.jsx)("button",{onClick:()=>E(Math.min(J,M+1)),disabled:M===J,style:{padding:"8px 12px",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"6px",background:M===J?"rgba(148, 163, 184, 0.1)":"transparent",color:"var(--text-primary, #f8fafc)",cursor:M===J?"not-allowed":"pointer",opacity:M===J?"0.5":"1"},children:"Next \u2192"})]}),(0,_.jsxs)("select",{value:O,onChange:e=>{G(parseInt(e.target.value)),E(1)},style:{padding:"8px",border:i?"1px solid #404040":"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px",background:i?"#1a1a1a":"#0f172a",color:i?"#e0e0e0":"#f8fafc",cursor:"pointer",fontSize:"0.875rem"},children:[(0,_.jsx)("option",{value:10,children:"10 per page"}),(0,_.jsx)("option",{value:25,children:"25 per page"}),(0,_.jsx)("option",{value:50,children:"50 per page"}),(0,_.jsx)("option",{value:100,children:"100 per page"})]})]})]}),(b||j)&&(0,_.jsx)("div",{className:"modal",children:(0,_.jsxs)("div",{className:"modal-content",children:[(0,_.jsx)("h3",{children:b?"Edit Device: ".concat(b.device_serial):"Register New Device"}),(0,_.jsxs)("form",{onSubmit:e=>{e.preventDefault(),b?Le():Te()},children:[(0,_.jsxs)("div",{className:"modal-body",children:[(0,_.jsxs)("div",{className:"form-section",children:[(0,_.jsx)("h4",{className:"form-section-title",children:"Device Identity"}),(0,_.jsx)("div",{className:"form-grid",children:(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Device Serial Number"}),(0,_.jsx)("input",{type:"text",value:b?pe.device_serial:he.device_serial,onChange:e=>b?ge((0,r.A)((0,r.A)({},pe),{},{device_serial:e.target.value})):me((0,r.A)((0,r.A)({},he),{},{device_serial:e.target.value})),required:!0,autoComplete:"off",placeholder:"SN-12345678",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]})})]}),(0,_.jsxs)("div",{className:"form-section",children:[(0,_.jsx)("h4",{className:"form-section-title",children:"Ownership & Assignment"}),(0,_.jsx)("div",{className:"form-grid",children:(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Assigned User"}),(0,_.jsxs)("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,_.jsx)("input",{type:"text",placeholder:"Search and select user...",value:N,onChange:e=>{C(e.target.value),z(!0)},onFocus:()=>z(!0),autoComplete:"off",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}}),(b?pe.user:he.user)&&(0,_.jsxs)("div",{style:{marginTop:"8px",fontSize:"0.875rem",color:i?"#b0b0b0":"#94a3b8"},children:[(0,_.jsx)("strong",{children:"Selected:"})," ",null===(e=W.find(e=>e.username===(b?pe.user:he.user)))||void 0===e?void 0:e.first_name," ",null===(t=W.find(e=>e.username===(b?pe.user:he.user)))||void 0===t?void 0:t.last_name," (",b?pe.user:he.user,")",(0,_.jsx)("button",{type:"button",onClick:()=>{b?ge((0,r.A)((0,r.A)({},pe),{},{user:""})):me((0,r.A)((0,r.A)({},he),{},{user:""})),C("")},className:"btn-icon btn-icon-danger",style:{marginLeft:"10px"},title:"Remove Assignment",children:"\u2715"})]}),F&&(0,_.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--bg-secondary, #0f172a)",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",borderRadius:"8px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"var(--shadow-xl)",marginTop:"4px"},children:A.length>0?A.map(e=>(0,_.jsxs)("div",{onClick:()=>{b?ge((0,r.A)((0,r.A)({},pe),{},{user:e.username})):me((0,r.A)((0,r.A)({},he),{},{user:e.username})),C("".concat(e.first_name," ").concat(e.last_name," (").concat(e.username,")")),z(!1)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",background:(b?pe.user:he.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",color:"var(--text-primary, #f8fafc)",transition:"all 0.15s ease",fontSize:"0.875rem"},onMouseEnter:e=>e.currentTarget.style.background="rgba(255, 255, 255, 0.06)",onMouseLeave:t=>t.currentTarget.style.background=(b?pe.user:he.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",children:[e.first_name," ",e.last_name," (",e.username,") ",(0,_.jsx)("br",{}),(0,_.jsx)("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary, #94a3b8)"},children:e.email})]},e.id)):(0,_.jsx)("div",{style:{padding:"12px 16px",color:"var(--text-muted, #64748b)",fontSize:"0.875rem"},children:""===N.trim()?"Start typing to search users...":"No users found"})})]})]})})]}),(0,_.jsxs)("div",{className:"form-section",children:[(0,_.jsx)("h4",{className:"form-section-title",children:"Configuration"}),(0,_.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Preset Template"}),(0,_.jsxs)("select",{value:b?pe.config_version:he.config_version,onChange:e=>b?ge((0,r.A)((0,r.A)({},pe),{},{config_version:e.target.value})):me((0,r.A)((0,r.A)({},he),{},{config_version:e.target.value})),className:"full-width",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"},children:[(0,_.jsx)("option",{value:"",children:"-- Manual Configuration --"}),Y&&(0,_.jsx)("option",{value:"",disabled:!0,children:"Loading presets..."}),!Y&&q.map(e=>(0,_.jsxs)("option",{value:Me(e),children:[e.name," (",Me(e)||"no ID",")"]},e.id))]}),(0,_.jsx)("small",{className:"form-hint",children:"Selecting a preset sets the Config Version ID below."})]}),(0,_.jsxs)("div",{className:"form-group",children:[(0,_.jsx)("label",{children:"Config Version ID"}),(0,_.jsx)("input",{type:"text",value:b?pe.config_version:he.config_version,onChange:e=>b?ge((0,r.A)((0,r.A)({},pe),{},{config_version:e.target.value})):me((0,r.A)((0,r.A)({},he),{},{config_version:e.target.value})),autoComplete:"off",placeholder:"Manual Config ID",style:{background:i?"#1a1a1a":"white",color:i?"#e0e0e0":"inherit",border:i?"1px solid #404040":"1px solid #ced4da"}})]})]})]})]}),b&&(0,_.jsx)("div",{style:{padding:"0 24px"},children:(0,_.jsx)(d.A,{createdBy:b.created_by_username,createdAt:b.created_at,updatedBy:b.updated_by_username,updatedAt:b.updated_at})}),(0,_.jsxs)("div",{className:"form-actions",style:{padding:"24px"},children:[(0,_.jsx)("button",{type:"submit",className:"btn",children:b?"Save Changes":"Register Device"}),(0,_.jsx)("button",{type:"button",onClick:Be,className:"btn btn-secondary",children:"Cancel"})]})]})]})})]})}}}]);
//# sourceMappingURL=239.4d85447e.chunk.js.map