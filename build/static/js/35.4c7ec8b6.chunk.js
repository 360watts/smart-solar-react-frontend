"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[35],{8035(e,t,s){s.r(t),s.d(t,{default:()=>l});var a=s(2555),r=s(5043),n=s(5560),i=s(579);const l=()=>{const[e,t]=(0,r.useState)([]),[s,l]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[d,h]=(0,r.useState)(null),[u,g]=(0,r.useState)(null),[m,x]=(0,r.useState)(!1),[p,v]=(0,r.useState)(""),[f,j]=(0,r.useState)(null),[y,b]=(0,r.useState)(null),[_,N]=(0,r.useState)([]),[A,w]=(0,r.useState)(!1),[C,S]=(0,r.useState)(null),[T,k]=(0,r.useState)({config_id:"",name:"",description:"",baud_rate:9600,data_bits:8,stop_bits:1,parity:0}),[I,L]=(0,r.useState)({name:"",description:"",baud_rate:9600,data_bits:8,stop_bits:1,parity:0}),[D,E]=(0,r.useState)({slave_id:"",device_name:"",polling_interval_ms:5e3,timeout_ms:1e3,enabled:!0,registers:[]}),[P,q]=(0,r.useState)({label:"",address:0,num_registers:1,function_code:3,data_type:0,scale_factor:1,offset:0,enabled:!0});(0,r.useEffect)(()=>{F()},[]);const[O,U]=(0,r.useState)("");(0,r.useEffect)(()=>{const e=setTimeout(()=>{U(p)},300);return()=>clearTimeout(e)},[p]),(0,r.useEffect)(()=>{F(O)},[O]);const F=async e=>{try{const s=await n.K.getPresets();let a=s;if(e){const t=e.toLowerCase();a=s.filter(e=>e.name.toLowerCase().includes(t)||e.config_id.toLowerCase().includes(t)||e.description.toLowerCase().includes(t))}t(s),l(a),c(!1)}catch(s){h(s instanceof Error?s.message:"An error occurred"),c(!1)}},B=async()=>{if(u)try{const s=await n.K.updatePreset(u.id,T),a=e.map(e=>e.id===u.id?s:e);t(a);const r=p.toLowerCase(),i=a.filter(e=>e.name.toLowerCase().includes(r)||e.config_id.toLowerCase().includes(r)||e.description.toLowerCase().includes(r));l(i),g(null)}catch(s){h(s instanceof Error?s.message:"Failed to update preset")}},M=async()=>{try{const s=await n.K.createPreset(I),a=[...e,s];t(a);const r=p.toLowerCase(),i=a.filter(e=>e.name.toLowerCase().includes(r)||e.config_id.toLowerCase().includes(r)||e.description.toLowerCase().includes(r));l(i),x(!1),L({name:"",description:"",baud_rate:9600,data_bits:8,stop_bits:1,parity:0})}catch(s){h(s instanceof Error?s.message:"Failed to create preset")}},J=async e=>{try{const t=(await n.K.getSlaves(e)).map(e=>({id:e.id,slaveId:e.slave_id,deviceName:e.device_name,pollingIntervalMs:e.polling_interval_ms,timeoutMs:e.timeout_ms,enabled:e.enabled,registers:e.registers.map(e=>({id:e.id,label:e.label,address:e.address,numRegisters:e.num_registers,functionCode:e.function_code,dataType:e.data_type,scaleFactor:e.scale_factor,offset:e.offset,enabled:e.enabled}))}));N(t)}catch(t){console.error("Failed to fetch slaves:",t),h("Failed to load slaves for this preset")}},R=(s,r)=>{const n=e.map(e=>e.config_id===s?(0,a.A)((0,a.A)({},e),{},{slaves_count:r}):e);t(n);const i=p.toLowerCase(),o=n.filter(e=>e.name.toLowerCase().includes(i)||e.config_id.toLowerCase().includes(i)||e.description.toLowerCase().includes(i));l(o),y&&y.config_id===s&&b((0,a.A)((0,a.A)({},y),{},{slaves_count:r}))},K=async()=>{if(y){if(!C){const e=parseInt(D.slave_id);if(_.find(t=>t.slaveId===e))return void h("Slave ID ".concat(e," already exists for this configuration. Please choose a different ID."))}try{const e={slave_id:parseInt(D.slave_id),device_name:D.device_name,polling_interval_ms:D.polling_interval_ms,timeout_ms:D.timeout_ms,enabled:D.enabled,registers:D.registers};if(C){const t=await n.K.updateSlave(y.config_id,C.slaveId,e),s={id:t.id,slaveId:t.slave_id,deviceName:t.device_name,pollingIntervalMs:t.polling_interval_ms,timeoutMs:t.timeout_ms,enabled:t.enabled,registers:t.registers.map(e=>({id:e.id,label:e.label,address:e.address,numRegisters:e.num_registers,functionCode:e.function_code,dataType:e.data_type,scaleFactor:e.scale_factor,offset:e.offset,enabled:e.enabled}))},a=_.map(e=>e.slaveId===C.slaveId?s:e);N(a),R(y.config_id,a.length),S(null)}else{const t=await n.K.createSlave(y.config_id,e),s={id:t.id,slaveId:t.slave_id,deviceName:t.device_name,pollingIntervalMs:t.polling_interval_ms,timeoutMs:t.timeout_ms,enabled:t.enabled,registers:t.registers.map(e=>({id:e.id,label:e.label,address:e.address,numRegisters:e.num_registers,functionCode:e.function_code,dataType:e.data_type,scaleFactor:e.scale_factor,offset:e.offset,enabled:e.enabled}))},a=[..._,s];N(a),R(y.config_id,a.length),w(!1)}E({slave_id:"",device_name:"",polling_interval_ms:5e3,timeout_ms:1e3,enabled:!0,registers:[]})}catch(e){h(e instanceof Error?e.message:"Failed to save slave")}}};return o?(0,i.jsx)("div",{className:"loading",children:"Loading presets..."}):d?(0,i.jsxs)("div",{className:"error",children:["Error: ",d]}):(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{children:"Device Presets"}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("div",{className:"card-header",children:[(0,i.jsxs)("h2",{children:["Presets (",s.length,")"]}),(0,i.jsxs)("div",{className:"card-actions",children:[(0,i.jsx)("input",{type:"text",placeholder:"Search presets...",value:p,onChange:e=>{v(e.target.value)},className:"search-input"}),(0,i.jsx)("button",{onClick:()=>x(!0),className:"btn",children:"Create New Preset"})]})]}),(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{textAlign:"center"},children:"Name"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Config ID"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Description"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Slaves"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Actions"})]})}),(0,i.jsx)("tbody",{children:s.map(s=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:s.name}),(0,i.jsx)("td",{children:s.config_id}),(0,i.jsx)("td",{children:s.description}),(0,i.jsx)("td",{children:s.slaves_count||0}),(0,i.jsxs)("td",{children:[(0,i.jsx)("button",{onClick:()=>(e=>{j(e)})(s),style:{background:"none",border:"none",cursor:"pointer"},title:"View Details",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,i.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}),(0,i.jsx)("button",{onClick:()=>(async e=>{b(e),await J(e.config_id)})(s),style:{background:"none",border:"none",cursor:"pointer",color:"#007bff"},title:"Configure Slaves",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,i.jsx)("line",{x1:"9",y1:"9",x2:"15",y2:"15"}),(0,i.jsx)("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),(0,i.jsx)("line",{x1:"21",y1:"3",x2:"3",y2:"21"})]})}),(0,i.jsx)("button",{onClick:()=>(e=>{g(e),k({config_id:e.gateway_configuration.general_settings.config_id,name:e.name,description:e.description,baud_rate:e.gateway_configuration.uart_configuration.baud_rate,data_bits:e.gateway_configuration.uart_configuration.data_bits,stop_bits:e.gateway_configuration.uart_configuration.stop_bits,parity:"None"===e.gateway_configuration.uart_configuration.parity?0:"Odd"===e.gateway_configuration.uart_configuration.parity?1:2})})(s),style:{background:"none",border:"none",cursor:"pointer"},title:"Edit",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,i.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,i.jsx)("button",{onClick:()=>(async s=>{if(window.confirm("Are you sure you want to delete preset ".concat(s.name,"?")))try{await n.K.deletePreset(s.id);const a=e.filter(e=>e.id!==s.id);t(a);const r=p.toLowerCase(),i=a.filter(e=>e.name.toLowerCase().includes(r)||e.config_id.toLowerCase().includes(r)||e.description.toLowerCase().includes(r));l(i)}catch(a){h(a instanceof Error?a.message:"Failed to delete preset")}})(s),style:{background:"none",border:"none",cursor:"pointer",color:"red"},title:"Delete",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,i.jsx)("path",{d:"M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"}),(0,i.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,i.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]},s.id))})]})]}),(u||m)&&(0,i.jsx)("div",{className:"modal",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsx)("h3",{children:u?"Edit Preset: ".concat(u.name):"Create New Preset"}),(0,i.jsx)("div",{className:"modal-body",children:(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u?B():M()},children:[u&&(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Config ID:"}),(0,i.jsx)("input",{type:"text",value:T.config_id,onChange:e=>k((0,a.A)((0,a.A)({},T),{},{config_id:e.target.value})),required:!0,autoComplete:"off"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Name:"}),(0,i.jsx)("input",{type:"text",value:u?T.name:I.name,onChange:e=>u?k((0,a.A)((0,a.A)({},T),{},{name:e.target.value})):L((0,a.A)((0,a.A)({},I),{},{name:e.target.value})),required:!0,autoComplete:"off"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Description:"}),(0,i.jsx)("textarea",{value:u?T.description:I.description,onChange:e=>u?k((0,a.A)((0,a.A)({},T),{},{description:e.target.value})):L((0,a.A)((0,a.A)({},I),{},{description:e.target.value})),autoComplete:"off"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Baud Rate:"}),(0,i.jsxs)("select",{value:u?T.baud_rate:I.baud_rate,onChange:e=>u?k((0,a.A)((0,a.A)({},T),{},{baud_rate:parseInt(e.target.value)})):L((0,a.A)((0,a.A)({},I),{},{baud_rate:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:9600,children:"9600"}),(0,i.jsx)("option",{value:19200,children:"19200"}),(0,i.jsx)("option",{value:38400,children:"38400"}),(0,i.jsx)("option",{value:57600,children:"57600"}),(0,i.jsx)("option",{value:115200,children:"115200"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Data Bits:"}),(0,i.jsxs)("select",{value:u?T.data_bits:I.data_bits,onChange:e=>u?k((0,a.A)((0,a.A)({},T),{},{data_bits:parseInt(e.target.value)})):L((0,a.A)((0,a.A)({},I),{},{data_bits:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:7,children:"7"}),(0,i.jsx)("option",{value:8,children:"8"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Stop Bits:"}),(0,i.jsxs)("select",{value:u?T.stop_bits:I.stop_bits,onChange:e=>u?k((0,a.A)((0,a.A)({},T),{},{stop_bits:parseInt(e.target.value)})):L((0,a.A)((0,a.A)({},I),{},{stop_bits:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:1,children:"1"}),(0,i.jsx)("option",{value:2,children:"2"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Parity:"}),(0,i.jsxs)("select",{value:u?T.parity:I.parity,onChange:e=>u?k((0,a.A)((0,a.A)({},T),{},{parity:parseInt(e.target.value)})):L((0,a.A)((0,a.A)({},I),{},{parity:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:0,children:"None"}),(0,i.jsx)("option",{value:1,children:"Odd"}),(0,i.jsx)("option",{value:2,children:"Even"})]})]})]})}),(0,i.jsxs)("div",{className:"form-actions",children:[(0,i.jsx)("button",{type:"submit",className:"btn",onClick:e=>{e.preventDefault(),u?B():M()},children:u?"Save":"Create"}),(0,i.jsx)("button",{type:"button",onClick:()=>{g(null),x(!1)},className:"btn btn-secondary",children:"Cancel"})]})]})}),f&&(0,i.jsx)("div",{className:"modal",children:(0,i.jsxs)("div",{className:"modal-content",style:{maxWidth:"600px"},children:[(0,i.jsxs)("h3",{children:["Gateway Configuration: ",f.name]}),(0,i.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,i.jsx)("h4",{children:"General Settings"}),(0,i.jsxs)("div",{style:{marginLeft:"20px"},children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Config ID:"})," ",f.gateway_configuration.general_settings.config_id]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Schema Version:"})," ",f.gateway_configuration.general_settings.schema_version]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Last Updated:"})," ",f.gateway_configuration.general_settings.last_updated]})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,i.jsx)("h4",{children:"UART Configuration"}),(0,i.jsxs)("div",{style:{marginLeft:"20px"},children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Baud Rate:"})," ",f.gateway_configuration.uart_configuration.baud_rate]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Data Bits:"})," ",f.gateway_configuration.uart_configuration.data_bits]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Stop Bits:"})," ",f.gateway_configuration.uart_configuration.stop_bits]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Parity:"})," ",f.gateway_configuration.uart_configuration.parity]})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Description:"})," ",f.description]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Slave Devices:"})," ",f.slaves_count]})]}),(0,i.jsx)("div",{className:"form-actions",children:(0,i.jsx)("button",{onClick:()=>{j(null)},className:"btn btn-secondary",children:"Close"})})]})}),y&&(0,i.jsx)("div",{className:"modal",children:(0,i.jsxs)("div",{className:"modal-content",style:{maxWidth:"1200px",maxHeight:"90vh",overflow:"auto"},children:[(0,i.jsxs)("h3",{children:["Configure Slaves: ",y.name]}),d&&(0,i.jsxs)("div",{className:"error",style:{marginBottom:"20px",padding:"10px",backgroundColor:"#f8d7da",border:"1px solid #f5c6cb",borderRadius:"4px",color:"#721c24"},children:[(0,i.jsx)("strong",{children:"Error:"})," ",d,(0,i.jsx)("button",{onClick:()=>h(null),style:{float:"right",background:"none",border:"none",color:"#721c24",cursor:"pointer",fontSize:"16px"},title:"Close error",children:"\xd7"})]}),(0,i.jsxs)("div",{className:"card",style:{marginBottom:"20px"},children:[(0,i.jsxs)("div",{className:"card-header",children:[(0,i.jsxs)("h4",{children:["Slave Devices (",_.length,")"]}),(0,i.jsx)("button",{onClick:()=>{E({slave_id:"",device_name:"",polling_interval_ms:5e3,timeout_ms:1e3,enabled:!0,registers:[]}),w(!0)},className:"btn",children:"Add Slave"})]}),0===_.length?(0,i.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#666"},children:[(0,i.jsx)("p",{children:"No slave devices configured yet."}),(0,i.jsx)("p",{children:'Click "Add Slave" to configure your first slave device.'})]}):(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{textAlign:"center"},children:"Slave ID"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Device Name"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Polling Interval"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Timeout"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Status"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Registers"}),(0,i.jsx)("th",{style:{textAlign:"center"},children:"Actions"})]})}),(0,i.jsx)("tbody",{children:_.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{textAlign:"center"},children:e.slaveId}),(0,i.jsx)("td",{children:e.deviceName}),(0,i.jsxs)("td",{style:{textAlign:"center"},children:[e.pollingIntervalMs,"ms"]}),(0,i.jsxs)("td",{style:{textAlign:"center"},children:[e.timeoutMs,"ms"]}),(0,i.jsx)("td",{style:{textAlign:"center"},children:(0,i.jsx)("span",{className:e.enabled?"status-online":"status-offline",children:e.enabled?"Enabled":"Disabled"})}),(0,i.jsx)("td",{style:{textAlign:"center"},children:e.registers.length}),(0,i.jsxs)("td",{style:{textAlign:"center"},children:[(0,i.jsx)("button",{onClick:()=>(e=>{E({slave_id:e.slaveId.toString(),device_name:e.deviceName,polling_interval_ms:e.pollingIntervalMs,timeout_ms:e.timeoutMs,enabled:e.enabled,registers:[...e.registers]}),S(e)})(e),style:{background:"none",border:"none",cursor:"pointer",marginRight:"10px"},title:"Edit",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,i.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,i.jsx)("button",{onClick:()=>(async e=>{if(y&&window.confirm("Are you sure you want to delete slave ".concat(e.deviceName,"?")))try{await n.K.deleteSlave(y.config_id,e.slaveId);const t=_.filter(t=>t.id!==e.id);N(t),R(y.config_id,t.length)}catch(t){h(t instanceof Error?t.message:"Failed to delete slave")}})(e),style:{background:"none",border:"none",cursor:"pointer",color:"red"},title:"Delete",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,i.jsx)("path",{d:"M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"}),(0,i.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,i.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]},e.id))})]})]}),(0,i.jsx)("div",{className:"form-actions",children:(0,i.jsx)("button",{onClick:()=>{b(null),N([]),w(!1),S(null),E({slave_id:"",device_name:"",polling_interval_ms:5e3,timeout_ms:1e3,enabled:!0,registers:[]})},className:"btn btn-secondary",children:"Close"})})]})}),(A||C)&&y&&(0,i.jsx)("div",{className:"modal",children:(0,i.jsxs)("div",{className:"modal-content large-modal",children:[(0,i.jsx)("h3",{children:C?"Edit Slave: ".concat(C.deviceName):"Configure New Slave"}),(0,i.jsx)("div",{className:"modal-body",children:(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),K()},children:[(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Basic Information"}),(0,i.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Slave ID"}),(0,i.jsx)("input",{type:"number",value:D.slave_id,onChange:e=>E((0,a.A)((0,a.A)({},D),{},{slave_id:e.target.value})),required:!0,min:"1",max:"247",placeholder:"1-247"}),(0,i.jsxs)("small",{className:"form-hint",children:["Unique identifier (1-247)",_.length>0&&(0,i.jsxs)("span",{className:"form-hint-accent",children:["Existing: ",_.map(e=>e.slaveId).join(", ")]})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Device Name"}),(0,i.jsx)("input",{type:"text",value:D.device_name,onChange:e=>E((0,a.A)((0,a.A)({},D),{},{device_name:e.target.value})),required:!0,placeholder:"e.g., Solar Inverter"})]})]})]}),(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Communication Settings"}),(0,i.jsxs)("div",{className:"form-grid form-grid-3",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Polling Interval (ms)"}),(0,i.jsx)("input",{type:"number",value:D.polling_interval_ms,onChange:e=>E((0,a.A)((0,a.A)({},D),{},{polling_interval_ms:parseInt(e.target.value)})),min:"100",placeholder:"5000"}),(0,i.jsx)("small",{className:"form-hint",children:"How often to poll"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Timeout (ms)"}),(0,i.jsx)("input",{type:"number",value:D.timeout_ms,onChange:e=>E((0,a.A)((0,a.A)({},D),{},{timeout_ms:parseInt(e.target.value)})),min:"100",placeholder:"1000"}),(0,i.jsx)("small",{className:"form-hint",children:"Response timeout"})]}),(0,i.jsxs)("div",{className:"form-group checkbox-group",children:[(0,i.jsx)("label",{children:"Status"}),(0,i.jsxs)("label",{className:"checkbox-label checkbox-vertical",children:[(0,i.jsx)("input",{type:"checkbox",checked:D.enabled,onChange:e=>E((0,a.A)((0,a.A)({},D),{},{enabled:e.target.checked}))}),(0,i.jsx)("span",{className:D.enabled?"status-text-enabled":"status-text-disabled",children:D.enabled?"Enabled":"Disabled"})]})]})]})]}),(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsx)("h4",{className:"form-section-title",children:"Register Mappings"}),(0,i.jsx)("p",{className:"form-section-desc",children:"Configure the Modbus registers to read from this slave device."}),(0,i.jsxs)("div",{className:"form-subsection",children:[(0,i.jsx)("h5",{className:"form-subsection-title",children:"Add New Register"}),(0,i.jsxs)("div",{className:"form-grid form-grid-auto",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Label"}),(0,i.jsx)("input",{type:"text",placeholder:"e.g., voltage",value:P.label,onChange:e=>q((0,a.A)((0,a.A)({},P),{},{label:e.target.value}))})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Address"}),(0,i.jsx)("input",{type:"number",placeholder:"0",value:P.address,onChange:e=>q((0,a.A)((0,a.A)({},P),{},{address:parseInt(e.target.value)})),min:"0"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Data Type"}),(0,i.jsxs)("select",{value:P.data_type,onChange:e=>q((0,a.A)((0,a.A)({},P),{},{data_type:parseInt(e.target.value)})),children:[(0,i.jsx)("option",{value:0,children:"UINT16"}),(0,i.jsx)("option",{value:1,children:"INT16"}),(0,i.jsx)("option",{value:2,children:"UINT32"}),(0,i.jsx)("option",{value:3,children:"INT32"}),(0,i.jsx)("option",{value:4,children:"FLOAT32"}),(0,i.jsx)("option",{value:5,children:"FLOAT64"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Scale"}),(0,i.jsx)("input",{type:"number",placeholder:"1.0",value:P.scale_factor,onChange:e=>q((0,a.A)((0,a.A)({},P),{},{scale_factor:parseFloat(e.target.value)})),step:"0.01"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Offset"}),(0,i.jsx)("input",{type:"number",placeholder:"0.0",value:P.offset,onChange:e=>q((0,a.A)((0,a.A)({},P),{},{offset:parseFloat(e.target.value)})),step:"0.01"})]}),(0,i.jsxs)("div",{className:"form-group checkbox-group",children:[(0,i.jsx)("label",{children:"Active"}),(0,i.jsxs)("label",{className:"checkbox-label checkbox-vertical",children:[(0,i.jsx)("input",{type:"checkbox",checked:P.enabled,onChange:e=>q((0,a.A)((0,a.A)({},P),{},{enabled:e.target.checked}))}),(0,i.jsx)("span",{children:P.enabled?"Yes":"No"})]})]}),(0,i.jsx)("div",{className:"form-group form-group-btn",children:(0,i.jsx)("button",{type:"button",onClick:()=>{const e={id:Date.now(),label:P.label,address:P.address,numRegisters:P.num_registers,functionCode:P.function_code,dataType:P.data_type,scaleFactor:P.scale_factor,offset:P.offset,enabled:P.enabled};E((0,a.A)((0,a.A)({},D),{},{registers:[...D.registers,e]})),q({label:"",address:0,num_registers:1,function_code:3,data_type:0,scale_factor:1,offset:0,enabled:!0})},className:"btn btn-sm",children:"Add Register"})})]})]}),D.registers.length>0?(0,i.jsxs)("div",{className:"registers-table-wrapper",children:[(0,i.jsxs)("h5",{className:"form-subsection-title",children:["Configured Registers (",D.registers.length,")"]}),(0,i.jsxs)("table",{className:"table registers-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Label"}),(0,i.jsx)("th",{children:"Address"}),(0,i.jsx)("th",{children:"Data Type"}),(0,i.jsx)("th",{children:"Scale"}),(0,i.jsx)("th",{children:"Offset"}),(0,i.jsx)("th",{children:"Status"}),(0,i.jsx)("th",{children:"Actions"})]})}),(0,i.jsx)("tbody",{children:D.registers.map((e,t)=>{return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.label}),(0,i.jsx)("td",{children:e.address}),(0,i.jsx)("td",{children:(s=e.dataType,["UINT16","INT16","UINT32","INT32","FLOAT32","FLOAT64"][s]||"UNKNOWN")}),(0,i.jsx)("td",{children:e.scaleFactor}),(0,i.jsx)("td",{children:e.offset}),(0,i.jsx)("td",{children:(0,i.jsx)("span",{className:"status-badge ".concat(e.enabled?"status-badge-success":"status-badge-danger"),children:e.enabled?"Enabled":"Disabled"})}),(0,i.jsx)("td",{children:(0,i.jsx)("button",{type:"button",onClick:()=>(e=>{E((0,a.A)((0,a.A)({},D),{},{registers:D.registers.filter((t,s)=>s!==e)}))})(t),className:"btn-icon btn-icon-danger",title:"Remove",children:"\u2715"})})]},t);var s})})]})]}):(0,i.jsx)("div",{className:"empty-state",children:"No registers configured yet. Add registers above to define what data to read from this slave device."})]})]})}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-primary",onClick:e=>{e.preventDefault(),K()},children:C?"Save Changes":"Create Slave"}),(0,i.jsx)("button",{type:"button",onClick:()=>{w(!1),S(null)},className:"btn btn-secondary",children:"Cancel"})]})]})})]})}},5560(e,t,s){s.d(t,{K:()=>o});var a=s(2555);class r{constructor(){this.cache=new Map}set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.DEFAULT_TTL;this.cache.set(e,{data:t,timestamp:Date.now(),expiresIn:s})}get(e){const t=this.cache.get(e);if(!t)return null;return Date.now()-t.timestamp>t.expiresIn?(this.cache.delete(e),null):t.data}has(e){const t=this.cache.get(e);if(!t)return!1;return!(Date.now()-t.timestamp>t.expiresIn)||(this.cache.delete(e),!1)}clear(e){this.cache.delete(e)}clearAll(){this.cache.clear()}size(){return this.cache.size}static getTTL(){return"long"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short")?r.LONG_TTL:r.DEFAULT_TTL}}r.DEFAULT_TTL=3e5,r.LONG_TTL=18e5;const n=new r,i=3e5,l="https://smart-solar-django-backend.vercel.app/api";const o=new class{getAuthHeaders(){const e=localStorage.getItem("authTokens");if(e)try{const t=JSON.parse(e);return{Authorization:"Bearer ".concat(t.access),"Content-Type":"application/json"}}catch(t){console.error("Error parsing auth tokens:",t)}return{"Content-Type":"application/json"}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s="".concat(l).concat(e);let r=this.getAuthHeaders(),n=await fetch(s,(0,a.A)((0,a.A)({},t),{},{headers:(0,a.A)((0,a.A)({},r),t.headers)}));if(401===n.status){await this.refreshToken()&&(r=this.getAuthHeaders(),n=await fetch(s,(0,a.A)((0,a.A)({},t),{},{headers:(0,a.A)((0,a.A)({},r),t.headers)})))}if(401===n.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!n.ok){const e=await n.text();throw new Error("API request failed: ".concat(n.status," ").concat(n.statusText," - ").concat(e))}return n.json()}async refreshToken(){const e=localStorage.getItem("authTokens");if(!e)return!1;try{const t=JSON.parse(e),s=await fetch("".concat(l,"/auth/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t.refresh})});if(s.ok){const e={access:(await s.json()).access,refresh:t.refresh};return localStorage.setItem("authTokens",JSON.stringify(e)),!0}}catch(t){console.error("Token refresh failed:",t)}return!1}async getConfiguration(){return this.request("/config/")}async getTelemetry(){return this.request("/telemetry/")}async provisionDevice(e){const t=await fetch("".concat(l,"/devices/provision"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Provisioning failed: ".concat(t.statusText));return t.json()}async getAlerts(){const e="alerts",t=n.get(e);if(t)return t;const s=await this.request("/alerts/");return n.set(e,s,i),s}async getSystemHealth(){const e="system_health",t=n.get(e);if(t)return t;const s=await this.request("/health/");return n.set(e,s,i),s}async getKPIs(){const e="kpis",t=n.get(e);if(t)return t;const s=await this.request("/kpis/");return n.set(e,s,i),s}async getUsers(e){const t="users_".concat(e||"all"),s=n.get(t);if(s)return s;const a=e?"?search=".concat(encodeURIComponent(e)):"",r=await this.request("/users/".concat(a));return n.set(t,r,i),r}async createUser(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("users_all"),n.clearAll(),t}async createEmployee(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify((0,a.A)((0,a.A)({},e),{},{is_staff:!0}))});return n.clear("users_all"),t}async getUserDevices(e){return this.request("/users/".concat(e,"/devices/"))}async updateUser(e,t){const s=await this.request("/users/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("users_all"),s}async deleteUser(e){const t=await this.request("/users/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("users_all"),t}async getProfile(){return this.request("/profile/")}async updateProfile(e){return this.request("/profile/update/",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e){return this.request("/profile/change-password/",{method:"POST",body:JSON.stringify(e)})}async getCustomers(e){const t=e?"?search=".concat(encodeURIComponent(e)):"";return this.request("/customers/".concat(t))}async createCustomer(e){return this.request("/customers/create/",{method:"POST",body:JSON.stringify(e)})}async getCustomer(e){return this.request("/customers/".concat(e,"/"))}async updateCustomer(e,t){return this.request("/customers/".concat(e,"/update/"),{method:"PUT",body:JSON.stringify(t)})}async deleteCustomer(e){return this.request("/customers/".concat(e,"/delete/"),{method:"DELETE"})}async getPresets(){const e="presets",t=n.get(e);if(t)return t;const s=await this.request("/presets/");return n.set(e,s,18e5),s}async createPreset(e){const t=await this.request("/presets/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("presets"),t}async updatePreset(e,t){const s=await this.request("/presets/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("presets"),s}async deletePreset(e){const t=await this.request("/presets/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("presets"),t}async getDevices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;const a=new URLSearchParams;e&&a.append("search",e),a.append("page",t.toString()),a.append("page_size",s.toString());const r=a.toString();return this.request("/devices/?".concat(r))}async createDevice(e){return this.request("/devices/create/",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,t){return this.request("/devices/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteDevice(e){return this.request("/devices/".concat(e,"/delete/"),{method:"DELETE"})}async deleteDevicesBulk(e){return this.request("/devices/delete-bulk/",{method:"POST",body:JSON.stringify({device_ids:e})})}async getSlaves(e){return this.request("/presets/".concat(e,"/slaves/"))}async createSlave(e,t){return this.request("/presets/".concat(e,"/slaves/create/"),{method:"POST",body:JSON.stringify(t)})}async updateSlave(e,t,s){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/"),{method:"PUT",body:JSON.stringify(s)})}async deleteSlave(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/delete/"),{method:"DELETE"})}}}}]);
//# sourceMappingURL=35.4c7ec8b6.chunk.js.map