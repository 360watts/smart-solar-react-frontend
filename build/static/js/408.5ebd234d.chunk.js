"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[408],{408(e,t,s){s.r(t),s.d(t,{default:()=>m});var r=s(5043),a=s(1327),n=s(6150),c=s(108),i=s(7734),o=s(168),l=s(2185),d=s(6026),h=s(1653),u=s(5560),y=s(579);const m=()=>{const[e,t]=(0,r.useState)([]),[s,m]=(0,r.useState)([]),[g,p]=(0,r.useState)(!0),[f,v]=(0,r.useState)(null),[x,S]=(0,r.useState)("all"),[j,T]=(0,r.useState)("all");(0,r.useEffect)(()=>{w()},[]);const w=async()=>{try{const e=await u.K.getTelemetry();t(e),p(!1)}catch(e){v(e instanceof Error?e.message:"An error occurred"),p(!1)}};(0,r.useEffect)(()=>{let t=e;"all"!==x&&(t=t.filter(e=>e.data_type===x)),"all"!==j&&(t=t.filter(e=>e.deviceId===j)),m(t)},[e,x,j]);if(g)return(0,y.jsx)("div",{className:"loading",children:"Loading telemetry data..."});if(f)return(0,y.jsxs)("div",{className:"error",children:["Error: ",f]});const q=(()=>{const e={};return s.forEach(t=>{const s=new Date(t.timestamp).toLocaleTimeString();e[s]||(e[s]={time:s}),e[s][t.data_type]=t.value}),Object.values(e).slice(-50)})(),b=(()=>{const e={};return s.forEach(t=>{const s="".concat(t.deviceId,"-").concat(t.data_type);(!e[s]||new Date(t.timestamp)>new Date(e[s].timestamp))&&(e[s]=t)}),Object.values(e)})(),O=(()=>{if(0===s.length)return null;const e=s.map(e=>e.value);return{avg:e.reduce((e,t)=>e+t,0)/e.length,min:Math.min(...e),max:Math.max(...e),count:e.length}})(),N=Array.from(new Set(e.map(e=>e.data_type))),A=Array.from(new Set(e.map(e=>e.deviceId)));return(0,y.jsxs)("div",{children:[(0,y.jsx)("h1",{children:"Telemetry Data"}),(0,y.jsxs)("div",{className:"card",children:[(0,y.jsx)("h2",{children:"Filters"}),(0,y.jsxs)("div",{className:"grid",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"var(--space-6)",alignItems:"start"},children:[(0,y.jsxs)("div",{className:"form-group",children:[(0,y.jsx)("label",{children:"Data Type:"}),(0,y.jsxs)("select",{value:x,onChange:e=>S(e.target.value),children:[(0,y.jsx)("option",{value:"all",children:"All Types"}),N.map(e=>(0,y.jsx)("option",{value:e,children:e},e))]})]}),(0,y.jsxs)("div",{className:"form-group",children:[(0,y.jsx)("label",{children:"Device:"}),(0,y.jsxs)("select",{value:j,onChange:e=>T(e.target.value),children:[(0,y.jsx)("option",{value:"all",children:"All Devices"}),A.map(e=>(0,y.jsx)("option",{value:e,children:e},e))]})]})]})]}),O&&(0,y.jsxs)("div",{className:"grid",children:[(0,y.jsxs)("div",{className:"card",children:[(0,y.jsx)("h3",{children:"Statistics"}),(0,y.jsxs)("p",{children:[(0,y.jsx)("strong",{children:"Count:"})," ",O.count]}),(0,y.jsxs)("p",{children:[(0,y.jsx)("strong",{children:"Average:"})," ",O.avg.toFixed(2)]}),(0,y.jsxs)("p",{children:[(0,y.jsx)("strong",{children:"Min:"})," ",O.min.toFixed(2)]}),(0,y.jsxs)("p",{children:[(0,y.jsx)("strong",{children:"Max:"})," ",O.max.toFixed(2)]})]}),(0,y.jsxs)("div",{className:"card",children:[(0,y.jsx)("h3",{children:"Latest Values"}),b.slice(0,5).map((e,t)=>(0,y.jsxs)("p",{children:[(0,y.jsxs)("strong",{children:[e.data_type,":"]})," ",e.value," ",e.unit,(0,y.jsxs)("small",{children:[" (",new Date(e.timestamp).toLocaleTimeString(),")"]})]},t))]})]}),(0,y.jsxs)("div",{className:"card",children:[(0,y.jsx)("h2",{children:"Telemetry Trends"}),(0,y.jsx)("div",{className:"chart-container",children:(0,y.jsx)(c.u,{width:"100%",height:"100%",children:(0,y.jsxs)(h.b,{data:q,children:[(0,y.jsx)(i.d,{strokeDasharray:"3 3",stroke:"rgba(148, 163, 184, 0.1)"}),(0,y.jsx)(l.W,{dataKey:"time",stroke:"#64748b",fontSize:12}),(0,y.jsx)(d.h,{stroke:"#64748b",fontSize:12}),(0,y.jsx)(n.m,{contentStyle:{backgroundColor:"#0f172a",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"8px",color:"#f8fafc"}}),(0,y.jsx)(a.s,{}),N.map((e,t)=>(0,y.jsx)(o.N,{type:"monotone",dataKey:e,stroke:"hsl(".concat(60*t+240,", 70%, 60%)"),strokeWidth:2},e))]})})})]}),(0,y.jsxs)("div",{className:"card",children:[(0,y.jsxs)("h2",{children:["Raw Data (",s.length," records)"]}),(0,y.jsxs)("table",{className:"table",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{children:"Device"}),(0,y.jsx)("th",{children:"Data Type"}),(0,y.jsx)("th",{children:"Value"}),(0,y.jsx)("th",{children:"Unit"}),(0,y.jsx)("th",{children:"Timestamp"}),(0,y.jsx)("th",{children:"Quality"})]})}),(0,y.jsx)("tbody",{children:s.slice(-100).reverse().map((e,t)=>(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{children:e.deviceId}),(0,y.jsx)("td",{children:e.data_type}),(0,y.jsx)("td",{children:e.value}),(0,y.jsx)("td",{children:e.unit}),(0,y.jsx)("td",{children:new Date(e.timestamp).toLocaleString()}),(0,y.jsx)("td",{children:(0,y.jsx)("span",{className:"good"===e.quality?"status-online":"status-offline",children:e.quality})})]},t))})]})]})]})}},5560(e,t,s){s.d(t,{K:()=>o});var r=s(2555);class a{constructor(){this.cache=new Map}set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.DEFAULT_TTL;this.cache.set(e,{data:t,timestamp:Date.now(),expiresIn:s})}get(e){const t=this.cache.get(e);if(!t)return null;return Date.now()-t.timestamp>t.expiresIn?(this.cache.delete(e),null):t.data}has(e){const t=this.cache.get(e);if(!t)return!1;return!(Date.now()-t.timestamp>t.expiresIn)||(this.cache.delete(e),!1)}clear(e){this.cache.delete(e)}clearAll(){this.cache.clear()}size(){return this.cache.size}static getTTL(){return"long"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short")?a.LONG_TTL:a.DEFAULT_TTL}}a.DEFAULT_TTL=3e5,a.LONG_TTL=18e5;const n=new a,c=3e5,i="https://smart-solar-django-backend.vercel.app/api";const o=new class{getAuthHeaders(){const e=localStorage.getItem("authTokens");if(e)try{const t=JSON.parse(e);return{Authorization:"Bearer ".concat(t.access),"Content-Type":"application/json"}}catch(t){console.error("Error parsing auth tokens:",t)}return{"Content-Type":"application/json"}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s="".concat(i).concat(e);let a=this.getAuthHeaders(),n=await fetch(s,(0,r.A)((0,r.A)({},t),{},{headers:(0,r.A)((0,r.A)({},a),t.headers)}));if(401===n.status){await this.refreshToken()&&(a=this.getAuthHeaders(),n=await fetch(s,(0,r.A)((0,r.A)({},t),{},{headers:(0,r.A)((0,r.A)({},a),t.headers)})))}if(401===n.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!n.ok){const e=await n.text();throw new Error("API request failed: ".concat(n.status," ").concat(n.statusText," - ").concat(e))}return n.json()}async refreshToken(){const e=localStorage.getItem("authTokens");if(!e)return!1;try{const t=JSON.parse(e),s=await fetch("".concat(i,"/auth/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t.refresh})});if(s.ok){const e={access:(await s.json()).access,refresh:t.refresh};return localStorage.setItem("authTokens",JSON.stringify(e)),!0}}catch(t){console.error("Token refresh failed:",t)}return!1}async getConfiguration(){return this.request("/config/")}async getTelemetry(){return this.request("/telemetry/")}async provisionDevice(e){const t=await fetch("".concat(i,"/devices/provision"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Provisioning failed: ".concat(t.statusText));return t.json()}async getAlerts(){const e="alerts",t=n.get(e);if(t)return t;const s=await this.request("/alerts/");return n.set(e,s,c),s}async getSystemHealth(){const e="system_health",t=n.get(e);if(t)return t;const s=await this.request("/health/");return n.set(e,s,c),s}async getKPIs(){const e="kpis",t=n.get(e);if(t)return t;const s=await this.request("/kpis/");return n.set(e,s,c),s}async getUsers(e){const t="users_".concat(e||"all"),s=n.get(t);if(s)return s;const r=e?"?search=".concat(encodeURIComponent(e)):"",a=await this.request("/users/".concat(r));return n.set(t,a,c),a}async createUser(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("users_all"),n.clearAll(),t}async createEmployee(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify((0,r.A)((0,r.A)({},e),{},{is_staff:!0}))});return n.clear("users_all"),t}async getUserDevices(e){return this.request("/users/".concat(e,"/devices/"))}async updateUser(e,t){const s=await this.request("/users/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("users_all"),s}async deleteUser(e){const t=await this.request("/users/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("users_all"),t}async getProfile(){return this.request("/profile/")}async updateProfile(e){return this.request("/profile/update/",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e){return this.request("/profile/change-password/",{method:"POST",body:JSON.stringify(e)})}async getCustomers(e){const t=e?"?search=".concat(encodeURIComponent(e)):"";return this.request("/customers/".concat(t))}async createCustomer(e){return this.request("/customers/create/",{method:"POST",body:JSON.stringify(e)})}async getCustomer(e){return this.request("/customers/".concat(e,"/"))}async updateCustomer(e,t){return this.request("/customers/".concat(e,"/update/"),{method:"PUT",body:JSON.stringify(t)})}async deleteCustomer(e){return this.request("/customers/".concat(e,"/delete/"),{method:"DELETE"})}async getPresets(){const e="presets",t=n.get(e);if(t)return t;const s=await this.request("/presets/");return n.set(e,s,18e5),s}async createPreset(e){const t=await this.request("/presets/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("presets"),t}async updatePreset(e,t){const s=await this.request("/presets/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("presets"),s}async deletePreset(e){const t=await this.request("/presets/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("presets"),t}async getGlobalSlaves(){return this.request("/slaves/")}async createGlobalSlave(e){return this.request("/slaves/create/",{method:"POST",body:JSON.stringify(e)})}async updateGlobalSlave(e,t){return this.request("/slaves/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteGlobalSlave(e){return this.request("/slaves/".concat(e,"/delete/"),{method:"DELETE"})}async getDevices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;const r=new URLSearchParams;e&&r.append("search",e),r.append("page",t.toString()),r.append("page_size",s.toString());const a=r.toString();return this.request("/devices/?".concat(a))}async createDevice(e){return this.request("/devices/create/",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,t){return this.request("/devices/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteDevice(e){return this.request("/devices/".concat(e,"/delete/"),{method:"DELETE"})}async deleteDevicesBulk(e){return this.request("/devices/delete-bulk/",{method:"POST",body:JSON.stringify({device_ids:e})})}async getSlaves(e){return this.request("/presets/".concat(e,"/slaves/"))}async createSlave(e,t){return this.request("/presets/".concat(e,"/slaves/create/"),{method:"POST",body:JSON.stringify(t)})}async updateSlave(e,t,s){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/"),{method:"PUT",body:JSON.stringify(s)})}async deleteSlave(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/delete/"),{method:"DELETE"})}async addSlavesToPreset(e,t){return this.request("/presets/".concat(e,"/slaves/add/"),{method:"POST",body:JSON.stringify({slave_ids:t})})}async getFirmwareVersions(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=new URLSearchParams;return t.append("active",e.toString()),this.request("/ota/firmware/?".concat(t.toString()))}async uploadFirmwareVersion(e){const t=this.getAuthHeaders();return delete t["Content-Type"],fetch("".concat(i,"/ota/firmware/create/"),{method:"POST",headers:(0,r.A)((0,r.A)({},t),{},{Authorization:"Bearer ".concat(JSON.parse(localStorage.getItem("authTokens")||"{}").access)}),body:e}).then(e=>e.json())}async updateFirmwareVersion(e,t){return this.request("/ota/firmware/".concat(e,"/"),{method:"PATCH",body:JSON.stringify(t)})}async getDeviceUpdateLogs(e){return this.request("/ota/devices/".concat(e,"/logs"))}async getOTAConfig(){return this.request("/ota/config/")}async updateOTAConfig(e){return this.request("/ota/config/update/",{method:"PATCH",body:JSON.stringify(e)})}async getOTAHealth(){return this.request("/ota/health/")}}}}]);
//# sourceMappingURL=408.5ebd234d.chunk.js.map