"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[524],{9524(e,t,s){s.r(t),s.d(t,{default:()=>n});var r=s(5043),a=s(5560),c=s(579);const n=()=>{const[e,t]=(0,r.useState)(null),[s,n]=(0,r.useState)(!0),[i,o]=(0,r.useState)(null);(0,r.useEffect)(()=>{l();const e=setInterval(l,6e4);return()=>clearInterval(e)},[]);const l=async()=>{try{const e=await a.K.getSystemHealth();t(e),n(!1)}catch(e){o(e instanceof Error?e.message:"An error occurred"),n(!1)}},d=e=>{switch(e.toLowerCase()){case"healthy":return"status-online";case"warning":return"status-warning";case"critical":return"status-critical";default:return"status-offline"}},h=e=>{switch(e.toLowerCase()){case"healthy":return"\u2705";case"warning":return"\u26a0\ufe0f";case"critical":return"\ud83d\udea8";default:return"\u2753"}};if(s)return(0,c.jsx)("div",{className:"loading",children:"Loading system health..."});if(i)return(0,c.jsxs)("div",{className:"error",children:["Error: ",i]});if(!e)return(0,c.jsx)("div",{className:"error",children:"No health data available"});const u=e.active_devices/e.total_devices*100;return(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{children:"System Health Dashboard"}),(0,c.jsxs)("div",{className:"grid grid-cols-2",children:[(0,c.jsxs)("div",{className:"card",children:[(0,c.jsx)("h3",{children:"Overall System Status"}),(0,c.jsxs)("div",{className:"status-indicator ".concat(d(e.overall_health)),children:[h(e.overall_health)," ",e.overall_health.toUpperCase()]})]}),(0,c.jsxs)("div",{className:"card",children:[(0,c.jsx)("h3",{children:"System Uptime"}),(0,c.jsx)("p",{className:"metric-large",children:(e=>{const t=Math.floor(e/86400),s=Math.floor(e%86400/3600),r=Math.floor(e%3600/60);return"".concat(t,"d ").concat(s,"h ").concat(r,"m")})(e.uptime_seconds)}),(0,c.jsx)("p",{className:"metric-label",children:"Since first telemetry"})]}),(0,c.jsxs)("div",{className:"card",children:[(0,c.jsx)("h3",{children:"Device Connectivity"}),(0,c.jsxs)("p",{className:"metric-large",children:[e.active_devices,"/",e.total_devices]}),(0,c.jsx)("p",{className:"metric-label",children:"Active/Total Devices"}),(0,c.jsx)("div",{className:"progress-bar",children:(0,c.jsx)("div",{className:"progress-fill",style:{width:"".concat(u,"%")}})}),(0,c.jsxs)("p",{className:"metric-small",children:[u.toFixed(1),"% uptime"]})]}),(0,c.jsxs)("div",{className:"card",children:[(0,c.jsx)("h3",{children:"Data Collection"}),(0,c.jsx)("p",{className:"metric-large",children:e.total_telemetry_points.toLocaleString()}),(0,c.jsx)("p",{className:"metric-label",children:"Total Data Points"})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-2",children:[(0,c.jsxs)("div",{className:"card",children:[(0,c.jsx)("h3",{children:"Service Status"}),(0,c.jsxs)("div",{className:"service-status",children:[(0,c.jsxs)("div",{className:"service-item",children:[(0,c.jsx)("span",{className:"service-name",children:"Database"}),(0,c.jsxs)("span",{className:"service-status ".concat(d(e.database_status)),children:[h(e.database_status)," ",e.database_status]})]}),(0,c.jsxs)("div",{className:"service-item",children:[(0,c.jsx)("span",{className:"service-name",children:"MQTT Broker"}),(0,c.jsxs)("span",{className:"service-status ".concat(d(e.mqtt_status)),children:[h(e.mqtt_status)," ",e.mqtt_status]})]})]})]}),(0,c.jsxs)("div",{className:"card",children:[(0,c.jsx)("h3",{children:"Performance Metrics"}),(0,c.jsxs)("div",{className:"metrics-list",children:[(0,c.jsxs)("div",{className:"metric-item",children:[(0,c.jsx)("span",{children:"Data Points/Hour:"}),(0,c.jsx)("span",{children:(e.total_telemetry_points/(e.uptime_seconds/3600)).toFixed(1)})]}),(0,c.jsxs)("div",{className:"metric-item",children:[(0,c.jsx)("span",{children:"Avg Data/Device:"}),(0,c.jsx)("span",{children:e.total_devices>0?(e.total_telemetry_points/e.total_devices).toFixed(0):"0"})]}),(0,c.jsxs)("div",{className:"metric-item",children:[(0,c.jsx)("span",{children:"Active Device Ratio:"}),(0,c.jsxs)("span",{children:[u.toFixed(1),"%"]})]})]})]})]}),(0,c.jsxs)("div",{className:"card",children:[(0,c.jsx)("h3",{children:"System Information"}),(0,c.jsxs)("div",{className:"system-info",children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Last Updated:"})," ",(new Date).toLocaleString()]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Monitoring Since:"})," ",new Date(Date.now()-1e3*e.uptime_seconds).toLocaleString()]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"API Status:"})," ",(0,c.jsx)("span",{className:"status-online",children:"Connected"})]})]})]})]})}},5560(e,t,s){s.d(t,{K:()=>o});var r=s(2555);class a{constructor(){this.cache=new Map}set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.DEFAULT_TTL;this.cache.set(e,{data:t,timestamp:Date.now(),expiresIn:s})}get(e){const t=this.cache.get(e);if(!t)return null;return Date.now()-t.timestamp>t.expiresIn?(this.cache.delete(e),null):t.data}has(e){const t=this.cache.get(e);if(!t)return!1;return!(Date.now()-t.timestamp>t.expiresIn)||(this.cache.delete(e),!1)}clear(e){this.cache.delete(e)}clearAll(){this.cache.clear()}size(){return this.cache.size}static getTTL(){return"long"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short")?a.LONG_TTL:a.DEFAULT_TTL}}a.DEFAULT_TTL=3e5,a.LONG_TTL=18e5;const c=new a,n=3e5,i="https://smart-solar-django-backend.vercel.app/api";const o=new class{getAuthHeaders(){const e=localStorage.getItem("authTokens");if(e)try{const t=JSON.parse(e);return{Authorization:"Bearer ".concat(t.access),"Content-Type":"application/json"}}catch(t){console.error("Error parsing auth tokens:",t)}return{"Content-Type":"application/json"}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s="".concat(i).concat(e);let a=this.getAuthHeaders(),c=await fetch(s,(0,r.A)((0,r.A)({},t),{},{headers:(0,r.A)((0,r.A)({},a),t.headers)}));if(401===c.status){await this.refreshToken()&&(a=this.getAuthHeaders(),c=await fetch(s,(0,r.A)((0,r.A)({},t),{},{headers:(0,r.A)((0,r.A)({},a),t.headers)})))}if(401===c.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!c.ok){const e=await c.text();throw new Error("API request failed: ".concat(c.status," ").concat(c.statusText," - ").concat(e))}return c.json()}async refreshToken(){const e=localStorage.getItem("authTokens");if(!e)return!1;try{const t=JSON.parse(e),s=await fetch("".concat(i,"/auth/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t.refresh})});if(s.ok){const e={access:(await s.json()).access,refresh:t.refresh};return localStorage.setItem("authTokens",JSON.stringify(e)),!0}}catch(t){console.error("Token refresh failed:",t)}return!1}async getConfiguration(){return this.request("/config/")}async getTelemetry(){return this.request("/telemetry/")}async provisionDevice(e){const t=await fetch("".concat(i,"/devices/provision"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Provisioning failed: ".concat(t.statusText));return t.json()}async getAlerts(){const e="alerts",t=c.get(e);if(t)return t;const s=await this.request("/alerts/");return c.set(e,s,n),s}async getSystemHealth(){const e="system_health",t=c.get(e);if(t)return t;const s=await this.request("/health/");return c.set(e,s,n),s}async getKPIs(){const e="kpis",t=c.get(e);if(t)return t;const s=await this.request("/kpis/");return c.set(e,s,n),s}async getUsers(e){const t="users_".concat(e||"all"),s=c.get(t);if(s)return s;const r=e?"?search=".concat(encodeURIComponent(e)):"",a=await this.request("/users/".concat(r));return c.set(t,a,n),a}async createUser(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify(e)});return c.clear("users_all"),c.clearAll(),t}async createEmployee(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify((0,r.A)((0,r.A)({},e),{},{is_staff:!0}))});return c.clear("users_all"),t}async getUserDevices(e){return this.request("/users/".concat(e,"/devices/"))}async updateUser(e,t){const s=await this.request("/users/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return c.clear("users_all"),s}async deleteUser(e){const t=await this.request("/users/".concat(e,"/delete/"),{method:"DELETE"});return c.clear("users_all"),t}async getProfile(){return this.request("/profile/")}async updateProfile(e){return this.request("/profile/update/",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e){return this.request("/profile/change-password/",{method:"POST",body:JSON.stringify(e)})}async getCustomers(e){const t=e?"?search=".concat(encodeURIComponent(e)):"";return this.request("/customers/".concat(t))}async createCustomer(e){return this.request("/customers/create/",{method:"POST",body:JSON.stringify(e)})}async getCustomer(e){return this.request("/customers/".concat(e,"/"))}async updateCustomer(e,t){return this.request("/customers/".concat(e,"/update/"),{method:"PUT",body:JSON.stringify(t)})}async deleteCustomer(e){return this.request("/customers/".concat(e,"/delete/"),{method:"DELETE"})}async getPresets(){const e="presets",t=c.get(e);if(t)return t;const s=await this.request("/presets/");return c.set(e,s,18e5),s}async createPreset(e){const t=await this.request("/presets/create/",{method:"POST",body:JSON.stringify(e)});return c.clear("presets"),t}async updatePreset(e,t){const s=await this.request("/presets/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return c.clear("presets"),s}async deletePreset(e){const t=await this.request("/presets/".concat(e,"/delete/"),{method:"DELETE"});return c.clear("presets"),t}async getDevices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;const r=new URLSearchParams;e&&r.append("search",e),r.append("page",t.toString()),r.append("page_size",s.toString());const a=r.toString();return this.request("/devices/?".concat(a))}async createDevice(e){return this.request("/devices/create/",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,t){return this.request("/devices/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteDevice(e){return this.request("/devices/".concat(e,"/delete/"),{method:"DELETE"})}async deleteDevicesBulk(e){return this.request("/devices/delete-bulk/",{method:"POST",body:JSON.stringify({device_ids:e})})}async getSlaves(e){return this.request("/presets/".concat(e,"/slaves/"))}async createSlave(e,t){return this.request("/presets/".concat(e,"/slaves/create/"),{method:"POST",body:JSON.stringify(t)})}async updateSlave(e,t,s){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/"),{method:"PUT",body:JSON.stringify(s)})}async deleteSlave(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/delete/"),{method:"DELETE"})}}}}]);
//# sourceMappingURL=524.94ef107c.chunk.js.map