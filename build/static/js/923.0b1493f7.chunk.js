"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[923],{7923(e,t,r){r.d(t,{OTA:()=>d});var i=r(9379),s=r(5043),o=r(5560),n=r(8421),a=(r(4050),r(579));const d=()=>{var e;const{isDark:t}=(0,n.D)(),[r,d]=(0,s.useState)([]),[l,c]=(0,s.useState)({name:"",version:"",deviceModel:"ESP32-S3",minBootloader:"1.0.0",releaseNotes:"",file:null}),[h,m]=(0,s.useState)({firmwareVersion:"",targetDevices:[],mode:"immediate",autoRollback:!0,healthTimeout:300,failureThreshold:10}),[g,p]=(0,s.useState)({show:!1,firmware:"",deviceCount:0,dataTransfer:""}),[u,f]=(0,s.useState)(!1),[x,b]=(0,s.useState)([]),[y,v]=(0,s.useState)("all"),[j,w]=(0,s.useState)(!0),[S,k]=(0,s.useState)(!0),[A,T]=(0,s.useState)(null),[z,D]=(0,s.useState)({selectedDevices:[],reason:""}),[C,R]=(0,s.useState)(!1),[W,B]=(0,s.useState)({currentVersion:"all",status:"all",deviceModel:"all"}),[I,F]=(0,s.useState)({show:!1,firmware:null}),[_,P]=(0,s.useState)({show:!1,firmware:null}),[O,E]=(0,s.useState)({show:!1,message:""}),[q,V]=(0,s.useState)({show:!1,message:""});(0,s.useEffect)(()=>{N(),U(),L();const e=setInterval(()=>{L()},1e4);return()=>clearInterval(e)},[]);const N=async()=>{try{k(!0);const e=await o.K.getFirmwareVersions(!1),t=(e.results||e||[]).map(e=>{var t,r;return{id:e.id,name:e.filename||"Firmware v".concat(e.version),version:e.version,deviceModel:(null===(t=e.description)||void 0===t||null===(r=t.match(/(?:ESP32|STM32|[A-Z0-9-]+)/i))||void 0===r?void 0:r[0])||"Unknown",minBootloaderVersion:"1.0.0",file:null,size:e.size||0,checksum:e.checksum||"",signatureValid:!1!==e.is_active,releaseNotes:e.release_notes||e.description||"",status:e.is_active?"stable":"draft",uploadDate:e.created_at||(new Date).toISOString()}});d(t)}catch(e){console.error("Failed to load firmware versions:",e),d([])}finally{k(!1)}},U=async()=>{try{w(!0);const e=await o.K.getDevices("",1,1e3),t=e.results||e,r=(Array.isArray(t)?t:[]).map(e=>({deviceId:e.device_serial||e.serial||"DEV".concat(e.id),currentVersion:e.firmware_version||e.config_version||"v1.0.0",targetVersion:"N/A",activeSlot:Math.random()>.5?"A":"B",status:"idle",bootCount:e.boot_count||0,lastError:"",progress:void 0}));b(r)}catch(e){console.error("Failed to load devices:",e),b([])}finally{w(!1)}},L=async()=>{try{const e=(await o.K.listTargetedUpdates()).find(e=>"in_progress"===e.status||"pending"===e.status);T(e||null),e&&await M(e)}catch(e){console.error("Failed to load deployments:",e)}},M=async e=>{try{const t=e||A;if(!t)return;const r=(t.device_targets||[]).map(e=>{var t;return null===(t=e.device)||void 0===t?void 0:t.device_serial}).filter(Boolean);if(0===r.length)return;const s=r.map(async e=>{try{var t,r;const i=await o.K.getDeviceUpdateLogs(e),s=i&&i.length>0?i[0]:null;if(!s)return{deviceId:e,status:"idle"};const n=null===(t=s.status)||void 0===t?void 0:t.toLowerCase();let a="idle";switch(n){case"pending":case"checking":case"available":a="trial";break;case"downloading":a="downloading";break;case"completed":a="healthy";break;case"failed":a="failed"}return{deviceId:e,status:a,currentVersion:s.current_firmware,targetVersion:null===(r=s.firmware_version)||void 0===r?void 0:r.version,lastError:"failed"===a?"Update failed":""}}catch(i){return console.error("Failed to get logs for ".concat(e,":"),i),{deviceId:e,status:"idle"}}}),n=await Promise.all(s),a=new Map(n.map(e=>[e.deviceId,e]));b(e=>e.map(e=>{const t=a.get(e.deviceId);return t?(0,i.A)((0,i.A)({},e),{},{status:t.status,currentVersion:t.currentVersion||e.currentVersion,targetVersion:t.targetVersion||e.targetVersion,lastError:t.lastError||e.lastError}):e}))}catch(t){console.error("Failed to update deployed device statuses:",t)}},J={total:x.length,inProgress:x.filter(e=>["downloading","flashing","rebooting"].includes(e.status)).length,healthy:x.filter(e=>"healthy"===e.status).length,failed:x.filter(e=>"failed"===e.status).length,rolledBack:x.filter(e=>"rolledback"===e.status).length},H=e=>{D(t=>(0,i.A)((0,i.A)({},t),{},{selectedDevices:t.selectedDevices.includes(e)?t.selectedDevices.filter(t=>t!==e):[...t.selectedDevices,e]}))},Y=()=>x.filter(e=>("all"===W.currentVersion||e.currentVersion===W.currentVersion)&&("all"===W.status||e.status===W.status)),K=()=>{const e=Y();D(t=>(0,i.A)((0,i.A)({},t),{},{selectedDevices:e.map(e=>e.deviceId)}))},G=()=>{D(e=>(0,i.A)((0,i.A)({},e),{},{selectedDevices:[]}))},X="all"===y?x:x.filter(e=>e.status===y);return(0,a.jsxs)("div",{style:{padding:"2rem",maxWidth:"1600px",margin:"0 auto",background:t?"#1a1a1a":"#f5f6fa",minHeight:"100vh"},children:[(0,a.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,a.jsxs)("h1",{style:{fontSize:"2rem",fontWeight:"700",color:t?"#e0e0e0":"#2c3e50",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,a.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,a.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,a.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]}),"OTA Firmware Management"]}),(0,a.jsx)("p",{style:{color:t?"#a0a0a0":"#7f8c8d",margin:0},children:"Upload, deploy, and monitor firmware updates across your device fleet"})]}),(0,a.jsxs)("div",{style:{background:t?"#2d2d2d":"white",borderRadius:"12px",padding:"2rem",marginBottom:"2rem",boxShadow:t?"0 2px 8px rgba(0,0,0,0.3)":"0 2px 8px rgba(0,0,0,0.08)",border:t?"1px solid #404040":"1px solid #e1e8ed"},children:[(0,a.jsxs)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:t?"#e0e0e0":"#2c3e50",marginBottom:"1.5rem",paddingBottom:"0.75rem",borderBottom:t?"2px solid #404040":"2px solid #e1e8ed",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,a.jsx)("span",{style:{fontSize:"1.25rem"},children:"\ud83d\udce6"}),"Firmware Repository"]}),(0,a.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),l.file)try{var t;const e=new FormData;e.append("file",l.file),e.append("version",l.version),e.append("description",l.name),e.append("release_notes",l.releaseNotes),e.append("is_active","false");const r=await o.K.uploadFirmwareVersion(e);E({show:!0,message:"Firmware uploaded successfully!\n\nVersion: ".concat(r.version,"\nSize: ").concat((r.size/1024).toFixed(2)," KB\nChecksum: ").concat(null===(t=r.checksum)||void 0===t?void 0:t.substring(0,16),"...\nStored in: S3")}),c({name:"",version:"",deviceModel:"ESP32-S3",minBootloader:"1.0.0",releaseNotes:"",file:null});const i=document.querySelector('input[type="file"]');i&&(i.value=""),await N()}catch(r){console.error("Firmware upload failed:",r),V({show:!0,message:"Upload failed: ".concat(r.message||"Unknown error","\n\nPlease check:\n- File size is reasonable\n- S3 credentials are configured (USE_S3=True)\n- You have admin permissions")})}else V({show:!0,message:"Please select a firmware file before uploading."})},style:{background:t?"#242424":"#f8f9fa",padding:"1.5rem",borderRadius:"8px",marginBottom:"2rem",border:t?"1px solid #404040":"1px solid #dee2e6"},children:[(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Firmware Name *"}),(0,a.jsx)("input",{type:"text",value:l.name,onChange:e=>c((0,i.A)((0,i.A)({},l),{},{name:e.target.value})),placeholder:"Solar Controller Firmware",required:!0,style:{width:"100%",padding:"0.75rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.95rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Version (semver) *"}),(0,a.jsx)("input",{type:"text",value:l.version,onChange:e=>c((0,i.A)((0,i.A)({},l),{},{version:e.target.value})),placeholder:"1.4.0",required:!0,pattern:"\\d+\\.\\d+\\.\\d+",style:{width:"100%",padding:"0.75rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.95rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Device Model"}),(0,a.jsxs)("select",{value:l.deviceModel,onChange:e=>c((0,i.A)((0,i.A)({},l),{},{deviceModel:e.target.value})),style:{width:"100%",padding:"0.75rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.95rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"},children:[(0,a.jsx)("option",{value:"ESP32-S3",children:"ESP32-S3"}),(0,a.jsx)("option",{value:"ESP32",children:"ESP32"}),(0,a.jsx)("option",{value:"STM32",children:"STM32"}),(0,a.jsx)("option",{value:"nRF52",children:"nRF52"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Min Bootloader Version"}),(0,a.jsx)("input",{type:"text",value:l.minBootloader,onChange:e=>c((0,i.A)((0,i.A)({},l),{},{minBootloader:e.target.value})),placeholder:"1.0.0",required:!0,style:{width:"100%",padding:"0.75rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.95rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"}})]})]}),(0,a.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Release Notes"}),(0,a.jsx)("textarea",{value:l.releaseNotes,onChange:e=>c((0,i.A)((0,i.A)({},l),{},{releaseNotes:e.target.value})),placeholder:"Bug fixes, new features, improvements...",rows:3,style:{width:"100%",padding:"0.75rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.95rem",fontFamily:"inherit",resize:"vertical",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"}})]}),(0,a.jsxs)("div",{style:{marginTop:"1rem",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",alignItems:"end"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Firmware File (.bin) *"}),(0,a.jsx)("input",{type:"file",accept:".bin",onChange:async e=>{var t;if(null!==(t=e.target.files)&&void 0!==t&&t[0]){const t=e.target.files[0];c((0,i.A)((0,i.A)({},l),{},{file:t}));try{const e=await(async e=>{const t=await e.arrayBuffer(),r=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(r)).map(e=>e.toString(16).padStart(2,"0")).join("")})(t);console.log("Calculated SHA-256 checksum:",e)}catch(r){console.error("Failed to calculate checksum:",r)}}},required:!0,style:{width:"100%",padding:"0.5rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.9rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"}}),l.file&&(0,a.jsxs)("small",{style:{color:t?"#a0a0a0":"#6c757d",display:"block",marginTop:"0.25rem"},children:[l.file.name," (",(l.file.size/1024).toFixed(1)," KB)"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"SHA256 (auto-calculated)"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem",background:t?"#242424":"#e9ecef",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da"},children:[(0,a.jsx)("input",{type:"text",value:"Calculating...",disabled:!0,style:{width:"100%",border:"none",background:"transparent",fontSize:"0.85rem",fontFamily:"monospace",color:t?"#a0a0a0":"#6c757d"}}),(0,a.jsx)("span",{style:{background:l.file?"#28a745":"#6c757d",color:"white",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:"600",whiteSpace:"nowrap"},children:l.file?"Valid":"Pending"})]})]})]}),(0,a.jsxs)("button",{type:"submit",style:{marginTop:"1.5rem",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",padding:"0.875rem 2rem",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},children:[(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,a.jsx)("polyline",{points:"17 8 12 3 7 8"}),(0,a.jsx)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),"Upload Firmware"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"1rem",color:t?"#e0e0e0":"#495057"},children:"Available Firmware Versions"}),(0,a.jsx)("div",{style:{overflowX:"auto"},children:(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{style:{background:t?"#242424":"#f8f9fa",borderBottom:t?"2px solid #404040":"2px solid #dee2e6"},children:[(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057",fontSize:"0.85rem"},children:"Name"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057",fontSize:"0.85rem"},children:"Version"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057",fontSize:"0.85rem"},children:"Device Model"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057",fontSize:"0.85rem"},children:"File Size"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057",fontSize:"0.85rem"},children:"Upload Date"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057",fontSize:"0.85rem"},children:"Status"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"center",fontWeight:"600",color:t?"#b0b0b0":"#495057",fontSize:"0.85rem"},children:"Actions"})]})}),(0,a.jsx)("tbody",{children:S?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,style:{padding:"2rem",textAlign:"center",color:t?"#a0a0a0":"#6c757d",fontSize:"0.95rem"},children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"10",opacity:"0.25"}),(0,a.jsx)("path",{d:"M12 2a10 10 0 0 1 10 10",opacity:"0.75"})]}),"Loading firmware versions..."]})})}):0===r.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,style:{padding:"2rem",textAlign:"center",color:t?"#a0a0a0":"#6c757d",fontSize:"0.95rem"},children:"No firmware versions uploaded yet. Use the form above to upload your first firmware."})}):r.map(e=>(0,a.jsxs)("tr",{style:{borderBottom:t?"1px solid #404040":"1px solid #e9ecef"},children:[(0,a.jsxs)("td",{style:{padding:"1rem 0.75rem"},children:[(0,a.jsx)("div",{style:{fontWeight:"500",color:t?"#e0e0e0":"#2c3e50",marginBottom:"0.25rem"},children:e.name}),e.signatureValid&&(0,a.jsxs)("span",{style:{fontSize:"0.75rem",color:"#28a745",display:"flex",alignItems:"center",gap:"0.25rem"},children:[(0,a.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:(0,a.jsx)("polyline",{points:"20 6 9 17 4 12"})}),"Signature Valid"]})]}),(0,a.jsx)("td",{style:{padding:"1rem 0.75rem",fontFamily:"monospace",fontSize:"0.9rem",fontWeight:"500"},children:e.version}),(0,a.jsx)("td",{style:{padding:"1rem 0.75rem",fontSize:"0.9rem"},children:e.deviceModel}),(0,a.jsxs)("td",{style:{padding:"1rem 0.75rem",fontSize:"0.9rem"},children:[(e.size/1024).toFixed(0)," KB"]}),(0,a.jsx)("td",{style:{padding:"1rem 0.75rem",fontSize:"0.9rem"},children:new Date(e.uploadDate).toLocaleDateString()}),(0,a.jsx)("td",{style:{padding:"1rem 0.75rem"},children:(0,a.jsx)("span",{style:{background:"stable"===e.status?"#d4edda":"#fff3cd",color:"stable"===e.status?"#155724":"#856404",padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600",textTransform:"uppercase"},children:"stable"===e.status?"\u2713 Production Stable":"Draft"})}),(0,a.jsx)("td",{style:{padding:"1rem 0.75rem",textAlign:"center"},children:(0,a.jsxs)("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:["draft"===e.status?(0,a.jsx)("button",{onClick:()=>(async e=>{try{await o.K.updateFirmwareVersion(e,{is_active:!0}),E({show:!0,message:"Firmware activated successfully!"}),await N()}catch(t){console.error("Firmware update failed:",t),V({show:!0,message:"Activation failed: ".concat(t.message||"Unknown error")})}})(e.id),style:{background:"#28a745",color:"white",border:"none",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",cursor:"pointer",fontWeight:"500"},children:"Activate"}):(0,a.jsx)("button",{onClick:()=>(async e=>{P({show:!0,firmware:e})})(e),style:{background:"#ffc107",color:"#000",border:"none",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",cursor:"pointer",fontWeight:"500"},children:"Deactivate"}),(0,a.jsx)("button",{onClick:()=>(async e=>{F({show:!0,firmware:e})})(e),style:{background:"#dc3545",color:"white",border:"none",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",cursor:"pointer",fontWeight:"500"},children:"Delete"})]})})]},e.id))})]})})]})]}),(0,a.jsxs)("div",{style:{background:t?"#2d2d2d":"white",borderRadius:"12px",padding:"2rem",marginBottom:"2rem",boxShadow:t?"0 2px 8px rgba(0,0,0,0.3)":"0 2px 8px rgba(0,0,0,0.08)",border:"2px solid #667eea"},children:[(0,a.jsxs)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:t?"#e0e0e0":"#2c3e50",marginBottom:"1.5rem",paddingBottom:"0.75rem",borderBottom:t?"2px solid #404040":"2px solid #e1e8ed",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,a.jsx)("span",{style:{fontSize:"1.25rem"},children:"\ud83d\ude80"}),"Deployment Panel"]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Select Firmware Version *"}),(0,a.jsxs)("select",{value:h.firmwareVersion,onChange:e=>m((0,i.A)((0,i.A)({},h),{},{firmwareVersion:e.target.value})),style:{width:"100%",padding:"0.75rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.95rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"},children:[(0,a.jsx)("option",{value:"",children:"-- Select Version --"}),r.filter(e=>"stable"===e.status).map(e=>(0,a.jsxs)("option",{value:e.version,children:[e.name," - v",e.version]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Deployment Mode"}),(0,a.jsxs)("select",{value:h.mode,onChange:e=>m((0,i.A)((0,i.A)({},h),{},{mode:e.target.value})),style:{width:"100%",padding:"0.75rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.95rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"},children:[(0,a.jsx)("option",{value:"immediate",children:"Immediate (Push to all devices)"}),(0,a.jsx)("option",{value:"canary",children:"Canary (Gradual rollout)"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Health Confirmation Timeout (seconds)"}),(0,a.jsx)("input",{type:"number",value:h.healthTimeout,onChange:e=>m((0,i.A)((0,i.A)({},h),{},{healthTimeout:parseInt(e.target.value)})),min:"30",max:"3600",style:{width:"100%",padding:"0.75rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.95rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Failure Threshold (%)"}),(0,a.jsx)("input",{type:"number",value:h.failureThreshold,onChange:e=>m((0,i.A)((0,i.A)({},h),{},{failureThreshold:parseInt(e.target.value)})),min:"1",max:"100",style:{width:"100%",padding:"0.75rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.95rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"}})]})]}),(0,a.jsxs)("div",{style:{marginTop:"1.5rem"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[(0,a.jsxs)("label",{style:{fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:["Target Devices (",h.targetDevices.length," selected)"]}),(0,a.jsxs)("button",{onClick:()=>{const e=x.filter(e=>"idle"===e.status);m((0,i.A)((0,i.A)({},h),{},{targetDevices:e.map(e=>e.deviceId)}))},style:{background:"transparent",color:"#667eea",border:"1px solid #667eea",padding:"0.25rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",cursor:"pointer",fontWeight:"500"},children:["Select All Idle (",x.filter(e=>"idle"===e.status).length,")"]})]}),(0,a.jsx)("div",{style:{maxHeight:"150px",overflowY:"auto",border:t?"1px solid #404040":"1px solid #ced4da",borderRadius:"6px",padding:"0.75rem",background:t?"#242424":"#f8f9fa"},children:j?(0,a.jsx)("div",{style:{textAlign:"center",color:t?"#a0a0a0":"#6c757d",padding:"1rem"},children:"Loading devices..."}):0===x.filter(e=>"idle"===e.status).length?(0,a.jsx)("div",{style:{textAlign:"center",color:t?"#a0a0a0":"#6c757d",padding:"1rem"},children:"No idle devices available for deployment"}):(0,a.jsx)(a.Fragment,{children:x.filter(e=>"idle"===e.status).map(e=>(0,a.jsxs)("label",{style:{display:"block",marginBottom:"0.5rem",cursor:"pointer",fontSize:"0.9rem"},children:[(0,a.jsx)("input",{type:"checkbox",checked:h.targetDevices.includes(e.deviceId),onChange:t=>{const r=t.target.checked?[...h.targetDevices,e.deviceId]:h.targetDevices.filter(t=>t!==e.deviceId);m((0,i.A)((0,i.A)({},h),{},{targetDevices:r}))},style:{marginRight:"0.5rem"}}),e.deviceId," (Current: ",e.currentVersion,")"]},e.deviceId))})})]}),(0,a.jsxs)("div",{style:{marginTop:"1.5rem",display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,a.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",fontWeight:"500",color:t?"#b0b0b0":"#495057"},children:[(0,a.jsx)("input",{type:"checkbox",checked:h.autoRollback,onChange:e=>m((0,i.A)((0,i.A)({},h),{},{autoRollback:e.target.checked})),style:{width:"20px",height:"20px",cursor:"pointer"}}),"Enable Auto Rollback"]}),(0,a.jsx)("span",{style:{fontSize:"0.85rem",color:t?"#a0a0a0":"#6c757d"},children:"(Automatically rollback on failure)"})]}),(0,a.jsxs)("div",{style:{marginTop:"2rem",display:"flex",gap:"1rem",flexWrap:"wrap"},children:[(0,a.jsxs)("button",{onClick:()=>{if(!h.firmwareVersion)return void V({show:!0,message:"Please select a firmware version before deploying."});if(0===h.targetDevices.length)return void V({show:!0,message:"Please select at least one device to deploy to."});const e=r.find(e=>e.version===h.firmwareVersion);if(!e)return;const t=(e.size*h.targetDevices.length/1048576).toFixed(2)+" MB";p({show:!0,firmware:e.version,deviceCount:h.targetDevices.length,dataTransfer:t})},disabled:u,style:{background:u?"#6c757d":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",padding:"1rem 2.5rem",borderRadius:"8px",fontSize:"1.125rem",fontWeight:"600",cursor:u?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.75rem",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},children:[(0,a.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),u?"Deploying...":"Deploy Firmware"]}),u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{style:{background:"#ffc107",color:"#000",border:"none",padding:"1rem 2rem",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:"pointer"},children:"\u23f8 Pause Deployment"}),(0,a.jsx)("button",{style:{background:"#dc3545",color:"white",border:"none",padding:"1rem 2rem",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:"pointer"},children:"\u23f9 Abort Deployment"})]})]})]}),g.show&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:(0,a.jsxs)("div",{style:{background:t?"#2d2d2d":"white",borderRadius:"12px",padding:"2rem",maxWidth:"500px",width:"90%",boxShadow:t?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:t?"1px solid #404040":"none"},children:[(0,a.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",marginBottom:"1.5rem",color:t?"#e0e0e0":"#2c3e50"},children:"Confirm Deployment"}),(0,a.jsxs)("div",{style:{marginBottom:"1.5rem",color:t?"#b0b0b0":"#495057",lineHeight:"1.8"},children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Firmware Version:"})," ",g.firmware]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Target Devices:"})," ",g.deviceCount]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Estimated Data Transfer:"})," ",g.dataTransfer]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Auto Rollback:"})," ",h.autoRollback?"Enabled \u2713":"Disabled"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Failure Threshold:"})," ",h.failureThreshold,"%"]})]}),(0,a.jsxs)("div",{style:{background:t?"#3a2a00":"#fff3cd",border:t?"1px solid #6b5300":"1px solid #ffc107",borderRadius:"8px",padding:"1rem",marginBottom:"1.5rem",color:t?"#ffd966":"#856404"},children:[(0,a.jsx)("strong",{children:"\u26a0\ufe0f Warning:"})," This will push firmware updates to ",g.deviceCount," devices."]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[(0,a.jsx)("button",{onClick:()=>p((0,i.A)((0,i.A)({},g),{},{show:!1})),style:{background:"#6c757d",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:"pointer"},children:"Cancel"}),(0,a.jsx)("button",{onClick:async()=>{p((0,i.A)((0,i.A)({},g),{},{show:!1})),f(!0);try{const e=r.find(e=>e.version===h.firmwareVersion);if(!e)throw new Error("Selected firmware not found");const t=await o.K.deployFirmware(e.id,h.targetDevices,"Deployment: ".concat(e.version," to ").concat(h.targetDevices.length," device(s)"));f(!1),alert("Deployment initiated successfully!\n\nTargeted Update ID: ".concat(t.id||"N/A","\nDevices: ").concat(t.devices_total||h.targetDevices.length,"\nFirmware: ").concat(e.version,"\n\nDevices will receive the update on their next check-in.")),await L()}catch(e){f(!1),console.error("Deployment failed:",e),alert("Deployment failed: ".concat(e.message||"Unknown error","\n\nPlease check the console for details."))}},style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:"pointer"},children:"Confirm Deploy"})]})]})}),(0,a.jsxs)("div",{style:{background:t?"#2d2d2d":"white",borderRadius:"12px",padding:"2rem",marginBottom:"2rem",boxShadow:t?"0 2px 8px rgba(0,0,0,0.3)":"0 2px 8px rgba(0,0,0,0.08)",border:t?"1px solid #404040":"1px solid #e1e8ed"},children:[(0,a.jsxs)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:t?"#e0e0e0":"#2c3e50",marginBottom:"1.5rem",paddingBottom:"0.75rem",borderBottom:t?"2px solid #404040":"2px solid #e1e8ed",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,a.jsx)("span",{style:{fontSize:"1.25rem"},children:"\ud83d\udcca"}),"Live Deployment Status",j&&(0,a.jsx)("span",{style:{fontSize:"0.85rem",color:t?"#a0a0a0":"#6c757d",fontWeight:"400",marginLeft:"auto"},children:"Loading devices..."})]}),j?(0,a.jsxs)("div",{style:{textAlign:"center",padding:"3rem 1rem",color:t?"#a0a0a0":"#6c757d"},children:[(0,a.jsx)("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"\u23f3"}),(0,a.jsx)("p",{style:{fontSize:"1.1rem"},children:"Loading devices from backend..."})]}):0===x.length?(0,a.jsxs)("div",{style:{textAlign:"center",padding:"3rem 1rem",color:t?"#a0a0a0":"#6c757d"},children:[(0,a.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"\ud83d\udcf1"}),(0,a.jsx)("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:"No devices registered yet"}),(0,a.jsx)("p",{style:{fontSize:"0.9rem"},children:"Register devices to see them here"})]}):(0,a.jsxs)(a.Fragment,{children:[A&&(0,a.jsxs)("div",{style:{background:"in_progress"===A.status?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":t?"#2a4a2a":"#d4edda",color:"in_progress"===A.status?"white":t?"#90ee90":"#155724",padding:"1.5rem",borderRadius:"12px",marginBottom:"2rem",border:"in_progress"===A.status?"none":t?"1px solid #4a6a4a":"1px solid #c3e6cb"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.75rem"},children:[(0,a.jsx)("h3",{style:{fontSize:"1.1rem",fontWeight:"600",margin:0},children:"in_progress"===A.status?"\ud83d\ude80 Active Deployment":"\u2705 Deployment Completed"}),(0,a.jsxs)("span",{style:{fontSize:"0.85rem",padding:"0.25rem 0.75rem",background:"rgba(255,255,255,0.2)",borderRadius:"20px"},children:["ID: ",A.id]})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",fontSize:"0.9rem"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Firmware:"})," ",(null===(e=A.target_firmware)||void 0===e?void 0:e.version)||"N/A"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Total Devices:"})," ",A.devices_total||0]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Updated:"})," ",A.devices_updated||0]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Failed:"})," ",A.devices_failed||0]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Progress:"})," ",A.devices_total>0?"".concat(Math.round(A.devices_updated/A.devices_total*100),"%"):"0%"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Started:"})," ",new Date(A.created_at).toLocaleString()]})]}),A.notes&&(0,a.jsxs)("div",{style:{marginTop:"1rem",fontSize:"0.85rem",opacity:.9},children:[(0,a.jsx)("strong",{children:"Notes:"})," ",A.notes]})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[(0,a.jsxs)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"1.25rem",borderRadius:"12px",textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"2rem",fontWeight:"700",marginBottom:"0.25rem"},children:J.total}),(0,a.jsx)("div",{style:{fontSize:"0.85rem",opacity:.9},children:"Total Devices"})]}),(0,a.jsxs)("div",{style:{background:"#17a2b8",color:"white",padding:"1.25rem",borderRadius:"12px",textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"2rem",fontWeight:"700",marginBottom:"0.25rem"},children:J.inProgress}),(0,a.jsx)("div",{style:{fontSize:"0.85rem",opacity:.9},children:"In Progress"})]}),(0,a.jsxs)("div",{style:{background:"#28a745",color:"white",padding:"1.25rem",borderRadius:"12px",textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"2rem",fontWeight:"700",marginBottom:"0.25rem"},children:J.healthy}),(0,a.jsx)("div",{style:{fontSize:"0.85rem",opacity:.9},children:"Healthy"})]}),(0,a.jsxs)("div",{style:{background:"#dc3545",color:"white",padding:"1.25rem",borderRadius:"12px",textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"2rem",fontWeight:"700",marginBottom:"0.25rem"},children:J.failed}),(0,a.jsx)("div",{style:{fontSize:"0.85rem",opacity:.9},children:"Failed"})]}),(0,a.jsxs)("div",{style:{background:"#6610f2",color:"white",padding:"1.25rem",borderRadius:"12px",textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"2rem",fontWeight:"700",marginBottom:"0.25rem"},children:J.rolledBack}),(0,a.jsx)("div",{style:{fontSize:"0.85rem",opacity:.9},children:"Rolled Back"})]})]}),(0,a.jsx)("div",{style:{marginBottom:"1rem",display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:["all","idle","downloading","flashing","rebooting","trial","healthy","failed","rolledback"].map(e=>(0,a.jsx)("button",{onClick:()=>v(e),style:{background:y===e?"#667eea":t?"#242424":"#f8f9fa",color:y===e?"white":t?"#e0e0e0":"#495057",border:t?"1px solid #404040":"1px solid #dee2e6",padding:"0.5rem 1rem",borderRadius:"20px",fontSize:"0.85rem",fontWeight:"500",cursor:"pointer",textTransform:"capitalize"},children:e},e))}),(0,a.jsx)("div",{style:{overflowX:"auto",maxHeight:"500px",overflowY:"auto"},children:(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[(0,a.jsx)("thead",{style:{position:"sticky",top:0,background:t?"#242424":"#f8f9fa",zIndex:1},children:(0,a.jsxs)("tr",{style:{borderBottom:t?"2px solid #404040":"2px solid #dee2e6"},children:[(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057"},children:"Device ID"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057"},children:"Current"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057"},children:"Target"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"center",fontWeight:"600",color:t?"#b0b0b0":"#495057"},children:"Slot"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057"},children:"Status"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"center",fontWeight:"600",color:t?"#b0b0b0":"#495057"},children:"Boot Count"}),(0,a.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"#495057"},children:"Last Error"})]})}),(0,a.jsx)("tbody",{children:X.map(e=>{return(0,a.jsxs)("tr",{style:{borderBottom:t?"1px solid #404040":"1px solid #e9ecef"},children:[(0,a.jsx)("td",{style:{padding:"0.75rem",fontFamily:"monospace",fontWeight:"500"},children:e.deviceId}),(0,a.jsx)("td",{style:{padding:"0.75rem",fontFamily:"monospace",fontSize:"0.85rem"},children:e.currentVersion}),(0,a.jsx)("td",{style:{padding:"0.75rem",fontFamily:"monospace",fontSize:"0.85rem"},children:e.targetVersion}),(0,a.jsx)("td",{style:{padding:"0.75rem",textAlign:"center"},children:(0,a.jsx)("span",{style:{background:"A"===e.activeSlot?"#e3f2fd":"#fff3e0",color:"A"===e.activeSlot?"#1976d2":"#f57c00",padding:"0.25rem 0.5rem",borderRadius:"6px",fontWeight:"600",fontSize:"0.75rem"},children:e.activeSlot})}),(0,a.jsxs)("td",{style:{padding:"0.75rem"},children:[(0,a.jsx)("span",{style:(r=e.status,{background:{idle:"#6c757d",downloading:"#17a2b8",flashing:"#ffc107",rebooting:"#fd7e14",trial:"#007bff",healthy:"#28a745",failed:"#dc3545",rolledback:"#6610f2"}[r],color:"white",padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600",textTransform:"uppercase",whiteSpace:"nowrap"}),children:e.status}),void 0!==e.progress&&(0,a.jsxs)("div",{style:{marginTop:"0.25rem",fontSize:"0.75rem",color:t?"#a0a0a0":"#6c757d"},children:[e.progress.toFixed(0),"%"]})]}),(0,a.jsx)("td",{style:{padding:"0.75rem",textAlign:"center",fontSize:"0.9rem"},children:e.bootCount}),(0,a.jsx)("td",{style:{padding:"0.75rem",fontSize:"0.85rem",color:e.lastError?"#dc3545":t?"#a0a0a0":"#6c757d"},children:e.lastError||"-"})]},e.deviceId);var r})})]})})]})]}),(0,a.jsxs)("div",{style:{background:t?"#2d2d2d":"white",borderRadius:"12px",padding:"2rem",boxShadow:t?"0 2px 8px rgba(0,0,0,0.3)":"0 2px 8px rgba(0,0,0,0.08)",border:"2px solid #dc3545"},children:[(0,a.jsxs)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#dc3545",marginBottom:"1rem",paddingBottom:"0.75rem",borderBottom:t?"2px solid #5a1f24":"2px solid #f8d7da",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,a.jsx)("span",{style:{fontSize:"1.25rem"},children:"\ud83d\udea8"}),"Emergency Rollback"]}),(0,a.jsxs)("div",{style:{background:t?"#3d1a1a":"#f8d7da",border:t?"1px solid #5a1f24":"1px solid #f5c6cb",borderRadius:"8px",padding:"1rem",marginBottom:"1.5rem",color:t?"#ff9999":"#721c24"},children:[(0,a.jsx)("strong",{children:"\u26a0\ufe0f Warning:"})," Use this feature only in emergency situations. Rollback command will revert devices to their previous firmware version automatically."]}),(0,a.jsxs)("div",{style:{marginBottom:"1.5rem",padding:"1rem",background:t?"#1a2a3a":"#e7f3ff",border:t?"1px solid #2a4a6a":"1px solid #b3d9ff",borderRadius:"8px",color:t?"#66b2ff":"#004085"},children:[(0,a.jsx)("strong",{children:"\u2139\ufe0f How it works:"})," The rollback sends an ",(0,a.jsx)("code",{style:{background:t?"#0d1117":"#fff",padding:"0.2rem 0.5rem",borderRadius:"4px",fontFamily:"monospace",color:t?"#e0e0e0":"inherit"},children:"updateConfig"})," command with value ",(0,a.jsx)("code",{style:{background:t?"#0d1117":"#fff",padding:"0.2rem 0.5rem",borderRadius:"4px",fontFamily:"monospace",color:t?"#e0e0e0":"inherit"},children:"2"})," to selected devices, triggering them to automatically revert to their previous firmware version."]}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.9rem"},children:"Rollback Reason *"}),(0,a.jsx)("textarea",{value:z.reason,onChange:e=>D((0,i.A)((0,i.A)({},z),{},{reason:e.target.value})),placeholder:"Reason for emergency rollback...",rows:3,style:{width:"100%",padding:"0.75rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.95rem",fontFamily:"inherit",resize:"vertical",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"}})]})}),(0,a.jsxs)("div",{style:{marginTop:"1.5rem"},children:[(0,a.jsx)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"1rem",color:t?"#e0e0e0":"#495057"},children:"Device Selection & Filters"}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1rem"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.85rem"},children:"Filter by Current Version"}),(0,a.jsxs)("select",{value:W.currentVersion,onChange:e=>B((0,i.A)((0,i.A)({},W),{},{currentVersion:e.target.value})),style:{width:"100%",padding:"0.5rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.9rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"},children:[(0,a.jsx)("option",{value:"all",children:"All Versions"}),Array.from(new Set(x.map(e=>e.currentVersion))).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.85rem"},children:"Filter by Status"}),(0,a.jsxs)("select",{value:W.status,onChange:e=>B((0,i.A)((0,i.A)({},W),{},{status:e.target.value})),style:{width:"100%",padding:"0.5rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.9rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"},children:[(0,a.jsx)("option",{value:"all",children:"All Statuses"}),(0,a.jsx)("option",{value:"failed",children:"Failed"}),(0,a.jsx)("option",{value:"healthy",children:"Healthy"}),(0,a.jsx)("option",{value:"trial",children:"Trial"}),(0,a.jsx)("option",{value:"downloading",children:"Downloading"}),(0,a.jsx)("option",{value:"flashing",children:"Flashing"}),(0,a.jsx)("option",{value:"rebooting",children:"Rebooting"}),(0,a.jsx)("option",{value:"rolledback",children:"Rolled Back"}),(0,a.jsx)("option",{value:"idle",children:"Idle"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:t?"#b0b0b0":"#495057",fontSize:"0.85rem"},children:"Filter by Target Version"}),(0,a.jsxs)("select",{value:W.deviceModel,onChange:e=>B((0,i.A)((0,i.A)({},W),{},{deviceModel:e.target.value})),style:{width:"100%",padding:"0.5rem",borderRadius:"6px",border:t?"1px solid #404040":"1px solid #ced4da",fontSize:"0.9rem",background:t?"#1a1a1a":"white",color:t?"#e0e0e0":"inherit"},children:[(0,a.jsx)("option",{value:"all",children:"All Target Versions"}),Array.from(new Set(x.map(e=>e.targetVersion))).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap",marginBottom:"1rem"},children:[(0,a.jsxs)("button",{onClick:K,style:{background:"#007bff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",fontSize:"0.85rem",fontWeight:"600",cursor:"pointer"},children:["Select All Filtered (",Y().length,")"]}),(0,a.jsx)("button",{onClick:G,style:{background:"#6c757d",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",fontSize:"0.85rem",fontWeight:"600",cursor:"pointer"},children:"Deselect All"}),(0,a.jsxs)("button",{onClick:()=>{const e=x.filter(e=>"failed"===e.status).map(e=>e.deviceId);D((0,i.A)((0,i.A)({},z),{},{selectedDevices:e}))},style:{background:"#ffc107",color:"#000",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",fontSize:"0.85rem",fontWeight:"600",cursor:"pointer"},children:["Select Failed Only (",x.filter(e=>"failed"===e.status).length,")"]}),(0,a.jsxs)("button",{onClick:()=>{const e=x.filter(e=>["failed","rolledback"].includes(e.status)).map(e=>e.deviceId);D((0,i.A)((0,i.A)({},z),{},{selectedDevices:e}))},style:{background:"#fd7e14",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",fontSize:"0.85rem",fontWeight:"600",cursor:"pointer"},children:["Select Problem Devices (",x.filter(e=>["failed","rolledback"].includes(e.status)).length,")"]})]}),(0,a.jsxs)("div",{style:{background:t?"#242424":"#f8f9fa",borderRadius:"8px",padding:"1rem",border:t?"1px solid #404040":"1px solid #dee2e6",maxHeight:"400px",overflowY:"auto"},children:[(0,a.jsx)("div",{style:{marginBottom:"0.75rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,a.jsxs)("strong",{style:{fontSize:"0.95rem",color:t?"#e0e0e0":"inherit"},children:["Devices List (",Y().length," available, ",z.selectedDevices.length," selected)"]})}),j?(0,a.jsx)("div",{style:{padding:"2rem",textAlign:"center",color:t?"#a0a0a0":"#6c757d"},children:"Loading devices..."}):0===Y().length?(0,a.jsx)("div",{style:{padding:"2rem",textAlign:"center",color:t?"#a0a0a0":"#6c757d"},children:"No devices match the current filters"}):(0,a.jsxs)("table",{style:{width:"100%",fontSize:"0.85rem"},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{style:{borderBottom:t?"2px solid #404040":"2px solid #dee2e6"},children:[(0,a.jsx)("th",{style:{padding:"0.5rem",textAlign:"left",fontWeight:"600",width:"50px",color:t?"#b0b0b0":"inherit"},children:(0,a.jsx)("input",{type:"checkbox",checked:Y().length>0&&Y().every(e=>z.selectedDevices.includes(e.deviceId)),onChange:e=>{e.target.checked?K():G()},style:{cursor:"pointer",width:"16px",height:"16px"}})}),(0,a.jsx)("th",{style:{padding:"0.5rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"inherit"},children:"Device ID"}),(0,a.jsx)("th",{style:{padding:"0.5rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"inherit"},children:"Current Version"}),(0,a.jsx)("th",{style:{padding:"0.5rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"inherit"},children:"Target Version"}),(0,a.jsx)("th",{style:{padding:"0.5rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"inherit"},children:"Status"}),(0,a.jsx)("th",{style:{padding:"0.5rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"inherit"},children:"Boot Count"}),(0,a.jsx)("th",{style:{padding:"0.5rem",textAlign:"left",fontWeight:"600",color:t?"#b0b0b0":"inherit"},children:"Last Error"})]})}),(0,a.jsx)("tbody",{children:Y().map(e=>(0,a.jsxs)("tr",{style:{borderBottom:t?"1px solid #404040":"1px solid #e9ecef",background:z.selectedDevices.includes(e.deviceId)?t?"#3a2a00":"#fff3cd":"transparent",cursor:"pointer"},onClick:()=>H(e.deviceId),children:[(0,a.jsx)("td",{style:{padding:"0.75rem 0.5rem"},children:(0,a.jsx)("input",{type:"checkbox",checked:z.selectedDevices.includes(e.deviceId),onChange:()=>H(e.deviceId),onClick:e=>e.stopPropagation(),style:{cursor:"pointer",width:"16px",height:"16px"}})}),(0,a.jsx)("td",{style:{padding:"0.75rem 0.5rem",fontFamily:"monospace",fontWeight:"500"},children:e.deviceId}),(0,a.jsx)("td",{style:{padding:"0.75rem 0.5rem",fontFamily:"monospace"},children:e.currentVersion}),(0,a.jsx)("td",{style:{padding:"0.75rem 0.5rem",fontFamily:"monospace"},children:e.targetVersion}),(0,a.jsx)("td",{style:{padding:"0.75rem 0.5rem"},children:(0,a.jsx)("span",{style:{padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600",background:"failed"===e.status?t?"#3d1a1a":"#f8d7da":"healthy"===e.status?t?"#1a3d1a":"#d4edda":"downloading"===e.status||"flashing"===e.status?t?"#1a2a3a":"#cce5ff":"rolledback"===e.status?t?"#3a2a00":"#fff3cd":t?"#2a2a2a":"#e9ecef",color:"failed"===e.status?t?"#ff9999":"#721c24":"healthy"===e.status?t?"#99ff99":"#155724":"downloading"===e.status||"flashing"===e.status?t?"#66b2ff":"#004085":"rolledback"===e.status?t?"#ffd966":"#856404":t?"#b0b0b0":"#495057"},children:e.status})}),(0,a.jsx)("td",{style:{padding:"0.75rem 0.5rem"},children:e.bootCount}),(0,a.jsx)("td",{style:{padding:"0.75rem 0.5rem",color:e.lastError?"#dc3545":t?"#a0a0a0":"#6c757d",fontSize:"0.8rem"},children:e.lastError||"None"})]},e.deviceId))})]})]})]}),(0,a.jsx)("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"flex-end"},children:(0,a.jsxs)("button",{onClick:()=>{R(!0)},disabled:0===z.selectedDevices.length,style:{background:0===z.selectedDevices.length?"#6c757d":"#dc3545",color:"white",border:"none",padding:"0.75rem 2rem",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:0===z.selectedDevices.length?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.5rem",opacity:0===z.selectedDevices.length?.6:1},children:[(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("polyline",{points:"1 4 1 10 7 10"}),(0,a.jsx)("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]}),"Rollback ",z.selectedDevices.length," Device",1!==z.selectedDevices.length?"s":""]})})]}),C&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:(0,a.jsxs)("div",{style:{background:t?"#2d2d2d":"white",borderRadius:"12px",padding:"2rem",maxWidth:"500px",width:"90%",boxShadow:t?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:"2px solid #dc3545"},children:[(0,a.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",marginBottom:"1rem",color:"#dc3545"},children:"\u26a0\ufe0f Confirm Emergency Rollback"}),(0,a.jsxs)("div",{style:{background:t?"#3d1a1a":"#f8d7da",border:t?"1px solid #5a1f24":"1px solid #f5c6cb",borderRadius:"8px",padding:"1rem",marginBottom:"1.5rem",color:t?"#ff9999":"#721c24",fontSize:"0.95rem"},children:[(0,a.jsx)("strong",{children:"This action cannot be undone!"}),(0,a.jsx)("p",{style:{margin:"0.5rem 0 0 0"},children:"You are about to rollback devices to a previous firmware version."})]}),(0,a.jsxs)("div",{style:{marginBottom:"1.5rem",color:t?"#b0b0b0":"#495057",lineHeight:"1.8"},children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Command:"})," ",(0,a.jsx)("code",{style:{background:t?"#1a1a1a":"#f8f9fa",padding:"0.2rem 0.5rem",borderRadius:"4px",fontFamily:"monospace",color:t?"#e0e0e0":"inherit"},children:"updateConfig = 2"})," (automatic rollback to previous version)"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Devices to Rollback:"})," ",z.selectedDevices.length]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Reason:"})," ",z.reason||"Not provided"]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[(0,a.jsx)("button",{onClick:()=>R(!1),style:{background:"#6c757d",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:"pointer"},children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{0!==z.selectedDevices.length?z.reason.trim()?(R(!1),alert("Sending rollback command (updateConfig=2) to ".concat(z.selectedDevices.length," device(s)")),D({selectedDevices:[],reason:""})):alert("Please provide a reason for rollback"):alert("Please select devices to rollback")},style:{background:"#dc3545",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:"pointer"},children:"Confirm Rollback"})]})]})}),I.show&&I.firmware&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:(0,a.jsxs)("div",{style:{background:t?"#2d2d2d":"white",borderRadius:"16px",padding:"2rem",maxWidth:"500px",width:"90%",boxShadow:t?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:"2px solid #7f1d1d",animation:"slideIn 0.2s ease-out"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[(0,a.jsx)("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:"linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",animation:"pulse 2s infinite"},children:"\ud83d\uddd1\ufe0f"}),(0,a.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",margin:0,color:"#7f1d1d"},children:"Delete Firmware"})]}),(0,a.jsxs)("div",{style:{marginBottom:"1.5rem",color:t?"#b0b0b0":"#495057",lineHeight:"1.6"},children:[(0,a.jsxs)("p",{style:{marginBottom:"1rem"},children:["Are you sure you want to delete firmware version ",(0,a.jsx)("strong",{style:{color:t?"#e0e0e0":"#2c3e50"},children:I.firmware.version}),"?"]}),(0,a.jsxs)("div",{style:{background:t?"rgba(127, 29, 29, 0.1)":"#fee2e2",border:t?"1px solid rgba(127, 29, 29, 0.3)":"1px solid #fecaca",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:t?"#fca5a5":"#991b1b"},children:[(0,a.jsx)("strong",{children:"\u26a0\ufe0f Warning:"})," This will permanently remove the firmware file from S3. This action cannot be undone."]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[(0,a.jsx)("button",{onClick:()=>F({show:!1,firmware:null}),style:{background:t?"#3a3a3a":"#e0e0e0",color:t?"#e0e0e0":"#495057",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.background=t?"#4a4a4a":"#d0d0d0",onMouseOut:e=>e.currentTarget.style.background=t?"#3a3a3a":"#e0e0e0",children:"Cancel"}),(0,a.jsx)("button",{onClick:async()=>{if(I.firmware)try{await o.K.deleteFirmwareVersion(I.firmware.id),F({show:!1,firmware:null}),E({show:!0,message:"Firmware deleted successfully!"}),await N()}catch(e){console.error("Firmware deletion failed:",e),F({show:!1,firmware:null}),V({show:!0,message:"Deletion failed: ".concat(e.message||"Unknown error")})}},style:{background:"linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%)",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(127, 29, 29, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.transform="translateY(-1px)",onMouseOut:e=>e.currentTarget.style.transform="translateY(0)",children:"Yes, Delete"})]})]})}),_.show&&_.firmware&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:(0,a.jsxs)("div",{style:{background:t?"#2d2d2d":"white",borderRadius:"16px",padding:"2rem",maxWidth:"500px",width:"90%",boxShadow:t?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:"2px solid #ffc107",animation:"slideIn 0.2s ease-out"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[(0,a.jsx)("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:"linear-gradient(135deg, #ffc107 0%, #ff9800 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",animation:"pulse 2s infinite"},children:"\u23f8\ufe0f"}),(0,a.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",margin:0,color:"#ff9800"},children:"Deactivate Firmware"})]}),(0,a.jsxs)("div",{style:{marginBottom:"1.5rem",color:t?"#b0b0b0":"#495057",lineHeight:"1.6"},children:[(0,a.jsxs)("p",{style:{marginBottom:"1rem"},children:["Are you sure you want to deactivate firmware version ",(0,a.jsx)("strong",{style:{color:t?"#e0e0e0":"#2c3e50"},children:_.firmware.version}),"?"]}),(0,a.jsxs)("div",{style:{background:t?"rgba(255, 193, 7, 0.1)":"#fff3cd",border:t?"1px solid rgba(255, 193, 7, 0.3)":"1px solid #ffc107",borderRadius:"8px",padding:"0.75rem 1rem",fontSize:"0.9rem",color:t?"#ffcc00":"#856404"},children:[(0,a.jsx)("strong",{children:"\u2139\ufe0f Note:"})," This firmware will no longer be available for OTA updates. You can reactivate it later."]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[(0,a.jsx)("button",{onClick:()=>P({show:!1,firmware:null}),style:{background:t?"#3a3a3a":"#e0e0e0",color:t?"#e0e0e0":"#495057",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.background=t?"#4a4a4a":"#d0d0d0",onMouseOut:e=>e.currentTarget.style.background=t?"#3a3a3a":"#e0e0e0",children:"Cancel"}),(0,a.jsx)("button",{onClick:async()=>{if(_.firmware)try{await o.K.updateFirmwareVersion(_.firmware.id,{is_active:!1}),P({show:!1,firmware:null}),E({show:!0,message:"Firmware deactivated successfully!"}),await N()}catch(e){console.error("Firmware deactivation failed:",e),P({show:!1,firmware:null}),V({show:!0,message:"Deactivation failed: ".concat(e.message||"Unknown error")})}},style:{background:"linear-gradient(135deg, #ffc107 0%, #ff9800 100%)",color:"#000",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(255, 193, 7, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.transform="translateY(-1px)",onMouseOut:e=>e.currentTarget.style.transform="translateY(0)",children:"Yes, Deactivate"})]})]})}),O.show&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)"},children:(0,a.jsx)("div",{style:{background:t?"#2d2d2d":"white",borderRadius:"16px",padding:"2rem",maxWidth:"450px",width:"90%",boxShadow:t?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:t?"1px solid #28a745":"2px solid #28a745",animation:"slideIn 0.2s ease-out"},children:(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("div",{style:{width:"64px",height:"64px",borderRadius:"50%",background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",margin:"0 auto 1rem",animation:"scaleIn 0.3s ease-out"},children:"\u2713"}),(0,a.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",marginBottom:"1rem",color:t?"#e0e0e0":"#2c3e50"},children:"Success"}),(0,a.jsx)("p",{style:{color:t?"#b0b0b0":"#495057",lineHeight:"1.6",marginBottom:"1.5rem",whiteSpace:"pre-line"},children:O.message}),(0,a.jsx)("button",{onClick:()=>E({show:!1,message:""}),style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",color:"white",border:"none",padding:"0.75rem 2rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(40, 167, 69, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.transform="translateY(-1px)",onMouseOut:e=>e.currentTarget.style.transform="translateY(0)",children:"Got it!"})]})})}),q.show&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)"},children:(0,a.jsx)("div",{style:{background:t?"#2d2d2d":"white",borderRadius:"16px",padding:"2rem",maxWidth:"450px",width:"90%",boxShadow:t?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:"2px solid #dc3545",animation:"slideIn 0.2s ease-out"},children:(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("div",{style:{width:"64px",height:"64px",borderRadius:"50%",background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",margin:"0 auto 1rem",animation:"pulse 2s infinite"},children:"\u26a0\ufe0f"}),(0,a.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",marginBottom:"1rem",color:"#dc3545"},children:"Error"}),(0,a.jsx)("p",{style:{color:t?"#b0b0b0":"#495057",lineHeight:"1.6",marginBottom:"1.5rem",whiteSpace:"pre-line"},children:q.message}),(0,a.jsx)("button",{onClick:()=>V({show:!1,message:""}),style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",color:"white",border:"none",padding:"0.75rem 2rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(220, 53, 69, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.transform="translateY(-1px)",onMouseOut:e=>e.currentTarget.style.transform="translateY(0)",children:"Dismiss"})]})})})]})}},5560(e,t,r){r.d(t,{K:()=>d});var i=r(9379);class s{constructor(){this.cache=new Map,this.subscribers=new Map}set(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.DEFAULT_TTL,i=arguments.length>3?arguments[3]:void 0;this.cache.set(e,{data:t,timestamp:Date.now(),expiresIn:r,staleTime:null!==i&&void 0!==i?i:Math.min(r/2,s.STALE_TIME)}),this.notifySubscribers(e,t)}get(e){const t=this.cache.get(e);if(!t)return null;return Date.now()-t.timestamp>t.expiresIn?(this.cache.delete(e),null):t.data}getWithStaleStatus(e){var t;const r=this.cache.get(e);if(!r)return null;const i=Date.now()-r.timestamp,s=i>r.expiresIn,o=i>(null!==(t=r.staleTime)&&void 0!==t?t:r.expiresIn/2);return s?(this.cache.delete(e),null):{data:r.data,isStale:o,isExpired:!1}}has(e){const t=this.cache.get(e);if(!t)return!1;return!(Date.now()-t.timestamp>t.expiresIn)||(this.cache.delete(e),!1)}isStale(e){var t;const r=this.cache.get(e);if(!r)return!0;return Date.now()-r.timestamp>(null!==(t=r.staleTime)&&void 0!==t?t:r.expiresIn/2)}clear(e){this.cache.delete(e)}clearPattern(e){const t="string"===typeof e?new RegExp(e):e,r=[];this.cache.forEach((e,i)=>{t.test(i)&&r.push(i)}),r.forEach(e=>this.cache.delete(e))}clearAll(){this.cache.clear()}size(){return this.cache.size}subscribe(e,t){this.subscribers.has(e)||this.subscribers.set(e,new Set);const r={callback:t};return this.subscribers.get(e).add(r),()=>{const t=this.subscribers.get(e);t&&(t.delete(r),0===t.size&&this.subscribers.delete(e))}}subscribePattern(e,t){const r="__pattern__".concat(e.source);this.subscribers.has(r)||this.subscribers.set(r,new Set);const i={callback:t,pattern:e};return this.subscribers.get(r).add(i),()=>{const e=this.subscribers.get(r);e&&(e.delete(i),0===e.size&&this.subscribers.delete(r))}}notifySubscribers(e,t){const r=this.subscribers.get(e);r&&r.forEach(r=>{try{r.callback(t)}catch(i){console.error("Cache subscriber error for key ".concat(e,":"),i)}}),this.subscribers.forEach((r,i)=>{i.startsWith("__pattern__")&&r.forEach(r=>{if(r.pattern&&r.pattern.test(e))try{r.callback(t)}catch(i){console.error("Cache pattern subscriber error for key ".concat(e,":"),i)}})})}keys(){return Array.from(this.cache.keys())}getStats(){return{size:this.cache.size,keys:this.keys(),subscribers:Array.from(this.subscribers.values()).reduce((e,t)=>e+t.size,0)}}static getTTL(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short"){case"realtime":return s.REALTIME_TTL;case"long":return s.LONG_TTL;default:return s.DEFAULT_TTL}}}s.DEFAULT_TTL=3e5,s.LONG_TTL=18e5,s.REALTIME_TTL=1e4,s.STALE_TIME=3e4;const o=new s,n=3e5,a="https://smart-solar-django-backend.vercel.app/api";const d=new class{getAuthHeaders(){const e=localStorage.getItem("authTokens");if(e)try{const t=JSON.parse(e);return{Authorization:"Bearer ".concat(t.access),"Content-Type":"application/json"}}catch(t){console.error("Error parsing auth tokens:",t)}return{"Content-Type":"application/json"}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r="".concat(a).concat(e);let s=this.getAuthHeaders(),o=await fetch(r,(0,i.A)((0,i.A)({},t),{},{headers:(0,i.A)((0,i.A)({},s),t.headers)}));if(401===o.status){await this.refreshToken()&&(s=this.getAuthHeaders(),o=await fetch(r,(0,i.A)((0,i.A)({},t),{},{headers:(0,i.A)((0,i.A)({},s),t.headers)})))}if(401===o.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!o.ok){const e=await o.text();throw new Error("API request failed: ".concat(o.status," ").concat(o.statusText," - ").concat(e))}return 204===o.status?null:o.json()}async refreshToken(){const e=localStorage.getItem("authTokens");if(!e)return!1;try{const t=JSON.parse(e),r=await fetch("".concat(a,"/auth/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t.refresh})});if(r.ok){const e={access:(await r.json()).access,refresh:t.refresh};return localStorage.setItem("authTokens",JSON.stringify(e)),!0}}catch(t){console.error("Token refresh failed:",t)}return!1}async getConfiguration(){return this.request("/config/")}async getTelemetry(){return this.request("/telemetry/")}async provisionDevice(e){const t=await fetch("".concat(a,"/devices/provision"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Provisioning failed: ".concat(t.statusText));return t.json()}async getAlerts(){const e="alerts",t=o.get(e);if(t)return t;const r=await this.request("/alerts/");return o.set(e,r,n),r}async getSystemHealth(){const e="system_health",t=o.get(e);if(t)return t;const r=await this.request("/health/");return o.set(e,r,n),r}async getKPIs(){const e="kpis",t=o.get(e);if(t)return t;const r=await this.request("/kpis/");return o.set(e,r,n),r}async getUsers(e){const t="users_".concat(e||"all"),r=o.get(t);if(r)return r;const i=e?"?search=".concat(encodeURIComponent(e)):"",s=await this.request("/users/".concat(i));return o.set(t,s,n),s}async createUser(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify(e)});return o.clear("users_all"),o.clearAll(),t}async createEmployee(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify((0,i.A)((0,i.A)({},e),{},{is_staff:!0}))});return o.clear("users_all"),t}async getUserDevices(e){return this.request("/users/".concat(e,"/devices/"))}async getUserSite(e){return this.request("/users/".concat(e,"/site/"))}async createUserSite(e,t){return this.request("/users/".concat(e,"/site/"),{method:"POST",body:JSON.stringify(t)})}async updateUserSite(e,t){return this.request("/users/".concat(e,"/site/update/"),{method:"PUT",body:JSON.stringify(t)})}async getDeviceSite(e){return this.request("/devices/".concat(e,"/site/"))}async createDeviceSite(e,t){return this.request("/devices/".concat(e,"/site/"),{method:"POST",body:JSON.stringify(t)})}async updateDeviceSite(e,t){return this.request("/devices/".concat(e,"/site/update/"),{method:"PUT",body:JSON.stringify(t)})}async getSiteTelemetry(e,t){const r=new URLSearchParams;null!==t&&void 0!==t&&t.start_date&&r.append("start_date",t.start_date),null!==t&&void 0!==t&&t.end_date&&r.append("end_date",t.end_date),null!==t&&void 0!==t&&t.days&&r.append("days",t.days.toString());const i="/sites/".concat(e,"/telemetry/").concat(r.toString()?"?"+r.toString():"");return this.request(i)}async getSiteHistory(e,t){const r=new URLSearchParams({start_date:t.start_date,end_date:t.end_date});return this.request("/sites/".concat(e,"/history/?").concat(r.toString()))}async getSiteForecast(e,t){const r=new URLSearchParams;null!==t&&void 0!==t&&t.date&&r.append("date",t.date),null!==t&&void 0!==t&&t.start_date&&r.append("start_date",t.start_date),null!==t&&void 0!==t&&t.end_date&&r.append("end_date",t.end_date);const i="/sites/".concat(e,"/forecast/").concat(r.toString()?"?"+r.toString():"");return this.request(i)}async getSiteWeather(e){return this.request("/sites/".concat(e,"/weather/"))}async updateUser(e,t){const r=await this.request("/users/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return o.clear("users_all"),r}async deleteUser(e){const t=await this.request("/users/".concat(e,"/delete/"),{method:"DELETE"});return o.clear("users_all"),t}async getProfile(){return this.request("/profile/")}async updateProfile(e){return this.request("/profile/update/",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e){return this.request("/profile/change-password/",{method:"POST",body:JSON.stringify(e)})}async getCustomers(e){const t=e?"?search=".concat(encodeURIComponent(e)):"";return this.request("/customers/".concat(t))}async createCustomer(e){return this.request("/customers/create/",{method:"POST",body:JSON.stringify(e)})}async getCustomer(e){return this.request("/customers/".concat(e,"/"))}async updateCustomer(e,t){return this.request("/customers/".concat(e,"/update/"),{method:"PUT",body:JSON.stringify(t)})}async deleteCustomer(e){return this.request("/customers/".concat(e,"/delete/"),{method:"DELETE"})}async getPresets(){const e="presets",t=o.get(e);if(t)return t;const r=await this.request("/presets/");return o.set(e,r,18e5),r}async createPreset(e){const t=await this.request("/presets/create/",{method:"POST",body:JSON.stringify(e)});return o.clear("presets"),t}async updatePreset(e,t){const r=await this.request("/presets/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return o.clear("presets"),r}async deletePreset(e){const t=await this.request("/presets/".concat(e,"/delete/"),{method:"DELETE"});return o.clear("presets"),t}async getGlobalSlaves(){return this.request("/slaves/")}async createGlobalSlave(e){return this.request("/slaves/create/",{method:"POST",body:JSON.stringify(e)})}async updateGlobalSlave(e,t){return this.request("/slaves/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteGlobalSlave(e){return this.request("/slaves/".concat(e,"/delete/"),{method:"DELETE"})}async getDevices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;const i=new URLSearchParams;e&&i.append("search",e),i.append("page",t.toString()),i.append("page_size",r.toString());const s=i.toString();return this.request("/devices/?".concat(s))}async createDevice(e){return this.request("/devices/create/",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,t){return this.request("/devices/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteDevice(e){return this.request("/devices/".concat(e,"/delete/"),{method:"DELETE"})}async rebootDevice(e){return this.request("/devices/".concat(e,"/reboot/"),{method:"POST"})}async hardResetDevice(e){return this.request("/devices/".concat(e,"/hard-reset/"),{method:"POST"})}async getDeviceLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.request("/devices/".concat(e,"/logs/?limit=").concat(t,"&offset=").concat(r))}async toggleDeviceLogs(e,t){return this.request("/devices/".concat(e,"/logs/toggle/"),{method:"POST",body:JSON.stringify({enabled:t})})}async deleteDevicesBulk(e){return this.request("/devices/delete-bulk/",{method:"POST",body:JSON.stringify({device_ids:e})})}async getSlaves(e){return this.request("/presets/".concat(e,"/slaves/"))}async createSlave(e,t){return this.request("/presets/".concat(e,"/slaves/create/"),{method:"POST",body:JSON.stringify(t)})}async updateSlave(e,t,r){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/"),{method:"PUT",body:JSON.stringify(r)})}async deleteSlave(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/delete/"),{method:"DELETE"})}async addSlavesToPreset(e,t){return this.request("/presets/".concat(e,"/slaves/add/"),{method:"POST",body:JSON.stringify({slave_ids:t})})}async detachSlaveFromPreset(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/detach/"),{method:"POST"})}async getFirmwareVersions(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=new URLSearchParams;return t.append("active",e.toString()),this.request("/ota/firmware/?".concat(t.toString()))}async uploadFirmwareVersion(e){const t="".concat(a,"/ota/firmware/create/"),r=localStorage.getItem("authTokens");if(!r)throw new Error("Authentication required");const i=JSON.parse(r);let s={Authorization:"Bearer ".concat(i.access)},o=await fetch(t,{method:"POST",headers:s,body:e});if(401===o.status){if(await this.refreshToken()){const r=JSON.parse(localStorage.getItem("authTokens")||"{}");s={Authorization:"Bearer ".concat(r.access)},o=await fetch(t,{method:"POST",headers:s,body:e})}}if(401===o.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!o.ok){const e=await o.text();throw new Error("Upload failed: ".concat(o.status," ").concat(o.statusText," - ").concat(e))}return o.json()}async updateFirmwareVersion(e,t){return this.request("/ota/firmware/".concat(e,"/"),{method:"PATCH",body:JSON.stringify(t)})}async deleteFirmwareVersion(e){return this.request("/ota/firmware/".concat(e,"/delete/"),{method:"DELETE"})}async getDeviceUpdateLogs(e){return this.request("/ota/devices/".concat(e,"/logs"))}async getOTAConfig(){return this.request("/ota/config/")}async updateOTAConfig(e){return this.request("/ota/config/update/",{method:"PATCH",body:JSON.stringify(e)})}async getOTAHealth(){return this.request("/ota/health/")}async triggerRollback(e,t){return this.request("/ota/updates/rollback/",{method:"POST",body:JSON.stringify({device_serial:e,notes:t||""})})}async deployFirmware(e,t,r){return this.request("/ota/updates/multiple/",{method:"POST",body:JSON.stringify({firmware_id:e,device_serials:t,notes:r||""})})}async listTargetedUpdates(){return this.request("/ota/updates/")}async getTargetedUpdate(e){return this.request("/ota/updates/".concat(e,"/"))}}}}]);
//# sourceMappingURL=923.0b1493f7.chunk.js.map