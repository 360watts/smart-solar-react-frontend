"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[192],{3192(e,t,r){r.r(t),r.d(t,{default:()=>o});var s=r(5043),a=r(5560),n=r(9550),i=r(579);const o=()=>{const[e,t]=(0,s.useState)([]),[r,o]=(0,s.useState)(!0),[c,l]=(0,s.useState)(null),[d,h]=(0,s.useState)("all"),[u,g]=(0,s.useState)("overview");(0,s.useEffect)(()=>{m();const e=setInterval(m,3e4);return()=>clearInterval(e)},[]);const m=async()=>{try{const e=await a.K.getAlerts();t(e),o(!1)}catch(e){l(e instanceof Error?e.message:"An error occurred"),o(!1)}},y=e=>{switch(e){case"critical":return"status-critical";case"warning":return"status-warning";case"info":return"status-info";default:return"status-offline"}},p=e=>{switch(e){case"critical":return"\ud83d\udea8";case"warning":return"\u26a0\ufe0f";case"info":return"\u2139\ufe0f";default:return"\u2753"}},x=e.filter(e=>"all"===d||e.severity===d),f=e.filter(e=>!e.resolved);return r?(0,i.jsx)("div",{className:"loading",children:"Loading alerts..."}):c?(0,i.jsxs)("div",{className:"error",children:["Error: ",c]}):(0,i.jsxs)("div",{className:"admin-container",children:[(0,i.jsxs)("div",{className:"admin-header",style:{marginBottom:"2rem"},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h1",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[(0,i.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),(0,i.jsx)("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),(0,i.jsx)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),"System Alerts"]}),(0,i.jsx)("p",{style:{color:"var(--text-secondary)",margin:0},children:"Monitor and track system alerts and notifications"})]}),(0,i.jsx)("div",{className:"health-status",children:(0,i.jsxs)("span",{className:"status-badge ".concat(0===f.length?"status-badge-success":f.some(e=>"critical"===e.severity)?"status-badge-danger":"status-badge-warning"),children:[f.length," UNRESOLVED"]})})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1.5rem",borderBottom:"2px solid var(--border-color)",paddingBottom:"0"},children:[(0,i.jsxs)("button",{onClick:()=>g("overview"),style:{background:"overview"===u?"var(--primary-gradient)":"transparent",color:"overview"===u?"var(--text-primary)":"var(--text-secondary)",border:"none",padding:"0.75rem 1.5rem",cursor:"pointer",fontSize:"0.95rem",fontWeight:"overview"===u?"600":"500",borderRadius:"8px 8px 0 0",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,i.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("rect",{x:"3",y:"3",width:"7",height:"7"}),(0,i.jsx)("rect",{x:"14",y:"3",width:"7",height:"7"}),(0,i.jsx)("rect",{x:"14",y:"14",width:"7",height:"7"}),(0,i.jsx)("rect",{x:"3",y:"14",width:"7",height:"7"})]}),"Overview"]}),(0,i.jsxs)("button",{onClick:()=>g("alerts"),style:{background:"alerts"===u?"var(--primary-gradient)":"transparent",color:"alerts"===u?"var(--text-primary)":"var(--text-secondary)",border:"none",padding:"0.75rem 1.5rem",cursor:"pointer",fontSize:"0.95rem",fontWeight:"alerts"===u?"600":"500",borderRadius:"8px 8px 0 0",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,i.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),(0,i.jsx)("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),(0,i.jsx)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),"All Alerts (",x.length,")"]}),(0,i.jsxs)("button",{onClick:()=>g("analytics"),style:{background:"analytics"===u?"var(--primary-gradient)":"transparent",color:"analytics"===u?"var(--text-primary)":"var(--text-secondary)",border:"none",padding:"0.75rem 1.5rem",cursor:"pointer",fontSize:"0.95rem",fontWeight:"analytics"===u?"600":"500",borderRadius:"8px 8px 0 0",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,i.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M3 3v18h18"}),(0,i.jsx)("path",{d:"M18 17V9"}),(0,i.jsx)("path",{d:"M13 17V5"}),(0,i.jsx)("path",{d:"M8 17v-3"})]}),"Analytics"]})]}),"overview"===u&&(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem"},children:[(0,i.jsxs)("div",{className:"admin-card",children:[(0,i.jsxs)("h2",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1.5rem"},children:[(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M3 3v18h18"}),(0,i.jsx)("path",{d:"M18 17V9"}),(0,i.jsx)("path",{d:"M13 17V5"}),(0,i.jsx)("path",{d:"M8 17v-3"})]}),"Alert Summary"]}),(0,i.jsxs)("div",{style:{display:"grid",gap:"1rem"},children:[(0,i.jsxs)("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderRadius:"8px"},children:[(0,i.jsx)("p",{style:{margin:0,fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Total Alerts"}),(0,i.jsx)("p",{style:{margin:"0.25rem 0 0",fontSize:"2rem",fontWeight:"800",fontFamily:"monospace"},children:e.length})]}),(0,i.jsxs)("div",{style:{padding:"1rem",background:"rgba(239, 68, 68, 0.1)",borderRadius:"8px",border:"1px solid rgba(239, 68, 68, 0.2)"},children:[(0,i.jsx)("p",{style:{margin:0,fontSize:"0.85rem",color:"#ef4444"},children:"Unresolved"}),(0,i.jsx)("p",{style:{margin:"0.25rem 0 0",fontSize:"2rem",fontWeight:"800",fontFamily:"monospace",color:"#ef4444"},children:f.length})]}),(0,i.jsxs)("div",{style:{padding:"1rem",background:"rgba(220, 38, 38, 0.1)",borderRadius:"8px",border:"1px solid rgba(220, 38, 38, 0.2)"},children:[(0,i.jsx)("p",{style:{margin:0,fontSize:"0.85rem",color:"#dc2626"},children:"Critical"}),(0,i.jsx)("p",{style:{margin:"0.25rem 0 0",fontSize:"2rem",fontWeight:"800",fontFamily:"monospace",color:"#dc2626"},children:e.filter(e=>"critical"===e.severity).length})]}),(0,i.jsxs)("div",{style:{padding:"1rem",background:"rgba(245, 158, 11, 0.1)",borderRadius:"8px",border:"1px solid rgba(245, 158, 11, 0.2)"},children:[(0,i.jsx)("p",{style:{margin:0,fontSize:"0.85rem",color:"#f59e0b"},children:"Warnings"}),(0,i.jsx)("p",{style:{margin:"0.25rem 0 0",fontSize:"2rem",fontWeight:"800",fontFamily:"monospace",color:"#f59e0b"},children:e.filter(e=>"warning"===e.severity).length})]})]})]}),(0,i.jsxs)("div",{className:"admin-card",children:[(0,i.jsxs)("h2",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1.5rem"},children:[(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,i.jsx)("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),"Filter by Severity"]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{children:"Severity Level"}),(0,i.jsxs)("select",{className:"form-control",value:d,onChange:e=>h(e.target.value),style:{padding:"0.75rem",borderRadius:"8px",border:"1px solid var(--border-color)",background:"var(--bg-secondary)"},children:[(0,i.jsx)("option",{value:"all",children:"All Severities"}),(0,i.jsx)("option",{value:"critical",children:"Critical"}),(0,i.jsx)("option",{value:"warning",children:"Warning"}),(0,i.jsx)("option",{value:"info",children:"Info"})]})]}),(0,i.jsxs)("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"var(--bg-secondary)",borderRadius:"8px"},children:[(0,i.jsx)("p",{style:{margin:0,fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Filtered Results"}),(0,i.jsxs)("p",{style:{margin:"0.25rem 0 0",fontSize:"1.5rem",fontWeight:"700"},children:[x.length," alerts"]})]})]})]}),"alerts"===u&&(0,i.jsxs)("div",{className:"admin-card",children:[(0,i.jsxs)("h2",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1.5rem"},children:[(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),(0,i.jsx)("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),(0,i.jsx)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),"Active Alerts (",x.length,")"]}),0===x.length?(0,i.jsxs)("div",{style:{textAlign:"center",padding:"3rem 1rem",color:"var(--text-secondary)"},children:[(0,i.jsxs)("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",style:{margin:"0 auto 1rem",opacity:.3},children:[(0,i.jsx)("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),(0,i.jsx)("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),(0,i.jsx)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),(0,i.jsx)("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:"No alerts found"}),(0,i.jsx)("p",{style:{fontSize:"0.9rem"},children:"All systems are running smoothly"})]}):(0,i.jsx)("div",{className:"alerts-list",children:x.map(e=>(0,i.jsxs)("div",{className:"alert-item ".concat(y(e.severity)),style:{border:"1px solid var(--border-color)",borderRadius:"12px",padding:"1.25rem",marginBottom:"1rem",background:"var(--bg-secondary)",transition:"all 0.2s",borderLeft:"4px solid ".concat("critical"===e.severity?"#ef4444":"warning"===e.severity?"#f59e0b":"#3b82f6")},children:[(0,i.jsxs)("div",{className:"alert-header",style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.75rem",flexWrap:"wrap"},children:[(0,i.jsx)("span",{className:"alert-icon",style:{fontSize:"1.5rem"},children:p(e.severity)}),(0,i.jsx)("span",{className:"alert-type",style:{background:"var(--bg-tertiary)",padding:"0.25rem 0.75rem",borderRadius:"6px",fontSize:"0.85rem",fontWeight:"600"},children:e.type.replace("_"," ").toUpperCase()}),(0,i.jsxs)("span",{className:"alert-device",style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:["Device: ",e.device_id]}),(0,i.jsx)("span",{className:"alert-time",style:{marginLeft:"auto",color:"var(--text-secondary)",fontSize:"0.8rem"},children:new Date(e.timestamp).toLocaleString()})]}),(0,i.jsx)("div",{className:"alert-message",style:{color:"var(--text-primary)",marginBottom:"0.75rem",fontSize:"0.95rem"},children:e.message}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid var(--border-color)"},children:[(0,i.jsx)("div",{className:"alert-status",style:{padding:"0.25rem 0.75rem",borderRadius:"6px",fontSize:"0.8rem",fontWeight:"600",background:e.resolved?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)",color:e.resolved?"#10b981":"#ef4444"},children:e.resolved?"\u2713 Resolved":"\u25cf Active"}),(0,i.jsx)(n.A,{createdBy:e.created_by_username,createdAt:e.created_at})]})]},e.id))})]}),"analytics"===u&&(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem"},children:[(0,i.jsxs)("div",{className:"admin-card",children:[(0,i.jsxs)("h2",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1.5rem"},children:[(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,i.jsx)("path",{d:"M12 6v6l4 2"})]}),"By Severity"]}),(0,i.jsx)("div",{style:{display:"grid",gap:"1rem"},children:[{severity:"critical",count:e.filter(e=>"critical"===e.severity).length,color:"#ef4444",label:"Critical"},{severity:"warning",count:e.filter(e=>"warning"===e.severity).length,color:"#f59e0b",label:"Warnings"},{severity:"info",count:e.filter(e=>"info"===e.severity).length,color:"#3b82f6",label:"Info"}].map(e=>(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem",background:"".concat(e.color,"15"),borderRadius:"8px",border:"1px solid ".concat(e.color,"40")},children:[(0,i.jsx)("span",{style:{fontWeight:"600",color:e.color},children:e.label}),(0,i.jsx)("span",{style:{fontSize:"1.5rem",fontWeight:"800",fontFamily:"monospace",color:e.color},children:e.count})]},e.severity))})]}),(0,i.jsxs)("div",{className:"admin-card",children:[(0,i.jsxs)("h2",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1.5rem"},children:[(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,i.jsx)("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})}),"By Status"]}),(0,i.jsxs)("div",{style:{display:"grid",gap:"1rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem",background:"rgba(16, 185, 129, 0.1)",borderRadius:"8px",border:"1px solid rgba(16, 185, 129, 0.3)"},children:[(0,i.jsx)("span",{style:{fontWeight:"600",color:"#10b981"},children:"Resolved"}),(0,i.jsx)("span",{style:{fontSize:"1.5rem",fontWeight:"800",fontFamily:"monospace",color:"#10b981"},children:e.filter(e=>e.resolved).length})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem",background:"rgba(239, 68, 68, 0.1)",borderRadius:"8px",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[(0,i.jsx)("span",{style:{fontWeight:"600",color:"#ef4444"},children:"Unresolved"}),(0,i.jsx)("span",{style:{fontSize:"1.5rem",fontWeight:"800",fontFamily:"monospace",color:"#ef4444"},children:f.length})]}),(0,i.jsxs)("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderRadius:"8px",textAlign:"center"},children:[(0,i.jsx)("p",{style:{margin:0,fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Resolution Rate"}),(0,i.jsxs)("p",{style:{margin:"0.25rem 0 0",fontSize:"2rem",fontWeight:"800",fontFamily:"monospace"},children:[e.length>0?Math.round(e.filter(e=>e.resolved).length/e.length*100):0,"%"]})]})]})]}),(0,i.jsxs)("div",{className:"admin-card",style:{gridColumn:"span 2"},children:[(0,i.jsxs)("h2",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1.5rem"},children:[(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),(0,i.jsx)("path",{d:"M8 21h8M12 17v4"})]}),"Recent Critical Alerts"]}),0===e.filter(e=>"critical"===e.severity).length?(0,i.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"var(--text-secondary)"},children:(0,i.jsx)("p",{children:"No critical alerts - system is stable"})}):(0,i.jsx)("div",{style:{display:"grid",gap:"0.75rem"},children:e.filter(e=>"critical"===e.severity).slice(0,5).map(e=>(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1rem",background:"rgba(239, 68, 68, 0.05)",borderRadius:"8px",borderLeft:"4px solid #ef4444"},children:[(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("strong",{style:{color:"#ef4444",fontSize:"0.9rem"},children:e.type.replace("_"," ").toUpperCase()}),(0,i.jsx)("p",{style:{margin:"0.25rem 0 0",fontSize:"0.85rem",color:"var(--text-secondary)"},children:e.message})]}),(0,i.jsx)("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"6px",fontSize:"0.75rem",fontWeight:"600",background:e.resolved?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)",color:e.resolved?"#10b981":"#ef4444",whiteSpace:"nowrap",marginLeft:"1rem"},children:e.resolved?"Resolved":"Active"})]},e.id))})]})]})]})}},9550(e,t,r){r.d(t,{A:()=>i});var s=r(5043),a=r(579);const n=e=>{let{createdBy:t,createdAt:r,updatedBy:s,updatedAt:n,className:i="audit-trail"}=e;const o=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleString()}catch(t){return e}};return(0,a.jsxs)("div",{className:i,children:[(0,a.jsxs)("div",{className:"audit-row",children:[(0,a.jsx)("span",{className:"audit-label",children:"Created:"}),t?(0,a.jsxs)("span",{className:"audit-value",children:["by ",(0,a.jsx)("strong",{children:t})," on ",o(r)]}):(0,a.jsx)("span",{className:"audit-value",children:"System"})]}),s&&(0,a.jsxs)("div",{className:"audit-row",children:[(0,a.jsx)("span",{className:"audit-label",children:"Last Updated:"}),(0,a.jsxs)("span",{className:"audit-value",children:["by ",(0,a.jsx)("strong",{children:s})," on ",o(n)]})]})]})},i=s.memo(n)},5560(e,t,r){r.d(t,{K:()=>c});var s=r(2555);class a{constructor(){this.cache=new Map,this.subscribers=new Map}set(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.DEFAULT_TTL,s=arguments.length>3?arguments[3]:void 0;this.cache.set(e,{data:t,timestamp:Date.now(),expiresIn:r,staleTime:null!==s&&void 0!==s?s:Math.min(r/2,a.STALE_TIME)}),this.notifySubscribers(e,t)}get(e){const t=this.cache.get(e);if(!t)return null;return Date.now()-t.timestamp>t.expiresIn?(this.cache.delete(e),null):t.data}getWithStaleStatus(e){var t;const r=this.cache.get(e);if(!r)return null;const s=Date.now()-r.timestamp,a=s>r.expiresIn,n=s>(null!==(t=r.staleTime)&&void 0!==t?t:r.expiresIn/2);return a?(this.cache.delete(e),null):{data:r.data,isStale:n,isExpired:!1}}has(e){const t=this.cache.get(e);if(!t)return!1;return!(Date.now()-t.timestamp>t.expiresIn)||(this.cache.delete(e),!1)}isStale(e){var t;const r=this.cache.get(e);if(!r)return!0;return Date.now()-r.timestamp>(null!==(t=r.staleTime)&&void 0!==t?t:r.expiresIn/2)}clear(e){this.cache.delete(e)}clearPattern(e){const t="string"===typeof e?new RegExp(e):e,r=[];this.cache.forEach((e,s)=>{t.test(s)&&r.push(s)}),r.forEach(e=>this.cache.delete(e))}clearAll(){this.cache.clear()}size(){return this.cache.size}subscribe(e,t){this.subscribers.has(e)||this.subscribers.set(e,new Set);const r={callback:t};return this.subscribers.get(e).add(r),()=>{const t=this.subscribers.get(e);t&&(t.delete(r),0===t.size&&this.subscribers.delete(e))}}subscribePattern(e,t){const r="__pattern__".concat(e.source);this.subscribers.has(r)||this.subscribers.set(r,new Set);const s={callback:t,pattern:e};return this.subscribers.get(r).add(s),()=>{const e=this.subscribers.get(r);e&&(e.delete(s),0===e.size&&this.subscribers.delete(r))}}notifySubscribers(e,t){const r=this.subscribers.get(e);r&&r.forEach(r=>{try{r.callback(t)}catch(s){console.error("Cache subscriber error for key ".concat(e,":"),s)}}),this.subscribers.forEach((r,s)=>{s.startsWith("__pattern__")&&r.forEach(r=>{if(r.pattern&&r.pattern.test(e))try{r.callback(t)}catch(s){console.error("Cache pattern subscriber error for key ".concat(e,":"),s)}})})}keys(){return Array.from(this.cache.keys())}getStats(){return{size:this.cache.size,keys:this.keys(),subscribers:Array.from(this.subscribers.values()).reduce((e,t)=>e+t.size,0)}}static getTTL(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short"){case"realtime":return a.REALTIME_TTL;case"long":return a.LONG_TTL;default:return a.DEFAULT_TTL}}}a.DEFAULT_TTL=3e5,a.LONG_TTL=18e5,a.REALTIME_TTL=1e4,a.STALE_TIME=3e4;const n=new a,i=3e5,o="https://smart-solar-django-backend.vercel.app/api";const c=new class{getAuthHeaders(){const e=localStorage.getItem("authTokens");if(e)try{const t=JSON.parse(e);return{Authorization:"Bearer ".concat(t.access),"Content-Type":"application/json"}}catch(t){console.error("Error parsing auth tokens:",t)}return{"Content-Type":"application/json"}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r="".concat(o).concat(e);let a=this.getAuthHeaders(),n=await fetch(r,(0,s.A)((0,s.A)({},t),{},{headers:(0,s.A)((0,s.A)({},a),t.headers)}));if(401===n.status){await this.refreshToken()&&(a=this.getAuthHeaders(),n=await fetch(r,(0,s.A)((0,s.A)({},t),{},{headers:(0,s.A)((0,s.A)({},a),t.headers)})))}if(401===n.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!n.ok){const e=await n.text();throw new Error("API request failed: ".concat(n.status," ").concat(n.statusText," - ").concat(e))}return 204===n.status?null:n.json()}async refreshToken(){const e=localStorage.getItem("authTokens");if(!e)return!1;try{const t=JSON.parse(e),r=await fetch("".concat(o,"/auth/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t.refresh})});if(r.ok){const e={access:(await r.json()).access,refresh:t.refresh};return localStorage.setItem("authTokens",JSON.stringify(e)),!0}}catch(t){console.error("Token refresh failed:",t)}return!1}async getConfiguration(){return this.request("/config/")}async getTelemetry(){return this.request("/telemetry/")}async provisionDevice(e){const t=await fetch("".concat(o,"/devices/provision"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Provisioning failed: ".concat(t.statusText));return t.json()}async getAlerts(){const e="alerts",t=n.get(e);if(t)return t;const r=await this.request("/alerts/");return n.set(e,r,i),r}async getSystemHealth(){const e="system_health",t=n.get(e);if(t)return t;const r=await this.request("/health/");return n.set(e,r,i),r}async getKPIs(){const e="kpis",t=n.get(e);if(t)return t;const r=await this.request("/kpis/");return n.set(e,r,i),r}async getUsers(e){const t="users_".concat(e||"all"),r=n.get(t);if(r)return r;const s=e?"?search=".concat(encodeURIComponent(e)):"",a=await this.request("/users/".concat(s));return n.set(t,a,i),a}async createUser(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("users_all"),n.clearAll(),t}async createEmployee(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify((0,s.A)((0,s.A)({},e),{},{is_staff:!0}))});return n.clear("users_all"),t}async getUserDevices(e){return this.request("/users/".concat(e,"/devices/"))}async getUserSite(e){return this.request("/users/".concat(e,"/site/"))}async createUserSite(e,t){return this.request("/users/".concat(e,"/site/"),{method:"POST",body:JSON.stringify(t)})}async updateUserSite(e,t){return this.request("/users/".concat(e,"/site/update/"),{method:"PUT",body:JSON.stringify(t)})}async getDeviceSite(e){return this.request("/devices/".concat(e,"/site/"))}async createDeviceSite(e,t){return this.request("/devices/".concat(e,"/site/"),{method:"POST",body:JSON.stringify(t)})}async updateDeviceSite(e,t){return this.request("/devices/".concat(e,"/site/update/"),{method:"PUT",body:JSON.stringify(t)})}async getSiteTelemetry(e,t){const r=new URLSearchParams;null!==t&&void 0!==t&&t.start_date&&r.append("start_date",t.start_date),null!==t&&void 0!==t&&t.end_date&&r.append("end_date",t.end_date),null!==t&&void 0!==t&&t.days&&r.append("days",t.days.toString());const s="/sites/".concat(e,"/telemetry/").concat(r.toString()?"?"+r.toString():"");return this.request(s)}async getSiteForecast(e,t){const r=new URLSearchParams;null!==t&&void 0!==t&&t.date&&r.append("date",t.date),null!==t&&void 0!==t&&t.start_date&&r.append("start_date",t.start_date),null!==t&&void 0!==t&&t.end_date&&r.append("end_date",t.end_date);const s="/sites/".concat(e,"/forecast/").concat(r.toString()?"?"+r.toString():"");return this.request(s)}async getSiteWeather(e){return this.request("/sites/".concat(e,"/weather/"))}async updateUser(e,t){const r=await this.request("/users/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("users_all"),r}async deleteUser(e){const t=await this.request("/users/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("users_all"),t}async getProfile(){return this.request("/profile/")}async updateProfile(e){return this.request("/profile/update/",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e){return this.request("/profile/change-password/",{method:"POST",body:JSON.stringify(e)})}async getCustomers(e){const t=e?"?search=".concat(encodeURIComponent(e)):"";return this.request("/customers/".concat(t))}async createCustomer(e){return this.request("/customers/create/",{method:"POST",body:JSON.stringify(e)})}async getCustomer(e){return this.request("/customers/".concat(e,"/"))}async updateCustomer(e,t){return this.request("/customers/".concat(e,"/update/"),{method:"PUT",body:JSON.stringify(t)})}async deleteCustomer(e){return this.request("/customers/".concat(e,"/delete/"),{method:"DELETE"})}async getPresets(){const e="presets",t=n.get(e);if(t)return t;const r=await this.request("/presets/");return n.set(e,r,18e5),r}async createPreset(e){const t=await this.request("/presets/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("presets"),t}async updatePreset(e,t){const r=await this.request("/presets/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("presets"),r}async deletePreset(e){const t=await this.request("/presets/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("presets"),t}async getGlobalSlaves(){return this.request("/slaves/")}async createGlobalSlave(e){return this.request("/slaves/create/",{method:"POST",body:JSON.stringify(e)})}async updateGlobalSlave(e,t){return this.request("/slaves/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteGlobalSlave(e){return this.request("/slaves/".concat(e,"/delete/"),{method:"DELETE"})}async getDevices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;const s=new URLSearchParams;e&&s.append("search",e),s.append("page",t.toString()),s.append("page_size",r.toString());const a=s.toString();return this.request("/devices/?".concat(a))}async createDevice(e){return this.request("/devices/create/",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,t){return this.request("/devices/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteDevice(e){return this.request("/devices/".concat(e,"/delete/"),{method:"DELETE"})}async rebootDevice(e){return this.request("/devices/".concat(e,"/reboot/"),{method:"POST"})}async hardResetDevice(e){return this.request("/devices/".concat(e,"/hard-reset/"),{method:"POST"})}async getDeviceLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.request("/devices/".concat(e,"/logs/?limit=").concat(t,"&offset=").concat(r))}async toggleDeviceLogs(e,t){return this.request("/devices/".concat(e,"/logs/toggle/"),{method:"POST",body:JSON.stringify({enabled:t})})}async deleteDevicesBulk(e){return this.request("/devices/delete-bulk/",{method:"POST",body:JSON.stringify({device_ids:e})})}async getSlaves(e){return this.request("/presets/".concat(e,"/slaves/"))}async createSlave(e,t){return this.request("/presets/".concat(e,"/slaves/create/"),{method:"POST",body:JSON.stringify(t)})}async updateSlave(e,t,r){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/"),{method:"PUT",body:JSON.stringify(r)})}async deleteSlave(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/delete/"),{method:"DELETE"})}async addSlavesToPreset(e,t){return this.request("/presets/".concat(e,"/slaves/add/"),{method:"POST",body:JSON.stringify({slave_ids:t})})}async detachSlaveFromPreset(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/detach/"),{method:"POST"})}async getFirmwareVersions(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=new URLSearchParams;return t.append("active",e.toString()),this.request("/ota/firmware/?".concat(t.toString()))}async uploadFirmwareVersion(e){const t="".concat(o,"/ota/firmware/create/"),r=localStorage.getItem("authTokens");if(!r)throw new Error("Authentication required");const s=JSON.parse(r);let a={Authorization:"Bearer ".concat(s.access)},n=await fetch(t,{method:"POST",headers:a,body:e});if(401===n.status){if(await this.refreshToken()){const r=JSON.parse(localStorage.getItem("authTokens")||"{}");a={Authorization:"Bearer ".concat(r.access)},n=await fetch(t,{method:"POST",headers:a,body:e})}}if(401===n.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!n.ok){const e=await n.text();throw new Error("Upload failed: ".concat(n.status," ").concat(n.statusText," - ").concat(e))}return n.json()}async updateFirmwareVersion(e,t){return this.request("/ota/firmware/".concat(e,"/"),{method:"PATCH",body:JSON.stringify(t)})}async deleteFirmwareVersion(e){return this.request("/ota/firmware/".concat(e,"/delete/"),{method:"DELETE"})}async getDeviceUpdateLogs(e){return this.request("/ota/devices/".concat(e,"/logs"))}async getOTAConfig(){return this.request("/ota/config/")}async updateOTAConfig(e){return this.request("/ota/config/update/",{method:"PATCH",body:JSON.stringify(e)})}async getOTAHealth(){return this.request("/ota/health/")}async triggerRollback(e,t){return this.request("/ota/updates/rollback/",{method:"POST",body:JSON.stringify({device_serial:e,notes:t||""})})}}}}]);
//# sourceMappingURL=192.96d5ba55.chunk.js.map