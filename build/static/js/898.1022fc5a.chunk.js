"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[898],{9550(e,t,s){s.d(t,{A:()=>o});var a=s(5043),r=s(579);const n=e=>{let{createdBy:t,createdAt:s,updatedBy:a,updatedAt:n,className:o="audit-trail"}=e;const c=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleString()}catch(t){return e}};return(0,r.jsxs)("div",{className:o,children:[(0,r.jsxs)("div",{className:"audit-row",children:[(0,r.jsx)("span",{className:"audit-label",children:"Created:"}),t?(0,r.jsxs)("span",{className:"audit-value",children:["by ",(0,r.jsx)("strong",{children:t})," on ",c(s)]}):(0,r.jsx)("span",{className:"audit-value",children:"System"})]}),a&&(0,r.jsxs)("div",{className:"audit-row",children:[(0,r.jsx)("span",{className:"audit-label",children:"Last Updated:"}),(0,r.jsxs)("span",{className:"audit-value",children:["by ",(0,r.jsx)("strong",{children:a})," on ",c(n)]})]})]})},o=a.memo(n)},898(e,t,s){s.r(t),s.d(t,{default:()=>i});var a=s(2555),r=s(5043),n=s(5560),o=s(9550),c=s(579);const i=()=>{const[e,t]=(0,r.useState)([]),[s,i]=(0,r.useState)([]),[l,d]=(0,r.useState)(!0),[u,h]=(0,r.useState)(null),[m,p]=(0,r.useState)(null),[y,g]=(0,r.useState)(!1),[f,x]=(0,r.useState)(""),[v,j]=(0,r.useState)({first_name:"",last_name:"",email:"",mobile_number:"",address:""}),[b,S]=(0,r.useState)({username:"",email:"",password:"",first_name:"",last_name:"",mobile_number:"",address:"",is_staff:!0});(0,r.useEffect)(()=>{w()},[]);const[A,N]=(0,r.useState)("");(0,r.useEffect)(()=>{const e=setTimeout(()=>{N(f)},300);return()=>clearTimeout(e)},[f]),(0,r.useEffect)(()=>{w(A)},[A]);const w=async e=>{try{const s=(await n.K.getUsers(e)).filter(e=>e.is_staff&&!e.is_superuser);t(s),i(s),d(!1)}catch(s){h(s instanceof Error?s.message:"An error occurred"),d(!1)}};return l?(0,c.jsx)("div",{className:"loading",children:"Loading employees..."}):u?(0,c.jsxs)("div",{className:"error",children:["Error: ",u]}):(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{children:"Employee Management"}),(0,c.jsxs)("div",{className:"card",children:[(0,c.jsxs)("div",{className:"card-header",children:[(0,c.jsxs)("h2",{children:["Employees (",s.length,")"]}),(0,c.jsxs)("div",{className:"card-actions",children:[(0,c.jsx)("input",{type:"text",placeholder:"Search employees...",value:f,onChange:e=>{x(e.target.value)},className:"search-input"}),(0,c.jsx)("button",{onClick:()=>g(!0),className:"btn",children:"Add New Employee"})]})]}),(0,c.jsxs)("table",{className:"table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{style:{textAlign:"center"},children:"Name"}),(0,c.jsx)("th",{style:{textAlign:"center"},children:"Username"}),(0,c.jsx)("th",{style:{textAlign:"center"},children:"Email"}),(0,c.jsx)("th",{style:{textAlign:"center"},children:"Mobile"}),(0,c.jsx)("th",{style:{textAlign:"center"},children:"Joined"}),(0,c.jsx)("th",{style:{textAlign:"center"},children:"Actions"})]})}),(0,c.jsx)("tbody",{children:s.map(a=>(0,c.jsxs)("tr",{children:[(0,c.jsxs)("td",{children:[a.first_name," ",a.last_name]}),(0,c.jsx)("td",{children:a.username}),(0,c.jsx)("td",{children:a.email}),(0,c.jsx)("td",{children:a.mobile_number||"-"}),(0,c.jsx)("td",{children:(()=>{if(!a.date_joined)return"N/A";const e=new Date(a.date_joined);return isNaN(e.getTime())?"Invalid Date":e.toLocaleDateString()})()}),(0,c.jsxs)("td",{children:[(0,c.jsx)("button",{onClick:()=>(e=>{p(e),j({first_name:e.first_name,last_name:e.last_name,email:e.email,mobile_number:e.mobile_number||"",address:e.address||""})})(a),style:{background:"none",border:"none",cursor:"pointer"},title:"Edit",children:(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,c.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,c.jsx)("button",{onClick:()=>(async a=>{if(window.confirm("Are you sure you want to delete employee ".concat(a.username,"?")))try{await n.K.deleteUser(a.id),t(e.filter(e=>e.id!==a.id)),i(s.filter(e=>e.id!==a.id))}catch(r){h(r instanceof Error?r.message:"Failed to delete employee")}})(a),style:{background:"none",border:"none",cursor:"pointer",color:"red"},title:"Delete",children:(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,c.jsx)("path",{d:"M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"}),(0,c.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,c.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]},a.id))})]})]}),(m||y)&&(0,c.jsx)("div",{className:"modal",children:(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsx)("h3",{children:m?"Edit Employee: ".concat(m.username):"Add New Employee"}),(0,c.jsxs)("form",{onSubmit:e=>{e.preventDefault(),m?(async()=>{if(m)try{await n.K.updateUser(m.id,v),p(null),await w(f)}catch(e){h(e instanceof Error?e.message:"Failed to update employee")}})():(async()=>{try{await n.K.createEmployee(b),g(!1),S({username:"",email:"",password:"",first_name:"",last_name:"",mobile_number:"",address:"",is_staff:!0}),await w(f)}catch(e){h(e instanceof Error?e.message:"Failed to create employee")}})()},children:[(0,c.jsxs)("div",{className:"modal-body",children:[(0,c.jsxs)("div",{className:"form-section",children:[(0,c.jsx)("h4",{className:"form-section-title",children:"Account Information"}),(0,c.jsxs)("div",{className:"form-grid",children:[y&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("input",{type:"text",autoComplete:"username",style:{display:"none"}}),(0,c.jsx)("input",{type:"password",autoComplete:"current-password",style:{display:"none"}}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Username"}),(0,c.jsx)("input",{type:"text",value:b.username,onChange:e=>S((0,a.A)((0,a.A)({},b),{},{username:e.target.value})),required:!0,autoComplete:"off",placeholder:"jdoe"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Password"}),(0,c.jsx)("input",{type:"password",value:b.password,onChange:e=>S((0,a.A)((0,a.A)({},b),{},{password:e.target.value})),required:!0,autoComplete:"new-password",placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"})]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Email Address"}),(0,c.jsx)("input",{type:"email",value:m?v.email:b.email,onChange:e=>m?j((0,a.A)((0,a.A)({},v),{},{email:e.target.value})):S((0,a.A)((0,a.A)({},b),{},{email:e.target.value})),required:!0,autoComplete:"off",placeholder:"john.doe@example.com"})]})]})]}),(0,c.jsxs)("div",{className:"form-section",children:[(0,c.jsx)("h4",{className:"form-section-title",children:"Personal Details"}),(0,c.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"First Name"}),(0,c.jsx)("input",{type:"text",value:m?v.first_name:b.first_name,onChange:e=>m?j((0,a.A)((0,a.A)({},v),{},{first_name:e.target.value})):S((0,a.A)((0,a.A)({},b),{},{first_name:e.target.value})),required:!0,autoComplete:"off",placeholder:"John"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Last Name"}),(0,c.jsx)("input",{type:"text",value:m?v.last_name:b.last_name,onChange:e=>m?j((0,a.A)((0,a.A)({},v),{},{last_name:e.target.value})):S((0,a.A)((0,a.A)({},b),{},{last_name:e.target.value})),required:!0,autoComplete:"off",placeholder:"Doe"})]})]})]}),(0,c.jsxs)("div",{className:"form-section",children:[(0,c.jsx)("h4",{className:"form-section-title",children:"Contact Information"}),(0,c.jsxs)("div",{className:"form-grid",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Mobile Number"}),(0,c.jsx)("input",{type:"tel",value:m?v.mobile_number:b.mobile_number,onChange:e=>m?j((0,a.A)((0,a.A)({},v),{},{mobile_number:e.target.value})):S((0,a.A)((0,a.A)({},b),{},{mobile_number:e.target.value})),autoComplete:"off",placeholder:"+1 (555) 000-0000"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Address"}),(0,c.jsx)("textarea",{value:m?v.address:b.address,onChange:e=>m?j((0,a.A)((0,a.A)({},v),{},{address:e.target.value})):S((0,a.A)((0,a.A)({},b),{},{address:e.target.value})),autoComplete:"off",rows:3,placeholder:"123 Solar Street..."})]})]})]})]}),m&&(0,c.jsx)(o.A,{createdBy:m.created_by_username,createdAt:m.created_at,updatedBy:m.updated_by_username,updatedAt:m.updated_at}),(0,c.jsxs)("div",{className:"form-actions",children:[(0,c.jsx)("button",{type:"submit",className:"btn",children:m?"Save":"Create"}),(0,c.jsx)("button",{type:"button",onClick:()=>{p(null),g(!1)},className:"btn btn-secondary",children:"Cancel"})]})]})]})})]})}},5560(e,t,s){s.d(t,{K:()=>i});var a=s(2555);class r{constructor(){this.cache=new Map}set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.DEFAULT_TTL;this.cache.set(e,{data:t,timestamp:Date.now(),expiresIn:s})}get(e){const t=this.cache.get(e);if(!t)return null;return Date.now()-t.timestamp>t.expiresIn?(this.cache.delete(e),null):t.data}has(e){const t=this.cache.get(e);if(!t)return!1;return!(Date.now()-t.timestamp>t.expiresIn)||(this.cache.delete(e),!1)}clear(e){this.cache.delete(e)}clearAll(){this.cache.clear()}size(){return this.cache.size}static getTTL(){return"long"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short")?r.LONG_TTL:r.DEFAULT_TTL}}r.DEFAULT_TTL=3e5,r.LONG_TTL=18e5;const n=new r,o=3e5,c="https://smart-solar-django-backend.vercel.app/api";const i=new class{getAuthHeaders(){const e=localStorage.getItem("authTokens");if(e)try{const t=JSON.parse(e);return{Authorization:"Bearer ".concat(t.access),"Content-Type":"application/json"}}catch(t){console.error("Error parsing auth tokens:",t)}return{"Content-Type":"application/json"}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s="".concat(c).concat(e);let r=this.getAuthHeaders(),n=await fetch(s,(0,a.A)((0,a.A)({},t),{},{headers:(0,a.A)((0,a.A)({},r),t.headers)}));if(401===n.status){await this.refreshToken()&&(r=this.getAuthHeaders(),n=await fetch(s,(0,a.A)((0,a.A)({},t),{},{headers:(0,a.A)((0,a.A)({},r),t.headers)})))}if(401===n.status)throw localStorage.removeItem("authTokens"),localStorage.removeItem("authUser"),window.location.href="/login",new Error("Authentication required");if(!n.ok){const e=await n.text();throw new Error("API request failed: ".concat(n.status," ").concat(n.statusText," - ").concat(e))}return n.json()}async refreshToken(){const e=localStorage.getItem("authTokens");if(!e)return!1;try{const t=JSON.parse(e),s=await fetch("".concat(c,"/auth/token/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:t.refresh})});if(s.ok){const e={access:(await s.json()).access,refresh:t.refresh};return localStorage.setItem("authTokens",JSON.stringify(e)),!0}}catch(t){console.error("Token refresh failed:",t)}return!1}async getConfiguration(){return this.request("/config/")}async getTelemetry(){return this.request("/telemetry/")}async provisionDevice(e){const t=await fetch("".concat(c,"/devices/provision"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Provisioning failed: ".concat(t.statusText));return t.json()}async getAlerts(){const e="alerts",t=n.get(e);if(t)return t;const s=await this.request("/alerts/");return n.set(e,s,o),s}async getSystemHealth(){const e="system_health",t=n.get(e);if(t)return t;const s=await this.request("/health/");return n.set(e,s,o),s}async getKPIs(){const e="kpis",t=n.get(e);if(t)return t;const s=await this.request("/kpis/");return n.set(e,s,o),s}async getUsers(e){const t="users_".concat(e||"all"),s=n.get(t);if(s)return s;const a=e?"?search=".concat(encodeURIComponent(e)):"",r=await this.request("/users/".concat(a));return n.set(t,r,o),r}async createUser(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("users_all"),n.clearAll(),t}async createEmployee(e){const t=await this.request("/users/create/",{method:"POST",body:JSON.stringify((0,a.A)((0,a.A)({},e),{},{is_staff:!0}))});return n.clear("users_all"),t}async getUserDevices(e){return this.request("/users/".concat(e,"/devices/"))}async updateUser(e,t){const s=await this.request("/users/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("users_all"),s}async deleteUser(e){const t=await this.request("/users/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("users_all"),t}async getProfile(){return this.request("/profile/")}async updateProfile(e){return this.request("/profile/update/",{method:"PUT",body:JSON.stringify(e)})}async changePassword(e){return this.request("/profile/change-password/",{method:"POST",body:JSON.stringify(e)})}async getCustomers(e){const t=e?"?search=".concat(encodeURIComponent(e)):"";return this.request("/customers/".concat(t))}async createCustomer(e){return this.request("/customers/create/",{method:"POST",body:JSON.stringify(e)})}async getCustomer(e){return this.request("/customers/".concat(e,"/"))}async updateCustomer(e,t){return this.request("/customers/".concat(e,"/update/"),{method:"PUT",body:JSON.stringify(t)})}async deleteCustomer(e){return this.request("/customers/".concat(e,"/delete/"),{method:"DELETE"})}async getPresets(){const e="presets",t=n.get(e);if(t)return t;const s=await this.request("/presets/");return n.set(e,s,18e5),s}async createPreset(e){const t=await this.request("/presets/create/",{method:"POST",body:JSON.stringify(e)});return n.clear("presets"),t}async updatePreset(e,t){const s=await this.request("/presets/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)});return n.clear("presets"),s}async deletePreset(e){const t=await this.request("/presets/".concat(e,"/delete/"),{method:"DELETE"});return n.clear("presets"),t}async getGlobalSlaves(){return this.request("/slaves/")}async createGlobalSlave(e){return this.request("/slaves/create/",{method:"POST",body:JSON.stringify(e)})}async updateGlobalSlave(e,t){return this.request("/slaves/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteGlobalSlave(e){return this.request("/slaves/".concat(e,"/delete/"),{method:"DELETE"})}async getDevices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;const a=new URLSearchParams;e&&a.append("search",e),a.append("page",t.toString()),a.append("page_size",s.toString());const r=a.toString();return this.request("/devices/?".concat(r))}async createDevice(e){return this.request("/devices/create/",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,t){return this.request("/devices/".concat(e,"/"),{method:"PUT",body:JSON.stringify(t)})}async deleteDevice(e){return this.request("/devices/".concat(e,"/delete/"),{method:"DELETE"})}async deleteDevicesBulk(e){return this.request("/devices/delete-bulk/",{method:"POST",body:JSON.stringify({device_ids:e})})}async getSlaves(e){return this.request("/presets/".concat(e,"/slaves/"))}async createSlave(e,t){return this.request("/presets/".concat(e,"/slaves/create/"),{method:"POST",body:JSON.stringify(t)})}async updateSlave(e,t,s){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/"),{method:"PUT",body:JSON.stringify(s)})}async deleteSlave(e,t){return this.request("/presets/".concat(e,"/slaves/").concat(t,"/delete/"),{method:"DELETE"})}async addSlavesToPreset(e,t){return this.request("/presets/".concat(e,"/slaves/add/"),{method:"POST",body:JSON.stringify({slave_ids:t})})}async getFirmwareVersions(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=new URLSearchParams;return t.append("active",e.toString()),this.request("/ota/firmware/?".concat(t.toString()))}async uploadFirmwareVersion(e){const t=this.getAuthHeaders();return delete t["Content-Type"],fetch("".concat(c,"/ota/firmware/create/"),{method:"POST",headers:(0,a.A)((0,a.A)({},t),{},{Authorization:"Bearer ".concat(JSON.parse(localStorage.getItem("authTokens")||"{}").access)}),body:e}).then(e=>e.json())}async updateFirmwareVersion(e,t){return this.request("/ota/firmware/".concat(e,"/"),{method:"PATCH",body:JSON.stringify(t)})}async getDeviceUpdateLogs(e){return this.request("/ota/devices/".concat(e,"/logs"))}async getOTAConfig(){return this.request("/ota/config/")}async updateOTAConfig(e){return this.request("/ota/config/update/",{method:"PATCH",body:JSON.stringify(e)})}async getOTAHealth(){return this.request("/ota/health/")}}}}]);
//# sourceMappingURL=898.1022fc5a.chunk.js.map