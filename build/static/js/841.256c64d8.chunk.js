"use strict";(self.webpackChunksmart_solar_frontend=self.webpackChunksmart_solar_frontend||[]).push([[841],{9550(e,t,r){r.d(t,{A:()=>o});var i=r(5043),n=r(579);const a=e=>{let{createdBy:t,createdAt:r,updatedBy:i,updatedAt:a,className:o="audit-trail"}=e;const s=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleString()}catch(t){return e}};return(0,n.jsxs)("div",{className:o,children:[(0,n.jsxs)("div",{className:"audit-row",children:[(0,n.jsx)("span",{className:"audit-label",children:"Created:"}),t?(0,n.jsxs)("span",{className:"audit-value",children:["by ",(0,n.jsx)("strong",{children:t})," on ",s(r)]}):(0,n.jsx)("span",{className:"audit-value",children:"System"})]}),i&&(0,n.jsxs)("div",{className:"audit-row",children:[(0,n.jsx)("span",{className:"audit-label",children:"Last Updated:"}),(0,n.jsxs)("span",{className:"audit-value",children:["by ",(0,n.jsx)("strong",{children:i})," on ",s(a)]})]})]})},o=i.memo(a)},8841(e,t,r){r.r(t),r.d(t,{default:()=>Z});var i=r(9379),n=r(5043),a=r(5475),o=r(5560);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;const r=(0,n.useRef)(null),i=(0,n.useRef)(e);(0,n.useEffect)(()=>{i.current=e},[e]);const a=(0,n.useCallback)(function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{i.current(...n)},t)},[t]);return(0,n.useEffect)(()=>()=>{r.current&&clearTimeout(r.current)},[]),a}var l=r(8421),d=r(9550),c=r(1180),m=r(877),p=r(7734),u=r(2185),x=r(6026),g=r(379),h=r(95),f=r(1385),b=r(5344),y=r(3243),v=r(768),j=r(8443),w=r(579);const k=[{id:"overview",label:"Overview",icon:"\ud83c\udfe0"},{id:"weather",label:"Weather",icon:"\ud83c\udf24"},{id:"history",label:"History",icon:"\ud83d\udcc8"},{id:"forecast",label:"Forecast",icon:"\ud83d\udd06"}],_=e=>{let{active:t,payload:r,label:i}=e;const{isDark:n}=(0,l.D)();return t&&r&&r.length?(0,w.jsxs)("div",{style:{background:n?"rgba(30,41,59,0.97)":"rgba(255,255,255,0.97)",backdropFilter:"blur(8px)",border:"1px solid ".concat(n?"rgba(148,163,184,0.12)":"#f3f4f6"),borderRadius:12,padding:"0.75rem 1rem",boxShadow:"0 10px 15px -3px rgba(0,0,0,0.1)",minWidth:175},children:[(0,w.jsx)("div",{style:{fontFamily:"Urbanist, sans-serif",fontWeight:700,color:n?"#f1f5f9":"#111827",fontSize:"0.85rem",marginBottom:"0.4rem",borderBottom:"1px solid ".concat(n?"rgba(148,163,184,0.12)":"#f3f4f6"),paddingBottom:"0.25rem"},children:i}),(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.2rem"},children:r.map(e=>{var t,r,i;const a=null!==(t=e.name)&&void 0!==t&&t.includes("Temp")?"\xb0C":null!==(r=e.name)&&void 0!==r&&r.includes("GHI")?"W/m\xb2":"kW";return(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem",fontSize:"0.78rem",fontFamily:"Inter, sans-serif",color:n?"#94a3b8":"#374151"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:[(0,w.jsx)("span",{style:{width:7,height:7,borderRadius:"50%",background:e.color||e.stroke||e.fill,flexShrink:0}}),(0,w.jsx)("span",{style:{fontWeight:600},children:null===(i=e.name)||void 0===i?void 0:i.split(" ")[0]})]}),(0,w.jsxs)("span",{style:{fontFamily:"JetBrains Mono, monospace",fontWeight:600,color:n?"#f1f5f9":"#111827"},children:[Number(e.value).toFixed(3)," ",a]})]},e.name)})})]}):null},S=j.Bx;function C(e){return e.toLocaleDateString("en-CA",{timeZone:S})}function N(e){const t=198e5,r=Date.now()+t,i=864e5*Math.floor(r/864e5);return C(new Date(i+864e5*e-t))}function D(e,t){try{const r=new Date(e);return"24h"===t?r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:S}):"7d"===t?r.toLocaleDateString([],{weekday:"short",timeZone:S})+" "+r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:S}):r.toLocaleDateString([],{month:"short",day:"numeric",timeZone:S})}catch(r){return e}}const A=()=>(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#F07522",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,w.jsx)("circle",{cx:"12",cy:"12",r:"5",fill:"#FFD600",stroke:"#F07522",strokeWidth:"1.5"}),(0,w.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),(0,w.jsx)("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),(0,w.jsx)("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),(0,w.jsx)("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),(0,w.jsx)("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),(0,w.jsx)("line",{x1:"21",y1:"12",x2:"23",y2:"12"})]}),z=()=>(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,w.jsx)("rect",{x:"1",y:"6",width:"18",height:"12",rx:"2"}),(0,w.jsx)("line",{x1:"23",y1:"13",x2:"23",y2:"11"}),(0,w.jsx)("rect",{x:"3",y:"8",width:"10",height:"8",fill:"currentColor",rx:"1"})]}),F=()=>(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,w.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),(0,w.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]}),W=()=>(0,w.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,w.jsx)("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),T=()=>(0,w.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,w.jsx)("path",{d:"M18 10h-1.26A8 8 0 109 20h9a5 5 0 000-10z"})}),I=()=>(0,w.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,w.jsx)("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})}),R=()=>(0,w.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,w.jsx)("path",{d:"M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"})}),M=e=>{let{label:t,value:r,unit:i,sub:n,accent:a,icon:o,badge:s}=e;return(0,w.jsxs)("div",{className:"card",style:{padding:"1.1rem",flex:1,minWidth:140},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.4rem"},children:[(0,w.jsx)("span",{style:{fontSize:"0.7rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:t}),(0,w.jsx)("span",{style:{width:28,height:28,borderRadius:"50%",background:"".concat(a,"18"),display:"flex",alignItems:"center",justifyContent:"center",color:a,flexShrink:0},children:o})]}),(0,w.jsxs)("p",{style:{margin:0,fontFamily:"JetBrains Mono, monospace",fontSize:"1.5rem",fontWeight:800,color:"var(--text-primary)",lineHeight:1},children:[r,i&&(0,w.jsx)("span",{style:{fontSize:"0.78rem",fontWeight:500,color:"var(--text-muted)",marginLeft:4},children:i})]}),n&&(0,w.jsx)("p",{style:{margin:"0.2rem 0 0",fontSize:"0.7rem",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:n}),s&&(0,w.jsx)("div",{style:{marginTop:"0.3rem"},children:s})]})},L=e=>{let{hourly:t}=e;if(!t||0===t.length)return null;return(0,w.jsxs)("div",{className:"card",style:{padding:"1rem 1.25rem",marginBottom:"1rem"},children:[(0,w.jsx)("p",{style:{margin:"0 0 0.65rem",fontSize:"0.68rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.07em",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:"24 h Weather Outlook"}),(0,w.jsx)("div",{style:{overflowX:"auto",paddingTop:14,paddingBottom:2},children:(0,w.jsx)("div",{style:{display:"flex",gap:"0.45rem",minWidth:"max-content"},children:t.map((e,t)=>{var r,i,n,a;const o=(()=>{try{return new Date(e.forecast_for).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:S})}catch(t){return""}})(),s=null!==(r=e.cloud_cover_pct)&&void 0!==r?r:0,l=null!==(i=e.ghi_wm2)&&void 0!==i?i:0,d=Number(null!==(n=e.temperature_c)&&void 0!==n?n:0),c=Number(null!==(a=e.wind_speed_ms)&&void 0!==a?a:0),m=null!=e.humidity_pct?Number(e.humidity_pct):null,p=null!=e.precip_prob_pct?Number(e.precip_prob_pct):null,u=Math.min(100,l/900*100),x=null!=m?Math.min(100,m):null,g=0===t,h=((e,t,r)=>t<10?"\ud83c\udf19":null!=r&&r>60?"\ud83c\udf27":null!=r&&r>30?e>40?"\ud83c\udf26":"\u26c5":e>75?"\u2601\ufe0f":e>40?"\u26c5":"\u2600\ufe0f")(s,l,p),f=l>600?"#F07522":l>200?"#f59e0b":"#d1d5db",b=null==m?"#d1d5db":m>80?"#3b82f6":m>50?"#60a5fa":"#93c5fd",y=null==p?"#d1d5db":p>60?"#1d4ed8":p>30?"#3b82f6":"#93c5fd";return(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",background:g?"rgba(0,166,62,0.09)":"rgba(0,0,0,0.025)",border:"1px solid ".concat(g?"rgba(0,166,62,0.28)":"rgba(0,0,0,0.07)"),borderRadius:10,padding:"0.45rem 0.65rem",minWidth:64,gap:"0.1rem",position:"relative"},children:[g&&(0,w.jsx)("span",{style:{position:"absolute",top:-9,fontSize:"0.55rem",fontWeight:700,background:"#00a63e",color:"#fff",padding:"1px 5px",borderRadius:4,fontFamily:"Poppins, sans-serif"},children:"NOW"}),(0,w.jsx)("span",{style:{fontSize:"0.65rem",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif",fontWeight:600},children:o}),(0,w.jsx)("span",{style:{fontSize:"1.1rem",lineHeight:1.4},children:h}),(0,w.jsxs)("span",{style:{fontSize:"0.8rem",fontFamily:"JetBrains Mono, monospace",fontWeight:700,color:"var(--text-primary)"},children:[d.toFixed(1),"\xb0"]}),(0,w.jsx)("div",{title:"GHI ".concat(Math.round(l)," W/m\xb2"),style:{width:"100%",height:3,background:"rgba(0,0,0,0.08)",borderRadius:2,overflow:"hidden",margin:"2px 0"},children:(0,w.jsx)("div",{style:{width:"".concat(u,"%"),height:"100%",background:f,borderRadius:2}})}),(0,w.jsxs)("span",{style:{fontSize:"0.6rem",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:[Math.round(l)," W/m\xb2"]}),null!=x&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{title:"Humidity ".concat(Math.round(x),"%"),style:{width:"100%",height:3,background:"rgba(0,0,0,0.06)",borderRadius:2,overflow:"hidden",margin:"2px 0"},children:(0,w.jsx)("div",{style:{width:"".concat(x,"%"),height:"100%",background:b,borderRadius:2}})}),(0,w.jsxs)("span",{style:{fontSize:"0.6rem",color:b,fontFamily:"Poppins, sans-serif",fontWeight:600},children:["\ud83d\udca7",Math.round(x),"%"]})]}),null!=p&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{title:"Rain ".concat(Math.round(p),"%"),style:{width:"100%",height:3,background:"rgba(0,0,0,0.06)",borderRadius:2,overflow:"hidden",margin:"2px 0"},children:(0,w.jsx)("div",{style:{width:"".concat(p,"%"),height:"100%",background:y,borderRadius:2}})}),(0,w.jsxs)("span",{style:{fontSize:"0.6rem",color:y,fontFamily:"Poppins, sans-serif",fontWeight:600},children:["\ud83c\udf27",Math.round(p),"%"]})]}),(0,w.jsxs)("span",{style:{fontSize:"0.6rem",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:[c.toFixed(1)," m/s"]})]},t)})})})]})},B=e=>{let{latest:t}=e;if(!t)return null;const r=[{label:"PV Yield",value:t.pv_today_kwh,color:"#F07522",bg:"#F0752212",icon:"\u2600"},{label:"Grid In",value:t.grid_buy_today_kwh,color:"#3b82f6",bg:"#3b82f612",icon:"\u2b07"},{label:"Grid Out",value:t.grid_sell_today_kwh,color:"#10b981",bg:"#10b98112",icon:"\u2b06"},{label:"Batt Chg",value:t.batt_charge_today_kwh,color:"#8b5cf6",bg:"#8b5cf612",icon:"\u2191"},{label:"Batt Dchg",value:t.batt_discharge_today_kwh,color:"#ec4899",bg:"#ec489912",icon:"\u2193"},{label:"Consumption",value:t.load_today_kwh,color:"#6b7280",bg:"#6b728012",icon:"\u2302"}].filter(e=>null!=e.value);return r.length?(0,w.jsxs)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"1rem",alignItems:"center"},children:[(0,w.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif",alignSelf:"center",minWidth:40},children:"Today"}),r.map(e=>(0,w.jsxs)("span",{style:{fontSize:"0.72rem",fontWeight:600,fontFamily:"Poppins, sans-serif",padding:"0.2rem 0.65rem",borderRadius:99,background:e.bg,border:"1px solid ".concat(e.color,"28"),color:e.color,display:"flex",alignItems:"center",gap:"0.3rem"},children:[(0,w.jsx)("span",{style:{opacity:.85},children:e.icon}),e.label,":\xa0",(0,w.jsx)("span",{style:{fontFamily:"JetBrains Mono, monospace",color:"var(--text-primary)"},children:Number(e.value).toFixed(2)}),(0,w.jsx)("span",{style:{fontSize:"0.6rem",color:"var(--text-muted)"},children:"kWh"})]},e.label))]}):null},P=e=>{var t,r,i;let{latest:n}=e;if(!n)return null;const a=Number(null!==(t=n.pv_today_kwh)&&void 0!==t?t:0),o=Number(null!==(r=n.load_today_kwh)&&void 0!==r?r:0),s=Number(null!==(i=n.grid_buy_today_kwh)&&void 0!==i?i:0);if(0===a&&0===o)return null;const l=.82*a,d=o>0?Math.max(0,Math.min(100,Math.round((o-s)/o*100))):null,c=o>0?Math.max(0,Math.min(100,Math.round(s/o*100))):null,m=[];if(a>0&&m.push({icon:"\ud83c\udf3f",label:"CO\u2082 Avoided",value:l>=1?"".concat(l.toFixed(2)," kg"):"".concat((1e3*l).toFixed(0)," g"),sub:"vs grid (0.82 kg/kWh)",color:"#10b981",bg:"#10b98110"}),null!=d){const e=d>=70?"#00a63e":d>=40?"#f59e0b":"#ef4444";m.push({icon:"\u26a1",label:"Self-Sufficiency",value:"".concat(d,"%"),sub:"load met by solar+battery",color:e,bg:"".concat(e,"10")})}if(null!=c){const e=c<=20?"#10b981":c<=50?"#f59e0b":"#ef4444";m.push({icon:"\ud83d\udd0c",label:"Grid Dependency",value:"".concat(c,"%"),sub:"portion from grid",color:e,bg:"".concat(e,"10")})}return m.length?(0,w.jsxs)("div",{style:{display:"flex",gap:"0.6rem",flexWrap:"wrap",marginBottom:"1rem"},children:[(0,w.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif",alignSelf:"center",minWidth:40},children:"Insights"}),m.map(e=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.55rem",padding:"0.35rem 0.85rem",borderRadius:10,background:e.bg,border:"1px solid ".concat(e.color,"28"),flexShrink:0},children:[(0,w.jsx)("span",{style:{fontSize:"1rem",lineHeight:1},children:e.icon}),(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:1},children:[(0,w.jsx)("span",{style:{fontSize:"0.62rem",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.04em"},children:e.label}),(0,w.jsx)("span",{style:{fontFamily:"JetBrains Mono, monospace",fontWeight:800,color:e.color,fontSize:"0.88rem",lineHeight:1},children:e.value}),e.sub&&(0,w.jsx)("span",{style:{fontSize:"0.58rem",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:e.sub})]})]},e.label))]}):null},O={night:{bg:"#1e293b1a",color:"#475569"},ramp:{bg:"#f59e0b18",color:"#d97706"},midday:{bg:"#F0752218",color:"#c2410c"}},E=e=>{var t,r,i;let{x:n,y:a,payload:o,forecastWindow:s}=e;const l=null!==(t=null===o||void 0===o?void 0:o.value)&&void 0!==t?t:"";if(!l)return null;const d="today"===s,c=d?l:null!==(r=l.split("||")[0])&&void 0!==r?r:l,m=d?"":null!==(i=l.split("||")[1])&&void 0!==i?i:"";return(0,w.jsxs)("g",{transform:"translate(".concat(n,",").concat(a,")"),children:[(0,w.jsx)("text",{x:0,y:0,dy:13,textAnchor:"middle",fill:"#00a63e",fontSize:10,fontWeight:700,fontFamily:"Inter, sans-serif",children:c}),!d&&m&&(0,w.jsx)("text",{x:0,y:0,dy:25,textAnchor:"middle",fill:"var(--text-muted)",fontSize:9,fontFamily:"Inter, sans-serif",children:m})]})},H=e=>{let{data:t}=e;const{isDark:r}=(0,l.D)(),i=r?"rgba(15,23,42,0.9)":"#f9fafb",n=r?"1px solid rgba(148,163,184,0.07)":"1px solid #f3f4f6";return(0,w.jsx)("div",{style:{maxHeight:300,overflowY:"auto"},children:(0,w.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.8rem",fontFamily:"Inter, sans-serif"},children:[(0,w.jsx)("thead",{style:{position:"sticky",top:0,background:i,zIndex:1},children:(0,w.jsxs)("tr",{children:[(0,w.jsx)("th",{style:{padding:"0.7rem 1rem",textAlign:"left",fontWeight:600,color:"var(--text-secondary)",borderBottom:"1px solid ".concat(r?"rgba(148,163,184,0.1)":"#e5e7eb")},children:"Time"}),(0,w.jsx)("th",{style:{padding:"0.7rem 0.6rem",textAlign:"center",fontWeight:600,color:"var(--text-muted)",borderBottom:"1px solid ".concat(r?"rgba(148,163,184,0.1)":"#e5e7eb")},children:"Regime"}),(0,w.jsx)("th",{style:{padding:"0.7rem 0.8rem",textAlign:"right",fontWeight:600,color:"#f59e0b",borderBottom:"1px solid ".concat(r?"rgba(148,163,184,0.1)":"#e5e7eb")},children:"P10 \u2193"}),(0,w.jsx)("th",{style:{padding:"0.7rem 0.8rem",textAlign:"right",fontWeight:600,color:"#00a63e",borderBottom:"1px solid ".concat(r?"rgba(148,163,184,0.1)":"#e5e7eb")},children:"P50"}),(0,w.jsx)("th",{style:{padding:"0.7rem 0.8rem",textAlign:"right",fontWeight:600,color:"#3b82f6",borderBottom:"1px solid ".concat(r?"rgba(148,163,184,0.1)":"#e5e7eb")},children:"P90 \u2191"}),(0,w.jsx)("th",{style:{padding:"0.7rem 0.8rem",textAlign:"right",fontWeight:600,color:"var(--text-muted)",borderBottom:"1px solid ".concat(r?"rgba(148,163,184,0.1)":"#e5e7eb")},children:"Physics"}),(0,w.jsx)("th",{style:{padding:"0.7rem 0.8rem",textAlign:"right",fontWeight:600,color:"#eab308",borderBottom:"1px solid ".concat(r?"rgba(148,163,184,0.1)":"#e5e7eb")},children:"GHI W/m\xb2"})]})}),(0,w.jsx)("tbody",{children:t.map((e,t)=>{var r,i,a,o,s,l,d,c,m,p,u,x;const g=e.regime?null!==(r=O[e.regime])&&void 0!==r?r:{bg:"transparent",color:"var(--text-muted)"}:null;return(0,w.jsxs)("tr",{style:{borderBottom:n},children:[(0,w.jsxs)("td",{style:{padding:"0.55rem 1rem",color:"var(--text-primary)",fontFamily:"JetBrains Mono, monospace"},children:[e.dateLabel?(0,w.jsx)("span",{style:{marginRight:"0.5rem",color:"#00a63e",fontWeight:700},children:e.dateLabel}):null,null!==(i=e.timeLabel)&&void 0!==i?i:e.time]}),(0,w.jsx)("td",{style:{padding:"0.4rem 0.6rem",textAlign:"center"},children:e.regime&&g&&(0,w.jsx)("span",{style:{fontSize:"0.62rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.04em",background:g.bg,color:g.color,padding:"2px 6px",borderRadius:4,fontFamily:"Poppins, sans-serif"},children:e.regime})}),(0,w.jsx)("td",{style:{padding:"0.55rem 0.8rem",textAlign:"right",color:"var(--text-secondary)"},children:null!==(a=null===(o=e.p10)||void 0===o?void 0:o.toFixed(3))&&void 0!==a?a:"\u2014"}),(0,w.jsx)("td",{style:{padding:"0.55rem 0.8rem",textAlign:"right",fontWeight:600,color:"var(--text-primary)"},children:null!==(s=null===(l=e.p50)||void 0===l?void 0:l.toFixed(3))&&void 0!==s?s:"\u2014"}),(0,w.jsx)("td",{style:{padding:"0.55rem 0.8rem",textAlign:"right",color:"var(--text-secondary)"},children:null!==(d=null===(c=e.p90)||void 0===c?void 0:c.toFixed(3))&&void 0!==d?d:"\u2014"}),(0,w.jsx)("td",{style:{padding:"0.55rem 0.8rem",textAlign:"right",color:"var(--text-muted)",fontStyle:"italic"},children:null!==(m=null===(p=e.physics)||void 0===p?void 0:p.toFixed(3))&&void 0!==m?m:"\u2014"}),(0,w.jsx)("td",{style:{padding:"0.55rem 0.8rem",textAlign:"right",color:"var(--text-secondary)"},children:null!==(u=null===(x=e.ghi)||void 0===x?void 0:x.toFixed(0))&&void 0!==u?u:"\u2014"})]},t)})})]})})},G=e=>{var t,a,s,d,j,O,G,K,Y,U;let{siteId:J,autoRefresh:Z=!1}=e;const{isDark:V}=(0,l.D)(),[q,Q]=(0,n.useState)([]),[X,$]=(0,n.useState)([]),[ee,te]=(0,n.useState)(null),[re,ie]=(0,n.useState)(!0),[ne,ae]=(0,n.useState)(null),[oe,se]=(0,n.useState)(null),[le,de]=(0,n.useState)("overview"),[ce,me]=(0,n.useState)({P10:!0,P50:!0,P90:!0}),[pe,ue]=(0,n.useState)("24h"),[xe,ge]=(0,n.useState)(""),[he,fe]=(0,n.useState)(""),[be,ye]=(0,n.useState)(""),[ve,je]=(0,n.useState)("");(0,n.useEffect)(()=>{const e=setTimeout(()=>ye(xe),600);return()=>clearTimeout(e)},[xe]),(0,n.useEffect)(()=>{const e=setTimeout(()=>je(he),600);return()=>clearTimeout(e)},[he]);const[we,ke]=(0,n.useState)("chart"),[_e,Se]=(0,n.useState)("7d"),[Ce,Ne]=(0,n.useState)(""),[De,Ae]=(0,n.useState)(""),[ze,Fe]=(0,n.useState)(!1),[We,Te]=(0,n.useState)(null),[Ie,Re]=(0,n.useState)(null),Me=(0,n.useMemo)(()=>({background:V?"rgba(30,41,59,0.97)":"rgba(255,255,255,0.97)",border:"1px solid ".concat(V?"rgba(148,163,184,0.1)":"rgba(0,166,62,0.15)"),borderRadius:10,color:V?"#f1f5f9":"#0a0a0a",boxShadow:"0 8px 24px rgba(0,0,0,0.1)",fontSize:12}),[V]),Le=(0,n.useCallback)(async()=>{try{const e=new Date,t=e.toISOString().split("T")[0]+"T00:00:00Z",r=new Date(e.getTime()+6048e5).toISOString().split("T")[0]+"T23:59:59Z";let i={};"custom"===pe&&be&&ve?i={start_date:new Date(be).toISOString(),end_date:new Date(ve).toISOString()}:"7d"===pe?i={days:7}:"30d"===pe&&(i={days:30});let n=null;const a=new Date(e.getTime()-6048e5),s=new Date(e.getTime()-2592e6);if("7d"===pe)n={start_date:a.toISOString(),end_date:e.toISOString()};else if("30d"===pe)n={start_date:s.toISOString(),end_date:e.toISOString()};else if("custom"===pe&&be&&ve){const e=new Date(be),t=new Date(ve);n={start_date:e.toISOString(),end_date:t.toISOString()}}const l=await Promise.all([o.K.getSiteTelemetry(J,i),o.K.getSiteForecast(J,{start_date:t,end_date:r}),o.K.getSiteWeather(J),n?o.K.getSiteHistory(J,n):Promise.resolve(null)]),[d,c,m,p]=l;let u=Array.isArray(d)?d:[];if(Array.isArray(p)&&p.length>0){const e=new Set(u.map(e=>e.timestamp));u=[...p.filter(t=>!e.has(t.timestamp)),...u].sort((e,t)=>e.timestamp.localeCompare(t.timestamp))}Q(u),$(Array.isArray(c)?c:[]),te(m||null),se(new Date),ae(null)}catch(e){ae(e instanceof Error?e.message:"Failed to load site data")}finally{ie(!1)}},[J,pe,be,ve]);(0,n.useEffect)(()=>{if(ie(!0),Le(),!Z)return;const e=setInterval(Le,6e4);return()=>clearInterval(e)},[Le,Z]),(0,n.useEffect)(()=>{Te(null),Re(null)},[_e]);const Be=q.length>0?q[q.length-1]:null,Pe=Be?((null!==(t=Be.pv1_power_w)&&void 0!==t?t:0)+(null!==(a=Be.pv2_power_w)&&void 0!==a?a:0))/1e3:null,Oe=null!==(s=null===Be||void 0===Be?void 0:Be.battery_soc_percent)&&void 0!==s?s:null,Ee=Be?(null!==(d=Be.load_power_w)&&void 0!==d?d:0)/1e3:null,He=null!==(j=null===Be||void 0===Be?void 0:Be.pv_today_kwh)&&void 0!==j?j:null,Ge=Be?(null!==(O=Be.grid_power_w)&&void 0!==O?O:0)/1e3:null,Ke=Be?(null!==(G=Be.battery_power_w)&&void 0!==G?G:0)/1e3:null,Ye=null!==(K=null===Be||void 0===Be?void 0:Be.inverter_temp_c)&&void 0!==K?K:null,Ue=null!==(Y=null===Be||void 0===Be?void 0:Be.battery_voltage_v)&&void 0!==Y?Y:null,Je=null===Be||void 0===Be?void 0:Be.run_state,Ze=null!=Ge&&Ge>.01,Ve=null!=Ge&&Ge<-.01,qe=null!=Ke&&Ke>.01,Qe=null!=Je?0===Je?{label:"Standby",color:"#9ca3af"}:1===Je?{label:"Online",color:"#00a63e"}:2===Je?{label:"Warning",color:"#f59e0b"}:3===Je?{label:"Fault",color:"#ef4444"}:{label:"State ".concat(Je),color:"#6b7280"}:null,Xe=null==Ye?"#9ca3af":Ye>60?"#ef4444":Ye>45?"#f59e0b":"#10b981",$e=(0,n.useMemo)(()=>function(e,t){if(!e.length)return[];if("24h"===t)return e.filter((t,r)=>r%2===0||r===e.length-1);const r="7d"!==t,i=new Map;return e.forEach(e=>{const t=new Date(e.timestamp),n=r?"".concat(t.getFullYear(),"-").concat(t.getMonth(),"-").concat(t.getDate()):"".concat(t.getFullYear(),"-").concat(t.getMonth(),"-").concat(t.getDate(),"-").concat(t.getHours());i.has(n)||i.set(n,[]),i.get(n).push(e)}),Array.from(i.values()).map(e=>{const t=t=>e.reduce((e,r)=>{var i;return e+(null!==(i=r[t])&&void 0!==i?i:0)},0)/e.length,i=e[0];return{timestamp:i.timestamp,pv1_power_w:t("pv1_power_w"),pv2_power_w:t("pv2_power_w"),load_power_w:t("load_power_w"),grid_power_w:t("grid_power_w"),battery_soc_percent:t("battery_soc_percent"),battery_power_w:t("battery_power_w"),pv_today_kwh:r?Math.max(...e.map(e=>{var t;return null!==(t=e.pv_today_kwh)&&void 0!==t?t:0})):i.pv_today_kwh}})}(q,pe).map(e=>{var t,r,i,n,a;return{time:D(e.timestamp,pe),"PV (kW)":+(((null!==(t=e.pv1_power_w)&&void 0!==t?t:0)+(null!==(r=e.pv2_power_w)&&void 0!==r?r:0))/1e3).toFixed(2),"Load (kW)":+((null!==(i=e.load_power_w)&&void 0!==i?i:0)/1e3).toFixed(2),"Grid (kW)":+((null!==(n=e.grid_power_w)&&void 0!==n?n:0)/1e3).toFixed(2),"Batt SOC (%)":null!==(a=e.battery_soc_percent)&&void 0!==a?a:null}}),[q,pe]),{forecastFiltered:et,forecastData:tt}=(0,n.useMemo)(()=>{const e=C(new Date),t=X.filter(t=>{const r=t.forecast_for||t.timestamp.replace("FORECAST#",""),i=C(new Date(r));return"today"===_e?i===e:"3d"===_e?i>N(0)&&i<=N(3):i>N(0)&&i<=N(7)}),r=t.map(e=>{var t;const r=e.forecast_for||e.timestamp.replace("FORECAST#",""),i=new Date(r),n=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:S}),a="3d"===_e?i.toLocaleDateString([],{weekday:"short",day:"numeric",timeZone:S}):i.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric",timeZone:S}),o=C(i),s=i.getTime();return{time:"today"===_e?n:"".concat(a,"||").concat(n),dateLabel:a,timeLabel:n,rawDate:o,rawTs:s,p50:null!=e.p50_kw?+Number(e.p50_kw).toFixed(3):null,p10:null!=e.p10_kw?+Number(e.p10_kw).toFixed(3):null,p90:null!=e.p90_kw?+Number(e.p90_kw).toFixed(3):null,physics:null!=e.physics_baseline_kw?+Number(e.physics_baseline_kw).toFixed(3):null,ghi:null!=e.ghi_input_wm2?+e.ghi_input_wm2:null,temp:null!=e.temperature_c?+e.temperature_c:null,regime:null!==(t=e.regime)&&void 0!==t?t:null}});return{forecastFiltered:t,forecastData:r}},[X,_e]),rt=(0,n.useMemo)(()=>{if(!We||!Ie)return tt;const e=tt.findIndex(e=>e.time===We),t=tt.findIndex(e=>e.time===Ie);if(-1===e||-1===t||e===t)return tt;const[r,i]=e<t?[e,t]:[t,e];return tt.slice(r,i+1)},[tt,We,Ie]),it=(0,n.useMemo)(()=>{if("today"===_e)return rt.filter(e=>{const t=new Date(e.rawTs);return 30===t.getUTCMinutes()&&t.getUTCHours()%2===0});const e=new Map;for(const t of rt){e.has(t.rawDate)||e.set(t.rawDate,t);const r=new Date(t.rawTs);6===r.getUTCHours()&&30===r.getUTCMinutes()&&e.set(t.rawDate,t)}return Array.from(e.values())},[rt,_e]),nt=null===it||void 0===it?void 0:it.map(e=>e.time),at=(0,n.useMemo)(()=>{if(0===X.length)return null;let e="";for(const t of X)t.generated_at&&t.generated_at>e&&(e=t.generated_at);return e?new Date(e):X[0].timestamp?new Date(X[0].timestamp.replace("FORECAST#","").split("T")[0]+"T00:00:00Z"):null},[X]),{fcastP10:ot,fcastP50:st,fcastP90:lt}=(0,n.useMemo)(()=>{let e=0,t=0,r=0;if(et.length>1)for(let i=0;i<et.length-1;i++){const n=Math.abs(new Date(et[i+1].timestamp.replace("FORECAST#","")).getTime()-new Date(et[i].timestamp.replace("FORECAST#","")).getTime())/36e5;null!=et[i].p10_kw&&null!=et[i+1].p10_kw&&(e+=(et[i].p10_kw+et[i+1].p10_kw)/2*n),null!=et[i].p50_kw&&null!=et[i+1].p50_kw&&(t+=(et[i].p50_kw+et[i+1].p50_kw)/2*n),null!=et[i].p90_kw&&null!=et[i+1].p90_kw&&(r+=(et[i].p90_kw+et[i+1].p90_kw)/2*n)}return{fcastP10:e,fcastP50:t,fcastP90:r}},[et]),dt=(0,n.useMemo)(()=>{const e=C(new Date),t=X.filter(t=>{const r=t.forecast_for||t.timestamp.replace("FORECAST#","");return C(new Date(r))===e});let r=0;if(t.length>1)for(let i=0;i<t.length-1;i++){const e=Math.abs(new Date(t[i+1].timestamp.replace("FORECAST#","")).getTime()-new Date(t[i].timestamp.replace("FORECAST#","")).getTime())/36e5;null!=t[i].p50_kw&&null!=t[i+1].p50_kw&&(r+=(t[i].p50_kw+t[i+1].p50_kw)/2*e)}return null!=He&&r>0?Math.min(999,Math.round(He/r*100)):null},[X,He]),ct=V?"rgba(30,41,59,0.85)":"#ffffff",mt=V?"rgba(30,41,59,0.6)":"linear-gradient(to right,#ffffff,#f9fafb)",pt=V?"rgba(15,23,42,0.6)":"#f3f4f6",ut=V?"rgba(30,41,59,0.95)":"#fff",xt=V?"rgba(148,163,184,0.1)":"#e5e7eb";if(re)return(0,w.jsxs)("div",{style:{padding:"1.5rem 0"},children:[(0,w.jsx)("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem",flexWrap:"wrap"},children:[...Array(6)].map((e,t)=>(0,w.jsx)("div",{className:"card skeleton",style:{flex:1,minWidth:140,height:100}},t))}),(0,w.jsx)("div",{className:"card skeleton",style:{height:52,marginBottom:"0.75rem"}}),(0,w.jsx)("div",{className:"card skeleton",style:{height:130,marginBottom:"1rem"}}),(0,w.jsx)("div",{className:"card skeleton",style:{height:240,marginBottom:"1rem"}}),(0,w.jsx)("div",{className:"card skeleton",style:{height:200}})]});if(ne)return(0,w.jsxs)("div",{style:{padding:"1.5rem",color:"#ef4444",fontSize:"0.85rem",background:"rgba(239,68,68,0.06)",borderRadius:10,marginTop:"1rem"},children:["Failed to load DynamoDB data for ",(0,w.jsx)("strong",{children:J}),": ",ne]});const gt=0===q.length&&0===X.length&&!ee;return(0,w.jsxs)("div",{style:{marginTop:"1.5rem"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.75rem",gap:"1rem",flexWrap:"wrap"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[(0,w.jsxs)("p",{className:"dash-section-label",style:{margin:0},children:["Live Site Intelligence \u2014 ",(0,w.jsx)("span",{style:{fontFamily:"JetBrains Mono, monospace",color:"#00a63e"},children:J})]}),Qe&&(0,w.jsxs)("span",{style:{fontSize:"0.65rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",background:"".concat(Qe.color,"18"),color:Qe.color,padding:"2px 8px",borderRadius:99,fontFamily:"Poppins, sans-serif",border:"1px solid ".concat(Qe.color,"30")},children:["\u25cf ",Qe.label]})]}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[("overview"===le||"history"===le)&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("select",{value:pe,onChange:e=>ue(e.target.value),style:{background:"var(--bg-card,#fff)",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.3rem 0.6rem",fontSize:"0.72rem",color:"var(--text-primary,#0a0a0a)",cursor:"pointer",fontFamily:"Poppins, sans-serif",fontWeight:600},children:[(0,w.jsx)("option",{value:"24h",children:"Today"}),(0,w.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,w.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,w.jsx)("option",{value:"custom",children:"Custom range"})]}),"custom"===pe&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("input",{type:"date",value:xe,onChange:e=>ge(e.target.value),style:{background:"var(--bg-card,#fff)",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.3rem 0.6rem",fontSize:"0.72rem",color:"var(--text-primary,#0a0a0a)",fontFamily:"Poppins, sans-serif",fontWeight:600}}),(0,w.jsx)("span",{style:{color:"var(--text-muted)",fontSize:"0.7rem"},children:"to"}),(0,w.jsx)("input",{type:"date",value:he,onChange:e=>fe(e.target.value),style:{background:"var(--bg-card,#fff)",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.3rem 0.6rem",fontSize:"0.72rem",color:"var(--text-primary,#0a0a0a)",fontFamily:"Poppins, sans-serif",fontWeight:600}})]})]}),"forecast"===le&&(0,w.jsxs)("select",{value:_e,onChange:e=>Se(e.target.value),style:{background:"var(--bg-card,#fff)",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.3rem 0.6rem",fontSize:"0.72rem",color:"var(--text-primary,#0a0a0a)",cursor:"pointer",fontFamily:"Poppins, sans-serif",fontWeight:600},children:[(0,w.jsx)("option",{value:"today",children:"Today"}),(0,w.jsx)("option",{value:"3d",children:"Next 3 days"}),(0,w.jsx)("option",{value:"7d",children:"Next 7 days"})]})]}),oe&&(0,w.jsxs)("span",{style:{fontSize:"0.7rem",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:["Updated ",oe.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:S})," IST"]}),(0,w.jsx)("button",{onClick:()=>{ie(!0),Le()},style:{background:"none",border:"1px solid rgba(0,166,62,0.2)",borderRadius:8,padding:"0.2rem 0.6rem",fontSize:"0.72rem",color:"#00a63e",cursor:"pointer",fontFamily:"Poppins, sans-serif",fontWeight:600},children:"\u21bb Refresh"})]})]}),gt?(0,w.jsxs)("div",{style:{padding:"2rem",textAlign:"center",color:"var(--text-muted)",fontSize:"0.875rem",background:"rgba(0,166,62,0.03)",borderRadius:12,border:"1px dashed rgba(0,166,62,0.15)"},children:["No DynamoDB data found for site ",(0,w.jsx)("strong",{style:{color:"#00a63e"},children:J})," in the ","24h"===pe?"today":"7d"===pe?"last 7 days":"30d"===pe?"last 30 days":"selected date range",".",(0,w.jsx)("br",{}),(0,w.jsx)("span",{style:{fontSize:"0.78rem"},children:"Data is written by the ML forecast scheduler when the device is actively posting telemetry."})]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{style:{display:"flex",borderBottom:"2px solid ".concat(V?"rgba(148,163,184,0.12)":"#f3f4f6"),marginBottom:"1rem",gap:0},children:k.map(e=>{const t=le===e.id;return(0,w.jsxs)("button",{onClick:()=>de(e.id),style:{border:"none",background:"transparent",cursor:"pointer",padding:"0.5rem 1rem",fontSize:"0.78rem",fontWeight:t?700:600,fontFamily:"Poppins, sans-serif",color:t?"#00a63e":"var(--text-muted)",borderBottom:"2px solid ".concat(t?"#00a63e":"transparent"),marginBottom:-2,display:"flex",alignItems:"center",gap:"0.35rem",transition:"color 0.15s",letterSpacing:"0.01em"},children:[(0,w.jsx)("span",{children:e.icon}),(0,w.jsx)("span",{children:e.label})]},e.id)})}),"overview"===le&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap",marginBottom:"0.75rem"},children:[(0,w.jsx)(M,{label:"PV Power",value:null!=Pe?Pe.toFixed(2):"\u2014",unit:"kW",sub:null!=(null===Be||void 0===Be?void 0:Be.pv1_power_w)&&null!=(null===Be||void 0===Be?void 0:Be.pv2_power_w)?"S1: ".concat((Be.pv1_power_w/1e3).toFixed(2)," \xb7 S2: ").concat((Be.pv2_power_w/1e3).toFixed(2)," kW"):"Current generation",accent:"#F07522",icon:(0,w.jsx)(A,{})}),(0,w.jsx)(M,{label:"Battery",value:null!=Oe?Oe.toFixed(1):"\u2014",unit:"%",sub:null!=Ue?"".concat(Ue.toFixed(1)," V"):"State of charge",accent:"#00a63e",icon:(0,w.jsx)(z,{}),badge:null!=Ke&&Math.abs(Ke)>.01?(0,w.jsxs)("span",{style:{fontSize:"0.65rem",fontWeight:700,color:qe?"#00a63e":"#ec4899",fontFamily:"Poppins, sans-serif"},children:[qe?"\u26a1 Charging":"\u2b07 Discharging"," ",Math.abs(Ke).toFixed(2)," kW"]}):(0,w.jsx)("span",{style:{fontSize:"0.65rem",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:"Idle"})}),(0,w.jsx)(M,{label:"Load",value:null!=Ee?Ee.toFixed(2):"\u2014",unit:"kW",sub:"Current consumption",accent:"#8b5cf6",icon:(0,w.jsx)(F,{})}),(0,w.jsx)(M,{label:"Energy Today",value:null!=He?He.toFixed(2):"\u2014",unit:"kWh",sub:"Solar yield today",accent:"#10b981",icon:(0,w.jsx)(W,{})}),(0,w.jsx)(M,{label:"Grid",value:null!=Ge?Math.abs(Ge).toFixed(2):"\u2014",unit:"kW",sub:null!=(null===Be||void 0===Be?void 0:Be.grid_voltage_v)?"".concat(Number(Be.grid_voltage_v).toFixed(0)," V \xb7 ").concat(Number(null!==(U=Be.grid_frequency_hz)&&void 0!==U?U:0).toFixed(1)," Hz"):"Grid power",accent:"#3b82f6",icon:(0,w.jsx)(I,{}),badge:null!=Ge?(0,w.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:700,color:Ze?"#3b82f6":Ve?"#10b981":"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:Ze?"\u2b07 Importing":Ve?"\u2b06 Exporting":"\u2194 Standby"}):void 0}),(0,w.jsx)(M,{label:"Inv. Temp",value:null!=Ye?Ye.toFixed(1):"\u2014",unit:"\xb0C",sub:null!=Ye?Ye>60?"\ud83d\udd34 Hot \u2014 check cooling":Ye>45?"\ud83d\udfe1 Warm":"\ud83d\udfe2 Normal":"No data",accent:Xe,icon:(0,w.jsx)(R,{})})]}),(0,w.jsx)(B,{latest:Be}),(0,w.jsx)(P,{latest:Be})]}),"weather"===le&&(0,w.jsxs)(w.Fragment,{children:[null!==ee&&void 0!==ee&&ee.current?(0,w.jsxs)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.75rem",alignItems:"center"},children:[(0,w.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.06em",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:"Now"}),[{label:"Temp",value:null!=ee.current.temperature_c?"".concat(Number(ee.current.temperature_c).toFixed(1)," \xb0C"):null},{label:"Humidity",value:null!=ee.current.humidity_pct?"".concat(ee.current.humidity_pct," %"):null},{label:"Cloud",value:null!=ee.current.cloud_cover_pct?"".concat(ee.current.cloud_cover_pct," %"):null,icon:(0,w.jsx)(T,{})},{label:"Wind",value:null!=ee.current.wind_speed_ms?"".concat(Number(ee.current.wind_speed_ms).toFixed(1)," m/s"):null},{label:"GHI",value:null!=ee.current.ghi_wm2?"".concat(Math.round(ee.current.ghi_wm2)," W/m\xb2"):null}].filter(e=>e.value).map(e=>(0,w.jsxs)("span",{style:{fontSize:"0.72rem",fontWeight:600,fontFamily:"Poppins, sans-serif",padding:"0.2rem 0.65rem",borderRadius:99,background:"rgba(0,166,62,0.07)",border:"1px solid rgba(0,166,62,0.12)",color:"#007a55",display:"flex",alignItems:"center",gap:"0.3rem"},children:[e.icon,e.label,": ",(0,w.jsx)("span",{style:{fontFamily:"JetBrains Mono, monospace",color:"var(--text-primary)"},children:e.value})]},e.label))]}):(0,w.jsx)("div",{style:{padding:"1.5rem",textAlign:"center",color:"var(--text-muted)",fontSize:"0.85rem",background:V?"rgba(0,0,0,0.15)":"rgba(0,166,62,0.03)",borderRadius:12,border:"1px dashed rgba(0,166,62,0.15)",marginBottom:"1rem"},children:"No current weather data available."}),null!==ee&&void 0!==ee&&ee.hourly_forecast&&ee.hourly_forecast.length>0?(0,w.jsx)(L,{hourly:ee.hourly_forecast}):!(null!==ee&&void 0!==ee&&ee.current)&&null]}),"history"===le&&($e.length>0?(0,w.jsxs)("div",{className:"card",style:{padding:"1.25rem",marginBottom:"1rem"},children:[(0,w.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,w.jsxs)("h3",{style:{margin:"0 0 0.2rem",fontSize:"0.9rem",fontFamily:"Urbanist, sans-serif",color:"var(--text-primary)"},children:["Power History \u2014 ","24h"===pe?"Today":"7d"===pe?"Last 7 days":"30d"===pe?"Last 30 days":xe&&he?"".concat(new Date(xe).toLocaleDateString([],{timeZone:S})," \u2013 ").concat(new Date(he).toLocaleDateString([],{timeZone:S})):"Custom range"]}),(0,w.jsxs)("p",{style:{margin:0,fontSize:"0.68rem",color:"var(--text-muted)",fontFamily:"Poppins, sans-serif"},children:["7d"===pe?"Hourly aggregates":"24h"!==pe?"Daily aggregates":"30-min samples"," \xb7 Battery SOC on right axis"]})]}),(0,w.jsx)("div",{style:{height:240},children:(0,w.jsx)(c.u,{width:"100%",height:"100%",children:(0,w.jsxs)(m.Q,{data:$e,margin:{top:4,right:44,left:0,bottom:"7d"===pe||"30d"===pe?20:0},children:[(0,w.jsxs)("defs",{children:[(0,w.jsxs)("linearGradient",{id:"pvGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:"#F07522",stopOpacity:.22}),(0,w.jsx)("stop",{offset:"95%",stopColor:"#F07522",stopOpacity:0})]}),(0,w.jsxs)("linearGradient",{id:"loadGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.18}),(0,w.jsx)("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]})]}),(0,w.jsx)(p.d,{strokeDasharray:"3 3",stroke:V?"rgba(148,163,184,0.07)":"rgba(0,166,62,0.08)"}),(0,w.jsx)(u.W,{dataKey:"time",stroke:"var(--text-muted)",interval:"24h"===pe?"preserveStartEnd":Math.ceil($e.length/10),angle:"7d"===pe||"30d"===pe?-15:0,textAnchor:"7d"===pe||"30d"===pe?"end":"middle",tick:{fontSize:"30d"===pe?9:10,fill:"var(--text-muted)"}}),(0,w.jsx)(x.h,{yAxisId:"power",stroke:"var(--text-muted)",tickFormatter:e=>"".concat(e,"kW"),tick:{fontSize:10,fill:"var(--text-muted)"}}),(0,w.jsx)(x.h,{yAxisId:"soc",orientation:"right",stroke:"var(--text-muted)",domain:[0,100],tickFormatter:e=>"".concat(e,"%"),width:36,tick:{fontSize:10,fill:"var(--text-muted)"}}),(0,w.jsx)(g.m,{contentStyle:Me,formatter:(e,t)=>["".concat(e," ").concat(String(t).includes("%")?"%":"kW"),t]}),(0,w.jsx)(h.s,{iconType:"circle",iconSize:8,wrapperStyle:{fontSize:11,fontFamily:"Poppins, sans-serif",color:"var(--text-secondary)"}}),(0,w.jsx)(f.Gk,{yAxisId:"power",type:"monotone",dataKey:"PV (kW)",stroke:"#F07522",strokeWidth:2,fill:"url(#pvGrad)",dot:!1}),(0,w.jsx)(f.Gk,{yAxisId:"power",type:"monotone",dataKey:"Load (kW)",stroke:"#8b5cf6",strokeWidth:2,fill:"url(#loadGrad)",dot:!1}),(0,w.jsx)(b.N1,{yAxisId:"power",type:"monotone",dataKey:"Grid (kW)",stroke:"#3b82f6",strokeWidth:1.5,dot:!1,strokeDasharray:"4 3"}),(0,w.jsx)(b.N1,{yAxisId:"soc",type:"monotone",dataKey:"Batt SOC (%)",stroke:"#00a63e",strokeWidth:1.5,dot:!1,strokeDasharray:"2 3"})]})})})]}):(0,w.jsx)("div",{style:{padding:"2rem",textAlign:"center",color:"var(--text-muted)",fontSize:"0.875rem",background:V?"rgba(0,0,0,0.15)":"rgba(0,166,62,0.03)",borderRadius:12,border:"1px dashed rgba(0,166,62,0.15)"},children:"No telemetry history data available for the selected range."})),"forecast"===le&&(tt.length>0?(0,w.jsxs)("div",{className:"card",style:{padding:0,boxShadow:"0 10px 30px -5px rgba(0,0,0,0.1)",border:"1px solid ".concat(xt),borderRadius:16,background:ct,overflow:"hidden"},children:[(0,w.jsxs)("div",{style:{padding:"1.25rem 1.5rem",borderBottom:"1px solid ".concat(xt),display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center",justifyContent:"space-between",background:mt},children:[(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,w.jsx)("div",{style:{width:32,height:32,borderRadius:8,background:"rgba(0,166,62,0.1)",color:"#00a63e",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.1rem"},children:"\ud83d\udd06"}),(0,w.jsx)("h3",{style:{margin:0,fontSize:"1.1rem",fontFamily:"Urbanist, sans-serif",color:"var(--text-primary)",fontWeight:700},children:"Solar Forecast"})]}),st>0&&(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.6rem",marginLeft:"2.5rem",flexWrap:"wrap"},children:[(0,w.jsxs)("span",{style:{fontSize:"0.82rem",color:"var(--text-muted)",fontFamily:"Inter, sans-serif"},children:["today"===_e?"Today":"3d"===_e?"3-day":"7-day"," Est. Yield:"]}),(0,w.jsxs)("span",{style:{fontFamily:"JetBrains Mono, monospace",fontSize:"0.82rem",fontWeight:600,color:"var(--text-primary)",background:V?"rgba(148,163,184,0.1)":"#f3f4f6",padding:"2px 7px",borderRadius:4},children:[ot.toFixed(1)," ",(0,w.jsx)("span",{style:{color:"var(--text-muted)"},children:"/"})," ",(0,w.jsx)("span",{style:{color:"#00a63e"},children:st.toFixed(1)})," ",(0,w.jsx)("span",{style:{color:"var(--text-muted)"},children:"/"})," ",lt.toFixed(1)," kWh"]}),null!=dt&&(0,w.jsxs)("span",{style:{fontSize:"0.72rem",fontWeight:700,fontFamily:"Poppins, sans-serif",padding:"2px 8px",borderRadius:99,background:dt>=80?"#10b98118":dt>=40?"#f59e0b18":V?"rgba(148,163,184,0.1)":"#e5e7eb",color:dt>=80?"#059669":dt>=40?"#d97706":"var(--text-muted)",border:"1px solid ".concat(dt>=80?"#10b98128":dt>=40?"#f59e0b28":xt)},children:[dt,"% achieved"]})]})]}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[(0,w.jsx)("div",{style:{display:"flex",background:pt,borderRadius:8,padding:3},children:["chart","table"].map(e=>(0,w.jsx)("button",{onClick:()=>ke(e),style:{border:"none",background:we===e?ut:"transparent",color:we===e?"#00a63e":"var(--text-muted)",borderRadius:6,padding:"0.35rem 0.75rem",fontSize:"0.75rem",fontWeight:600,cursor:"pointer",boxShadow:we===e?"0 1px 3px rgba(0,0,0,0.1)":"none",textTransform:"capitalize"},children:e},e))}),"chart"===we&&(0,w.jsx)("div",{style:{display:"flex",background:pt,padding:3,borderRadius:8},children:[{label:"P10",color:"#f59e0b",desc:"Conservative"},{label:"P50",color:"#00a63e",desc:"Median"},{label:"P90",color:"#3b82f6",desc:"Optimistic"}].map(e=>(0,w.jsxs)("button",{onClick:()=>me(t=>(0,i.A)((0,i.A)({},t),{},{[e.label]:!t[e.label]})),style:{border:"none",background:ce[e.label]?ut:"transparent",color:ce[e.label]?e.color:"var(--text-muted)",boxShadow:ce[e.label]?"0 2px 4px rgba(0,0,0,0.05)":"none",borderRadius:6,padding:"0.35rem 0.75rem",fontSize:"0.75rem",fontWeight:600,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:4},title:e.desc,children:[(0,w.jsx)("span",{style:{width:6,height:6,borderRadius:"50%",background:ce[e.label]?e.color:V?"#475569":"#d1d5db"}}),e.label]},e.label))}),(0,w.jsxs)("button",{onClick:async()=>{const e=document.getElementById("forecast-chart-container");if(e){const{default:t}=await r.e(239).then(r.t.bind(r,5239,23)),i=await t(e,{background:"#ffffff",scale:2}),n=document.createElement("a");n.download="solar-forecast-".concat((new Date).toISOString().slice(0,10),".png"),n.href=i.toDataURL(),n.click()}},style:{background:"transparent",border:"1px solid ".concat(xt),color:"var(--text-secondary)",borderRadius:8,padding:"0.4rem 0.8rem",fontSize:"0.8rem",fontWeight:600,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6},onMouseOver:e=>e.currentTarget.style.background=V?"rgba(148,163,184,0.07)":"#f9fafb",onMouseOut:e=>e.currentTarget.style.background="transparent",children:[(0,w.jsx)("span",{children:"\ud83d\udcf7"}),(0,w.jsx)("span",{children:"Save"})]}),(0,w.jsxs)("button",{onClick:()=>{if(!tt||0===tt.length)return;const e=Object.keys(tt[0]),t=[e.join(","),...tt.map(t=>e.map(e=>{var r;return JSON.stringify(null!==(r=t[e])&&void 0!==r?r:"")}).join(","))].join("\n"),r=new Blob([t],{type:"text/csv"}),i=URL.createObjectURL(r),n=document.createElement("a");n.href=i,n.download="solar-forecast-".concat((new Date).toISOString().slice(0,10),".csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)},style:{background:"transparent",border:"1px solid ".concat(xt),color:"#00a63e",borderRadius:8,padding:"0.4rem 0.8rem",fontSize:"0.8rem",fontWeight:600,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6},onMouseOver:e=>e.currentTarget.style.background=V?"rgba(148,163,184,0.07)":"#f9fafb",onMouseOut:e=>e.currentTarget.style.background="transparent",children:[(0,w.jsx)("span",{children:"\ud83d\udcbe"}),(0,w.jsx)("span",{children:"CSV"})]})]})]}),(0,w.jsxs)("div",{id:"forecast-chart-container",style:{padding:"0 1.5rem 1.5rem 0.5rem",background:ct,position:"relative"},children:["chart"===we?(0,w.jsxs)("div",{style:{height:"7d"===_e?360:300,width:"100%",userSelect:"none",cursor:ze?"crosshair":"default"},children:[(0,w.jsx)(c.u,{children:(0,w.jsxs)(m.Q,{data:rt,margin:{top:20,right:10,left:0,bottom:"today"!==_e?10:0},onMouseDown:e=>{null!==e&&void 0!==e&&e.activeLabel&&(Ne(e.activeLabel),Fe(!0))},onMouseMove:e=>{ze&&null!==e&&void 0!==e&&e.activeLabel&&Ae(e.activeLabel)},onMouseUp:()=>{Ce&&De&&Ce!==De&&(Te(Ce),Re(De)),Fe(!1),Ne(""),Ae("")},children:[(0,w.jsxs)("defs",{children:[(0,w.jsxs)("linearGradient",{id:"p50Grad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:"#00a63e",stopOpacity:.2}),(0,w.jsx)("stop",{offset:"95%",stopColor:"#00a63e",stopOpacity:0})]}),(0,w.jsxs)("linearGradient",{id:"p90Grad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.14}),(0,w.jsx)("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]}),(0,w.jsxs)("linearGradient",{id:"p10Grad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,w.jsx)("stop",{offset:"5%",stopColor:"#f59e0b",stopOpacity:.14}),(0,w.jsx)("stop",{offset:"95%",stopColor:"#f59e0b",stopOpacity:0})]})]}),(0,w.jsx)(p.d,{strokeDasharray:"3 3",stroke:V?"rgba(148,163,184,0.07)":"#f3f4f6",vertical:!1}),(0,w.jsx)(u.W,{dataKey:"time",stroke:"var(--text-muted)",tickLine:!1,axisLine:!1,height:42,allowDataOverflow:!0,type:"category",ticks:nt,minTickGap:-1,tick:e=>(0,w.jsx)(E,(0,i.A)((0,i.A)({},e),{},{forecastWindow:_e}))}),(0,w.jsx)(x.h,{stroke:"var(--text-muted)",tickLine:!1,axisLine:!1,width:40,allowDataOverflow:!0,tick:{fontSize:11,fontFamily:"Inter, sans-serif",fill:"var(--text-muted)"},label:{value:"kW",angle:-90,position:"insideLeft",fill:"var(--text-muted)",fontSize:10}}),(0,w.jsx)(g.m,{content:(0,w.jsx)(_,{}),cursor:{stroke:"#00a63e",strokeWidth:1,strokeDasharray:"4 4"},animationDuration:300,wrapperStyle:{pointerEvents:"none"}}),(0,w.jsx)(h.s,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,wrapperStyle:{right:0,top:0,fontSize:12,color:"var(--text-muted)",fontFamily:"Inter, sans-serif"}}),ce.P90&&(0,w.jsx)(f.Gk,{type:"monotone",dataKey:"p90",stroke:"#3b82f6",strokeWidth:1,strokeDasharray:"3 3",fill:"url(#p90Grad)",activeDot:!1,name:"P90 (Optimistic)",animationDuration:500}),ce.P10&&(0,w.jsx)(f.Gk,{type:"monotone",dataKey:"p10",stroke:"#f59e0b",strokeWidth:1,strokeDasharray:"3 3",fill:"url(#p10Grad)",activeDot:!1,name:"P10 (Conservative)",animationDuration:500}),ce.P50&&(0,w.jsx)(f.Gk,{type:"monotone",dataKey:"p50",stroke:"#00a63e",strokeWidth:2.5,fill:"url(#p50Grad)",activeDot:{r:4,strokeWidth:0},name:"P50 (Median)",animationDuration:800}),(0,w.jsx)(b.N1,{type:"monotone",dataKey:"physics",stroke:V?"#475569":"#d1d5db",strokeWidth:1.5,strokeDasharray:"5 3",dot:!1,name:"Physics Baseline",activeDot:!1}),(0,w.jsx)(y.e_,{x:(()=>{const e=new Date,t=e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:S});if("today"===_e)return t;const r="3d"===_e?e.toLocaleDateString([],{weekday:"short",day:"numeric",timeZone:S}):e.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric",timeZone:S});return"".concat(r," || ").concat(t)})(),stroke:"#ef4444",strokeWidth:1.5,strokeDasharray:"3 3",label:{value:"NOW",position:"top",fill:"#ef4444",fontSize:9,fontWeight:700}}),ze&&Ce&&De&&(0,w.jsx)(v.T,{x1:Ce,x2:De,fill:"#00a63e",fillOpacity:.08,stroke:"#00a63e",strokeOpacity:.3,strokeDasharray:"3 3"})]})}),(We||Ie)&&(0,w.jsx)("button",{onClick:()=>{Te(null),Re(null)},style:{position:"absolute",top:10,right:10,background:V?"rgba(30,41,59,0.9)":"rgba(255,255,255,0.92)",border:"1px solid ".concat(V?"rgba(148,163,184,0.2)":"rgba(0,166,62,0.2)"),borderRadius:6,padding:"3px 10px",fontSize:"0.72rem",color:"#00a63e",cursor:"pointer",fontFamily:"Poppins, sans-serif",fontWeight:600,backdropFilter:"blur(4px)"},children:"\u21ba Reset Zoom"}),(0,w.jsx)("div",{style:{position:"absolute",bottom:10,left:24,fontSize:"0.62rem",color:"var(--text-muted)",background:V?"rgba(30,41,59,0.85)":"rgba(255,255,255,0.85)",padding:"2px 6px",borderRadius:4,pointerEvents:"none"},children:We?"Drag to select \xb7 Click \u21ba to reset":"Drag on chart to zoom"})]}):(0,w.jsx)(H,{data:rt}),at&&(0,w.jsxs)("div",{style:{textAlign:"right",fontSize:"0.7rem",color:"var(--text-muted)",marginTop:"0.5rem",fontFamily:"Inter, sans-serif",padding:"0 1rem 1rem"},children:["last updated: ",at.toLocaleString([],{timeZone:S,day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})," IST"]})]})]}):(0,w.jsx)("div",{style:{padding:"2rem",textAlign:"center",color:"var(--text-muted)",fontSize:"0.875rem",background:V?"rgba(0,0,0,0.15)":"rgba(0,166,62,0.03)",borderRadius:12,border:"1px dashed rgba(0,166,62,0.15)"},children:"No forecast data available for the selected range."}))]})]})};var K=r(7315),Y=r(1293);const U=e=>{let{open:t,onClose:r,title:i,children:a,id:o="modal-title"}=e;const s=(0,n.useRef)(null);return(0,n.useEffect)(()=>{var e;if(!t)return;const i=e=>{"Escape"===e.key&&r()};document.addEventListener("keydown",i);const n=document.activeElement;return null===(e=s.current)||void 0===e||e.focus(),()=>{document.removeEventListener("keydown",i),null===n||void 0===n||n.focus()}},[t,r]),t?(0,w.jsx)("div",{className:"modal",role:"dialog","aria-modal":"true","aria-labelledby":o,ref:s,tabIndex:-1,onClick:e=>e.target===e.currentTarget&&r(),children:(0,w.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("h3",{id:o,children:i}),a]})}):null};function J(){const[e,t]=(0,n.useState)(!1),[r,i]=(0,n.useState)(null);return{open:e,data:r,openModal:(0,n.useCallback)(e=>{i(null!==e&&void 0!==e?e:null),t(!0)},[]),closeModal:(0,n.useCallback)(()=>{t(!1),i(null)},[])}}const Z=()=>{var e,t;const{isDark:r}=(0,l.D)(),[c]=(0,a.ok)(),[m,p]=(0,n.useState)([]),[u,x]=(0,n.useState)([]),[g,h]=(0,n.useState)(!0),[f,b]=(0,n.useState)(null),[y,v]=(0,n.useState)(null),[k,_]=(0,n.useState)(!1),[S,C]=(0,n.useState)(""),[N,D]=(0,n.useState)(""),[A,z]=(0,n.useState)([]),[F,W]=(0,n.useState)(!1),[T,I]=(0,n.useState)([]),[R,M]=(0,n.useState)(new Set),[L,B]=(0,n.useState)(!1),[P,O]=(0,n.useState)(1),[E,H]=(0,n.useState)(j.yQ),[Z,V]=(0,n.useState)(0),[q,Q]=(0,n.useState)(0),[X,$]=(0,n.useState)([]),[ee,te]=(0,n.useState)(!0),[re,ie]=(0,n.useState)(null),[ne,ae]=(0,n.useState)(null),[oe,se]=(0,n.useState)([]),[le,de]=(0,n.useState)(null),[ce,me]=(0,n.useState)(null),[pe,ue]=(0,n.useState)([]),[xe,ge]=(0,n.useState)(!1),[he,fe]=(0,n.useState)({device_serial:"",user:"",config_version:""}),[be,ye]=(0,n.useState)({device_serial:"",user:"",config_version:""}),[ve,je]=(0,n.useState)(null),[we,ke]=(0,n.useState)(!1),[_e,Se]=(0,n.useState)(!1),[Ce,Ne]=(0,n.useState)({site_id:"",display_name:"",latitude:"",longitude:"",capacity_kw:"",tilt_deg:"18",azimuth_deg:"180",timezone:j.Bx,is_active:!0}),[De,Ae]=(0,n.useState)(!1),[ze,Fe]=(0,n.useState)(null),[We,Te]=(0,n.useState)(null),Ie=J(),Re=J(),[Me,Le]=(0,n.useState)({show:!1,device:null}),[Be,Pe]=(0,n.useState)({show:!1,deviceList:[]}),[Oe,Ee]=(0,n.useState)({show:!1,message:""}),He=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{h(!0);const r=await o.K.getDevices(t||void 0,e,E);r.results?(p(r.results),x(r.results),V(r.count),Q(r.total_pages),O(r.current_page)):(p(Array.isArray(r)?r:[]),x(Array.isArray(r)?r:[]),V(Array.isArray(r)?r.length:0),Q(1),O(1)),h(!1)}catch(r){b(r instanceof Error?r.message:"An error occurred"),h(!1)}},[E]),Ge=(0,n.useCallback)(async e=>{ge(!0);try{const t=await o.K.getDeviceLogs(e,50,0);ue(t.logs||[])}catch(t){console.error("Failed to fetch device logs:",t),ue([])}finally{ge(!1)}},[]),Ke=(0,n.useCallback)(e=>{if(me(e),je(null),ke(!0),ue([]),e.config_version){const t=X.find(t=>t.config_id===e.config_version);Te(t||null)}else Te(null);Promise.all([o.K.getDeviceSite(e.id).then(e=>je(e)).catch(t=>{console.error("Failed to fetch site for device",e.id,":",t),je(null)}),Ge(e.id)]).finally(()=>ke(!1))},[Ge,X]);(0,n.useEffect)(()=>{(async()=>{try{const e=(await o.K.getUsers()).filter(e=>!e.is_staff&&!e.is_superuser);I(e)}catch(e){console.error("Failed to fetch users:",e),b("Failed to load users for device assignment")}})(),(async()=>{try{const e=await o.K.getPresets();$(Array.isArray(e)?e:[])}catch(e){console.error("Failed to fetch presets:",e)}finally{te(!1)}})(),(async()=>{try{const[e,t]=await Promise.all([o.K.getSystemHealth(),o.K.getTelemetry()]);ie(e||null);const r=Array.isArray(t)?t:[];se(r);const i=r.reduce((e,t)=>{if(null===t||void 0===t||!t.timestamp)return e;const r=new Date(t.timestamp);return Number.isNaN(r.getTime())?e:e?r>new Date(e)?t.timestamp:e:t.timestamp},null),n=new Set(r.map(e=>e.deviceId)).size;ae({totalPoints:r.length,deviceCount:n,latestTimestamp:i})}catch(e){console.error("Failed to fetch dashboard data:",e),de("Failed to load device dashboards")}})()},[]),(0,n.useEffect)(()=>{const e=c.get("deviceId");if(e){const t=parseInt(e,10);if(!isNaN(t)){const e=m.find(e=>e.id===t);e&&Ke(e)}}},[c,m,Ke]),(0,n.useEffect)(()=>{He(P,S)},[P,S,E,He]),(0,n.useEffect)(()=>{const e=()=>{W(!1)};return F&&document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[F]),(0,n.useEffect)(()=>{if(""===N.trim())z(T);else{const e=N.toLowerCase(),t=T.filter(t=>{const r="".concat(t.first_name," ").concat(t.last_name).toLowerCase();return t.username.toLowerCase().includes(e)||t.first_name.toLowerCase().includes(e)||t.last_name.toLowerCase().includes(e)||r.includes(e)||t.email.toLowerCase().includes(e)});z(t)}},[T,N]);const Ye=s(e=>{},300),Ue=e=>{var t,r;v(e),fe({device_serial:e.device_serial,user:e.user||"",config_version:e.config_version||""}),D(e.user?"".concat(null===(t=T.find(t=>t.username===e.user))||void 0===t?void 0:t.first_name," ").concat(null===(r=T.find(t=>t.username===e.user))||void 0===r?void 0:r.last_name," (").concat(e.user,")"):""),W(!1)},Je=async()=>{if(y)try{await o.K.updateDevice(y.id,he),v(null),await He(P,S)}catch(e){b(e instanceof Error?e.message:"Failed to update device")}},Ze=async()=>{try{await o.K.createDevice(be),_(!1),ye({device_serial:"",user:"",config_version:""}),await He(P,S)}catch(e){b(e instanceof Error?e.message:"Failed to create device")}},Ve=async()=>{if(Ie.data)try{await o.K.rebootDevice(Ie.data.id);const e=Ie.data.device_serial;Ie.closeModal(),Ee({show:!0,message:"Reboot command queued for ".concat(e,". Device will reboot on next heartbeat.")})}catch(e){b(e instanceof Error?e.message:"Failed to queue reboot command"),Ie.closeModal()}},qe=async()=>{if(Me.device)try{await o.K.hardResetDevice(Me.device.id),Le({show:!1,device:null}),Ee({show:!0,message:"Hard reset command queued for ".concat(Me.device.device_serial,". Device will reset on next heartbeat.")})}catch(e){console.error("Hard reset error:",e),b(e instanceof Error?e.message:"Failed to queue hard reset command"),Le({show:!1,device:null})}},Qe=async()=>{if(Re.data)try{await o.K.deleteDevice(Re.data.id);const e=Re.data.device_serial;Re.closeModal(),Ee({show:!0,message:"Device ".concat(e," has been permanently deleted.")}),me(null),He()}catch(e){b(e instanceof Error?e.message:"Failed to delete device"),Re.closeModal()}},Xe=()=>{v(null),_(!1),D(""),W(!1)},$e=()=>{me(null),je(null),Se(!1)};if(g)return(0,w.jsxs)("div",{children:[(0,w.jsx)("h1",{children:"Device Management"}),(0,w.jsxs)("div",{className:"card",children:[(0,w.jsx)("div",{className:"card-header",children:(0,w.jsx)("h2",{children:"Devices"})}),(0,w.jsx)(Y.uw,{count:6})]})]});if(f)return(0,w.jsxs)("div",{className:"error",children:["Error: ",f]});const et=e=>{var t,r;return(null===(t=e.gateway_configuration)||void 0===t||null===(r=t.general_settings)||void 0===r?void 0:r.config_id)||e.config_id||""};if(ce){var tt,rt;const e=oe.filter(e=>e.deviceId===ce.device_serial),t=e.reduce((e,t)=>{if(null===t||void 0===t||!t.timestamp)return e;const r=new Date(t.timestamp);if(Number.isNaN(r.getTime()))return e;if(!e)return t.timestamp;return r>new Date(e)?t.timestamp:e},null);return(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[(0,w.jsx)("button",{onClick:$e,className:"btn btn-secondary",style:{marginRight:"15px"},children:"\u2190 Back to Devices"}),(0,w.jsxs)("h1",{style:{margin:0},children:[ce.device_serial," Dashboard"]})]}),(0,w.jsxs)("div",{className:"card",style:{marginBottom:"20px"},children:[(0,w.jsxs)("div",{className:"card-header",children:[(0,w.jsx)("h2",{children:"Device Details"}),(0,w.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,w.jsx)("button",{onClick:()=>Ue(ce),className:"btn",children:"Edit Device"}),(0,w.jsx)("button",{onClick:()=>(async e=>{Ie.openModal(e)})(ce),className:"btn",style:{backgroundColor:"#f59e0b",color:"white",border:"none"},title:"Queue reboot command for device",children:"\ud83d\udd04 Reboot"}),(0,w.jsx)("button",{onClick:()=>(async e=>{Le({show:!0,device:e})})(ce),className:"btn",style:{backgroundColor:"#dc2626",color:"white",border:"none"},title:"Queue hard reset command for device (erases config)",children:"\u26a0\ufe0f Hard Reset"}),(0,w.jsx)("button",{onClick:()=>{return e=ce,void Re.openModal(e);var e},className:"btn",style:{backgroundColor:"#7f1d1d",color:"white",border:"none"},title:"Permanently delete device and all its data",children:"\ud83d\uddd1\ufe0f Delete"})]})]}),(0,w.jsx)("div",{style:{padding:"20px"},children:(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"15px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Status:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:(0,w.jsx)("span",{style:{display:"inline-block",padding:"4px 12px",borderRadius:"12px",fontSize:"0.875rem",fontWeight:"500",backgroundColor:ce.is_online?"#dcfce7":"#fee2e2",color:ce.is_online?"#166534":"#991b1b"},children:ce.is_online?"\ud83d\udfe2 Online":"\ud83d\udd34 Offline"})})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Last Heartbeat:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:ce.last_heartbeat?new Date(ce.last_heartbeat).toLocaleString():"Never"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"MAC / HW ID:"}),(0,w.jsx)("p",{style:{margin:"5px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.9rem"},children:ce.hw_id||"\u2014"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Model:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:ce.model||"\u2014"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Assigned User:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:ce.user||"-"})]}),(0,w.jsxs)("div",{style:{gridColumn:"1 / -1",padding:"15px",backgroundColor:"transparent",borderRadius:"8px",border:r?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-sync-card",children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{style:{fontSize:"0.95rem",color:"inherit"},className:"config-heading",children:"Configuration"}),We&&(0,w.jsx)("div",{style:{fontSize:"0.875rem",color:r?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginTop:"2px"},className:"config-label",children:We.name||ce.config_version})]}),ce.config_version?ce.pending_config_update?(0,w.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:"5px",padding:"4px 12px",borderRadius:"12px",fontSize:"0.8rem",fontWeight:"500",backgroundColor:"#fef9c3",color:"#854d0e"},children:"\u23f3 Pending update"}):(0,w.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:"5px",padding:"4px 12px",borderRadius:"12px",fontSize:"0.8rem",fontWeight:"500",backgroundColor:"#dcfce7",color:"#166534"},children:"\u2713 Synced"}):(0,w.jsx)("span",{style:{color:r?"#a0a0a0":"rgba(0, 0, 0, 0.5)",fontSize:"0.875rem"},className:"config-no-preset",children:"No preset assigned"})]}),ce.config_version&&(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px",fontSize:"0.8rem"},children:[(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:r?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:r?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:r?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Preset ID"}),(0,w.jsx)("div",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:ce.config_version})]}),null!=(null===We||void 0===We?void 0:We.slaves_count)&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:r?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:r?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:r?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Slaves"}),(0,w.jsxs)("div",{style:{fontWeight:"500",color:"inherit"},children:[We.slaves_count," device",1!==We.slaves_count?"s":""]})]}),null!=ce.config_ack_ver&&null!=(null===We||void 0===We?void 0:We.version)&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:r?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",gridColumn:"1 / -1",border:ce.config_ack_ver===We.version?"2px solid #dcfce7":"2px solid #fef9c3"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:r?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"4px"},className:"config-label",children:"Version Status"}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{fontSize:"0.75rem",color:r?"#b0b0b0":"rgba(0, 0, 0, 0.6)"},className:"config-label",children:"Device: "}),(0,w.jsxs)("span",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:["v",ce.config_ack_ver]}),(0,w.jsx)("span",{style:{margin:"0 8px",color:r?"#808080":"rgba(0, 0, 0, 0.4)"},className:"config-arrow",children:"\u2192"}),(0,w.jsx)("span",{style:{fontSize:"0.75rem",color:r?"#b0b0b0":"rgba(0, 0, 0, 0.6)"},className:"config-label",children:"Latest: "}),(0,w.jsxs)("span",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:["v",We.version]})]}),ce.config_ack_ver===We.version?(0,w.jsx)("span",{style:{color:"#166534",fontSize:"0.75rem",fontWeight:"500"},children:"\u2713 Up to date"}):(0,w.jsx)("span",{style:{color:"#854d0e",fontSize:"0.75rem",fontWeight:"500"},children:"\u27f3 Update available"})]})]}),null!=ce.config_ack_ver&&null==(null===We||void 0===We?void 0:We.version)&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:r?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:r?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:r?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Device Version"}),(0,w.jsxs)("div",{style:{fontWeight:"500",fontFamily:"monospace",color:"inherit"},children:["v",ce.config_ack_ver]})]}),(null===We||void 0===We||null===(tt=We.gateway_configuration)||void 0===tt||null===(rt=tt.general_settings)||void 0===rt?void 0:rt.last_updated)&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:r?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:r?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:r?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Last Modified"}),(0,w.jsx)("div",{style:{fontWeight:"500",fontSize:"0.75rem",color:"inherit"},children:new Date(We.gateway_configuration.general_settings.last_updated).toLocaleDateString()})]}),ce.config_acked_at&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:r?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:r?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)",gridColumn:"1 / -1"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:r?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Last Synced"}),(0,w.jsxs)("div",{style:{fontWeight:"500",fontSize:"0.75rem",color:"inherit"},children:[new Date(ce.config_acked_at).toLocaleString(),(()=>{const e=new Date(ce.config_acked_at),t=(new Date).getTime()-e.getTime(),r=Math.floor(t/6e4),i=Math.floor(r/60),n=Math.floor(i/24);return r<1?" \u2022 just now":r<60?" \u2022 ".concat(r,"m ago"):i<24?" \u2022 ".concat(i,"h ago"):" \u2022 ".concat(n,"d ago")})()]})]}),ce.config_downloaded_at&&ce.config_acked_at&&(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:r?"#242424":"rgba(0, 0, 0, 0.05)",borderRadius:"6px",border:r?"1px solid #404040":"1px solid rgba(0, 0, 0, 0.1)",gridColumn:"1 / -1"},className:"config-info-box",children:[(0,w.jsx)("div",{style:{color:r?"#b0b0b0":"rgba(0, 0, 0, 0.6)",marginBottom:"2px"},className:"config-label",children:"Apply Duration"}),(0,w.jsxs)("div",{style:{fontWeight:"500",color:"inherit"},children:[Math.round((new Date(ce.config_acked_at).getTime()-new Date(ce.config_downloaded_at).getTime())/1e3)," seconds",(0,w.jsx)("span",{style:{color:r?"#a0a0a0":"rgba(0, 0, 0, 0.5)",marginLeft:"8px",fontSize:"0.75rem"},className:"config-label",children:"(download \u2192 acknowledge)"})]})]})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Provisioned At:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:ce.provisioned_at?new Date(ce.provisioned_at).toLocaleDateString():"N/A"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Created By:"}),(0,w.jsx)("p",{style:{margin:"5px 0"},children:ce.created_by_username||"-"})]}),(0,w.jsx)("div",{style:{gridColumn:"1 / -1"},children:(0,w.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[(0,w.jsx)("input",{type:"checkbox",checked:ce.logs_enabled||!1,onChange:e=>(async(e,t)=>{try{await o.K.toggleDeviceLogs(e.id,t),me((0,i.A)((0,i.A)({},e),{},{logs_enabled:t})),He()}catch(r){console.error("Toggle logs error:",r),b(r instanceof Error?r.message:"Failed to toggle device logs")}})(ce,e.target.checked),style:{background:r?"#1a1a1a":"white",border:r?"1px solid #404040":"1px solid #ced4da"}}),(0,w.jsx)("strong",{children:"Enable Device Logs"}),(0,w.jsx)("span",{style:{fontSize:"0.875rem",color:r?"#b0b0b0":"#9ca3af"},children:"(Device will send logs when enabled)"})]})})]})})]}),(0,w.jsxs)("div",{className:"grid grid-cols-2",style:{gap:"var(--space-6, 24px)",marginTop:"32px"},children:[(0,w.jsxs)("div",{className:"card",children:[(0,w.jsx)("h2",{children:"System Health"}),le&&(0,w.jsx)("p",{className:"error",children:le}),!le&&!re&&(0,w.jsx)("p",{children:"Loading system health..."}),re&&(0,w.jsxs)("div",{children:[(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Overall:"})," ",re.overall_health]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Devices:"})," ",re.active_devices,"/",re.total_devices," active"]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Telemetry Points:"})," ",re.total_telemetry_points.toLocaleString()]})]})]}),(0,w.jsxs)("div",{className:"card",children:[(0,w.jsx)("h2",{children:"Telemetry Snapshot"}),le&&(0,w.jsx)("p",{className:"error",children:le}),!le&&!ne&&(0,w.jsx)("p",{children:"Loading telemetry..."}),ne&&(0,w.jsxs)("div",{children:[(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Total Points:"})," ",e.length.toLocaleString()]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Data Types:"})," ",new Set(e.map(e=>e.data_type)).size]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Latest:"})," ",t?new Date(t).toLocaleString():"N/A"]})]})]})]}),(0,w.jsxs)("div",{className:"card",style:{marginTop:"48px"},children:[(0,w.jsxs)("div",{className:"card-header",children:[(0,w.jsx)("h2",{children:"Site Configuration"}),!we&&(0,w.jsx)("button",{className:"btn",onClick:()=>{Ne(ve?{site_id:ve.site_id,display_name:ve.display_name,latitude:String(ve.latitude),longitude:String(ve.longitude),capacity_kw:String(ve.capacity_kw),tilt_deg:String(ve.tilt_deg),azimuth_deg:String(ve.azimuth_deg),timezone:ve.timezone,is_active:ve.is_active}:{site_id:"",display_name:"",latitude:"",longitude:"",capacity_kw:"",tilt_deg:"18",azimuth_deg:"180",timezone:j.Bx,is_active:!0}),Fe(null),Se(!0)},children:ve?"Edit Site":"Add Site"})]}),(0,w.jsx)("div",{style:{padding:"20px"},children:we?(0,w.jsx)("p",{style:{color:"var(--text-muted)"},children:"Loading site details\u2026"}):ve?(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"15px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Site ID:"}),(0,w.jsx)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.88rem",color:"#00a63e"},children:ve.site_id})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Display Name:"}),(0,w.jsx)("p",{style:{margin:"4px 0"},children:ve.display_name||"\u2014"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Status:"}),(0,w.jsx)("p",{style:{margin:"4px 0"},children:(0,w.jsx)("span",{className:ve.is_active?"status-badge status-badge-success":"status-badge status-badge-danger",children:ve.is_active?"Active":"Inactive"})})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Latitude:"}),(0,w.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.88rem"},children:[ve.latitude,"\xb0"]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Longitude:"}),(0,w.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace",fontSize:"0.88rem"},children:[ve.longitude,"\xb0"]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Timezone:"}),(0,w.jsx)("p",{style:{margin:"4px 0"},children:ve.timezone})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Capacity:"}),(0,w.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace"},children:[ve.capacity_kw," kW"]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Tilt:"}),(0,w.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace"},children:[ve.tilt_deg,"\xb0"]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Azimuth:"}),(0,w.jsxs)("p",{style:{margin:"4px 0",fontFamily:"JetBrains Mono, monospace"},children:[ve.azimuth_deg,"\xb0"]})]})]}):(0,w.jsx)("p",{style:{color:"var(--text-muted)",fontSize:"0.9rem"},children:"No site configured for this device yet."})})]}),ve&&(0,w.jsx)("div",{style:{marginTop:"48px"},children:(0,w.jsx)(G,{siteId:ve.site_id,autoRefresh:!0})}),(0,w.jsxs)("div",{className:"card",style:{marginTop:"48px",marginBottom:"20px"},children:[(0,w.jsxs)("div",{className:"card-header",children:[(0,w.jsx)("h2",{children:"Device Logs"}),(0,w.jsx)("button",{onClick:()=>Ge(ce.id),className:"btn",disabled:xe,children:xe?"Loading...":"\ud83d\udd04 Refresh"})]}),(0,w.jsxs)("div",{style:{padding:"20px"},children:[!ce.logs_enabled&&(0,w.jsx)("p",{style:{color:"var(--text-muted, #9ca3af)",fontStyle:"italic"},children:"Logging is disabled for this device. Enable it in Device Details to receive logs."}),0===pe.length&&ce.logs_enabled&&!xe&&(0,w.jsx)("p",{style:{color:"var(--text-muted, #9ca3af)"},children:"No logs available yet. Logs will appear when device sends them."}),xe&&(0,w.jsx)("p",{style:{color:"var(--text-muted, #9ca3af)"},children:"Loading logs..."}),pe.length>0&&(0,w.jsx)("div",{style:{maxHeight:"400px",overflowY:"auto",fontFamily:"JetBrains Mono, monospace",fontSize:"0.85rem",backgroundColor:"#1e1e1e",padding:"10px",borderRadius:"4px"},children:pe.map(e=>(0,w.jsxs)("div",{style:{marginBottom:"8px",paddingBottom:"8px",borderBottom:"1px solid #333",color:"ERROR"===e.level?"#ff6b6b":"WARNING"===e.level?"#ffa500":"INFO"===e.level?"#4dabf7":"#ced4da"},children:[(0,w.jsxs)("span",{style:{color:"#888"},children:["[",new Date(e.timestamp).toLocaleString(),"]"]}),(0,w.jsxs)("span",{style:{fontWeight:"bold",marginLeft:"8px"},children:["[",e.level,"]"]}),(0,w.jsx)("span",{style:{marginLeft:"8px"},children:e.message})]},e.id))})]})]}),_e&&(0,w.jsx)("div",{className:"modal",children:(0,w.jsxs)("div",{className:"modal-content",children:[(0,w.jsx)("h3",{children:ve?"Edit Site: ".concat(ve.site_id):"Add Site Configuration"}),(0,w.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),Ae(!0),Fe(null);try{const e={site_id:Ce.site_id.trim(),display_name:Ce.display_name.trim(),latitude:parseFloat(Ce.latitude),longitude:parseFloat(Ce.longitude),capacity_kw:parseFloat(Ce.capacity_kw),tilt_deg:parseFloat(Ce.tilt_deg),azimuth_deg:parseFloat(Ce.azimuth_deg),timezone:Ce.timezone.trim(),is_active:Ce.is_active};let t;if(t=ve?await o.K.updateDeviceSite(ce.id,e):await o.K.createDeviceSite(ce.id,e),!t||!t.site_id)throw new Error("Invalid response from server \u2014 site data missing");je(t),Se(!1),Ae(!1),ve||setTimeout(()=>{o.K.getDeviceSite(ce.id).then(e=>{e&&je(e)}).catch(e=>console.error("Failed to re-fetch site:",e))},500)}catch(t){Fe(t.message||"Failed to save site"),Ae(!1)}},children:[(0,w.jsxs)("div",{className:"modal-body",children:[ze&&(0,w.jsx)("p",{style:{color:r?"#fca5a5":"#ef4444",fontSize:"0.875rem",marginBottom:"1rem"},children:ze}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Identification"}),(0,w.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Site ID *"}),(0,w.jsx)("input",{type:"text",required:!0,value:Ce.site_id,disabled:!!ve,onChange:e=>Ne((0,i.A)((0,i.A)({},Ce),{},{site_id:e.target.value})),placeholder:"e.g. site_mumbai_01",autoComplete:"off",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}}),!!ve&&(0,w.jsx)("small",{className:"form-hint",children:"Site ID cannot be changed after creation."})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Display Name"}),(0,w.jsx)("input",{type:"text",value:Ce.display_name,onChange:e=>Ne((0,i.A)((0,i.A)({},Ce),{},{display_name:e.target.value})),placeholder:"e.g. Mumbai Rooftop",autoComplete:"off",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]})]})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Location"}),(0,w.jsxs)("div",{className:"form-grid form-grid-3",children:[(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Latitude *"}),(0,w.jsx)("input",{type:"number",required:!0,step:"any",value:Ce.latitude,onChange:e=>Ne((0,i.A)((0,i.A)({},Ce),{},{latitude:e.target.value})),placeholder:"19.0760",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Longitude *"}),(0,w.jsx)("input",{type:"number",required:!0,step:"any",value:Ce.longitude,onChange:e=>Ne((0,i.A)((0,i.A)({},Ce),{},{longitude:e.target.value})),placeholder:"72.8777",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Timezone"}),(0,w.jsx)("input",{type:"text",value:Ce.timezone,onChange:e=>Ne((0,i.A)((0,i.A)({},Ce),{},{timezone:e.target.value})),placeholder:"Asia/Kolkata",autoComplete:"off",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]})]})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Panel Configuration"}),(0,w.jsxs)("div",{className:"form-grid form-grid-3",children:[(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Capacity (kW) *"}),(0,w.jsx)("input",{type:"number",required:!0,step:"any",value:Ce.capacity_kw,onChange:e=>Ne((0,i.A)((0,i.A)({},Ce),{},{capacity_kw:e.target.value})),placeholder:"5.0",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Tilt (\xb0)"}),(0,w.jsx)("input",{type:"number",step:"any",value:Ce.tilt_deg,onChange:e=>Ne((0,i.A)((0,i.A)({},Ce),{},{tilt_deg:e.target.value})),style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Azimuth (\xb0)"}),(0,w.jsx)("input",{type:"number",step:"any",value:Ce.azimuth_deg,onChange:e=>Ne((0,i.A)((0,i.A)({},Ce),{},{azimuth_deg:e.target.value})),style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]})]}),(0,w.jsx)("div",{className:"form-group",children:(0,w.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[(0,w.jsx)("input",{type:"checkbox",id:"dev-site-active",checked:Ce.is_active,onChange:e=>Ne((0,i.A)((0,i.A)({},Ce),{},{is_active:e.target.checked})),style:{width:"16px",height:"16px",background:r?"#1a1a1a":"white",border:r?"1px solid #404040":"1px solid #ced4da"}}),"Active"]})})]})]}),(0,w.jsxs)("div",{className:"form-actions",style:{padding:"0 24px 24px 24px"},children:[(0,w.jsx)("button",{type:"submit",className:"btn",disabled:De,children:De?"Saving\u2026":ve?"Save Changes":"Add Site"}),(0,w.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>Se(!1),disabled:De,children:"Cancel"})]})]})]})}),y&&(0,w.jsx)("div",{className:"modal",children:(0,w.jsxs)("div",{className:"modal-content",children:[(0,w.jsx)("h3",{children:y?"Edit Device: ".concat(y.device_serial):"Register New Device"}),(0,w.jsxs)("form",{onSubmit:e=>{e.preventDefault(),y?Je():Ze()},children:[(0,w.jsxs)("div",{className:"modal-body",children:[(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Device Identity"}),(0,w.jsx)("div",{className:"form-grid",children:(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Device Serial Number"}),(0,w.jsx)("input",{type:"text",value:y?he.device_serial:be.device_serial,onChange:e=>y?fe((0,i.A)((0,i.A)({},he),{},{device_serial:e.target.value})):ye((0,i.A)((0,i.A)({},be),{},{device_serial:e.target.value})),required:!0,autoComplete:"off",placeholder:"SN-12345678",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]})})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Ownership & Assignment"}),(0,w.jsx)("div",{className:"form-grid",children:(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Assigned User"}),(0,w.jsxs)("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("input",{type:"text",placeholder:"Search by name, username, or email...",value:N,onChange:e=>{D(e.target.value),W(!0)},onFocus:()=>W(!0),autoComplete:"off",className:"full-width",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}}),F&&(0,w.jsx)("div",{style:{position:"absolute",top:"100%",left:"0",right:"0",background:"var(--bg-secondary, #1e293b)",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"6px",marginTop:"4px",maxHeight:"200px",overflowY:"auto",zIndex:10,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:A.length>0?A.map(e=>(0,w.jsxs)("div",{onClick:()=>{y?fe((0,i.A)((0,i.A)({},he),{},{user:e.username})):ye((0,i.A)((0,i.A)({},be),{},{user:e.username})),D("".concat(e.first_name," ").concat(e.last_name," (").concat(e.username,")")),W(!1)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",background:(y?he.user:be.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",color:"var(--text-primary, #f8fafc)",transition:"all 0.15s ease",fontSize:"0.875rem"},onMouseEnter:e=>e.currentTarget.style.background="rgba(255, 255, 255, 0.06)",onMouseLeave:t=>t.currentTarget.style.background=(y?he.user:be.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",children:[e.first_name," ",e.last_name," (",e.username,") ",(0,w.jsx)("br",{}),(0,w.jsx)("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary, #94a3b8)"},children:e.email})]},e.id)):(0,w.jsx)("div",{style:{padding:"12px 16px",color:"var(--text-muted, #64748b)",fontSize:"0.875rem"},children:""===N.trim()?"Start typing to search users...":"No users found"})})]})]})})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Configuration"}),(0,w.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Preset Template"}),(0,w.jsxs)("select",{value:y?he.config_version:be.config_version,onChange:e=>y?fe((0,i.A)((0,i.A)({},he),{},{config_version:e.target.value})):ye((0,i.A)((0,i.A)({},be),{},{config_version:e.target.value})),className:"full-width",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"},children:[(0,w.jsx)("option",{value:"",children:"-- Manual Configuration --"}),ee&&(0,w.jsx)("option",{value:"",disabled:!0,children:"Loading presets..."}),!ee&&X.map(e=>(0,w.jsxs)("option",{value:et(e),children:[e.name," (",et(e)||"no ID",")"]},e.id))]}),(0,w.jsx)("small",{className:"form-hint",children:"Selecting a preset sets the Config Version ID below."})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Config Version ID"}),(0,w.jsx)("input",{type:"text",value:y?he.config_version:be.config_version,onChange:e=>y?fe((0,i.A)((0,i.A)({},he),{},{config_version:e.target.value})):ye((0,i.A)((0,i.A)({},be),{},{config_version:e.target.value})),autoComplete:"off",placeholder:"Manual Config ID",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]})]})]})]}),y&&(0,w.jsx)("div",{style:{padding:"0 24px"},children:(0,w.jsx)(d.A,{createdBy:y.created_by_username,createdAt:y.created_at,updatedBy:y.updated_by_username,updatedAt:y.updated_at})}),(0,w.jsxs)("div",{className:"form-actions",style:{padding:"0 24px 24px 24px"},children:[(0,w.jsx)("button",{type:"submit",className:"btn",children:y?"Save Changes":"Create Device"}),(0,w.jsx)("button",{type:"button",onClick:Xe,className:"btn btn-secondary",children:"Cancel"})]})]})]})}),(0,w.jsx)(U,{open:Ie.open,onClose:Ie.closeModal,title:"Confirm Reboot",id:"reboot-modal-title",children:Ie.data&&(0,w.jsxs)("div",{className:"modal-reboot-content",children:[(0,w.jsxs)("p",{className:"modal-reboot-message",children:["Are you sure you want to reboot device ",(0,w.jsx)("strong",{children:Ie.data.device_serial}),"?"]}),(0,w.jsxs)("div",{className:"modal-warning-box modal-reboot-note",children:[(0,w.jsx)("strong",{children:"\u2139\ufe0f Note:"})," The device will restart on its next heartbeat. Any unsaved data may be lost."]}),(0,w.jsxs)("div",{className:"modal-actions",children:[(0,w.jsx)("button",{type:"button",className:"btn-secondary",onClick:Ie.closeModal,children:"Cancel"}),(0,w.jsx)("button",{type:"button",className:"btn-primary",onClick:Ve,children:"Confirm Reboot"})]})]})}),Me.show&&Me.device&&(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:(0,w.jsxs)("div",{style:{background:r?"#2d2d2d":"white",borderRadius:"16px",padding:"2rem",maxWidth:"500px",width:"90%",boxShadow:r?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:"2px solid #dc3545",animation:"slideIn 0.2s ease-out"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[(0,w.jsx)("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",animation:"pulse 2s infinite"},children:"\u26a0\ufe0f"}),(0,w.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",margin:0,color:"#dc3545"},children:"Hard Reset Warning"})]}),(0,w.jsxs)("div",{style:{marginBottom:"1.5rem",color:r?"#b0b0b0":"#495057",lineHeight:"1.6"},children:[(0,w.jsxs)("div",{style:{background:r?"rgba(220, 53, 69, 0.1)":"#f8d7da",border:r?"1px solid rgba(220, 53, 69, 0.3)":"1px solid #f5c6cb",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",color:r?"#ff9999":"#721c24"},children:[(0,w.jsx)("strong",{style:{fontSize:"1.05rem"},children:"\u26a0\ufe0f CRITICAL WARNING"}),(0,w.jsxs)("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem"},children:["This action will ",(0,w.jsx)("strong",{children:"erase all device configuration"})," and restart the device to factory settings."]})]}),(0,w.jsxs)("p",{style:{marginBottom:"0.75rem"},children:["Device to reset: ",(0,w.jsx)("strong",{style:{color:r?"#e0e0e0":"#2c3e50"},children:Me.device.device_serial})]}),(0,w.jsxs)("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[(0,w.jsx)("li",{children:"All configuration will be lost"}),(0,w.jsx)("li",{children:"Device will return to factory defaults"}),(0,w.jsx)("li",{children:"Re-provisioning will be required"})]})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[(0,w.jsx)("button",{onClick:()=>Le({show:!1,device:null}),style:{background:r?"#3a3a3a":"#e0e0e0",color:r?"#e0e0e0":"#495057",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.background=r?"#4a4a4a":"#d0d0d0",onMouseOut:e=>e.currentTarget.style.background=r?"#3a3a3a":"#e0e0e0",children:"Cancel"}),(0,w.jsx)("button",{onClick:qe,style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(220, 53, 69, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.transform="translateY(-1px)",onMouseOut:e=>e.currentTarget.style.transform="translateY(0)",children:"Yes, Hard Reset"})]})]})}),(0,w.jsx)(U,{open:Re.open,onClose:Re.closeModal,title:"Delete Device Permanently",id:"delete-modal-title",children:Re.data&&(0,w.jsxs)("div",{className:"modal-delete-content",children:[(0,w.jsxs)("div",{className:"modal-warning-box",children:[(0,w.jsx)("strong",{children:"\u26a0\ufe0f PERMANENT DELETION"}),(0,w.jsx)("p",{children:"This action cannot be undone. All device data will be permanently deleted."})]}),(0,w.jsxs)("p",{children:["Device to delete: ",(0,w.jsx)("strong",{children:Re.data.device_serial})]}),(0,w.jsxs)("ul",{className:"modal-consequences-list",children:[(0,w.jsx)("li",{children:"All telemetry data will be lost"}),(0,w.jsx)("li",{children:"All command history will be deleted"}),(0,w.jsx)("li",{children:"Device must be re-provisioned to use again"})]}),(0,w.jsxs)("div",{className:"modal-actions",children:[(0,w.jsx)("button",{type:"button",className:"btn-secondary",onClick:Re.closeModal,children:"Cancel"}),(0,w.jsx)("button",{type:"button",className:"btn-danger",onClick:Qe,children:"Yes, Delete Permanently"})]})]})}),Oe.show&&(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)"},children:(0,w.jsx)("div",{style:{background:r?"#2d2d2d":"white",borderRadius:"16px",padding:"2rem",maxWidth:"450px",width:"90%",boxShadow:r?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:r?"1px solid #28a745":"2px solid #28a745",animation:"slideIn 0.2s ease-out"},children:(0,w.jsxs)("div",{style:{textAlign:"center"},children:[(0,w.jsx)("div",{style:{width:"64px",height:"64px",borderRadius:"50%",background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",margin:"0 auto 1rem",animation:"scaleIn 0.3s ease-out"},children:"\u2713"}),(0,w.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",marginBottom:"1rem",color:r?"#e0e0e0":"#2c3e50"},children:"Command Queued"}),(0,w.jsx)("p",{style:{color:r?"#b0b0b0":"#495057",lineHeight:"1.6",marginBottom:"1.5rem"},children:Oe.message}),(0,w.jsx)("button",{onClick:()=>Ee({show:!1,message:""}),style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",color:"white",border:"none",padding:"0.75rem 2rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(40, 167, 69, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.transform="translateY(-1px)",onMouseOut:e=>e.currentTarget.style.transform="translateY(0)",children:"Got it!"})]})})})]})}return(0,w.jsxs)("div",{children:[(0,w.jsx)("h1",{children:"Device Management"}),(0,w.jsxs)("div",{className:"card",children:[(0,w.jsxs)("div",{className:"card-header",children:[(0,w.jsxs)("h2",{children:["Devices (",u.length,")"]}),(0,w.jsxs)("div",{className:"card-actions",children:[(0,w.jsx)("input",{type:"text",placeholder:"Search devices...",value:S,onChange:e=>{const t=e.target.value;C(t),O(1),Ye(t)},className:"search-input",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}}),R.size>0&&(0,w.jsx)("button",{onClick:()=>{if(0===R.size)return void b("No devices selected for deletion");const e=Array.from(R).map(e=>m.find(t=>t.id===e)).filter(Boolean);Pe({show:!0,deviceList:e})},disabled:L,style:{background:"var(--danger-color, #ef4444)",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:L?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:"500",opacity:L?"0.6":"1"},children:L?"Deleting ".concat(R.size,"..."):"Delete Selected (".concat(R.size,")")}),(0,w.jsx)("button",{onClick:()=>{_(!0),D(""),W(!1)},className:"btn",children:"Register New Device"})]})]}),(0,w.jsxs)("table",{className:"table",children:[(0,w.jsx)("thead",{children:(0,w.jsxs)("tr",{children:[(0,w.jsx)("th",{style:{textAlign:"center",width:"40px"},children:(0,w.jsx)("input",{type:"checkbox",checked:R.size===u.length&&u.length>0,onChange:()=>{if(R.size===u.length)M(new Set);else{const e=new Set(u.map(e=>e.id));M(e)}},title:"Select all displayed devices",style:{background:r?"#1a1a1a":"white",border:r?"1px solid #404040":"1px solid #ced4da"}})}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Device Serial"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Status"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"MAC / HW ID"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Model"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Assigned To"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Config Version"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Provisioned At"}),(0,w.jsx)("th",{style:{textAlign:"center"},children:"Actions"})]})}),(0,w.jsx)("tbody",{children:0===u.length?(0,w.jsx)("tr",{children:(0,w.jsx)("td",{colSpan:8,style:{textAlign:"center",padding:"2rem"},children:(0,w.jsx)(K.p,{title:S?"No devices match your search":"No devices yet",description:S?"Try a different search term.":"Register a device to get started.",action:S?void 0:{label:"Register New Device",onClick:()=>{_(!0),D(""),W(!1)}}})})}):u.map(e=>(0,w.jsxs)("tr",{onClick:()=>Ke(e),style:{background:R.has(e.id)?"rgba(99, 102, 241, 0.1)":"transparent",cursor:"pointer"},className:"clickable-row",children:[(0,w.jsx)("td",{style:{textAlign:"center"},onClick:e=>e.stopPropagation(),children:(0,w.jsx)("input",{type:"checkbox",checked:R.has(e.id),onChange:()=>(e=>{const t=new Set(R);t.has(e)?t.delete(e):t.add(e),M(t)})(e.id),onClick:e=>e.stopPropagation(),style:{background:r?"#1a1a1a":"white",border:r?"1px solid #404040":"1px solid #ced4da"}})}),(0,w.jsx)("td",{style:{textAlign:"center",fontFamily:"JetBrains Mono, monospace",fontSize:"0.85rem"},children:e.device_serial}),(0,w.jsx)("td",{style:{textAlign:"center"},children:(0,w.jsx)("span",{style:{display:"inline-block",padding:"4px 8px",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"500",backgroundColor:e.is_online?"#dcfce7":"#fee2e2",color:e.is_online?"#166534":"#991b1b"},children:e.is_online?"\ud83d\udfe2 Online":"\ud83d\udd34 Offline"})}),(0,w.jsx)("td",{style:{textAlign:"center",fontFamily:"JetBrains Mono, monospace",fontSize:"0.82rem",color:e.hw_id?"inherit":"var(--text-muted, #9ca3af)"},children:e.hw_id||"\u2014"}),(0,w.jsx)("td",{style:{textAlign:"center",fontSize:"0.875rem"},children:e.model||(0,w.jsx)("span",{style:{color:"var(--text-muted, #9ca3af)"},children:"\u2014"})}),(0,w.jsx)("td",{style:{textAlign:"center"},children:e.user||"-"}),(0,w.jsx)("td",{style:{textAlign:"center"},children:e.config_version||"-"}),(0,w.jsx)("td",{style:{textAlign:"center"},children:(()=>{if(!e.provisioned_at)return"N/A";const t=new Date(e.provisioned_at);return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString()})()}),(0,w.jsxs)("td",{style:{textAlign:"center"},children:[(0,w.jsx)("button",{onClick:t=>{t.stopPropagation(),Ue(e)},style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-secondary, #94a3b8)",margin:"0 6px"},title:"Edit",children:(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,w.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,w.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,w.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{Re.openModal(e)})(e)},style:{background:"none",border:"none",cursor:"pointer",color:"var(--danger-color, #ef4444)",margin:"0 6px"},title:"Delete",children:(0,w.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,w.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,w.jsx)("path",{d:"M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"}),(0,w.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,w.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]},e.id))})]}),Z>0&&(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",borderTop:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",gap:"16px"},children:[(0,w.jsxs)("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary, #94a3b8)"},children:["Showing ",(P-1)*E+1," - ",Math.min(P*E,Z)," of ",Z," devices"]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,w.jsx)("button",{onClick:()=>O(Math.max(1,P-1)),disabled:1===P,style:{padding:"8px 12px",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"6px",background:1===P?"rgba(148, 163, 184, 0.1)":"transparent",color:"var(--text-primary, #f8fafc)",cursor:1===P?"not-allowed":"pointer",opacity:1===P?"0.5":"1"},children:"\u2190 Previous"}),(0,w.jsx)("div",{style:{display:"flex",gap:"4px",alignItems:"center"},children:(()=>{const e=[];for(let r=1;r<=q;r++){var t;1===r||r===q||Math.abs(r-P)<=1?e.push((0,w.jsx)("button",{onClick:()=>O(r),style:{padding:"6px 10px",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"4px",background:r===P?"rgba(99, 102, 241, 0.2)":"transparent",color:"var(--text-primary, #f8fafc)",cursor:"pointer",fontWeight:r===P?"bold":"normal",minWidth:"32px"},children:r},r)):(null===(t=e[e.length-1])||void 0===t?void 0:t.key)!=="ellipsis-"+Math.floor(r/10)&&e.push((0,w.jsx)("span",{style:{padding:"0 4px",color:"var(--text-secondary, #94a3b8)"},children:"..."},"ellipsis-".concat(Math.floor(r/10))))}return e})()}),(0,w.jsx)("button",{onClick:()=>O(Math.min(q,P+1)),disabled:P===q,style:{padding:"8px 12px",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.2))",borderRadius:"6px",background:P===q?"rgba(148, 163, 184, 0.1)":"transparent",color:"var(--text-primary, #f8fafc)",cursor:P===q?"not-allowed":"pointer",opacity:P===q?"0.5":"1"},children:"Next \u2192"})]}),(0,w.jsxs)("select",{value:E,onChange:e=>{H(parseInt(e.target.value)),O(1)},style:{padding:"8px",border:r?"1px solid #404040":"1px solid rgba(148, 163, 184, 0.2)",borderRadius:"6px",background:r?"#1a1a1a":"#0f172a",color:r?"#e0e0e0":"#f8fafc",cursor:"pointer",fontSize:"0.875rem"},children:[(0,w.jsx)("option",{value:10,children:"10 per page"}),(0,w.jsx)("option",{value:25,children:"25 per page"}),(0,w.jsx)("option",{value:50,children:"50 per page"}),(0,w.jsx)("option",{value:100,children:"100 per page"})]})]})]}),(y||k)&&(0,w.jsx)("div",{className:"modal",children:(0,w.jsxs)("div",{className:"modal-content",children:[(0,w.jsx)("h3",{children:y?"Edit Device: ".concat(y.device_serial):"Register New Device"}),(0,w.jsxs)("form",{onSubmit:e=>{e.preventDefault(),y?Je():Ze()},children:[(0,w.jsxs)("div",{className:"modal-body",children:[(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Device Identity"}),(0,w.jsx)("div",{className:"form-grid",children:(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Device Serial Number"}),(0,w.jsx)("input",{type:"text",value:y?he.device_serial:be.device_serial,onChange:e=>y?fe((0,i.A)((0,i.A)({},he),{},{device_serial:e.target.value})):ye((0,i.A)((0,i.A)({},be),{},{device_serial:e.target.value})),required:!0,autoComplete:"off",placeholder:"SN-12345678",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]})})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Ownership & Assignment"}),(0,w.jsx)("div",{className:"form-grid",children:(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Assigned User"}),(0,w.jsxs)("div",{style:{position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("input",{type:"text",placeholder:"Search and select user...",value:N,onChange:e=>{D(e.target.value),W(!0)},onFocus:()=>W(!0),autoComplete:"off",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}}),(y?he.user:be.user)&&(0,w.jsxs)("div",{style:{marginTop:"8px",fontSize:"0.875rem",color:r?"#b0b0b0":"#94a3b8"},children:[(0,w.jsx)("strong",{children:"Selected:"})," ",null===(e=T.find(e=>e.username===(y?he.user:be.user)))||void 0===e?void 0:e.first_name," ",null===(t=T.find(e=>e.username===(y?he.user:be.user)))||void 0===t?void 0:t.last_name," (",y?he.user:be.user,")",(0,w.jsx)("button",{type:"button",onClick:()=>{y?fe((0,i.A)((0,i.A)({},he),{},{user:""})):ye((0,i.A)((0,i.A)({},be),{},{user:""})),D("")},className:"btn-icon btn-icon-danger",style:{marginLeft:"10px"},title:"Remove Assignment",children:"\u2715"})]}),F&&(0,w.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--bg-secondary, #0f172a)",border:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",borderRadius:"8px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"var(--shadow-xl)",marginTop:"4px"},children:A.length>0?A.map(e=>(0,w.jsxs)("div",{onClick:()=>{y?fe((0,i.A)((0,i.A)({},he),{},{user:e.username})):ye((0,i.A)((0,i.A)({},be),{},{user:e.username})),D("".concat(e.first_name," ").concat(e.last_name," (").concat(e.username,")")),W(!1)},style:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid var(--border-color, rgba(148, 163, 184, 0.1))",background:(y?he.user:be.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",color:"var(--text-primary, #f8fafc)",transition:"all 0.15s ease",fontSize:"0.875rem"},onMouseEnter:e=>e.currentTarget.style.background="rgba(255, 255, 255, 0.06)",onMouseLeave:t=>t.currentTarget.style.background=(y?he.user:be.user)===e.username?"rgba(99, 102, 241, 0.15)":"transparent",children:[e.first_name," ",e.last_name," (",e.username,") ",(0,w.jsx)("br",{}),(0,w.jsx)("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary, #94a3b8)"},children:e.email})]},e.id)):(0,w.jsx)("div",{style:{padding:"12px 16px",color:"var(--text-muted, #64748b)",fontSize:"0.875rem"},children:""===N.trim()?"Start typing to search users...":"No users found"})})]})]})})]}),(0,w.jsxs)("div",{className:"form-section",children:[(0,w.jsx)("h4",{className:"form-section-title",children:"Configuration"}),(0,w.jsxs)("div",{className:"form-grid form-grid-2",children:[(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Preset Template"}),(0,w.jsxs)("select",{value:y?he.config_version:be.config_version,onChange:e=>y?fe((0,i.A)((0,i.A)({},he),{},{config_version:e.target.value})):ye((0,i.A)((0,i.A)({},be),{},{config_version:e.target.value})),className:"full-width",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"},children:[(0,w.jsx)("option",{value:"",children:"-- Manual Configuration --"}),ee&&(0,w.jsx)("option",{value:"",disabled:!0,children:"Loading presets..."}),!ee&&X.map(e=>(0,w.jsxs)("option",{value:et(e),children:[e.name," (",et(e)||"no ID",")"]},e.id))]}),(0,w.jsx)("small",{className:"form-hint",children:"Selecting a preset sets the Config Version ID below."})]}),(0,w.jsxs)("div",{className:"form-group",children:[(0,w.jsx)("label",{children:"Config Version ID"}),(0,w.jsx)("input",{type:"text",value:y?he.config_version:be.config_version,onChange:e=>y?fe((0,i.A)((0,i.A)({},he),{},{config_version:e.target.value})):ye((0,i.A)((0,i.A)({},be),{},{config_version:e.target.value})),autoComplete:"off",placeholder:"Manual Config ID",style:{background:r?"#1a1a1a":"white",color:r?"#e0e0e0":"inherit",border:r?"1px solid #404040":"1px solid #ced4da"}})]})]})]})]}),y&&(0,w.jsx)("div",{style:{padding:"0 24px"},children:(0,w.jsx)(d.A,{createdBy:y.created_by_username,createdAt:y.created_at,updatedBy:y.updated_by_username,updatedAt:y.updated_at})}),(0,w.jsxs)("div",{className:"form-actions",style:{padding:"24px"},children:[(0,w.jsx)("button",{type:"submit",className:"btn",children:y?"Save Changes":"Register Device"}),(0,w.jsx)("button",{type:"button",onClick:Xe,className:"btn btn-secondary",children:"Cancel"})]})]})]})}),(0,w.jsx)(U,{open:Ie.open,onClose:Ie.closeModal,title:"Confirm Reboot",id:"reboot-modal-title-list",children:Ie.data&&(0,w.jsxs)("div",{className:"modal-reboot-content",children:[(0,w.jsxs)("p",{className:"modal-reboot-message",children:["Are you sure you want to reboot device ",(0,w.jsx)("strong",{children:Ie.data.device_serial}),"?"]}),(0,w.jsxs)("div",{className:"modal-warning-box modal-reboot-note",children:[(0,w.jsx)("strong",{children:"\u2139\ufe0f Note:"})," The device will restart on its next heartbeat. Any unsaved data may be lost."]}),(0,w.jsxs)("div",{className:"modal-actions",children:[(0,w.jsx)("button",{type:"button",className:"btn-secondary",onClick:Ie.closeModal,children:"Cancel"}),(0,w.jsx)("button",{type:"button",className:"btn-primary",onClick:Ve,children:"Confirm Reboot"})]})]})}),Me.show&&Me.device&&(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:(0,w.jsxs)("div",{style:{background:r?"#2d2d2d":"white",borderRadius:"16px",padding:"2rem",maxWidth:"500px",width:"90%",boxShadow:r?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:"2px solid #dc3545",animation:"slideIn 0.2s ease-out"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[(0,w.jsx)("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",animation:"pulse 2s infinite"},children:"\u26a0\ufe0f"}),(0,w.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",margin:0,color:"#dc3545"},children:"Hard Reset Warning"})]}),(0,w.jsxs)("div",{style:{marginBottom:"1.5rem",color:r?"#b0b0b0":"#495057",lineHeight:"1.6"},children:[(0,w.jsxs)("div",{style:{background:r?"rgba(220, 53, 69, 0.1)":"#f8d7da",border:r?"1px solid rgba(220, 53, 69, 0.3)":"1px solid #f5c6cb",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",color:r?"#ff9999":"#721c24"},children:[(0,w.jsx)("strong",{style:{fontSize:"1.05rem"},children:"\u26a0\ufe0f CRITICAL WARNING"}),(0,w.jsxs)("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem"},children:["This action will ",(0,w.jsx)("strong",{children:"erase all device configuration"})," and restart the device to factory settings."]})]}),(0,w.jsxs)("p",{style:{marginBottom:"0.75rem"},children:["Device to reset: ",(0,w.jsx)("strong",{style:{color:r?"#e0e0e0":"#2c3e50"},children:Me.device.device_serial})]}),(0,w.jsxs)("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[(0,w.jsx)("li",{children:"All configuration will be lost"}),(0,w.jsx)("li",{children:"Device will return to factory defaults"}),(0,w.jsx)("li",{children:"Re-provisioning will be required"})]})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[(0,w.jsx)("button",{onClick:()=>Le({show:!1,device:null}),style:{background:r?"#3a3a3a":"#e0e0e0",color:r?"#e0e0e0":"#495057",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.background=r?"#4a4a4a":"#d0d0d0",onMouseOut:e=>e.currentTarget.style.background=r?"#3a3a3a":"#e0e0e0",children:"Cancel"}),(0,w.jsx)("button",{onClick:qe,style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(220, 53, 69, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.transform="translateY(-1px)",onMouseOut:e=>e.currentTarget.style.transform="translateY(0)",children:"Yes, Hard Reset"})]})]})}),(0,w.jsx)(U,{open:Re.open,onClose:Re.closeModal,title:"Delete Device Permanently",id:"delete-modal-title-list",children:Re.data&&(0,w.jsxs)("div",{className:"modal-delete-content",children:[(0,w.jsxs)("div",{className:"modal-warning-box",children:[(0,w.jsx)("strong",{children:"\u26a0\ufe0f PERMANENT DELETION"}),(0,w.jsx)("p",{children:"This action cannot be undone. All device data will be permanently deleted."})]}),(0,w.jsxs)("p",{children:["Device to delete: ",(0,w.jsx)("strong",{children:Re.data.device_serial})]}),(0,w.jsxs)("ul",{className:"modal-consequences-list",children:[(0,w.jsx)("li",{children:"All telemetry data will be lost"}),(0,w.jsx)("li",{children:"All command history will be deleted"}),(0,w.jsx)("li",{children:"Device must be re-provisioned to use again"})]}),(0,w.jsxs)("div",{className:"modal-actions",children:[(0,w.jsx)("button",{type:"button",className:"btn-secondary",onClick:Re.closeModal,children:"Cancel"}),(0,w.jsx)("button",{type:"button",className:"btn-danger",onClick:Qe,children:"Yes, Delete Permanently"})]})]})}),Oe.show&&(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)"},children:(0,w.jsx)("div",{style:{background:r?"#2d2d2d":"white",borderRadius:"16px",padding:"2rem",maxWidth:"450px",width:"90%",boxShadow:r?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:r?"1px solid #28a745":"2px solid #28a745",animation:"slideIn 0.2s ease-out"},children:(0,w.jsxs)("div",{style:{textAlign:"center"},children:[(0,w.jsx)("div",{style:{width:"64px",height:"64px",borderRadius:"50%",background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",margin:"0 auto 1rem",animation:"scaleIn 0.3s ease-out"},children:"\u2713"}),(0,w.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",marginBottom:"1rem",color:r?"#e0e0e0":"#2c3e50"},children:"Command Queued"}),(0,w.jsx)("p",{style:{color:r?"#b0b0b0":"#495057",lineHeight:"1.6",marginBottom:"1.5rem"},children:Oe.message}),(0,w.jsx)("button",{onClick:()=>Ee({show:!1,message:""}),style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",color:"white",border:"none",padding:"0.75rem 2rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 12px rgba(40, 167, 69, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.transform="translateY(-1px)",onMouseOut:e=>e.currentTarget.style.transform="translateY(0)",children:"Got it!"})]})})}),Be.show&&(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:(0,w.jsxs)("div",{style:{background:r?"#2d2d2d":"white",borderRadius:"16px",padding:"2rem",maxWidth:"520px",width:"90%",boxShadow:r?"0 20px 60px rgba(0,0,0,0.6)":"0 20px 60px rgba(0,0,0,0.3)",border:"2px solid #7f1d1d",animation:"slideIn 0.2s ease-out"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[(0,w.jsx)("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:"linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",animation:"pulse 2s infinite"},children:"\ud83d\uddd1\ufe0f"}),(0,w.jsxs)("h3",{style:{fontSize:"1.5rem",fontWeight:"600",margin:0,color:"#7f1d1d"},children:["Delete ",Be.deviceList.length," Device",1!==Be.deviceList.length?"s":""," Permanently"]})]}),(0,w.jsxs)("div",{style:{marginBottom:"1.5rem",color:r?"#b0b0b0":"#495057",lineHeight:"1.6"},children:[(0,w.jsxs)("div",{style:{background:r?"rgba(127, 29, 29, 0.1)":"#fee2e2",border:r?"1px solid rgba(127, 29, 29, 0.3)":"1px solid #fecaca",borderRadius:"8px",padding:"1rem",marginBottom:"1rem",color:r?"#fca5a5":"#991b1b"},children:[(0,w.jsx)("strong",{style:{fontSize:"1.05rem"},children:"\u26a0\ufe0f PERMANENT DELETION"}),(0,w.jsxs)("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem"},children:["This action ",(0,w.jsx)("strong",{children:"cannot be undone"}),". All data for these devices will be permanently deleted."]})]}),(0,w.jsx)("p",{style:{marginBottom:"0.5rem"},children:"Devices to delete:"}),(0,w.jsx)("ul",{style:{margin:"0",paddingLeft:"1.5rem",fontSize:"0.9rem",maxHeight:"120px",overflowY:"auto"},children:Be.deviceList.map(e=>(0,w.jsx)("li",{style:{color:r?"#e0e0e0":"#2c3e50",fontWeight:"600"},children:e.device_serial},e.id))})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[(0,w.jsx)("button",{onClick:()=>Pe({show:!1,deviceList:[]}),style:{background:r?"#3a3a3a":"#e0e0e0",color:r?"#e0e0e0":"#495057",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},children:"Cancel"}),(0,w.jsx)("button",{onClick:async()=>{try{B(!0),await o.K.deleteDevicesBulk(Array.from(R));const e=m.filter(e=>!R.has(e.id));p(e),x(e.filter(e=>e.device_serial.toLowerCase().includes(S.toLowerCase()))),M(new Set),Pe({show:!1,deviceList:[]}),B(!1)}catch(e){B(!1),Pe({show:!1,deviceList:[]}),console.error("Bulk delete error:",e),b(e instanceof Error?e.message:"Failed to delete devices")}},disabled:L,style:{background:"linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%)",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",fontSize:"0.95rem",fontWeight:"600",cursor:L?"not-allowed":"pointer",boxShadow:"0 4px 12px rgba(127, 29, 29, 0.3)",transition:"all 0.2s",opacity:L?.7:1},children:L?"Deleting\u2026":"Yes, Delete All"})]})]})})]})}},7315(e,t,r){r.d(t,{p:()=>a});r(5043);var i=r(579);const n=()=>(0,i.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})}),a=e=>{let{icon:t,title:r,description:a,action:o}=e;return(0,i.jsxs)("div",{className:"empty-state",children:[(0,i.jsx)("div",{className:"empty-state-icon",children:null!==t&&void 0!==t?t:(0,i.jsx)(n,{})}),(0,i.jsx)("p",{className:"empty-state-title",children:r}),a&&(0,i.jsx)("p",{className:"empty-state-desc",children:a}),o&&(0,i.jsxs)("button",{className:"empty-state-cta",onClick:o.onClick,children:[(0,i.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2.5,children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),o.label]})]})}}}]);
//# sourceMappingURL=841.256c64d8.chunk.js.map